import{c as U,a as A,j as e}from"./index-BZrmoCkK.js";import{b as Y,r as j}from"./vendor-D4VeuP1H.js";import{s as L,e as P}from"./index-9LsBhEVl.js";import{p as D}from"./index-C6_7Odsa.js";import{r as _,t as b,a as q,f as y,C as G}from"./index-ClSPVA2p.js";import{A as H}from"./alert-circle-C34a3HRN.js";import{s as B,e as K}from"./index-B1nhvpRK.js";import{C as V}from"./chevron-right-CEKXESD7.js";import{M as J}from"./map-pin-CpISn9oH.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=U("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=U("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);function z(s,l){_(2,arguments);var n=b(s),a=q(l);if(isNaN(a))return new Date(NaN);if(!a)return n;var d=n.getDate(),c=new Date(n.getTime());c.setMonth(n.getMonth()+a+1,0);var t=c.getDate();return d>=t?c:(n.setFullYear(c.getFullYear(),c.getMonth(),d),n)}function I(s){_(1,arguments);var l=b(s);return l.setHours(0,0,0,0),l}function W(s,l){_(2,arguments);var n=I(s),a=I(l);return n.getTime()===a.getTime()}function X(s,l){var n;_(1,arguments);var a=s||{},d=b(a.start),c=b(a.end),t=c.getTime();if(!(d.getTime()<=t))throw new RangeError("Invalid interval");var u=[],f=d;f.setHours(0,0,0,0);var v=Number((n=void 0)!==null&&n!==void 0?n:1);if(v<1||isNaN(v))throw new RangeError("`options.step` must be a number greater than 1");for(;f.getTime()<=t;)u.push(b(f)),f.setDate(f.getDate()+v),f.setHours(0,0,0,0);return u}function Z(s,l){_(2,arguments);var n=b(s),a=b(l);return n.getFullYear()===a.getFullYear()&&n.getMonth()===a.getMonth()}function ee(s){return _(1,arguments),W(s,Date.now())}function me(){const s=Y(),[l,n]=j.useState({draft_events:0,published_events:0,completed_events:0,total_workers:0,gaps_to_fill:0,urgent_events:0,month_events:0}),[a,d]=j.useState(new Date),[c,t]=j.useState([]),[u,f]=j.useState([]),[v,k]=j.useState(!0);j.useEffect(()=>{S()},[a]);async function S(){k(!0);try{const x=await A.get("/dashboard");if(x.data.status==="success"){const i=x.data.data;n({draft_events:i.draft_events,published_events:i.published_events,completed_events:i.completed_events,total_workers:i.total_workers,gaps_to_fill:i.gaps_to_fill,urgent_events:i.urgent_events,month_events:i.month_events});const N=await A.get("/events");if(N.data.status==="success"){const M=N.data.data,w=L(a),p=P(a),C=M.filter(r=>r.status==="published"),h={};C.forEach(r=>{if(!r.schedule)return;const m=D(r.schedule.start_time_utc);if(m>=w&&m<=p){const g=y(m,"yyyy-MM-dd");h[g]||(h[g]={date:m,status:"fully_staffed",events:[],shifts_count:0,needs_workers_count:0}),h[g].events.push({id:r.id,title:r.title,unfilled_roles_count:r.unfilled_roles_count||0,staffing_status:r.staffing_status}),h[g].shifts_count+=r.total_shifts_count||0,r.staffing_status==="needs_workers"?h[g].status="needs_workers":r.staffing_status==="partially_staffed"&&h[g].status!=="needs_workers"&&(h[g].status="partially_staffed")}}),Object.values(h).forEach(r=>{r.needs_workers_count=r.events.reduce((m,g)=>m+(g.unfilled_roles_count||0),0)}),t(Object.values(h));const R=C.filter(r=>!r.schedule||(r.unfilled_roles_count||0)===0?!1:D(r.schedule.start_time_utc)>=new Date).map(r=>{const m=D(r.schedule.start_time_utc),g=Math.ceil((m.getTime()-new Date().getTime())/(1e3*60*60*24));return{...r,days_until:g}}).sort((r,m)=>r.days_until!==m.days_until?r.days_until-m.days_until:r.staffing_percentage-m.staffing_percentage).slice(0,5);f(R)}}}catch(x){console.error("Failed to load dashboard data:",x)}finally{k(!1)}}const T=()=>{d(z(a,-1))},O=()=>{d(z(a,1))},$=()=>{d(new Date)},o=x=>{const i=y(x,"yyyy-MM-dd");s(`/events?tab=active&date=${i}&filter=needs_workers`)};return v?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600"})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Overview of events and staffing needs"})]}),e.jsx("button",{onClick:()=>s("/events/create"),className:"px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Create New Event"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsx(E,{label:"Draft Events",value:l.draft_events,onClick:()=>s("/events?tab=draft"),color:"gray"}),e.jsx(E,{label:"Active Events",value:l.published_events,onClick:()=>s("/events?tab=active"),color:"blue"}),e.jsx(E,{label:"Completed Events",value:l.completed_events,onClick:()=>s("/events?tab=completed"),color:"green"}),e.jsx(E,{label:"Unfilled Roles",value:l.gaps_to_fill,onClick:()=>s("/events?tab=active&filter=needs_workers"),color:"red",isHero:!0})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6 mb-8",children:e.jsx(te,{currentMonth:a,calendarData:c,onPreviousMonth:T,onNextMonth:O,onToday:$,onDayClick:o})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200",children:e.jsx(se,{events:u,onEventClick:x=>s(`/events?tab=active&event_id=${x}`)})})]})})}function E({label:s,value:l,onClick:n,color:a,isHero:d}){const c={gray:"bg-white hover:border-gray-300",blue:"bg-white hover:border-blue-300",green:"bg-white hover:border-green-300",red:d?"bg-red-50 border-red-200 hover:border-red-300":"bg-white hover:border-red-300"},t={gray:"text-gray-900",blue:"text-blue-900",green:"text-green-900",red:"text-red-900"},u={gray:"text-gray-600",blue:"text-blue-600",green:"text-green-600",red:d?"text-red-700":"text-red-600"};return e.jsxs("button",{onClick:n,className:`relative overflow-hidden rounded-lg border p-6 transition-all duration-200 text-left ${c[a]} hover:shadow-lg`,children:[d&&l>5&&e.jsxs("div",{className:"absolute top-0 right-0 w-3 h-3 m-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-red-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`text-sm font-medium mb-1 ${u[a]}`,children:s}),e.jsx("span",{className:`text-4xl font-bold ${t[a]}`,children:l})]}),d&&l>0&&e.jsxs("div",{className:"mt-3 flex items-center gap-1 text-sm font-medium text-red-600",children:[e.jsx(H,{size:16}),e.jsx("span",{children:"Requires attention"})]}),!d&&e.jsxs("div",{className:"mt-3 flex items-center gap-1 text-sm font-medium text-gray-500",children:[e.jsx("span",{children:"View all"}),e.jsx(F,{size:16})]})]})}function te({currentMonth:s,calendarData:l,onPreviousMonth:n,onNextMonth:a,onToday:d,onDayClick:c}){const t=L(s),u=P(s),f=B(t,{weekStartsOn:0}),v=K(u,{weekStartsOn:0}),k=X({start:f,end:v}),S=o=>l.find(x=>W(x.date,o)),T=o=>{switch(o){case"fully_staffed":return"âœ“";case"partially_staffed":return"ðŸŸ¡";case"needs_workers":return"ðŸ”´";default:return null}},O=o=>{switch(o){case"fully_staffed":return"bg-green-50 border-green-200";case"partially_staffed":return"bg-yellow-50 border-yellow-200";case"needs_workers":return"bg-red-50 border-red-200";default:return""}},$=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:y(s,"MMMM yyyy")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:n,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Previous month",children:e.jsx(Q,{size:20})}),e.jsx("button",{onClick:d,className:"px-3 py-1.5 text-sm font-medium text-teal-600 hover:bg-teal-50 rounded-lg transition",children:"Today"}),e.jsx("button",{onClick:a,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Next month",children:e.jsx(V,{size:20})})]})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[$.map(o=>e.jsx("div",{className:"text-center text-sm font-medium text-gray-600 py-2",children:o},o)),k.map((o,x)=>{const i=S(o),N=Z(o,s),M=ee(o),w=i&&i.events.length>0;return e.jsxs("button",{onClick:()=>w&&c(o),disabled:!w,className:`
                relative min-h-[80px] p-2 rounded-lg border transition-all text-left
                ${M?"border-teal-500 bg-teal-50 ring-2 ring-teal-200":w?`${O(i.status)} hover:shadow-md cursor-pointer`:"border-gray-100 bg-white"}
                ${N?"":"opacity-40"}
              `,children:[e.jsx("div",{className:`text-sm font-medium mb-1 ${M?"text-teal-600":N?"text-gray-900":"text-gray-400"}`,children:y(o,"d")}),i&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-2xl text-center",children:T(i.status)}),i.events.length>0&&e.jsxs("div",{className:"space-y-1",children:[i.events.slice(0,2).map((p,C)=>e.jsxs("div",{onClick:h=>{h.stopPropagation();const R=y(o,"yyyy-MM-dd");navigate(`/events?tab=active&event_id=${p.id}&date=${R}`)},className:"text-xs p-1 bg-white/80 rounded cursor-pointer hover:bg-white hover:shadow-sm transition-all truncate",title:`${p.title} (${p.unfilled_roles_count} unfilled)`,children:[p.title,p.unfilled_roles_count>0&&e.jsxs("span",{className:"ml-1 text-red-600 font-medium",children:["(-",p.unfilled_roles_count,")"]})]},C)),i.events.length>2&&e.jsxs("div",{className:"text-xs text-center text-gray-500",children:["+",i.events.length-2," more"]})]}),i.needs_workers_count>0&&e.jsxs("div",{className:"text-xs text-center font-medium text-red-600",children:["-",i.needs_workers_count," total unfilled"]})]})]},x)})]}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-6 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-xl",children:"âœ“"}),e.jsx("span",{className:"text-gray-600",children:"Ready"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-xl",children:"ðŸŸ¡"}),e.jsx("span",{className:"text-gray-600",children:"Partial"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-xl",children:"ðŸ”´"}),e.jsx("span",{className:"text-gray-600",children:"Needs Workers"})]})]})]})}function se({events:s,onEventClick:l}){const n=(t,u)=>t<=3||u===0?e.jsx("span",{className:"px-2.5 py-1 bg-red-100 text-red-700 text-xs font-bold rounded-full",children:"ðŸ”´ URGENT"}):t<=7||u<50?e.jsx("span",{className:"px-2.5 py-1 bg-orange-100 text-orange-700 text-xs font-bold rounded-full",children:"âš ï¸ HIGH"}):e.jsx("span",{className:"px-2.5 py-1 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full",children:"âš ï¸ MEDIUM"}),a=t=>{const u=D(t);return y(u,"EEE, MMM d")},d=t=>{const u=D(t);return y(u,"h:mm a")},c=t=>t===0?"Today":t===1?"Tomorrow":`in ${t} days`;return s.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽ‰"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"All Caught Up!"}),e.jsx("p",{className:"text-gray-600",children:"No urgent staffing needs at the moment. Great work!"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"âš ï¸ Needs Your Attention"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[s.length," event",s.length!==1?"s":""," need",s.length===1?"s":""," workers â€¢ Sorted by urgency"]})]}),e.jsx("div",{className:"divide-y divide-gray-200",children:s.map(t=>e.jsx("div",{className:"px-6 py-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n(t.days_until,t.staffing_percentage),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:a(t.schedule.start_time_utc)}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",c(t.days_until),")"]})]}),e.jsx("h4",{className:"text-base font-semibold text-gray-900 mb-1",children:t.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(J,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"truncate",children:t.venue.name})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(G,{size:14,className:"text-gray-400"}),e.jsxs("span",{children:[d(t.schedule.start_time_utc)," - ",d(t.schedule.end_time_utc)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs("span",{className:"font-medium text-red-600",children:[t.unfilled_roles_count," role",t.unfilled_roles_count!==1?"s":""," still needed"]}),e.jsx("span",{className:"text-gray-400",children:"â€¢"}),e.jsxs("span",{className:"text-gray-600",children:[t.staffing_percentage,"% staffed"]})]})]}),e.jsxs("button",{onClick:()=>l(t.id),className:"px-4 py-2 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors whitespace-nowrap flex items-center gap-2",children:["Assign Workers",e.jsx(F,{size:16})]})]})},t.id))})]})}export{me as DashboardPage};
