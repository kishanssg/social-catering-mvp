import{c as je,a as A,j as e,C as ne}from"./index-CXNffjfI.js";import{r as d,b as Ne,f as ve}from"./vendor-D4VeuP1H.js";import{X as R,T as we}from"./Toast-D1zbuwiD.js";import{C as Q,f as O}from"./index-EgS3nfz4.js";import{M as B}from"./map-pin-CnPWTA3Y.js";import{U as G}from"./users-DRyBgNID.js";import{A as ee}from"./alert-circle-CJ9loY1Z.js";import{S as te,A as _e,C as Z,T as de}from"./ConfirmationModal-Bn2eXkLA.js";import{p as $}from"./index-CU-i3wyh.js";import{C as ke}from"./x-circle-DrL3bgR8.js";import{P as oe}from"./plus-CQBTC3UL.js";import{C as H}from"./calendar-B-Zi434T.js";import{P as Ce}from"./pen-square-C0pnWQUS.js";import{C as ce}from"./chevron-down-CJV72iCR.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=je("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);function Se({shiftId:b,onClose:j,onSuccess:F}){var D,p;const[r,E]=d.useState(null),[C,i]=d.useState([]),[l,x]=d.useState([]),[S,h]=d.useState(""),[N,t]=d.useState(null),[z,o]=d.useState(!0),[_,P]=d.useState(!1),[n,v]=d.useState(null);d.useEffect(()=>{V()},[b]),d.useEffect(()=>{r&&c()},[r]),d.useEffect(()=>{if(!S)x(C);else{const a=S.toLowerCase();x(C.filter(g=>{var y;return g.first_name.toLowerCase().includes(a)||g.last_name.toLowerCase().includes(a)||g.email.toLowerCase().includes(a)||((y=g.skills_json)==null?void 0:y.some(M=>M.toLowerCase().includes(a)))}))}},[S,C]);async function V(){try{const a=await A.get(`/shifts/${b}`);a.data.status==="success"?E(a.data.data):v("Failed to load shift details")}catch(a){console.error("Failed to load shift details:",a),v("Failed to load shift details")}}async function c(){try{const a=await A.get("/workers?active=true");if(a.data.status==="success"){const g=a.data.data.workers||a.data.data;if(r!=null&&r.role_needed){const y=g.filter(M=>{var w;return(w=M.skills_json)==null?void 0:w.includes(r.role_needed)});i(y)}else i(g)}else v("Failed to load workers")}catch(a){console.error("Failed to load workers:",a),v("Failed to load workers")}finally{o(!1)}}async function f(){var a,g,y,M;if(!(!N||!r)){P(!0),v(null);try{const L=(await A.post("/staffing",{assignment:{shift_id:r.id,worker_id:N.id,status:"assigned",assigned_at_utc:new Date().toISOString()}})).data;if(L.status==="success")F();else{const W=L.errors?L.errors.join(". "):L.message||"Failed to assign worker";v(W)}}catch(w){console.error("Failed to assign worker:",w);let L="Failed to assign worker";(g=(a=w.response)==null?void 0:a.data)!=null&&g.errors?L=w.response.data.errors.join(". "):(M=(y=w.response)==null?void 0:y.data)!=null&&M.message?L=w.response.data.message:w.message&&(L=w.message),v(L)}finally{P(!1)}}}const k=a=>{try{return O($(a),"MMM d, yyyy h:mm a")}catch{return a}},T=a=>{try{return O($(a),"h:mm a")}catch{return a}};return z?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-600"})})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Assign Worker"}),r&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[r.client_name," â€¢ ",r.role_needed]})]}),e.jsx("button",{onClick:j,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition",children:e.jsx(R,{size:20})})]}),e.jsxs("div",{className:"flex h-[600px]",children:[e.jsx("div",{className:"w-1/3 border-r border-gray-200 p-6 bg-gray-50",children:r?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Shift Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Q,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:k(r.start_time_utc)}),e.jsxs("div",{className:"text-sm text-gray-600",children:[T(r.start_time_utc)," - ",T(r.end_time_utc)]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(B,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"text-sm text-gray-900",children:r.location||((p=(D=r.event)==null?void 0:D.venue)==null?void 0:p.formatted_address)||"Location not specified"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(G,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900",children:r.role_needed}),r.required_skill&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Requires: ",r.required_skill]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Pay Rate:"})," $",r.pay_rate,"/hour"]}),r.uniform_name&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",r.uniform_name]})]}),r.notes&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Notes:"}),e.jsx("div",{className:"mt-1 whitespace-pre-line",children:r.notes.split("Uniform:").map((a,g)=>g===0?a.trim():e.jsxs("div",{children:[e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",a.trim()]},g))})]})})]})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ee,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Failed to load shift details"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search workers by name, email, or skills...",value:S,onChange:a=>h(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:n?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ee,{size:32,className:"text-red-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-red-600",children:n})]}):l.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(G,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:S?"No workers found matching your search":r!=null&&r.role_needed?`No workers found with "${r.role_needed}" skill`:"No available workers"}),(r==null?void 0:r.role_needed)&&!S&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:['Try adding "',r.role_needed,'" skill to workers or select a different shift.']})]}):e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:e.jsx("ul",{children:l.map(a=>{var y;const g=(N==null?void 0:N.id)===a.id;return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${g?"bg-teal-50":"bg-white"} cursor-pointer`,onClick:()=>t(a),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[a.first_name[0],a.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[a.first_name," ",a.last_name]}),e.jsx("div",{className:"text-xs text-gray-600",children:(y=a.skills_json)==null?void 0:y.slice(0,3).join(", ")})]})]}),g&&e.jsx("div",{className:"w-6 h-6 rounded-full bg-teal-600 flex items-center justify-center text-white",children:e.jsx(se,{size:14})})]},a.id)})})})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:[n&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-600",children:n})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:j,className:"flex-1 px-4 py-2 bg-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-400 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:f,disabled:!N||_,className:"flex-1 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:_?"Assigning...":"Assign Worker"})]})]})]})]})]})})}function Ee({isOpen:b,eventId:j,roleName:F,unfilledShiftIds:r,onClose:E,onDone:C}){const[i,l]=d.useState([]),[x,S]=d.useState([]),[h,N]=d.useState(""),[t,z]=d.useState(!1),[o,_]=d.useState(!1);d.useEffect(()=>{b&&(async()=>{var c,f,k;z(!0);try{const T=await A.get("/workers?active=true"),p=(((f=(c=T.data)==null?void 0:c.data)==null?void 0:f.workers)||((k=T.data)==null?void 0:k.data)||[]).filter(a=>(a.skills_json||[]).includes(F));l(p)}finally{z(!1)}})()},[b,F]);const P=d.useMemo(()=>{const c=h.trim().toLowerCase(),f=i;return c?f.filter(k=>`${k.first_name} ${k.last_name}`.toLowerCase().includes(c)||(k.email||"").toLowerCase().includes(c)):f},[i,h]),n=r.length,v=c=>{S(f=>f.includes(c)?f.filter(k=>k!==c):f.length>=n?f:[...f,c])},V=async()=>{var k;if(x.length===0||n===0)return;_(!0);let c=0,f=0;try{const T=x.map(a=>i.find(g=>g.id===a)).filter(Boolean),D=[...r];let p=0;for(;D.length>0&&T.length>0;){const a=T[p%T.length],g=D.shift();try{((k=(await A.post("/staffing",{assignment:{shift_id:g,worker_id:a.id,status:"assigned",assigned_at_utc:new Date().toISOString()}})).data)==null?void 0:k.status)==="success"?c+=1:f+=1}catch{f+=1}p+=1}C({assigned:c,conflicts:f})}finally{_(!1)}};return b?e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[10000] flex items-center justify-center p-4",onClick:c=>{c.target===c.currentTarget&&E()},children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-3xl w-full overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-5 border-b border-gray-100",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["Quick Fill â€” ",F]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Unfilled shifts: ",n]})]}),e.jsx("button",{onClick:E,className:"w-8 h-8 rounded-lg hover:bg-gray-100 flex items-center justify-center text-gray-500",children:e.jsx(R,{size:18})})]}),e.jsxs("div",{className:"px-6 py-5 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(te,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{value:h,onChange:c=>N(c.target.value),placeholder:"Search eligible workersâ€¦",className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsx("div",{className:"max-h-[340px] overflow-y-auto border border-gray-200 rounded-lg",children:t?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loadingâ€¦"}):P.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"No eligible workers"}):e.jsx("ul",{children:P.map(c=>{const f=x.includes(c.id);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${f?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[c.first_name[0],c.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[c.first_name," ",c.last_name]}),e.jsx("div",{className:"text-xs text-gray-600",children:(c.skills_json||[]).slice(0,3).join(", ")})]})]}),e.jsx("button",{onClick:()=>v(c.id),disabled:!f&&x.length>=n,className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${f?"bg-teal-600 text-white border-teal-600":x.length>=n?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:f?"Selected":"Select"})]},c.id)})})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(ke,{size:16,className:"text-teal-600"}),e.jsxs("span",{children:["Will assign ",e.jsx("strong",{children:Math.min(x.length,n)})," worker",Math.min(x.length,n)!==1?"s":""," to ",n," shift",n!==1?"s":"","."]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(_e,{size:14,className:"text-yellow-600"}),"Conflicts and already-filled shifts will be skipped automatically."]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 px-6 py-5 bg-gray-50",children:[e.jsx("button",{onClick:E,className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100",children:"Cancel"}),e.jsx("button",{onClick:V,disabled:o||x.length===0||n===0,className:"px-5 py-2 rounded-lg bg-teal-600 text-white font-semibold hover:bg-teal-700 disabled:opacity-50",children:o?"Assigningâ€¦":`Assign to ${n} shifts`})]})]})}):null}function Be(){const b=Ne(),[j,F]=ve(),r=(j.get("tab")==="completed"?"completed":j.get("tab"))||"active",E=j.get("filter")||"all",C=j.get("date")||"",[i,l]=d.useState(r),[x,S]=d.useState(E),[h,N]=d.useState(C),[t,z]=d.useState(""),[o,_]=d.useState("date"),[P,n]=d.useState(!0),[v,V]=d.useState([]),[c,f]=d.useState(new Set),[k,T]=d.useState({isOpen:!1}),[D,p]=d.useState({isVisible:!1,message:"",type:"success"}),[a,g]=d.useState({isOpen:!1,isLoading:!1}),[y,M]=d.useState({isOpen:!1,isLoading:!1}),[w,L]=d.useState({isOpen:!1,isLoading:!1}),[W,X]=d.useState({isOpen:!1,unfilledShiftIds:[]});d.useEffect(()=>{U()},[i,x]),d.useEffect(()=>{const s=j.get("event_id"),m=j.get("shift_id");if(s){const u=parseInt(s);isNaN(u)||(f(new Set([u])),m&&console.log(`Auto-expanding event ${u} with shift ${m}`))}},[j]);async function U(){n(!0);try{const m=`/events?tab=${i==="completed"?"completed":i}${x!=="all"?`&filter=${x}`:""}`,u=await A.get(m);u.data.status==="success"&&V(u.data.data)}catch(s){console.error("Failed to load events:",s)}finally{n(!1)}}const J=s=>{l(s),F({tab:s}),S("all")},q=s=>{S(s)},ae=s=>{const m=new Set(c);m.has(s)?m.delete(s):m.add(s),f(m)};async function re(s){const m=v==null?void 0:v.find(u=>u.id===s);L({isOpen:!0,isLoading:!1,eventId:s,eventTitle:m==null?void 0:m.title})}async function me(){if(w.eventId){L(s=>({...s,isLoading:!0}));try{const s=await A.delete(`/events/${w.eventId}`);s.data.status==="success"?(L({isOpen:!1,isLoading:!1}),p({isVisible:!0,message:"Event deleted successfully",type:"success"}),U()):p({isVisible:!0,message:s.data.message||"Failed to delete event",type:"error"})}catch(s){console.error("Failed to delete event:",s),p({isVisible:!0,message:"Failed to delete event",type:"error"})}finally{L(s=>({...s,isLoading:!1}))}}}function xe(){L({isOpen:!1,isLoading:!1})}function ie(s){g({isOpen:!0,eventId:s,isLoading:!1})}async function ge(){if(a.eventId){g(s=>({...s,isLoading:!0}));try{const s=await A.post(`/events/${a.eventId}/publish`);s.data.status==="success"?(p({isVisible:!0,message:s.data.message||"Event published",type:"success"}),g({isOpen:!1,isLoading:!1}),U()):(p({isVisible:!0,message:s.data.message||"Failed to publish event",type:"error"}),g({isOpen:!1,isLoading:!1}))}catch(s){console.error("Failed to publish event:",s),p({isVisible:!0,message:"Failed to publish event",type:"error"}),g({isOpen:!1,isLoading:!1})}}}function fe(){g({isOpen:!1,isLoading:!1})}function ue(s,m){M({isOpen:!0,assignmentId:s,isLoading:!1,workerName:m})}async function he(){var s,m;if(y.assignmentId){M(u=>({...u,isLoading:!0}));try{const u=await A.delete(`/staffing/${y.assignmentId}`);((s=u.data)==null?void 0:s.status)==="success"?(p({isVisible:!0,message:"Worker unassigned",type:"success"}),M({isOpen:!1,isLoading:!1}),U()):(p({isVisible:!0,message:((m=u.data)==null?void 0:m.message)||"Failed to unassign worker",type:"error"}),M({isOpen:!1,isLoading:!1}))}catch(u){console.error("Failed to unassign worker:",u),p({isVisible:!0,message:"Failed to unassign worker",type:"error"}),M({isOpen:!1,isLoading:!1})}}}const pe=s=>{T({isOpen:!0,shiftId:s})},le=()=>{T({isOpen:!1})},ye=()=>{le(),p({isVisible:!0,message:"Worker assigned successfully",type:"success"}),U()},K=v.filter(s=>{var m,u;if(t){const I=t.toLowerCase();if(!(s.title.toLowerCase().includes(I)||((m=s.venue)==null?void 0:m.name.toLowerCase().includes(I))))return!1}if(h){const I=(u=s.schedule)==null?void 0:u.start_time_utc;if(!I||O($(I),"yyyy-MM-dd")!==h)return!1}return!0}).sort((s,m)=>{var u,I;switch(o){case"name":return s.title.localeCompare(m.title);case"staffing":return s.staffing_percentage-m.staffing_percentage;case"date":default:const Y=((u=s.schedule)==null?void 0:u.start_time_utc)||s.created_at,be=((I=m.schedule)==null?void 0:I.start_time_utc)||m.created_at;return new Date(Y).getTime()-new Date(be).getTime()}});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Events"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage events and assign workers"})]}),e.jsxs("button",{onClick:()=>b("/events/create"),className:"flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(oe,{size:20}),"Create New Event"]})]}),h&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{size:16,className:"text-blue-600"}),e.jsxs("span",{className:"text-sm font-medium text-blue-900",children:["Showing events for ",O($(h),"EEEE, MMMM d, yyyy")]})]}),e.jsx("button",{onClick:()=>{N("");const s=new URLSearchParams(j);s.delete("date"),F(s)},className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Clear filter"})]}),e.jsxs("div",{className:"flex gap-6 border-b border-gray-200 mb-6",children:[e.jsx("button",{onClick:()=>J("draft"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${i==="draft"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Draft Events"}),e.jsx("button",{onClick:()=>J("active"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${i==="active"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Active Events"}),e.jsx("button",{onClick:()=>J("completed"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${i==="completed"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Completed Events"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 max-w-md relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search events or venues...",value:t,onChange:s=>z(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),e.jsxs("select",{value:o,onChange:s=>_(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"name",children:"Sort by Name"}),i!=="draft"&&e.jsx("option",{value:"staffing",children:"Sort by Staffing"})]}),i==="active"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>q("all"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${x==="all"?"bg-teal-100 text-teal-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"All"}),e.jsx("button",{onClick:()=>q("needs_workers"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${x==="needs_workers"?"bg-red-100 text-red-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Needs Workers"}),e.jsx("button",{onClick:()=>q("partially_filled"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${x==="partially_filled"?"bg-yellow-100 text-yellow-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Partial"}),e.jsx("button",{onClick:()=>q("fully_staffed"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${x==="fully_staffed"?"bg-green-100 text-green-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Ready"})]})]}),P?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600"})}):e.jsxs(e.Fragment,{children:[i==="draft"&&e.jsx(Le,{events:K,onDelete:re,onPublish:ie,onNavigate:s=>b(s),searchQuery:t}),i==="active"&&e.jsx(Fe,{events:K,expandedEvents:c,onToggleEvent:ae,onAssignWorker:pe,onUnassign:ue,onQuickFill:(s,m,u)=>X({isOpen:!0,eventId:s,roleName:m,unfilledShiftIds:u}),onPublish:ie,onDelete:re,searchQuery:t}),i==="completed"&&e.jsx(Me,{events:K,expandedEvents:c,onToggleEvent:ae,searchQuery:t})]})]}),k.isOpen&&k.shiftId&&e.jsx(Se,{shiftId:k.shiftId,onClose:le,onSuccess:ye}),e.jsx(we,{isVisible:D.isVisible,message:D.message,type:D.type,onClose:()=>p({...D,isVisible:!1})}),e.jsx(Z,{isOpen:a.isOpen,onClose:fe,onConfirm:ge,title:"Publish Event",message:"Publish this event? This will create shifts and make them available for staffing.",confirmText:a.isLoading?"Publishingâ€¦":"Publish",cancelText:"Cancel",isLoading:a.isLoading,isDestructive:!1}),e.jsx(Z,{isOpen:y.isOpen,onClose:()=>M({isOpen:!1,isLoading:!1}),onConfirm:he,title:"Unassign Worker",message:`Remove ${y.workerName||"this worker"} from this shift?`,confirmText:y.isLoading?"Removingâ€¦":"Unassign",cancelText:"Cancel",isLoading:y.isLoading,isDestructive:!0}),e.jsx(Z,{isOpen:w.isOpen,onClose:xe,onConfirm:me,title:"Delete Event",message:`Are you sure you want to delete "${w.eventTitle}"? This action cannot be undone.`,confirmText:w.isLoading?"Deletingâ€¦":"Delete",cancelText:"Cancel",isLoading:w.isLoading,isDestructive:!0}),e.jsx(Ee,{isOpen:W.isOpen,eventId:W.eventId||0,roleName:W.roleName||"",unfilledShiftIds:W.unfilledShiftIds,onClose:()=>X({isOpen:!1,unfilledShiftIds:[]}),onDone:({assigned:s,conflicts:m})=>{X({isOpen:!1,unfilledShiftIds:[]}),p({isVisible:!0,message:`Assigned ${s} workers â€¢ ${m} skipped`,type:m>0?"error":"success"}),U()}})]})}function Le({events:b,onDelete:j,onPublish:F,onNavigate:r,searchQuery:E}){const C=l=>l?O($(l),"MMM d, yyyy"):"No date set",i=l=>l?O($(l),"h:mm a"):"";return b.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:E?"No draft events found":"No draft events yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:E?"Try adjusting your search query":"Create your first event to get started"}),!E&&e.jsxs("button",{onClick:()=>r("/events/create"),className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:[e.jsx(oe,{size:20}),"Create Event"]})]}):e.jsx("div",{className:"space-y-4",children:b.map(l=>e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 flex-1",children:l.title}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Draft"})]}),l.venue&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[e.jsx(B,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:l.venue.name})]}),l.schedule&&e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{children:C(l.schedule.start_time_utc)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsxs("span",{children:[i(l.schedule.start_time_utc)," - ",i(l.schedule.end_time_utc)]})]})]}),l.total_workers_needed>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(G,{size:16,className:"text-gray-400"}),e.jsxs("span",{children:[l.total_workers_needed," workers needed"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>r(`/events/${l.id}/edit`),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Edit",children:e.jsx(Ce,{size:18})}),e.jsx("button",{onClick:()=>F(l.id),className:"px-4 py-2 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Publish"}),e.jsx("button",{onClick:()=>j(l.id),className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition",title:"Delete",children:e.jsx(de,{size:18})})]})]})})},l.id))})}function Fe({events:b,expandedEvents:j,onToggleEvent:F,onAssignWorker:r,onUnassign:E,onQuickFill:C,onPublish:i,onDelete:l,searchQuery:x}){const S=t=>O($(t),"EEE, MMM d, yyyy"),h=t=>O($(t),"h:mm a"),N=t=>{switch(t){case"fully_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[e.jsx(se,{size:14}),"Ready"]});case"partially_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full",children:[e.jsx(ee,{size:14}),"Partial"]});case"needs_workers":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[e.jsx(R,{size:14}),"Needs Workers"]});default:return null}};return b.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:x?"No active events found":"No active events"}),e.jsx("p",{className:"text-gray-600",children:x?"Try adjusting your search query or filters":"Publish draft events to see them here"})]}):e.jsx("div",{className:"space-y-4",children:b.map(t=>{const z=j.has(t.id);return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("button",{onClick:()=>F(t.id),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.title}),N(t.staffing_status)]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[t.venue&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(B,{size:14,className:"text-gray-400"}),t.venue.name]}),t.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(H,{size:14,className:"text-gray-400"}),S(t.schedule.start_time_utc)]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Q,{size:14,className:"text-gray-400"}),h(t.schedule.start_time_utc)]})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:[t.assigned_workers_count," of ",t.total_workers_needed," roles filled"]}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[t.staffing_percentage,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-full rounded-full transition-all ${t.staffing_percentage===100?"bg-green-500":t.staffing_percentage>0?"bg-yellow-500":"bg-red-500"}`,style:{width:`${t.staffing_percentage}%`}})})]}),t.unfilled_roles_count>0&&e.jsxs("p",{className:"text-sm text-red-600 font-medium",children:[t.unfilled_roles_count," role",t.unfilled_roles_count!==1?"s":""," still need workers"]})]}),e.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[(!t.shifts_by_role||t.shifts_by_role.length===0)&&l&&e.jsx("button",{onClick:o=>{o.stopPropagation(),l(t.id)},className:"px-3 py-1.5 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition-colors",children:"Delete Event"}),l&&e.jsx("button",{onClick:o=>{o.stopPropagation(),l(t.id)},title:"Delete",className:"p-1.5 text-red-600 hover:text-red-700 hover:bg-red-50 rounded transition-colors",children:e.jsx(de,{size:14})}),e.jsx("div",{className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:z?e.jsx(ne,{size:24,className:"text-gray-600 hover:text-gray-800"}):e.jsx(ce,{size:24,className:"text-gray-600 hover:text-gray-800"})})]})]}),z&&e.jsx("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:t.shifts_by_role&&t.shifts_by_role.length>0?e.jsx("div",{className:"space-y-4",children:t.shifts_by_role.map(o=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:o.role_name}),e.jsxs("span",{className:"text-sm text-gray-600",children:[o.assigned_workers||o.filled_shifts,"/",o.total_workers_needed||o.total_shifts," assigned"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(o.assigned_workers||o.filled_shifts)<(o.total_workers_needed||o.total_shifts)&&e.jsxs("span",{className:"px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[(o.total_workers_needed||o.total_shifts)-(o.assigned_workers||o.filled_shifts)," needed"]}),(o.assigned_workers||o.filled_shifts)<(o.total_workers_needed||o.total_shifts)&&e.jsx("button",{onClick:_=>{_.stopPropagation();const P=o.shifts.filter(n=>n.staffing_progress.percentage<100).sort((n,v)=>new Date(n.start_time_utc).getTime()-new Date(v.start_time_utc).getTime()).map(n=>n.id);C(t.id,o.role_name,P)},className:"px-2.5 py-1 text-xs font-semibold bg-teal-600 text-white rounded hover:bg-teal-700",title:"Quick Fill by Skill",children:"Quick Fill by Skill"})]})]}),e.jsx("div",{className:"space-y-2",children:o.shifts.map((_,P)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 text-gray-700 rounded-md flex items-center justify-center text-xs font-medium",children:P+1}),e.jsxs("span",{className:"text-sm text-gray-700",children:[h(_.start_time_utc)," - ",h(_.end_time_utc)]}),_.assignments.length>0&&e.jsx("div",{className:"flex items-center gap-1",children:_.assignments.map(n=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"px-2 py-0.5 bg-teal-100 text-teal-700 text-xs rounded",children:[n.worker.first_name," ",n.worker.last_name[0],"."]}),e.jsx("button",{onClick:v=>{v.stopPropagation(),E(n.id,`${n.worker.first_name} ${n.worker.last_name}`)},className:"w-5 h-5 flex items-center justify-center text-red-600 hover:text-red-700 hover:bg-red-50 rounded",title:"Unassign worker",children:e.jsx(R,{size:12})})]},n.id))})]}),_.staffing_progress.percentage===100?e.jsxs("span",{className:"flex items-center gap-1.5 text-sm font-medium text-green-600",children:[e.jsx(se,{size:16}),"Assigned"]}):e.jsx("button",{onClick:n=>{n.stopPropagation(),r(_.id)},className:"px-3 py-1.5 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Assign Worker"})]},_.id))})]},o.role_name))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:t.status==="draft"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"This event is still in draft status"}),e.jsx("p",{className:"text-sm",children:"Publish the event to generate shifts and assign workers"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"No shifts available"}),e.jsx("p",{className:"text-sm",children:"This event may not have any shifts generated yet"})]})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[t.status==="draft"&&e.jsx("button",{onClick:()=>i(t.id),className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors",children:"Publish Event"}),l&&e.jsx("button",{onClick:()=>l(t.id),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Delete Event"})]})]})})]},t.id)})})}function Me({events:b,expandedEvents:j,onToggleEvent:F,searchQuery:r}){const E=i=>O($(i),"MMM d, yyyy"),C=i=>O($(i),"h:mm a");return b.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“‹"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:r?"No past events found":"No past events yet"}),e.jsx("p",{className:"text-gray-600",children:r?"Try adjusting your search query":"Completed events will appear here"})]}):e.jsx("div",{className:"space-y-4",children:b.map(i=>{var S;const l=j.has(i.id);let x=0;return(S=i.shifts_by_role)==null||S.forEach(h=>{h.shifts.forEach(N=>{N.assignments.forEach(t=>{const z=t.hours_worked?parseFloat(t.hours_worked.toString()):0;x+=z})})}),x=Number(x)||0,e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("button",{onClick:()=>F(i.id),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:i.title}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Completed"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[i.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(H,{size:14,className:"text-gray-400"}),E(i.schedule.start_time_utc)]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Q,{size:14,className:"text-gray-400"}),C(i.schedule.start_time_utc)," - ",C(i.schedule.end_time_utc)]})]}),i.venue&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(B,{size:14,className:"text-gray-400"}),i.venue.name]})]})]}),e.jsx("div",{className:"ml-4 flex items-center",children:e.jsx("div",{className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:l?e.jsx(ne,{size:24,className:"text-gray-600 hover:text-gray-800"}):e.jsx(ce,{size:24,className:"text-gray-600 hover:text-gray-800"})})})]}),l&&i.shifts_by_role&&e.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:[e.jsx("div",{className:"mb-4 p-4 bg-white rounded-lg border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Workers"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:i.assigned_workers_count})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Hours"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:x.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Staffing"}),e.jsxs("p",{className:"text-2xl font-semibold text-green-600",children:[i.staffing_percentage,"%"]})]})]})}),e.jsx("div",{className:"space-y-3",children:i.shifts_by_role.map(h=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:h.role_name}),e.jsx("div",{className:"space-y-2",children:h.shifts.flatMap(N=>N.assignments.map(t=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 text-teal-700 flex items-center justify-center text-sm font-medium",children:[t.worker.first_name[0],t.worker.last_name[0]]}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[t.worker.first_name," ",t.worker.last_name]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[t.hours_worked&&e.jsxs("span",{className:"font-medium",children:[parseFloat(t.hours_worked.toString()).toFixed(2)," hrs"]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[C(N.start_time_utc)," - ",C(N.end_time_utc)]})]})]},t.id)))})]},h.role_name))})]})]},i.id)})})}export{Be as EventsPage};
