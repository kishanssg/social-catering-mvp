import{u as $e,a as J,j as e}from"./index-BqJ0E7Su.js";import{b as Ae,u as ze,r as d}from"./vendor-D4VeuP1H.js";import{L as ue}from"./LoadingSpinner-CKEr8yWy.js";import{S as Ce,T as De,C as Ee,A as _e}from"./ConfirmationModal-3MOpU0VP.js";import{T as Pe,X as Se}from"./Toast-CskoSaNK.js";import{P as we}from"./plus-BjsM0e8m.js";import{U as Me}from"./user-BRtEXnDr.js";import{C as Le,X as Fe}from"./x-circle-Cb1dDG8O.js";import{C as ke}from"./calendar-Le_Ap4Bb.js";import{P as Oe}from"./pen-square-BCqzXChY.js";import{f as le,C as Re}from"./index-zHBRnHzy.js";import{p as ne}from"./index-BwdrtCGV.js";import{B as Te}from"./briefcase-CXQpmVqJ.js";import{M as We}from"./map-pin-CC96rGfz.js";import{D as Be}from"./dollar-sign-DafOqtMp.js";function ls(){const i=Ae(),B=ze(),{isAuthenticated:w,isLoading:y}=$e(),[ie,p]=d.useState([]),[U,H]=d.useState(!0),[C,I]=d.useState(""),[q,K]=d.useState("name"),[f,z]=d.useState("all"),[V,P]=d.useState({isOpen:!1}),[xe,Y]=d.useState([]),[Q,M]=d.useState(null),[_,O]=d.useState({isOpen:!1}),[re,X]=d.useState(!1),[R,T]=d.useState({isVisible:!1,message:"",type:"success"});d.useEffect(()=>{w&&!y&&W()},[w,y]),d.useEffect(()=>{w&&!y&&B.pathname==="/workers"&&W()},[B.pathname,w,y]);async function W(){H(!0);try{const t=await J.get("/workers");if(t.data.status==="success"){const c=t.data.data||[];p(c)}else p([])}catch(t){console.error("Failed to load workers:",t),p([])}finally{H(!1)}}const Z=t=>{O({isOpen:!0,worker:t})},oe=async()=>{var t;if(_.worker){X(!0);try{(await J.delete(`/workers/${(t=_.worker)==null?void 0:t.id}`)).data.status==="success"&&(T({isVisible:!0,message:`${_.worker.first_name||"Unknown"} ${_.worker.last_name||"Worker"} has been deleted successfully`,type:"success"}),W(),O({isOpen:!1}))}catch(c){console.error("Failed to delete worker:",c),T({isVisible:!0,message:"Failed to delete worker. Please try again.",type:"error"})}finally{X(!1)}}},ce=()=>{O({isOpen:!1})},de=t=>{P({isOpen:!0,worker:t}),Y([]),M(null)},G=()=>{P({isOpen:!1})},ee=t=>{console.log("handleBulkAssignSuccess called with message:",t),console.log("Closing modal and showing toast..."),G(),T({isVisible:!0,message:t||"Worker scheduled successfully",type:"success"}),W(),console.log("Modal should now be closed")},se=ie.filter(t=>{if(f==="active"&&!t.active||f==="inactive"&&t.active)return!1;if(C){const c=C.toLowerCase();return(t.first_name||"").toLowerCase().includes(c)||(t.last_name||"").toLowerCase().includes(c)||(t.email||"").toLowerCase().includes(c)||(t.phone||"").includes(c)||(t.skills_json||[]).some(S=>(S||"").toLowerCase().includes(c))||(t.certifications||[]).some(S=>((S==null?void 0:S.name)||"").toLowerCase().includes(c))}return!0}).sort((t,c)=>{switch(q){case"name":return`${t.first_name||""} ${t.last_name||""}`.localeCompare(`${c.first_name||""} ${c.last_name||""}`);case"email":return(t.email||"").localeCompare(c.email||"");case"status":return(c.active?1:0)-(t.active?1:0);default:return 0}});return y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ue,{})}):w?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Workers"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your workforce"})]}),e.jsxs("button",{onClick:()=>i("/workers/create"),className:"flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(we,{size:20}),"Add New Worker"]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 max-w-md relative",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search workers by name, email, phone, skills, or certifications",value:C,onChange:t=>I(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),e.jsxs("select",{value:q,onChange:t=>K(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"name",children:"Sort by Name"}),e.jsx("option",{value:"email",children:"Sort by Email"}),e.jsx("option",{value:"status",children:"Sort by Status"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>z("all"),className:`px-3 py-2 text-sm font-medium rounded-lg transition-colors ${f==="all"?"bg-teal-100 text-teal-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"All"}),e.jsx("button",{onClick:()=>z("active"),className:`px-3 py-2 text-sm font-medium rounded-lg transition-colors ${f==="active"?"bg-green-100 text-green-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Active"}),e.jsx("button",{onClick:()=>z("inactive"),className:`px-3 py-2 text-sm font-medium rounded-lg transition-colors ${f==="inactive"?"bg-gray-200 text-gray-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Inactive"})]})]}),U?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ue,{})}):se.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Me,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:C?"No workers found":"No workers yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:C?"Try adjusting your search or filters":"Add your first worker to get started"}),!C&&e.jsxs("button",{onClick:()=>i("/workers/create"),className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:[e.jsx(we,{size:20}),"Add Worker"]})]}):e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Worker Name"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Phone Number"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Email Address"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:se.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>i(`/workers/${t.id}`),children:[e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 font-medium",children:[(t.first_name||"U")[0],(t.last_name||"W")[0]]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[t.first_name||"Unknown"," ",t.last_name||"Worker"]}),t.skills_json&&t.skills_json.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[t.skills_json.slice(0,3).map((c,S)=>e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded",children:c},S)),t.skills_json.length>3&&e.jsxs("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded",children:["+",t.skills_json.length-3]})]})]})]})}),e.jsx("td",{className:"py-4 px-6 text-sm text-gray-600",children:t.phone||"—"}),e.jsx("td",{className:"py-4 px-6 text-sm text-gray-600",children:t.email}),e.jsx("td",{className:"py-4 px-6",children:t.active?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[e.jsx(Le,{size:14}),"Active"]}):e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-gray-100 text-gray-600 text-xs font-medium rounded-full",children:[e.jsx(Fe,{size:14}),"Inactive"]})}),e.jsx("td",{className:"py-4 px-6 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.active&&e.jsxs("button",{onClick:c=>{c.stopPropagation(),de(t)},className:"px-3 py-1.5 bg-purple-600 text-white text-sm font-medium rounded-lg hover:bg-purple-700 transition-colors",title:"Schedule Worker",children:[e.jsx(ke,{size:14,className:"inline mr-1"}),"Schedule"]}),e.jsx("button",{onClick:c=>{c.stopPropagation(),i(`/workers/${t.id}/edit`)},className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Edit",children:e.jsx(Oe,{size:16})}),e.jsx("button",{onClick:c=>{c.preventDefault(),c.stopPropagation(),Z(t)},className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition",title:"Delete",children:e.jsx(De,{size:16})})]})})]},t.id))})]})})]}),V.isOpen&&V.worker&&e.jsx(Ue,{worker:V.worker,onClose:G,onSuccess:ee}),e.jsx(Ee,{isOpen:_.isOpen,onClose:ce,onConfirm:oe,title:"Delete Worker",message:"Are you sure you want to delete this worker?",confirmText:"Delete Worker",cancelText:"Cancel",isLoading:re,isDestructive:!0,workerName:_.worker?`${_.worker.first_name||"Unknown"} ${_.worker.last_name||"Worker"}`:void 0}),e.jsx(Pe,{isVisible:R.isVisible,message:R.message,type:R.type,onClose:()=>T({...R,isVisible:!1})})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Authentication Required"}),e.jsx("p",{className:"text-gray-600",children:"Please log in to view workers."})]})})}function Ue({worker:i,onClose:B,onSuccess:w}){var S;const[y,ie]=d.useState([]),[p,U]=d.useState(new Set),[H,C]=d.useState(!0),[I,q]=d.useState(!1),[K,f]=d.useState(null),[z,V]=d.useState(""),[P,xe]=d.useState("all"),[Y,Q]=d.useState([]),[M,_]=d.useState({}),[O,re]=d.useState(new Set),[X,R]=d.useState({});d.useEffect(()=>{i&&i.id&&T()},[i==null?void 0:i.id]),d.useEffect(()=>{i&&i.id&&y.length>0&&W()},[i==null?void 0:i.id,y]);async function T(){if(!(!i||!i.id)){C(!0);try{const s=await J.get("/events",{params:{tab:"active",filter:"needs_workers"}});if(s.data.status==="success"){const n=s.data.data,a=[];n.forEach(r=>{if(r&&r.shifts_by_role){const m={id:r.id,title:r.title||"Untitled Event"};r.shifts_by_role.forEach(l=>{var g;if(l&&i.skills_json&&i.skills_json.includes(l.role_name)&&l.filled_shifts<l.total_shifts){const o=(l.shifts||[]).filter(v=>{const k=v.filled_positions||0;return v.capacity>k});if(o.length===0)return;const u=o[0];if(u){const v=o.map($=>$.id),k={id:u.id,event:m,role_needed:l.role_name,start_time_utc:u.start_time_utc,end_time_utc:u.end_time_utc,location:((g=r.venue)==null?void 0:g.formatted_address)||"Location TBD",current_status:u.status,pay_rate:u.pay_rate,total_positions:l.total_shifts,filled_positions:l.filled_shifts,available_positions:o.reduce(($,D)=>$+(D.capacity-(D.filled_positions||0)),0),all_shift_ids:v};a.push(k)}}})}}),ie(a)}}catch(s){console.error("Failed to load available shifts:",s),f("Failed to load available shifts")}finally{C(!1)}}}async function W(){if(!(!i||!i.id))try{const s=[];if(y.forEach(a=>{a.all_shift_ids&&s.push(...a.all_shift_ids)}),s.length===0)return;const n=await J.post("/staffing/validate_bulk",{worker_id:i.id,shift_ids:s});if(n.data.status==="success"){const{invalid_shifts:a}=n.data.data,r=new Set,m={};a.forEach(l=>{const g=y.find(o=>{var u;return(u=o.all_shift_ids)==null?void 0:u.includes(l.shift_id)});g&&(r.add(g.id),m[g.id]=l.errors.map(o=>o.message))}),re(r),R(m)}}catch(s){console.error("Failed to validate shifts:",s)}}const Z=s=>{const n=new Set(p),a=y.find(r=>r.id===s);if(a){if(n.has(s))n.delete(s);else{if(O.has(s)){const m=X[s]||["Not available"];f(`Cannot select this shift: ${m.join(", ")}`);return}if(Array.from(n).forEach(m=>{var g,o,u;const l=y.find(v=>v.id===m);if(l&&((g=l.event)==null?void 0:g.id)===((o=a.event)==null?void 0:o.id)&&l.start_time_utc===a.start_time_utc&&l.end_time_utc===a.end_time_utc&&l.role_needed!==a.role_needed){n.delete(m),f(`Selected ${a.role_needed} for ${(u=a.event)==null?void 0:u.title}. Previous role (${l.role_needed}) was unselected.`);return}}),Array.from(n).some(m=>{var $,D;const l=y.find(te=>te.id===m);if(!l||(($=l.event)==null?void 0:$.id)===((D=a.event)==null?void 0:D.id))return!1;const g=new Date(a.start_time_utc).getTime(),o=new Date(a.end_time_utc).getTime(),u=new Date(l.start_time_utc).getTime(),v=new Date(l.end_time_utc).getTime(),k=g<v&&o>u;return console.log("Checking overlap:",{shiftA:`${new Date(g).toISOString()} - ${new Date(o).toISOString()}`,shiftB:`${new Date(u).toISOString()} - ${new Date(v).toISOString()}`,overlaps:k}),k})){f("Cannot select this shift: It overlaps with another selected shift. Please deselect the conflicting shift first.");return}n.add(s)}U(n),f(null)}},oe=(s,n)=>{_(a=>({...a,[s]:n}))},ce=()=>{p.size===t.length?U(new Set):U(new Set(t.map(s=>s.id)))};async function de(){var s,n,a,r,m,l,g,o,u,v,k,$,D,te,fe,he,ge,pe,ye,je,be,ve;if(p.size===0){f("Please select at least one shift");return}q(!0),f(null);try{const x=[];y.filter(j=>p.has(j.id)).forEach(j=>{j.all_shift_ids&&x.push(...j.all_shift_ids||[])});const L=[...new Set(x)].map(j=>{const E=y.find(A=>{var N;return(N=A.all_shift_ids)==null?void 0:N.includes(j)}),F=M[j]||Number(E==null?void 0:E.pay_rate)||0;return{shift_id:j,worker_id:i.id,hourly_rate:F}}),h=await J.post("/staffing/bulk_create",{assignments:L});if(console.log("Bulk create response:",h.data),console.log("Response status:",h.data.status),console.log("Response status in try block:",h.data.status),console.log("Response data:",JSON.stringify(h.data,null,2)),h.data.status==="success")console.log("Full success - calling onSuccess()"),f(null),Q([]),w(h.data.message);else if(h.data.status==="partial_success"){console.log("Partial success - clearing error state and closing modal"),f(null),Q([]);const{successful:j,failed:E,total_requested:F}=h.data.data,A=j.length,N=E.length,Ne=F||A+N;let me=h.data.message||`Successfully scheduled ${A} of ${Ne} shifts`;N>0&&A>0&&!h.data.message&&(me=`Successfully scheduled ${A} of ${Ne} shifts. ${N} ${N===1?"shift":"shifts"} could not be scheduled.`),console.log("Partial success - calling onSuccess with message:",me),w(me)}else if(h.data.status==="error"){let j=h.data.message||"Failed to schedule worker for shifts";h.data.details&&h.data.details.length>0&&(j+=`

Details:
• `+h.data.details.join(`
• `)),f(j)}else console.error("Unknown response status:",h.data.status),f("Unexpected response from server")}catch(x){console.error("Failed to bulk assign:",x),console.error("Error response data:",(s=x.response)==null?void 0:s.data),console.log("In catch block - checking for partial_success"),console.log("Error response data:",(n=x.response)==null?void 0:n.data),console.log("Error response status:",(r=(a=x.response)==null?void 0:a.data)==null?void 0:r.status);const ae=(l=(m=x.response)==null?void 0:m.data)==null?void 0:l.status;if(console.log("Response status:",ae),ae==="success"||ae==="partial_success"){console.log("Found success/partial_success - clearing ALL error state and calling onSuccess()"),f(null),Q([]);const b=((o=(g=x.response)==null?void 0:g.data)==null?void 0:o.data)||{},L=b.successful||[],h=b.failed||[],j=b.total_requested||L.length+h.length,E=L.length,F=h.length,A=j;let N=`Successfully scheduled ${E} of ${A} shift${A!==1?"s":""}`;F>0&&E>0&&(N+=`. ${F} ${F===1?"shift":"shifts"} could not be scheduled.`),console.log("Calling onSuccess with message:",N),w(N);return}if((v=(u=x.response)==null?void 0:u.data)!=null&&v.errors&&Array.isArray(x.response.data.errors)){const L=x.response.data.errors.find(h=>h.type==="batch_overlap");if(L){f(x.response.data.message||L.message);return}}if(($=(k=x.response)==null?void 0:k.data)!=null&&$.message){const b=(te=(D=x.response)==null?void 0:D.data)==null?void 0:te.status;if(b!=="success"&&b!=="partial_success"){f(x.response.data.message);return}}if((he=(fe=x.response)==null?void 0:fe.data)!=null&&he.conflicts){Q(((pe=(ge=x.response)==null?void 0:ge.data)==null?void 0:pe.conflicts)||[]);let b="Scheduling conflicts detected. Please review below.";x.response.data.details&&x.response.data.details.length>0&&(b+=`

Conflicts:
• `+x.response.data.details.join(`
• `)),f(b)}else if((je=(ye=x.response)==null?void 0:ye.data)!=null&&je.details){const b=x.response.data.details.join(`
• `);f(`Failed to schedule shifts:
• ${b}`)}else f(((ve=(be=x.response)==null?void 0:be.data)==null?void 0:ve.message)||"Failed to schedule worker for shifts")}finally{q(!1)}}const G=s=>le(ne(s),"EEE, MMM d, yyyy"),ee=s=>le(ne(s),"h:mm a"),se=i.skills_json||[],t=y.filter(s=>{var n;if(P!=="all"&&s.role_needed!==P)return!1;if(z){const a=z.toLowerCase();return(((n=s.event)==null?void 0:n.title)||"").toLowerCase().includes(a)||(s.location||"").toLowerCase().includes(a)}return!0}),c=s=>Array.from(p).some(a=>{var m,l;const r=y.find(g=>g.id===a);return r?((m=r.event)==null?void 0:m.id)===((l=s.event)==null?void 0:l.id)&&r.start_time_utc===s.start_time_utc&&r.end_time_utc===s.end_time_utc&&r.role_needed!==s.role_needed:!1});return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Schedule ",i.first_name," ",i.last_name," for Shifts"]}),e.jsx("button",{onClick:B,className:"p-1 text-gray-400 hover:text-gray-600 rounded transition",children:e.jsx(Se,{size:24})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:(S=i.skills_json)==null?void 0:S.map(s=>e.jsx("span",{className:"px-2.5 py-1 bg-teal-100 text-teal-700 text-xs font-medium rounded",children:s},s))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:H?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ue,{})}):e.jsxs(e.Fragment,{children:[K&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2",children:[e.jsx(Se,{size:18,className:"text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-red-700",children:K.split(`
`).map((s,n)=>e.jsx("p",{className:s.startsWith("•")?"ml-2":"",children:s},n))})]}),Y.length>0&&e.jsxs("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"Scheduling Conflicts"}),e.jsx("div",{className:"space-y-2",children:Y.map((s,n)=>{var a;return e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"text-yellow-800",children:[e.jsx("strong",{children:((a=s.new_shift)==null?void 0:a.event)||"Unknown Event"})," conflicts with:"]}),e.jsx("ul",{className:"ml-4 mt-1 space-y-1",children:(s.conflicting_with||[]).map((r,m)=>e.jsxs("li",{className:"text-yellow-700",children:[r.event||"Unknown Event"," (",le(ne(r.start_time),"MMM d, h:mm a")," - ",le(ne(r.end_time),"h:mm a"),")"]},m))})]},n)})})]}),e.jsxs("div",{className:"mb-4 flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search events or locations...",value:z,onChange:s=>V(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsxs("select",{value:P,onChange:s=>xe(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"all",children:"All Roles"}),se.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),t.length>0&&e.jsxs("div",{className:"mb-4 flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p.size===t.length&&t.length>0,onChange:ce,className:"w-4 h-4 text-teal-600 rounded focus:ring-teal-500"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Select All (",t.length," shifts)"]})]}),p.size>0&&e.jsxs("span",{className:"text-sm font-medium text-teal-600",children:[p.size," selected"]})]}),t.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Te,{size:48,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"font-medium",children:"No available shifts found"}),e.jsx("p",{className:"text-sm mt-1",children:z||P!=="all"?"Try adjusting your filters":`No shifts matching ${i.first_name}'s skills need workers`})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:t.map(s=>{var g;const n=p.has(s.id),a=c(s),r=O.has(s.id),m=(a||r)&&!n,l=X[s.id]||[];return e.jsxs("button",{onClick:()=>Z(s.id),className:`w-full p-4 rounded-lg border-2 transition-all text-left ${n?"border-teal-600 bg-teal-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:n,disabled:m,onChange:()=>Z(s.id),className:`mt-1 w-4 h-4 rounded focus:ring-teal-500 ${m?"text-gray-400 cursor-not-allowed":"text-teal-600"}`,onClick:o=>o.stopPropagation()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{children:[e.jsx("h4",{className:`font-medium ${m?"text-gray-500":"text-gray-900"}`,children:((g=s.event)==null?void 0:g.title)||"Untitled Event"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`inline-block px-2 py-0.5 text-xs font-medium rounded ${m?"bg-gray-200 text-gray-500":"bg-purple-100 text-purple-700"}`,children:s.role_needed}),s.total_positions&&s.total_positions>1&&e.jsxs("span",{className:`text-xs ${m?"text-gray-400":"text-gray-500"}`,children:[s.available_positions," of ",s.total_positions," positions available"]}),a&&!n&&e.jsx("span",{className:"text-xs text-red-600 font-medium",children:"(Conflicts with selected role)"}),r&&!n&&e.jsxs("span",{className:"text-xs text-red-600 font-medium flex items-center gap-1",children:[e.jsx(_e,{size:12}),"(Not available)"]})]})]})}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{size:14,className:"text-gray-400"}),e.jsx("span",{children:G(s.start_time_utc)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{size:14,className:"text-gray-400"}),e.jsxs("span",{children:[ee(s.start_time_utc)," - ",ee(s.end_time_utc)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"truncate",children:s.location})]})]})]}),e.jsx("div",{className:"flex flex-col items-end gap-1",onClick:o=>o.stopPropagation(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[M[s.id]&&M[s.id]!==(Number(s.pay_rate)||0)&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"(custom)"}),e.jsx(Be,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"text-gray-500 text-sm",children:"Pay:"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:(Number(s.pay_rate)||0).toString(),value:M[s.id]!==void 0?M[s.id]:Number(s.pay_rate)||0,onChange:o=>{const u=o.target.value;(u===""||/^\d*\.?\d*$/.test(u))&&oe(s.id,parseFloat(u)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:o=>o.stopPropagation(),onFocus:o=>o.stopPropagation()}),e.jsx("span",{className:"text-gray-500 text-sm",children:"/hr"})]})})]}),r&&l.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-red-200",children:e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx(_e,{size:14,className:"text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-red-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"Cannot assign to this shift:"}),e.jsx("ul",{className:"list-disc list-inside space-y-0.5",children:l.map((o,u)=>e.jsx("li",{children:o},u))})]})]})})]},s.id)})})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:p.size>0?e.jsxs("span",{className:"font-medium",children:[p.size," shift",p.size!==1?"s":""," selected"]}):e.jsxs("span",{children:["Select shifts to assign ",i.first_name," to"]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:B,disabled:I,className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:de,disabled:p.size===0||I,className:"px-6 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:I?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Scheduling..."]}):e.jsxs(e.Fragment,{children:["Schedule for ",p.size," Shift",p.size!==1?"s":""]})})]})]})]})})}export{ls as WorkersPage};
