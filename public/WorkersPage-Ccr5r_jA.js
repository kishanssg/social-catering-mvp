import{u as H,a as W,j as e}from"./index-CLobVFyw.js";import{b as J,r as l}from"./vendor-D4VeuP1H.js";import{L as q}from"./LoadingSpinner-Tw-bheX1.js";import{S as X,T as K,C as Y}from"./ConfirmationModal-DJg8A-l6.js";import{T as Z,X as I}from"./Toast-CDpcw_ag.js";import{P as Q}from"./plus-Bd_vAGcf.js";import{U as G}from"./user-BKnnFDE8.js";import{C as ee,X as se}from"./x-circle-Cr0HK_4n.js";import{C as U}from"./calendar-C9I7sryN.js";import{P as te}from"./pen-square-y_eldhvK.js";import{f as P,C as ae}from"./index-CQxb1Ghh.js";import{p as D}from"./index-Df9E7fob.js";import{B as le}from"./briefcase-C0VTnCu4.js";import{M as re}from"./map-pin-CVc-VzSy.js";function ve(){const o=J(),{isAuthenticated:j,isLoading:k}=H(),[F,S]=l.useState([]),[i,h]=l.useState(!0),[g,A]=l.useState(""),[b,L]=l.useState("name"),[f,d]=l.useState("all"),[p,M]=l.useState({isOpen:!1}),[_,O]=l.useState([]),[T,C]=l.useState(null),[x,v]=l.useState({isOpen:!1}),[V,$]=l.useState(!1),[N,y]=l.useState({isVisible:!1,message:"",type:"success"});l.useEffect(()=>{j&&!k&&z()},[j,k]);async function z(){h(!0);try{const s=await W.get("/workers");if(s.data.status==="success"){const a=s.data.data||[];S(a)}else S([])}catch(s){console.error("Failed to load workers:",s),S([])}finally{h(!1)}}const u=s=>{v({isOpen:!0,worker:s})},B=async()=>{if(x.worker){$(!0);try{(await W.delete(`/workers/${x.worker.id}`)).data.status==="success"&&(y({isVisible:!0,message:`${x.worker.first_name} ${x.worker.last_name} has been deleted successfully`,type:"success"}),z(),v({isOpen:!1}))}catch(s){console.error("Failed to delete worker:",s),y({isVisible:!0,message:"Failed to delete worker. Please try again.",type:"error"})}finally{$(!1)}}},t=()=>{v({isOpen:!1})},r=s=>{M({isOpen:!0,worker:s}),O([]),C(null)},c=()=>{M({isOpen:!1})},m=s=>{c(),y({isVisible:!0,message:s||"Worker scheduled successfully",type:"success"}),z()},n=F.filter(s=>{var a,E;if(f==="active"&&!s.active||f==="inactive"&&s.active)return!1;if(g){const w=g.toLowerCase();return s.first_name.toLowerCase().includes(w)||s.last_name.toLowerCase().includes(w)||s.email.toLowerCase().includes(w)||((a=s.phone)==null?void 0:a.includes(w))||s.skills_json.some(R=>R.toLowerCase().includes(w))||((E=s.certifications)==null?void 0:E.some(R=>R.name.toLowerCase().includes(w)))}return!0}).sort((s,a)=>{switch(b){case"name":return`${s.first_name} ${s.last_name}`.localeCompare(`${a.first_name} ${a.last_name}`);case"email":return s.email.localeCompare(a.email);case"status":return(a.active?1:0)-(s.active?1:0);default:return 0}});return k?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(q,{})}):j?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Workers"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your workforce"})]}),e.jsxs("button",{onClick:()=>o("/workers/create"),className:"flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(Q,{size:20}),"Add New Worker"]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 max-w-md relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search workers by name, email, phone, skills, or certifications",value:g,onChange:s=>A(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),e.jsxs("select",{value:b,onChange:s=>L(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"name",children:"Sort by Name"}),e.jsx("option",{value:"email",children:"Sort by Email"}),e.jsx("option",{value:"status",children:"Sort by Status"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>d("all"),className:`px-3 py-2 text-sm font-medium rounded-lg transition-colors ${f==="all"?"bg-teal-100 text-teal-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"All"}),e.jsx("button",{onClick:()=>d("active"),className:`px-3 py-2 text-sm font-medium rounded-lg transition-colors ${f==="active"?"bg-green-100 text-green-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Active"}),e.jsx("button",{onClick:()=>d("inactive"),className:`px-3 py-2 text-sm font-medium rounded-lg transition-colors ${f==="inactive"?"bg-gray-200 text-gray-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Inactive"})]})]}),i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(q,{})}):n.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(G,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:g?"No workers found":"No workers yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:g?"Try adjusting your search or filters":"Add your first worker to get started"}),!g&&e.jsxs("button",{onClick:()=>o("/workers/create"),className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:[e.jsx(Q,{size:20}),"Add Worker"]})]}):e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Worker Name"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Phone Number"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Email Address"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:n.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>o(`/workers/${s.id}`),children:[e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 font-medium",children:[s.first_name[0],s.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[s.first_name," ",s.last_name]}),s.skills_json&&s.skills_json.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[s.skills_json.slice(0,3).map((a,E)=>e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded",children:a},E)),s.skills_json.length>3&&e.jsxs("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded",children:["+",s.skills_json.length-3]})]})]})]})}),e.jsx("td",{className:"py-4 px-6 text-sm text-gray-600",children:s.phone||"â€”"}),e.jsx("td",{className:"py-4 px-6 text-sm text-gray-600",children:s.email}),e.jsx("td",{className:"py-4 px-6",children:s.active?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[e.jsx(ee,{size:14}),"Active"]}):e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-gray-100 text-gray-600 text-xs font-medium rounded-full",children:[e.jsx(se,{size:14}),"Inactive"]})}),e.jsx("td",{className:"py-4 px-6 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.active&&e.jsxs("button",{onClick:a=>{a.stopPropagation(),r(s)},className:"px-3 py-1.5 bg-purple-600 text-white text-sm font-medium rounded-lg hover:bg-purple-700 transition-colors",title:"Schedule Worker",children:[e.jsx(U,{size:14,className:"inline mr-1"}),"Schedule"]}),e.jsx("button",{onClick:a=>{a.stopPropagation(),o(`/workers/${s.id}/edit`)},className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Edit",children:e.jsx(te,{size:16})}),e.jsx("button",{onClick:a=>{a.preventDefault(),a.stopPropagation(),u(s)},className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition",title:"Delete",children:e.jsx(K,{size:16})})]})})]},s.id))})]})})]}),p.isOpen&&p.worker&&e.jsx(ie,{worker:p.worker,onClose:c,onSuccess:m}),e.jsx(Y,{isOpen:x.isOpen,onClose:t,onConfirm:B,title:"Delete Worker",message:"Are you sure you want to delete this worker?",confirmText:"Delete Worker",cancelText:"Cancel",isLoading:V,isDestructive:!0,workerName:x.worker?`${x.worker.first_name} ${x.worker.last_name}`:void 0}),e.jsx(Z,{isVisible:N.isVisible,message:N.message,type:N.type,onClose:()=>y({...N,isVisible:!1})})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Authentication Required"}),e.jsx("p",{className:"text-gray-600",children:"Please log in to view workers."})]})})}function ie({worker:o,onClose:j,onSuccess:k}){var B;const[F,S]=l.useState([]),[i,h]=l.useState(new Set),[g,A]=l.useState(!0),[b,L]=l.useState(!1),[f,d]=l.useState(null),[p,M]=l.useState(""),[_,O]=l.useState("all"),[T,C]=l.useState([]);l.useEffect(()=>{x()},[o.id]);async function x(){A(!0);try{const t=await W.get("/events",{params:{tab:"active",filter:"needs_workers"}});if(t.data.status==="success"){const r=t.data.data,c=[];r.forEach(m=>{m.shifts_by_role&&m.shifts_by_role.forEach(n=>{n.shifts.forEach(s=>{var a;o.skills_json.includes(n.role_name)&&s.staffing_progress.percentage<100&&c.push({id:s.id,event:{id:m.id,title:m.title},role_needed:n.role_name,start_time_utc:s.start_time_utc,end_time_utc:s.end_time_utc,location:((a=m.venue)==null?void 0:a.formatted_address)||"Location TBD",current_status:s.status})})})}),S(c)}}catch(t){console.error("Failed to load available shifts:",t),d("Failed to load available shifts")}finally{A(!1)}}const v=t=>{const r=new Set(i);r.has(t)?r.delete(t):r.add(t),h(r)},V=()=>{i.size===u.length?h(new Set):h(new Set(u.map(t=>t.id)))};async function $(){var t,r,c,m;if(i.size===0){d("Please select at least one shift");return}L(!0),d(null);try{const n=await W.post("/staffing/bulk_create",{worker_id:o.id,shift_ids:Array.from(i)});n.data.status==="success"?k(n.data.message):d(n.data.message||"Failed to schedule worker for shifts")}catch(n){console.error("Failed to bulk assign:",n),(r=(t=n.response)==null?void 0:t.data)!=null&&r.conflicts?(C(n.response.data.conflicts),d("Scheduling conflicts detected. Please review below.")):d(((m=(c=n.response)==null?void 0:c.data)==null?void 0:m.message)||"Failed to schedule worker for shifts")}finally{L(!1)}}const N=t=>P(D(t),"EEE, MMM d, yyyy"),y=t=>P(D(t),"h:mm a"),z=o.skills_json||[],u=F.filter(t=>{if(_!=="all"&&t.role_needed!==_)return!1;if(p){const r=p.toLowerCase();return t.event.title.toLowerCase().includes(r)||t.location.toLowerCase().includes(r)}return!0});return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Schedule ",o.first_name," ",o.last_name," for Shifts"]}),e.jsx("button",{onClick:j,className:"p-1 text-gray-400 hover:text-gray-600 rounded transition",children:e.jsx(I,{size:24})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:(B=o.skills_json)==null?void 0:B.map(t=>e.jsx("span",{className:"px-2.5 py-1 bg-teal-100 text-teal-700 text-xs font-medium rounded",children:t},t))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:g?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(q,{})}):e.jsxs(e.Fragment,{children:[f&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(I,{size:18,className:"text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700",children:f})]}),e.jsxs("button",{onClick:()=>{d(null),C([]),h(new Set)},className:"flex items-center gap-1 px-3 py-1 text-sm text-red-700 hover:text-red-900 hover:bg-red-100 rounded transition-colors flex-shrink-0",children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M10 12L6 8L10 4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Back"]})]})}),T.length>0&&e.jsxs("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-yellow-900",children:"Scheduling Conflicts"}),e.jsxs("button",{onClick:()=>{C([]),d(null),h(new Set)},className:"flex items-center gap-1 px-3 py-1 text-sm text-yellow-700 hover:text-yellow-900 hover:bg-yellow-100 rounded transition-colors",children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M10 12L6 8L10 4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Back"]})]}),e.jsx("div",{className:"space-y-2",children:T.map((t,r)=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"text-yellow-800",children:[e.jsx("strong",{children:t.new_shift.event})," conflicts with:"]}),e.jsx("ul",{className:"ml-4 mt-1 space-y-1",children:t.conflicting_with.map((c,m)=>e.jsxs("li",{className:"text-yellow-700",children:[c.event," (",P(D(c.start_time),"MMM d, h:mm a")," - ",P(D(c.end_time),"h:mm a"),")"]},m))})]},r))})]}),e.jsxs("div",{className:"mb-4 flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search events or locations...",value:p,onChange:t=>M(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsxs("select",{value:_,onChange:t=>O(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"all",children:"All Roles"}),z.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),u.length>0&&e.jsxs("div",{className:"mb-4 flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.size===u.length&&u.length>0,onChange:V,className:"w-4 h-4 text-teal-600 rounded focus:ring-teal-500"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Select All (",u.length," shifts)"]})]}),i.size>0&&e.jsxs("span",{className:"text-sm font-medium text-teal-600",children:[i.size," selected"]})]}),u.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(le,{size:48,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"font-medium",children:"No available shifts found"}),e.jsx("p",{className:"text-sm mt-1",children:p||_!=="all"?"Try adjusting your filters":`No shifts matching ${o.first_name}'s skills need workers`})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:u.map(t=>{const r=i.has(t.id);return e.jsx("button",{onClick:()=>v(t.id),className:`w-full p-4 rounded-lg border-2 transition-all text-left ${r?"border-teal-600 bg-teal-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:()=>v(t.id),className:"mt-1 w-4 h-4 text-teal-600 rounded focus:ring-teal-500",onClick:c=>c.stopPropagation()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:t.event.title}),e.jsx("span",{className:"inline-block px-2 py-0.5 bg-purple-100 text-purple-700 text-xs font-medium rounded mt-1",children:t.role_needed})]})}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{size:14,className:"text-gray-400"}),e.jsx("span",{children:N(t.start_time_utc)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{size:14,className:"text-gray-400"}),e.jsxs("span",{children:[y(t.start_time_utc)," - ",y(t.end_time_utc)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"truncate",children:t.location})]})]})]})]})},t.id)})})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:i.size>0?e.jsxs("span",{className:"font-medium",children:[i.size," shift",i.size!==1?"s":""," selected"]}):e.jsxs("span",{children:["Select shifts to assign ",o.first_name," to"]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:j,disabled:b,className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:$,disabled:i.size===0||b,className:"px-6 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Scheduling..."]}):e.jsxs(e.Fragment,{children:["Schedule for ",i.size," Shift",i.size!==1?"s":""]})})]})]})]})})}export{ve as WorkersPage};
