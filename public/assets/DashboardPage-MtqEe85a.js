import{c as P,a as q,j as e,A as S}from"./index-C9IWPjQt.js";import{b as K,u as Q,r as v}from"./vendor-79DyBOV9.js";import{c as H,C as J}from"./utils-8DdcPMYV.js";import{s as z,e as W}from"./index-6Qs-loHP.js";import{p as N}from"./index-BK_MyBzW.js";import{r as D,t as y,a as X,f as w}from"./index-C_slYh2M.js";import{s as Z,e as ee}from"./index-PThmsgkk.js";import{C as te}from"./chevron-right-dSdG2hoY.js";import{M as se}from"./map-pin-D6YiDQZi.js";import{C as ae}from"./clock-Bt7GUD-8.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=P("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=P("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);function I(s,o){D(2,arguments);var r=y(s),i=X(o);if(isNaN(i))return new Date(NaN);if(!i)return r;var l=r.getDate(),d=new Date(r.getTime());d.setMonth(r.getMonth()+i+1,0);var t=d.getDate();return l>=t?d:(r.setFullYear(d.getFullYear(),d.getMonth(),l),r)}function T(s){D(1,arguments);var o=y(s);return o.setHours(0,0,0,0),o}function V(s,o){D(2,arguments);var r=T(s),i=T(o);return r.getTime()===i.getTime()}function ne(s,o){var r;D(1,arguments);var i=s||{},l=y(i.start),d=y(i.end),t=d.getTime();if(!(l.getTime()<=t))throw new RangeError("Invalid interval");var c=[],x=l;x.setHours(0,0,0,0);var p=Number((r=void 0)!==null&&r!==void 0?r:1);if(p<1||isNaN(p))throw new RangeError("`options.step` must be a number greater than 1");for(;x.getTime()<=t;)c.push(y(x)),x.setDate(x.getDate()+p),x.setHours(0,0,0,0);return c}function le(s,o){D(2,arguments);var r=y(s),i=y(o);return r.getFullYear()===i.getFullYear()&&r.getMonth()===i.getMonth()}function ie(s){return D(1,arguments),V(s,Date.now())}function ye(){const s=K(),o=Q(),[r,i]=v.useState({draft_events:0,published_events:0,completed_events:0,total_workers:0,gaps_to_fill:0,urgent_events:0,month_events:0}),[l,d]=v.useState(new Date),[t,c]=v.useState([]),[x,p]=v.useState([]),[O,M]=v.useState(!0);v.useEffect(()=>{_()},[l]),v.useEffect(()=>{const n=()=>{document.hidden||_()},u=()=>{_()};return document.addEventListener("visibilitychange",n),window.addEventListener("focus",u),()=>{document.removeEventListener("visibilitychange",n),window.removeEventListener("focus",u)}},[l]),v.useEffect(()=>{if(o.pathname==="/dashboard"){const n=setTimeout(()=>{_()},100);return()=>clearTimeout(n)}},[o.pathname]);async function _(){M(!0);try{const n=await q.get("/dashboard");if(n.data.status==="success"){const u=n.data.data;i({draft_events:u.draft_events,published_events:u.published_events,completed_events:u.completed_events,total_workers:u.total_workers,gaps_to_fill:u.gaps_to_fill,urgent_events:u.urgent_events,month_events:u.month_events});const b=await q.get("/events");if(b.data.status==="success"){const j=b.data.data,L=z(l),B=W(l),U=j.filter(a=>a.status==="published"),f={};U.forEach(a=>{if(!a.schedule)return;const g=N(a.schedule.start_time_utc);if(g>=L&&g<=B){const h=w(g,"yyyy-MM-dd");f[h]||(f[h]={date:g,status:"fully_staffed",events:[],shifts_count:0,needs_workers_count:0,total_hired_today:0,total_required_today:0});const C=a.assigned_workers_count||0,A=a.total_workers_needed||0;f[h].events.push({id:a.id,title:a.title,unfilled_roles_count:a.unfilled_roles_count||0,hired_count:C,required_count:A}),f[h].shifts_count+=a.total_shifts_count||0,f[h].needs_workers_count+=a.unfilled_roles_count||0,f[h].total_hired_today+=C,f[h].total_required_today+=A,a.staffing_status==="needs_workers"?f[h].status="needs_workers":a.staffing_status==="partially_staffed"&&f[h].status!=="needs_workers"&&(f[h].status="partially_staffed")}}),c(Object.values(f));const $=new Map;U.filter(a=>{if(!a.schedule||(a.unfilled_roles_count||0)===0)return!1;const g=N(a.schedule.start_time_utc),h=new Date;if(g<h)return!1;const C=(g.getTime()-h.getTime())/(1e3*60*60);return C>0&&C<=48}).forEach(a=>{if(!$.has(a.id)){const h=(N(a.schedule.start_time_utc).getTime()-new Date().getTime())/(1e3*60*60);$.set(a.id,{...a,venue:a.venue||{name:"",formatted_address:""},hours_until:h})}});const G=Array.from($.values()).sort((a,g)=>a.hours_until!==g.hours_until?a.hours_until-g.hours_until:a.staffing_percentage-g.staffing_percentage).slice(0,5);p(G)}}}catch(n){console.error("Failed to load dashboard data:",n)}finally{M(!1)}}const R=()=>{d(I(l,-1))},F=()=>{d(I(l,1))},m=()=>{d(new Date)},k=n=>{const u=w(n,"yyyy-MM-dd"),b=T(new Date),L=T(n)<b?"completed":"active";s(`/events?tab=${L}&date=${u}`)};return O?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600"})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Overview of events and staffing needs"})]}),e.jsx("button",{onClick:()=>s("/events/create"),className:"px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Create New Event"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsx(E,{label:"Draft Events",value:r.draft_events,onClick:()=>s("/events?tab=draft"),color:"gray"}),e.jsx(E,{label:"Active Events",value:r.published_events,onClick:()=>s("/events?tab=active"),color:"blue"}),e.jsx(E,{label:"Completed Events",value:r.completed_events,onClick:()=>s("/events?tab=completed"),color:"green"}),e.jsx(E,{label:"Unfilled Roles",value:r.gaps_to_fill,onClick:()=>s("/events?tab=active&filter=needs_workers"),color:"red",isHero:!0})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6 mb-8",children:e.jsx(oe,{currentMonth:l,calendarData:t,onPreviousMonth:R,onNextMonth:F,onToday:m,onDayClick:k})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200",children:e.jsx(de,{events:x,onEventClick:n=>s(`/events?tab=active&event_id=${n}`)})})]})})}function E({label:s,value:o,onClick:r,color:i,isHero:l}){const d={gray:"bg-white hover:border-gray-300",blue:"bg-white hover:border-blue-300",green:"bg-white hover:border-green-300",red:l?"bg-red-50 border-red-200 hover:border-red-300":"bg-white hover:border-red-300"},t={gray:"text-gray-900",blue:"text-blue-900",green:"text-green-900",red:"text-red-900"},c={gray:"text-gray-600",blue:"text-blue-600",green:"text-green-600",red:l?"text-red-700":"text-red-600"};return e.jsxs("button",{onClick:r,className:`relative overflow-hidden rounded-lg border p-6 transition-all duration-200 text-left ${d[i]} hover:shadow-lg`,children:[l&&o>5&&e.jsxs("div",{className:"absolute top-0 right-0 w-3 h-3 m-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-red-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`text-sm font-medium mb-1 ${c[i]}`,children:s}),e.jsx("span",{className:`text-4xl font-bold ${t[i]}`,children:o})]}),l&&o>0&&e.jsxs("div",{className:"mt-3 flex items-center gap-1 text-sm font-medium text-red-600",children:[e.jsx(S,{size:16}),e.jsx("span",{children:"Requires attention"})]}),!l&&e.jsxs("div",{className:"mt-3 flex items-center gap-1 text-sm font-medium text-gray-500",children:[e.jsx("span",{children:"View all"}),e.jsx(Y,{size:16})]})]})}function oe({currentMonth:s,calendarData:o,onPreviousMonth:r,onNextMonth:i,onToday:l,onDayClick:d}){const t=z(s),c=W(s),x=Z(t,{weekStartsOn:0}),p=ee(c,{weekStartsOn:0}),O=ne({start:x,end:p}),M=m=>o.find(k=>V(k.date,m)),_=m=>{switch(m){case"fully_staffed":return"âœ“";case"partially_staffed":return"ðŸŸ¡";case"needs_workers":return"ðŸ”´";default:return null}},R=m=>{switch(m){case"fully_staffed":return"bg-green-50 border-green-200";case"partially_staffed":return"bg-yellow-50 border-yellow-200";case"needs_workers":return"bg-red-50 border-red-200";default:return""}},F=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:w(s,"MMMM yyyy")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Previous month",children:e.jsx(re,{size:20})}),e.jsx("button",{onClick:l,className:"px-3 py-1.5 text-sm font-medium text-teal-600 hover:bg-teal-50 rounded-lg transition",children:"Today"}),e.jsx("button",{onClick:i,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Next month",children:e.jsx(te,{size:20})})]})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[F.map(m=>e.jsx("div",{className:"text-center text-sm font-medium text-gray-600 py-2",children:m},m)),O.map((m,k)=>{const n=M(m),u=le(m,s),b=ie(m),j=n&&n.events.length>0;return e.jsxs("button",{onClick:()=>j&&d(m),disabled:!j,className:`
                relative min-h-[80px] p-2 rounded-lg border transition-all text-left
                ${b?"border-teal-500 bg-teal-50 ring-2 ring-teal-200":j?`${R(n.status)} hover:shadow-md cursor-pointer`:"border-gray-100 bg-white"}
                ${u?"":"opacity-40"}
              `,children:[e.jsx("div",{className:`text-sm font-medium mb-1 ${b?"text-teal-600":u?"text-gray-900":"text-gray-400"}`,children:w(m,"d")}),n&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-2xl text-center",children:_(n.status)}),n.events.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-center text-gray-600",children:[n.events.length," event",n.events.length!==1?"s":""]}),e.jsxs("div",{className:"text-xs text-center font-medium text-gray-700",children:[n.total_hired_today,"/",n.total_required_today," hired"]})]})]})]},k)})]}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-6 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-xl",children:"âœ“"}),e.jsx("span",{className:"text-gray-600",children:"Ready"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-xl",children:"ðŸŸ¡"}),e.jsx("span",{className:"text-gray-600",children:"Partial"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-xl",children:"ðŸ”´"}),e.jsx("span",{className:"text-gray-600",children:"Needs Workers"})]})]})]})}function de({events:s,onEventClick:o}){const r=t=>{if(!t.schedule)return!1;const x=(N(t.schedule.start_time_utc).getTime()-new Date().getTime())/(1e3*60*60);return x>0&&x<=48},i=()=>e.jsxs("span",{className:"bg-amber-100 text-amber-700 text-xs font-semibold px-2 py-0.5 rounded-full inline-flex items-center gap-1","aria-label":"Urgent: starts within 48 hours",children:[e.jsx(S,{className:"h-3 w-3"}),"Urgent"]}),l=t=>{const c=N(t);return w(c,"EEE, MMM d")},d=t=>{const c=N(t);return w(c,"h:mm a")};return s.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽ‰"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"All Caught Up!"}),e.jsx("p",{className:"text-gray-600",children:"No urgent staffing needs at the moment. Great work!"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(S,{className:"h-5 w-5 text-amber-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Priority Staffing Queue"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.length," ",s.length===1?"event needs":"events need"," workers Â· Sorted by urgency"]})]}),e.jsx("div",{className:"divide-y divide-gray-200",children:s.map(t=>{var c;return e.jsx("div",{className:"px-6 py-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:l(t.schedule.start_time_utc)}),r(t)&&e.jsx(e.Fragment,{children:i()})]}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-2 truncate",children:t.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3 flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"h-4 w-4 flex-shrink-0 text-gray-400"}),e.jsx("span",{className:"truncate",children:((c=t.venue)==null?void 0:c.name)||"Venue TBD"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"h-4 w-4 flex-shrink-0 text-gray-400"}),e.jsxs("span",{children:[d(t.schedule.start_time_utc)," - ",d(t.schedule.end_time_utc)]})]})]}),e.jsx("div",{className:"mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:H("h-full rounded-full transition-all duration-300",(t.staffing_percentage||0)>=100?"bg-green-500":(t.staffing_percentage||0)>=75?"bg-amber-500":"bg-red-500"),style:{width:`${t.staffing_percentage||0}%`}})}),e.jsxs("span",{className:"text-xs font-medium text-gray-600 min-w-[3rem] text-right",children:[t.staffing_percentage||0,"%"]})]})}),e.jsx("div",{className:"flex items-center gap-1.5 text-sm",children:t.unfilled_roles_count>0?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-4 w-4 text-red-600 flex-shrink-0"}),e.jsxs("span",{className:"text-red-600 font-medium",children:[t.unfilled_roles_count," ",t.unfilled_roles_count===1?"role":"roles"," still need workers"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 text-green-600 flex-shrink-0"}),e.jsx("span",{className:"text-green-600 font-medium",children:"Fully staffed"})]})})]}),e.jsxs("button",{onClick:()=>o(t.id),className:"px-4 py-2 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors whitespace-nowrap flex items-center gap-2",children:["Assign Workers",e.jsx(Y,{size:16})]})]})},t.id)})})]})}export{ye as DashboardPage};
