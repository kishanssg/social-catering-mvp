import{j as e,u as pe,a as X,X as me,b as ue}from"./index-CrUg2qsF.js";import{R as ye,b as be,u as je,r as f}from"./vendor-79DyBOV9.js";import{L as oe}from"./LoadingSpinner-Dlf4Thtt.js";import{S as xe,C as ve}from"./ConfirmationModal-B9xIhR5g.js";import{T as Ne}from"./Toast-BLWLEZrw.js";import{P as fe}from"./plus-C0xYgJ2s.js";import{U as _e}from"./user-Bio2_wqM.js";import{C as Se,X as we}from"./x-circle-DHcNWpLx.js";import{C as he}from"./calendar-uMuF1bsT.js";import{P as Ce}from"./pen-square-CmSWIQqN.js";import{T as ke}from"./trash-2-CBGAvWap.js";import{f as se}from"./index-C_slYh2M.js";import{p as te}from"./index-BK_MyBzW.js";import{B as $e}from"./briefcase-BrrsVYaW.js";import{C as Ae}from"./clock-BQ9zM5Kz.js";import{M as Ee}from"./map-pin-DaOKPb_z.js";import{D as ze}from"./dollar-sign-BA69K2km.js";function De({name:c,src:$,size:_=40}){const[x,W]=ye.useState(!1),h=(c||"User").split(" ").filter(Boolean).slice(0,2).map(B=>{var b;return(b=B[0])==null?void 0:b.toUpperCase()}).join("")||"UW",E={width:_,height:_,minWidth:_};return e.jsx("div",{className:"rounded-full overflow-hidden bg-gray-200 flex items-center justify-center ring-1 ring-gray-300",style:E,"aria-label":c,children:$&&!x?e.jsx("img",{src:$,alt:c,className:"w-full h-full object-cover",onError:()=>W(!0),crossOrigin:"anonymous",referrerPolicy:"no-referrer"}):e.jsx("span",{className:"text-gray-600 text-sm font-medium select-none",children:h})})}function Ye(){const c=be(),$=je(),{isAuthenticated:_,isLoading:x}=pe(),[W,h]=f.useState([]),[E,B]=f.useState(!0),[b,T]=f.useState(""),[I,H]=f.useState("name"),[p,A]=f.useState("all"),[V,z]=f.useState({isOpen:!1}),[ce,J]=f.useState([]),[de,D]=f.useState(null),[S,F]=f.useState({isOpen:!1}),[ae,q]=f.useState(!1),[L,O]=f.useState({isVisible:!1,message:"",type:"success"});f.useEffect(()=>{_&&!x&&U()},[_,x]),f.useEffect(()=>{_&&!x&&$.pathname==="/workers"&&U()},[$.pathname,_,x]);async function U(){B(!0);try{const t=await X.get("/workers");if(t.data.status==="success"){const d=t.data.data||[];h(d)}else h([])}catch(t){console.error("Failed to load workers:",t),h([])}finally{B(!1)}}const K=t=>{F({isOpen:!0,worker:t})},ie=async()=>{var t,d,v,s,r,a;if(S.worker){q(!0);try{(await X.delete(`/workers/${(t=S.worker)==null?void 0:t.id}`)).data.status==="success"&&(O({isVisible:!0,message:`${S.worker.first_name||"Unknown"} ${S.worker.last_name||"Worker"} has been deleted successfully`,type:"success"}),U(),F({isOpen:!1}))}catch(o){console.error("Failed to delete worker:",o),console.error("Error response data:",(d=o.response)==null?void 0:d.data);let l="Failed to delete worker. Please try again.";(s=(v=o.response)==null?void 0:v.data)!=null&&s.error?l=o.response.data.error:(a=(r=o.response)==null?void 0:r.data)!=null&&a.errors?l=Array.isArray(o.response.data.errors)?o.response.data.errors.join(", "):o.response.data.errors.toString():o.message&&(l=o.message),console.error("Final error message shown to user:",l),O({isVisible:!0,message:l,type:"error"})}finally{q(!1)}}},le=()=>{F({isOpen:!1})},ne=t=>{z({isOpen:!0,worker:t}),J([]),D(null)},Y=()=>{z({isOpen:!1})},Z=t=>{console.log("handleBulkAssignSuccess called with message:",t),console.log("Closing modal and showing toast..."),Y(),O({isVisible:!0,message:t||"Worker scheduled successfully",type:"success"}),U(),console.log("Modal should now be closed")},G=W.filter(t=>{if(p==="active"&&!t.active||p==="inactive"&&t.active)return!1;if(b){const d=b.toLowerCase();return(t.first_name||"").toLowerCase().includes(d)||(t.last_name||"").toLowerCase().includes(d)||(t.email||"").toLowerCase().includes(d)||(t.phone||"").includes(d)||(t.skills_json||[]).some(v=>(v||"").toLowerCase().includes(d))||(t.certifications||[]).some(v=>((v==null?void 0:v.name)||"").toLowerCase().includes(d))}return!0}).sort((t,d)=>{switch(I){case"name":return`${t.first_name||""} ${t.last_name||""}`.localeCompare(`${d.first_name||""} ${d.last_name||""}`);case"email":return(t.email||"").localeCompare(d.email||"");case"status":return(d.active?1:0)-(t.active?1:0);default:return 0}});return x?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(oe,{})}):_?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Workers"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your workforce"})]}),e.jsxs("button",{onClick:()=>c("/workers/create"),className:"flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(fe,{size:20}),"Add New Worker"]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 max-w-md relative",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search workers by name, email, phone, skills, or certifications",value:b,onChange:t=>T(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),e.jsxs("select",{value:I,onChange:t=>H(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"name",children:"Sort by Name"}),e.jsx("option",{value:"email",children:"Sort by Email"}),e.jsx("option",{value:"status",children:"Sort by Status"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>A("all"),className:`px-3 py-2 text-sm font-medium rounded-lg transition-colors ${p==="all"?"bg-teal-100 text-teal-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"All"}),e.jsx("button",{onClick:()=>A("active"),className:`px-3 py-2 text-sm font-medium rounded-lg transition-colors ${p==="active"?"bg-green-100 text-green-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Active"}),e.jsx("button",{onClick:()=>A("inactive"),className:`px-3 py-2 text-sm font-medium rounded-lg transition-colors ${p==="inactive"?"bg-gray-200 text-gray-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Inactive"})]})]}),E?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(oe,{})}):G.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_e,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:b?"No workers found":"No workers yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:b?"Try adjusting your search or filters":"Add your first worker to get started"}),!b&&e.jsxs("button",{onClick:()=>c("/workers/create"),className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:[e.jsx(fe,{size:20}),"Add Worker"]})]}):e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Name"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Phone"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Email"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:G.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>c(`/workers/${t.id}`),children:[e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(De,{name:`${t.first_name||"Unknown"} ${t.last_name||"Worker"}`,src:t.profile_photo_url,size:40}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[t.first_name||"Unknown"," ",t.last_name||"Worker"]}),t.skills_json&&t.skills_json.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.skills_json.map((d,v)=>{const s=b&&d.toLowerCase().includes(b.toLowerCase());return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${s?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:d},v)})})]})]})}),e.jsx("td",{className:"py-4 px-6 text-sm text-gray-600",children:t.phone||"â€”"}),e.jsx("td",{className:"py-4 px-6 text-sm text-gray-600",children:t.email}),e.jsx("td",{className:"py-4 px-6",children:t.active?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[e.jsx(Se,{size:14}),"Active"]}):e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-gray-100 text-gray-600 text-xs font-medium rounded-full",children:[e.jsx(we,{size:14}),"Inactive"]})}),e.jsx("td",{className:"py-4 px-6 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.active&&e.jsxs("button",{onClick:d=>{d.stopPropagation(),ne(t)},className:"px-3 py-1.5 bg-purple-600 text-white text-sm font-medium rounded-lg hover:bg-purple-700 transition-colors",title:"Schedule Worker",children:[e.jsx(he,{size:14,className:"inline mr-1"}),"Schedule"]}),e.jsx("button",{onClick:d=>{d.stopPropagation(),c(`/workers/${t.id}/edit`)},className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Edit",children:e.jsx(Ce,{size:16})}),e.jsx("button",{onClick:d=>{d.preventDefault(),d.stopPropagation(),K(t)},className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition",title:"Delete",children:e.jsx(ke,{size:16})})]})})]},t.id))})]})})]}),V.isOpen&&V.worker&&e.jsx(Re,{worker:V.worker,onClose:Y,onSuccess:Z}),e.jsx(ve,{isOpen:S.isOpen,onClose:le,onConfirm:ie,title:"Delete Worker",message:"Are you sure you want to delete this worker?",confirmText:"Delete Worker",cancelText:"Cancel",isLoading:ae,isDestructive:!0,workerName:S.worker?`${S.worker.first_name||"Unknown"} ${S.worker.last_name||"Worker"}`:void 0}),e.jsx(Ne,{isVisible:L.isVisible,message:L.message,type:L.type,onClose:()=>O({...L,isVisible:!1})})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Authentication Required"}),e.jsx("p",{className:"text-gray-600",children:"Please log in to view workers."})]})})}function Re({worker:c,onClose:$,onSuccess:_}){var v;const[x,W]=f.useState([]),[h,E]=f.useState(new Set),[B,b]=f.useState(!0),[T,I]=f.useState(!1),[H,p]=f.useState(null),[A,V]=f.useState(""),[z,ce]=f.useState("all"),[J,de]=f.useState([]),[D,S]=f.useState({}),[F,ae]=f.useState(new Set),[q,L]=f.useState({});f.useEffect(()=>{c&&c.id&&O()},[c==null?void 0:c.id]),f.useEffect(()=>{c&&c.id&&x.length>0&&U()},[c==null?void 0:c.id,x]),f.useEffect(()=>{if(x.length>0){const s={};x.forEach(r=>{const a=Number(r.pay_rate)||0,o=Number(r.default_pay_rate)||0,l=a>0?a:o;l>0&&(s[r.id]=l)}),Object.keys(s).length>0&&S(r=>({...r,...s}))}},[x]);async function O(){var s;if(!(!c||!c.id)){b(!0);try{const r=await X.get("/events",{params:{tab:"active",filter:"needs_workers"}});if(r.data.status==="success"){const a=r.data.data;console.log("ðŸ” Schedule Worker Modal - API Response:",{eventsCount:a.length,workerSkills:c.skills_json,firstEvent:a[0]?{id:a[0].id,title:a[0].title,hasShiftsByRole:!!a[0].shifts_by_role,shiftsByRoleCount:((s=a[0].shifts_by_role)==null?void 0:s.length)||0,shiftsByRole:a[0].shifts_by_role}:null});const o=[];a.forEach(l=>{if(l&&l.shifts_by_role){console.log(`ðŸ“‹ Event ${l.id} (${l.title}):`,{shiftsByRoleCount:l.shifts_by_role.length,roleNames:l.shifts_by_role.map(i=>i.role_name||i.skill_name)});const u={id:l.id,title:l.title||"Untitled Event"};l.shifts_by_role.forEach(i=>{var w,j,N;const n=i.role_name||i.skill_name,m=c.skills_json&&c.skills_json.includes(n),y=i.filled_shifts<i.total_shifts;if(console.log(`  ðŸ” Role "${n}":`,{workerHasSkill:m,isNotFullyStaffed:y,filledShifts:i.filled_shifts,totalShifts:i.total_shifts,shiftsCount:((w=i.shifts)==null?void 0:w.length)||0,shifts:((j=i.shifts)==null?void 0:j.map(g=>({id:g.id,capacity:g.capacity,filled_positions:g.filled_positions,hasCapacity:g.capacity>(g.filled_positions||0)})))||[]}),i&&m&&y){if(!i.shifts||i.shifts.length===0){console.log(`  âš ï¸ Role "${n}" has no shifts array or empty shifts`);return}const g=i.shifts.filter(k=>{const R=k.capacity?Number(k.capacity):1,M=k.filled_positions||0,P=R>M;return console.log(`    Shift ${k.id}: capacity=${R} (raw: ${k.capacity}), filled=${M}, hasCapacity=${P}`),P});if(console.log(`  ðŸ“Š Role "${n}": ${g.length} shifts with capacity out of ${i.shifts.length} total`),g.length===0){console.log(`  âŒ Role "${n}" filtered out: no shifts with available capacity`);return}const C=g[0];if(C){const k=g.map(Q=>Q.id),R=g.reduce((Q,ee)=>{const re=ee.capacity?Number(ee.capacity):1;return Q+re},0),M=g.reduce((Q,ee)=>{const re=ee.filled_positions||0;return Q+re},0),P=R-M,ge={id:C.id,event:u,role_needed:i.role_name,start_time_utc:C.start_time_utc,end_time_utc:C.end_time_utc,location:((N=l.venue)==null?void 0:N.formatted_address)||"Location TBD",current_status:C.status,pay_rate:Number(i.pay_rate)||Number(C.pay_rate)||0,default_pay_rate:Number(i.pay_rate)||0,total_positions:R||i.total_shifts||0,filled_positions:M||0,available_positions:Math.max(0,P),all_shift_ids:k};o.push(ge)}}})}}),console.log("âœ… Final available shifts:",{count:o.length,shifts:o.map(l=>{var u;return{event:(u=l.event)==null?void 0:u.title,role:l.role_needed,available:l.available_positions}})}),W(o)}}catch(r){console.error("Failed to load available shifts:",r),p("Failed to load available shifts")}finally{b(!1)}}}async function U(){if(!(!c||!c.id))try{const s=[];if(x.forEach(a=>{a.all_shift_ids&&s.push(...a.all_shift_ids)}),s.length===0)return;const r=await X.post("/staffing/validate_bulk",{worker_id:c.id,shift_ids:s});if(r.data.status==="success"){const{invalid_shifts:a}=r.data.data,o=new Set,l={};a.forEach(u=>{const i=x.find(n=>{var m;return(m=n.all_shift_ids)==null?void 0:m.includes(u.shift_id)});i&&(o.add(i.id),l[i.id]=u.errors.map(n=>n.message))}),ae(o),L(l)}}catch(s){console.error("Failed to validate shifts:",s)}}const K=s=>{const r=new Set(h),a=x.find(o=>o.id===s);if(a){if(r.has(s))r.delete(s);else{if(F.has(s)){const l=q[s]||["Not available"];p(`Cannot select this shift: ${l.join(", ")}`);return}if(Array.from(r).forEach(l=>{var i,n,m;const u=x.find(y=>y.id===l);if(u&&((i=u.event)==null?void 0:i.id)===((n=a.event)==null?void 0:n.id)&&u.start_time_utc===a.start_time_utc&&u.end_time_utc===a.end_time_utc&&u.role_needed!==a.role_needed){r.delete(l),p(`Selected ${a.role_needed} for ${(m=a.event)==null?void 0:m.title}. Previous role (${u.role_needed}) was unselected.`);return}}),Array.from(r).some(l=>{var j,N;const u=x.find(g=>g.id===l);if(!u||((j=u.event)==null?void 0:j.id)===((N=a.event)==null?void 0:N.id))return!1;const i=new Date(a.start_time_utc).getTime(),n=new Date(a.end_time_utc).getTime(),m=new Date(u.start_time_utc).getTime(),y=new Date(u.end_time_utc).getTime(),w=i<y&&n>m;return console.log("Checking overlap:",{shiftA:`${new Date(i).toISOString()} - ${new Date(n).toISOString()}`,shiftB:`${new Date(m).toISOString()} - ${new Date(y).toISOString()}`,overlaps:w}),w})){p("Cannot select this shift: It overlaps with another selected shift. Please deselect the conflicting shift first.");return}r.add(s)}E(r),p(null)}},ie=(s,r)=>{S(a=>({...a,[s]:r}))},le=()=>{h.size===t.length?E(new Set):E(new Set(t.map(s=>s.id)))};async function ne(){var s,r;if(h.size===0){p("Please select at least one shift");return}I(!0),p(null);try{const a=[];x.filter(n=>h.has(n.id)).forEach(n=>{a.push(n.id)});const u=[...new Set(a)].map(n=>{const m=x.find(w=>{var j;return(j=w.all_shift_ids)==null?void 0:j.includes(n)}),y=Number(D[n])||Number(m==null?void 0:m.pay_rate)||Number(m==null?void 0:m.default_pay_rate)||0;return{shift_id:n,worker_id:c.id,hourly_rate:y}}),i=await X.post("/staffing/bulk_create",{assignments:u});if(console.log("Bulk create response:",i.data),p(null),de([]),i.data.status==="success"||i.data.status==="partial_success"){let n=i.data.message;if(i.data.status==="partial_success"&&i.data.data){const{successful:m,failed:y,total_requested:w}=i.data.data,j=m.length,N=y.length,g=w||j+N;if(n=`Successfully scheduled ${j} of ${g} shift${g!==1?"s":""}`,N>0&&j>0){const C=y.map(k=>{var P;const R=k.event||"Unknown Event",M=((P=k.reasons)==null?void 0:P[0])||k.reason||"Unknown reason";return`${R} (${M})`}).join(", ");n+=`. ${N} ${N===1?"shift":"shifts"} could not be scheduled: ${C}`}}console.log("Success - calling onSuccess with message:",n),_(n)}else if(i.data.status==="error"){let n=i.data.message||"Failed to schedule worker for shifts";if(i.data.details&&i.data.details.length>0&&(n+=`

Details:
â€¢ `+i.data.details.join(`
â€¢ `)),(s=i.data.data)!=null&&s.failed){const m=i.data.data.failed.map(y=>{var N,g,C;const w=y.event||((g=(N=y.shift)==null?void 0:N.event)==null?void 0:g.title)||"Unknown Event",j=((C=y.reasons)==null?void 0:C[0])||y.reason||"Unknown reason";return`${w} (${j})`}).join(", ");n+=`

Failed shifts: ${m}`}p(n)}else console.error("Unknown response status:",i.data.status),p("Unexpected response from server")}catch(a){console.error("Failed to bulk assign:",a);let o="Failed to schedule worker for shifts";(r=a.response)!=null&&r.data&&(a.response.data.message&&(o=a.response.data.message),a.response.data.details&&a.response.data.details.length>0&&(o+=`

Details:
â€¢ `+a.response.data.details.join(`
â€¢ `))),p(o)}finally{I(!1)}}const Y=s=>se(te(s),"EEE, MMM d, yyyy"),Z=s=>se(te(s),"h:mm a"),G=c.skills_json||[],t=x.filter(s=>{var r;if(z!=="all"&&s.role_needed!==z)return!1;if(A){const a=A.toLowerCase();return(((r=s.event)==null?void 0:r.title)||"").toLowerCase().includes(a)||(s.location||"").toLowerCase().includes(a)}return!0}),d=s=>Array.from(h).some(a=>{var l,u;const o=x.find(i=>i.id===a);return o?((l=o.event)==null?void 0:l.id)===((u=s.event)==null?void 0:u.id)&&o.start_time_utc===s.start_time_utc&&o.end_time_utc===s.end_time_utc&&o.role_needed!==s.role_needed:!1});return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Schedule ",c.first_name," ",c.last_name," for Shifts"]}),e.jsx("button",{onClick:$,className:"p-1 text-gray-400 hover:text-gray-600 rounded transition",children:e.jsx(me,{size:24})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:(v=c.skills_json)==null?void 0:v.map(s=>e.jsx("span",{className:"px-2.5 py-1 bg-teal-100 text-teal-700 text-xs font-medium rounded",children:s},s))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:B?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(oe,{})}):e.jsxs(e.Fragment,{children:[H&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2",children:[e.jsx(me,{size:18,className:"text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-red-700",children:H.split(`
`).map((s,r)=>e.jsx("p",{className:s.startsWith("â€¢")?"ml-2":"",children:s},r))})]}),J.length>0&&e.jsxs("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"Scheduling Conflicts"}),e.jsx("div",{className:"space-y-2",children:J.map((s,r)=>{var a;return e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"text-yellow-800",children:[e.jsx("strong",{children:((a=s.new_shift)==null?void 0:a.event)||"Unknown Event"})," conflicts with:"]}),e.jsx("ul",{className:"ml-4 mt-1 space-y-1",children:(s.conflicting_with||[]).map((o,l)=>e.jsxs("li",{className:"text-yellow-700",children:[o.event||"Unknown Event"," (",se(te(o.start_time),"MMM d, h:mm a")," - ",se(te(o.end_time),"h:mm a"),")"]},l))})]},r)})})]}),e.jsxs("div",{className:"mb-4 flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search events or locations...",value:A,onChange:s=>V(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsxs("select",{value:z,onChange:s=>ce(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"all",children:"All Roles"}),G.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),t.length>0&&e.jsxs("div",{className:"mb-4 flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h.size===t.length&&t.length>0,onChange:le,className:"w-4 h-4 text-teal-600 rounded focus:ring-teal-500"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Select All (",t.length," shifts)"]})]}),h.size>0&&e.jsxs("span",{className:"text-sm font-medium text-teal-600",children:[h.size," selected"]})]}),t.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx($e,{size:48,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"font-medium",children:"No available shifts found"}),e.jsx("p",{className:"text-sm mt-1",children:A||z!=="all"?"Try adjusting your filters":`No shifts matching ${c.first_name}'s skills need workers`})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:t.map(s=>{var i;const r=h.has(s.id),a=d(s),o=F.has(s.id),l=(a||o)&&!r,u=q[s.id]||[];return e.jsxs("button",{onClick:()=>K(s.id),className:`w-full p-4 rounded-lg border-2 transition-all text-left ${r?"border-teal-600 bg-teal-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:r,disabled:l,onChange:()=>K(s.id),className:`mt-1 w-4 h-4 rounded focus:ring-teal-500 ${l?"text-gray-400 cursor-not-allowed":"text-teal-600"}`,onClick:n=>n.stopPropagation()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{children:[e.jsx("h4",{className:`font-medium ${l?"text-gray-500":"text-gray-900"}`,children:((i=s.event)==null?void 0:i.title)||"Untitled Event"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`inline-block px-2 py-0.5 text-xs font-medium rounded ${l?"bg-gray-200 text-gray-500":"bg-purple-100 text-purple-700"}`,children:s.role_needed}),s.total_positions&&s.total_positions>0&&e.jsxs("span",{className:`text-xs ${l?"text-gray-400":"text-gray-500"}`,children:[s.available_positions??0," of ",s.total_positions," positions available"]}),a&&!r&&e.jsx("span",{className:"text-xs text-red-600 font-medium",children:"(Conflicts with selected role)"}),o&&!r&&e.jsxs("span",{className:"text-xs text-red-600 font-medium flex items-center gap-1",children:[e.jsx(ue,{size:12}),"(Not available)"]})]})]})}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{size:14,className:"text-gray-400"}),e.jsx("span",{children:Y(s.start_time_utc)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{size:14,className:"text-gray-400"}),e.jsxs("span",{children:[Z(s.start_time_utc)," - ",Z(s.end_time_utc)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"truncate",children:s.location})]})]})]}),e.jsx("div",{className:"flex flex-col items-end gap-1",onClick:n=>n.stopPropagation(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[D[s.id]&&Number(D[s.id])!==(Number(s.pay_rate)||Number(s.default_pay_rate)||0)&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"(custom)"}),e.jsx(ze,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"text-gray-500 text-sm",children:"Pay:"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:(Number(s.pay_rate)||Number(s.default_pay_rate)||0).toString(),value:D[s.id]!==void 0?Number(D[s.id])||0:Number(s.pay_rate)||Number(s.default_pay_rate)||0,onChange:n=>{const m=n.target.value;(m===""||/^\d*\.?\d*$/.test(m))&&ie(s.id,parseFloat(m)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:n=>n.stopPropagation(),onFocus:n=>n.stopPropagation()}),e.jsx("span",{className:"text-gray-500 text-sm",children:"/hr"})]})})]}),o&&u.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-red-200",children:e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx(ue,{size:14,className:"text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-red-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"Cannot assign to this shift:"}),e.jsx("ul",{className:"list-disc list-inside space-y-0.5",children:u.map((n,m)=>e.jsx("li",{children:n},m))})]})]})})]},s.id)})})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:h.size>0?e.jsxs("span",{className:"font-medium",children:[h.size," shift",h.size!==1?"s":""," selected"]}):e.jsxs("span",{children:["Select shifts to assign ",c.first_name," to"]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:$,disabled:T,className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:ne,disabled:h.size===0||T,className:"px-6 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:T?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Scheduling..."]}):e.jsxs(e.Fragment,{children:["Schedule for ",h.size," Shift",h.size!==1?"s":""]})})]})]})]})})}export{Ye as WorkersPage};
