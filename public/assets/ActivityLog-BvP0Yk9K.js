import{b as z,r as _}from"./vendor-79DyBOV9.js";import{c as k,j as e,X as K,R as Q,a as ee}from"./index-CmwrWGyu.js";import{F as W}from"./file-text-CdRZajbK.js";import{S as I,T as te,L as re}from"./trash-2-DyCA02f_.js";import{D as se}from"./download-p7DVPi4w.js";import{C as T}from"./calendar-B3GBLfN5.js";import{c as E}from"./utils-DuMXYCiK.js";import{X as F,C as R}from"./x-circle-CcZdKpnf.js";import{c as P,d as U}from"./dateUtils-BrhuORve.js";import{U as A}from"./user-DifYpCLH.js";import{r as S,C as ae,f as L}from"./index-G_HN3LUL.js";import{D as H}from"./dollar-sign-BQ4HjPcc.js";import{C as B}from"./chevron-down-CdKvmPsJ.js";import{C as X}from"./chevron-right-Bb9_7F-H.js";import{p as Z}from"./index-DEVVWvUt.js";import{i as oe,b as le,a as ne}from"./index-BQR0oh0L.js";import{s as de}from"./index-D1vR08kF.js";import{s as q}from"./index-CAIrBGIE.js";import"./index-BfcYz2DB.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=k("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=k("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=k("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=k("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=k("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=k("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=k("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=k("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=k("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=k("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);function pe(t,s,n){S(2,arguments);var r=q(t,n),o=q(s,n);return r.getTime()===o.getTime()}function ue(t){return S(1,arguments),oe(Date.now(),t)}function he(t,s){return S(1,arguments),pe(t,Date.now(),s)}function be(t){return S(1,arguments),le(t,de(Date.now(),1))}function fe({searchQuery:t,onSearchChange:s,totalLogs:n,showingLogs:r,activities:o=[]}){const c=()=>{if(o.length===0)return;const a=["Date","Time","Actor","Action","Entity Type","Summary","Worker","Event","Role"],h=o.map(l=>{var N,b,p;const g=new Date(l.created_at);return[g.toLocaleDateString(),g.toLocaleTimeString(),l.actor_name||"System",l.action,l.entity_type,l.summary,((N=l.details)==null?void 0:N.worker_name)||"",((b=l.details)==null?void 0:b.event_name)||"",((p=l.details)==null?void 0:p.role)||""].map($=>`"${String($).replace(/"/g,'""')}"`).join(",")}),m=[a.map(l=>`"${l}"`).join(","),...h].join(`
`),j=new Blob([m],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a"),x=URL.createObjectURL(j);d.setAttribute("href",x),d.setAttribute("download",`activity-log-${new Date().toISOString().split("T")[0]}.csv`),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(W,{className:"h-6 w-6 text-teal-600"}),"Activity Log"]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Track all actions and changes in the system"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-blue-50 text-blue-700 rounded-lg",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsxs("span",{className:"font-medium",children:["Total Logs: ",n.toLocaleString()]})]}),t&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-teal-50 text-teal-700 rounded-lg",children:[e.jsx(I,{className:"h-4 w-4"}),e.jsxs("span",{className:"font-medium",children:["Showing: ",r," of ",n]})]}),o.length>0&&e.jsxs("button",{onClick:c,className:"flex items-center gap-2 px-3 py-1.5 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Export CSV"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(I,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",value:t,onChange:a=>s(a.target.value),placeholder:"Search by worker name, event name, or action...",className:"block w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 text-sm"}),t&&e.jsx("button",{onClick:()=>s(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx(K,{className:"h-5 w-5 text-gray-400 hover:text-gray-600"})})]}),t&&e.jsx("div",{className:"mt-2 text-xs text-gray-500",children:'ðŸ’¡ Tip: Search for "Charlie Williams" to see all activities for that worker, or "Wedding Reception" for all event activities'})]})}function ye({filters:t,onFiltersChange:s,onRefresh:n}){const r=[{label:"All",action:"all",entityType:"all"},{label:"Approvals",action:"event_hours_approved_selected",entityType:"all"},{label:"Edits",action:"hours_re_edited",entityType:"Assignment"},{label:"No-Shows",action:"marked_no_show",entityType:"Assignment"},{label:"Recalculations",action:"totals_recalculated",entityType:"Event"}],o=a=>{a.label==="All"?s({entityType:"all",action:"all",dateFrom:null,dateTo:null,actor:"all"}):s({...t,action:a.action,entityType:a.entityType})},c=Intl.DateTimeFormat().resolvedOptions().timeZone;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 flex-wrap",children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Quick filters:"}),r.map(a=>{const h=t.action===a.action&&t.entityType===a.entityType;return e.jsx("button",{onClick:()=>o(a),className:`
                px-3 py-1 rounded-full text-xs font-medium transition-colors
                ${h?"bg-teal-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}
              `,children:a.label},a.label)})]}),e.jsxs("div",{className:"mb-4 text-xs text-gray-500",children:["Times shown in ",c]}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 font-medium",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Filters:"})]}),e.jsxs("select",{value:t.entityType,onChange:a=>s({...t,entityType:a.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500",children:[e.jsx("option",{value:"all",children:"All Entity Types"}),e.jsx("option",{value:"Worker",children:"Workers"}),e.jsx("option",{value:"Event",children:"Events"}),e.jsx("option",{value:"Assignment",children:"Assignments"}),e.jsx("option",{value:"Shift",children:"Shifts"})]}),e.jsxs("select",{value:t.action,onChange:a=>s({...t,action:a.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500",children:[e.jsx("option",{value:"all",children:"All Actions"}),e.jsx("option",{value:"created",children:"Created"}),e.jsx("option",{value:"updated",children:"Updated"}),e.jsx("option",{value:"deleted",children:"Deleted"}),e.jsx("option",{value:"assigned_worker",children:"Assigned"}),e.jsx("option",{value:"marked_no_show",children:"No Show"}),e.jsx("option",{value:"hours_re_edited",children:"Hours Edited"}),e.jsx("option",{value:"event_hours_approved_selected",children:"Hours Approved"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4 text-gray-500"}),e.jsx("input",{type:"date",value:t.dateFrom||"",onChange:a=>s({...t,dateFrom:a.target.value||null}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500"}),e.jsx("span",{className:"text-gray-500 text-sm",children:"to"}),e.jsx("input",{type:"date",value:t.dateTo||"",onChange:a=>s({...t,dateTo:a.target.value||null}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500"})]}),e.jsxs("button",{onClick:n,className:"ml-auto px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Refresh"]})]})]})}function je({viewMode:t,onViewModeChange:s}){return e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"View:"}),e.jsxs("div",{className:"flex gap-1 bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>s("chronological"),className:E("px-4 py-1.5 rounded-md text-sm font-medium transition-colors flex items-center gap-2",t==="chronological"?"bg-white text-teal-700 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[e.jsx(me,{className:"h-4 w-4"}),"Chronological"]}),e.jsxs("button",{onClick:()=>s("grouped"),className:E("px-4 py-1.5 rounded-md text-sm font-medium transition-colors flex items-center gap-2",t==="grouped"?"bg-white text-teal-700 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[e.jsx(ce,{className:"h-4 w-4"}),"Grouped by Entity"]})]})]})})}function Ne(t){return{event_hours_approved_selected:{icon:R,bgColor:"bg-green-50",textColor:"text-green-600",borderColor:"border-green-500",label:"Hours Approved"},event_hours_approved:{icon:R,bgColor:"bg-green-50",textColor:"text-green-600",borderColor:"border-green-500",label:"All Hours Approved"},approved:{icon:R,bgColor:"bg-green-50",textColor:"text-green-600",borderColor:"border-green-500",label:"Approved"},hours_re_edited:{icon:D,bgColor:"bg-blue-50",textColor:"text-blue-600",borderColor:"border-blue-500",label:"Hours Edited"},hours_updated:{icon:D,bgColor:"bg-blue-50",textColor:"text-blue-600",borderColor:"border-blue-500",label:"Hours Updated"},updated:{icon:D,bgColor:"bg-blue-50",textColor:"text-blue-600",borderColor:"border-blue-500",label:"Updated"},assigned_worker:{icon:G,bgColor:"bg-purple-50",textColor:"text-purple-600",borderColor:"border-purple-500",label:"Worker Assigned"},created:{icon:G,bgColor:"bg-purple-50",textColor:"text-purple-600",borderColor:"border-purple-500",label:"Created"},unassigned_worker:{icon:V,bgColor:"bg-amber-50",textColor:"text-amber-600",borderColor:"border-amber-500",label:"Worker Removed"},removed_from_job:{icon:V,bgColor:"bg-amber-50",textColor:"text-amber-600",borderColor:"border-amber-500",label:"Removed from Job"},marked_no_show:{icon:F,bgColor:"bg-red-50",textColor:"text-red-600",borderColor:"border-red-500",label:"No Show"},rejected:{icon:F,bgColor:"bg-red-50",textColor:"text-red-600",borderColor:"border-red-500",label:"Rejected"},denied:{icon:F,bgColor:"bg-red-50",textColor:"text-red-600",borderColor:"border-red-500",label:"Rejected"},deleted:{icon:te,bgColor:"bg-red-50",textColor:"text-red-600",borderColor:"border-red-500",label:"Deleted"},restored_from_cancelled:{icon:xe,bgColor:"bg-teal-50",textColor:"text-teal-600",borderColor:"border-teal-500",label:"Restored"},hours_reopened_for_editing:{icon:ge,bgColor:"bg-teal-50",textColor:"text-teal-600",borderColor:"border-teal-500",label:"Reopened for Editing"},totals_recalculated:{icon:ie,bgColor:"bg-gray-50",textColor:"text-gray-600",borderColor:"border-gray-500",label:"Totals Recalculated"}}[t]||{icon:W,bgColor:"bg-gray-50",textColor:"text-gray-600",borderColor:"border-gray-500",label:t.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase())}}function _e({activity:t}){var n,r,o,c,a,h,m,j,d;const s=z();return e.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 px-4 py-3",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wider mb-3",children:"Full Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Action by"}),e.jsx("div",{className:"font-medium text-gray-900",children:t.actor_name})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(T,{className:"h-4 w-4 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Timestamp"}),e.jsx("div",{className:"font-medium text-gray-900",children:P(t.created_at)})]})]}),((n=t.details)==null?void 0:n.worker_name)&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-teal-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Worker"}),t.details.worker_id?e.jsxs("button",{onClick:()=>{var x;return s(`/workers/${(x=t.details)==null?void 0:x.worker_id}`)},className:"font-medium text-teal-600 hover:underline flex items-center gap-1",children:[t.details.worker_name,e.jsx(O,{className:"h-3 w-3"})]}):e.jsx("div",{className:"font-medium text-gray-900",children:t.details.worker_name})]})]}),((r=t.details)==null?void 0:r.event_name)&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(T,{className:"h-4 w-4 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Event"}),t.details.event_id?e.jsxs("button",{onClick:()=>{var x;return s(`/events/${(x=t.details)==null?void 0:x.event_id}`)},className:"font-medium text-blue-600 hover:underline flex items-center gap-1",children:[t.details.event_name,e.jsx(O,{className:"h-3 w-3"})]}):e.jsx("div",{className:"font-medium text-gray-900",children:t.details.event_name})]})]}),((o=t.details)==null?void 0:o.before_hours)!==void 0&&((c=t.details)==null?void 0:c.after_hours)!==void 0&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ae,{className:"h-4 w-4 text-purple-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Hours"}),e.jsxs("div",{className:"font-medium text-gray-900 tabular-nums text-right",children:[Number(t.details.before_hours||0).toFixed(1),"h â†’ ",Number(t.details.after_hours||0).toFixed(1),"h",e.jsx("span",{className:"text-xs text-gray-500 ml-1",children:(()=>{const x=Number(t.details.before_hours||0),g=Number(t.details.after_hours||0)-x;return g>0?`+${g.toFixed(1)}h`:`${g.toFixed(1)}h`})()})]})]})]}),((a=t.details)==null?void 0:a.before_pay)!==void 0&&((h=t.details)==null?void 0:h.after_pay)!==void 0&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Pay"}),e.jsxs("div",{className:"font-medium text-gray-900 tabular-nums text-right",children:["$",Number(t.details.before_pay||0).toFixed(2)," â†’ $",Number(t.details.after_pay||0).toFixed(2),e.jsx("span",{className:"text-xs text-gray-500 ml-1",children:(()=>{const x=Number(t.details.before_pay||0),g=Number(t.details.after_pay||0)-x;return g>0?`+$${g.toFixed(2)}`:`$${g.toFixed(2)}`})()})]})]})]}),((m=t.details)==null?void 0:m.before_rate)!==void 0&&((j=t.details)==null?void 0:j.after_rate)!==void 0&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-amber-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Hourly Rate"}),e.jsxs("div",{className:"font-medium text-gray-900 tabular-nums text-right",children:["$",Number(t.details.before_rate||0).toFixed(2),"/h â†’ $",Number(t.details.after_rate||0).toFixed(2),"/h"]})]})]}),((d=t.details)==null?void 0:d.role)&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-purple-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Role"}),e.jsx("div",{className:"font-medium text-gray-900",children:t.details.role})]})]})]}),!1]})}function Y({activity:t,searchQuery:s=""}){const[n,r]=_.useState(!1),o=z(),{icon:c,bgColor:a,textColor:h,borderColor:m}=Ne(t.action),j=()=>{let x=t.summary;const l=t.details,g=s.trim();if(l!=null&&l.worker_name){const b=l.worker_name,p=new RegExp(`\\b${b.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`,"gi");x=x.replace(p,`<span class="font-semibold text-teal-600 hover:underline cursor-pointer" data-worker-id="${l.worker_id||""}">${b}</span>`)}if(l!=null&&l.event_name){const b=l.event_name,p=new RegExp(`\\b${b.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`,"gi");x=x.replace(p,`<span class="font-semibold text-blue-600 hover:underline cursor-pointer" data-event-id="${l.event_id||""}">${b}</span>`)}let N=x;return g&&(N=N.split(/(<[^>]+>)/).map((p,$)=>{if(p.startsWith("<"))return p;const i=new RegExp(`(${g.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return p.replace(i,'<mark class="bg-yellow-200 font-semibold">$1</mark>')}).join("")),e.jsx("div",{dangerouslySetInnerHTML:{__html:N},onClick:b=>{const p=b.target;p.dataset.workerId?o(`/workers/${p.dataset.workerId}`):p.dataset.eventId&&o(`/events/${p.dataset.eventId}`)}})},d=`${t.actor_name} ${t.action.replace(/_/g," ")} ${t.entity_type} ${U(t.created_at)}`;return e.jsxs("div",{className:E("bg-white rounded-lg shadow-sm border-l-4 hover:shadow-md transition-all duration-200",m),"aria-label":d,role:"article",children:[e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:E("flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center",a),children:e.jsx(c,{className:E("h-5 w-5",h),"aria-hidden":"true"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm text-gray-900 mb-2",children:j()}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[e.jsx("span",{className:"flex items-center gap-1 px-2 py-0.5 bg-gray-100 rounded",children:t.entity_type}),e.jsx("span",{title:P(t.created_at),children:U(t.created_at)}),e.jsx("span",{className:"hidden sm:inline",children:P(t.created_at)})]}),t.details&&Object.keys(t.details).length>0&&e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[t.details.worker_name&&t.details.worker_id&&e.jsxs("button",{onClick:()=>o(`/workers/${t.details.worker_id}`),className:"flex items-center gap-1.5 px-2 py-1 bg-teal-50 text-teal-700 rounded text-xs hover:bg-teal-100 transition-colors",title:t.details.worker_name,children:[e.jsx("span",{className:"font-medium",children:"Worker:"}),e.jsx("span",{className:"truncate max-w-[120px]",children:t.details.worker_name})]}),t.details.event_name&&t.details.event_id&&e.jsxs("button",{onClick:()=>o(`/events/${t.details.event_id}`),className:"flex items-center gap-1.5 px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs hover:bg-blue-100 transition-colors",title:t.details.event_name,children:[e.jsx("span",{className:"font-medium",children:"Event:"}),e.jsx("span",{className:"truncate max-w-[120px]",children:t.details.event_name})]}),t.details.role&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-purple-50 text-purple-700 rounded text-xs",title:t.details.role,children:[e.jsx("span",{className:"font-medium",children:"Role:"}),e.jsx("span",{className:"truncate max-w-[100px]",children:t.details.role})]}),t.details.before_pay!==void 0&&t.details.after_pay!==void 0&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-green-50 text-green-700 rounded text-xs",children:[e.jsx("span",{className:"font-medium",children:"Pay:"}),e.jsxs("span",{className:"tabular-nums text-right",children:["$",Number(t.details.before_pay||0).toFixed(2)," â†’ $",Number(t.details.after_pay||0).toFixed(2)]})]})]})]}),e.jsx("button",{onClick:()=>r(!n),className:"flex-shrink-0 p-1 hover:bg-gray-100 rounded transition-colors",children:n?e.jsx(B,{className:"h-5 w-5 text-gray-400"}):e.jsx(X,{className:"h-5 w-5 text-gray-400"})})]})}),n&&e.jsx(_e,{activity:t})]})}function we(t){const s={};t.forEach(r=>{const o=L(Z(r.created_at),"yyyy-MM-dd");s[o]||(s[o]=[]),s[o].push(r)});const n={};return Object.keys(s).sort((r,o)=>o.localeCompare(r)).forEach(r=>{n[r]=s[r]}),n}function ve(t){const s={};t.forEach(r=>{var h,m,j,d,x,l,g,N,b,p,$,i,w,y,C;let o,c,a;if(r.entity_type==="Assignment"){let f=((h=r.details)==null?void 0:h.event_name)||((m=r.after_json)==null?void 0:m.event_name)||((j=r.before_json)==null?void 0:j.event_name)||((d=r.after_json)==null?void 0:d.shift_name)||((x=r.before_json)==null?void 0:x.shift_name);if(!f&&r.summary){const M=r.summary.match(/to\s+([^,\s]+(?:\s+[^,\s]+)*?)(?:\s+as|\s+\(|$|,)/i);M&&M[1]&&(f=M[1].trim())}const v=((l=r.details)==null?void 0:l.worker_name)||((g=r.after_json)==null?void 0:g.worker_name)||((N=r.before_json)==null?void 0:N.worker_name),u=((b=r.details)==null?void 0:b.role)||((p=r.after_json)==null?void 0:p.role)||(($=r.before_json)==null?void 0:$.role)||((i=r.after_json)==null?void 0:i.role_needed)||((w=r.before_json)==null?void 0:w.role_needed);f&&v&&u?(o=`assignment-event-${f}-${v}`,c=`Assignment â€¢ ${v} â€” ${f} (${u})`,a="Assignment"):f&&v?(o=`assignment-event-${f}-${v}`,c=`Assignment â€¢ ${v} â€” ${f}`,a="Assignment"):f?(o=`assignment-event-${f}`,c=`Assignment of ${f}`,a="Assignment"):(o=`assignment-${r.entity_id}`,c=`Assignment #${r.entity_id}`,a="Assignment")}else(y=r.details)!=null&&y.event_name?(o=`event-${r.details.event_id||r.entity_id}`,c=r.details.event_name,a="Event"):(C=r.details)!=null&&C.worker_name?(o=`worker-${r.details.worker_id||r.entity_id}`,c=r.details.worker_name,a="Worker"):(o=`${r.entity_type.toLowerCase()}-${r.entity_id}`,c=`${r.entity_type} #${r.entity_id}`,a=r.entity_type);s[o]||(s[o]={type:a,name:c,activities:[]}),s[o].activities.push(r)});const n={};return Object.keys(s).sort((r,o)=>{var h,m;const c=((h=s[r].activities[0])==null?void 0:h.created_at)||"";return(((m=s[o].activities[0])==null?void 0:m.created_at)||"").localeCompare(c)}).forEach(r=>{n[r]=s[r]}),n}function ke(t){try{const s=Z(t);return ne(s)?"Today":be(s)?"Yesterday":he(s)?L(s,"EEEE"):ue(s)?L(s,"MMMM d"):L(s,"MMMM d, yyyy")}catch(s){return console.error("Error formatting date:",s),t}}function Ce(t,s){if(!s.trim())return t;const n=s.toLowerCase();return t.filter(r=>{var o,c,a;return!!(r.summary.toLowerCase().includes(n)||r.details&&((o=r.details.worker_name)!=null&&o.toLowerCase().includes(n)||(c=r.details.event_name)!=null&&c.toLowerCase().includes(n)||(a=r.details.role)!=null&&a.toLowerCase().includes(n))||r.actor_name.toLowerCase().includes(n))})}function $e({date:t,activities:s,searchQuery:n=""}){return e.jsxs("div",{children:[e.jsx("div",{className:"sticky top-0 z-10 bg-gray-50 py-2 mb-4 -mx-4 px-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4 text-gray-400"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wider",children:ke(t)}),e.jsx("div",{className:"flex-1 h-px bg-gray-200"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[s.length," ",s.length===1?"activity":"activities"]})]})}),e.jsx("div",{className:"space-y-3 ml-6",children:s.map(r=>e.jsx(Y,{activity:r,searchQuery:n},r.id))})]})}function Te({entityType:t,entityName:s,activities:n,searchQuery:r=""}){const[o,c]=_.useState(!1),a=()=>{switch(t){case"Event":return T;case"Worker":return A;default:return T}},h=()=>{switch(t){case"Event":return"text-blue-600 bg-blue-50";case"Worker":return"text-teal-600 bg-teal-50";default:return"text-gray-600 bg-gray-50"}},m=a(),j=h();return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("button",{onClick:()=>c(!o),className:"w-full px-4 py-3 flex items-center gap-3 hover:bg-gray-50 transition-colors",children:[o?e.jsx(B,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}):e.jsx(X,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),e.jsx("div",{className:E("w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0",j),children:e.jsx(m,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:s}),e.jsxs("div",{className:"text-xs text-gray-500",children:[n.length," ",n.length===1?"activity":"activities"]})]}),e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs font-medium rounded",children:t})]}),o&&e.jsx("div",{className:"border-t border-gray-200 p-4 bg-gray-50 space-y-3",children:n.map(d=>e.jsx(Y,{activity:d,searchQuery:r},d.id))})]})}function Ee({searchQuery:t,hasFilters:s}){return t?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border border-gray-200",children:[e.jsx(I,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:['No results found for "',t,'"']}),e.jsx("p",{className:"text-sm text-gray-500",children:"Try searching for a different worker name or event name"})]}):s?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border border-gray-200",children:[e.jsx(J,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No activities match your filters"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Try adjusting your filters to see more results"})]}):e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border border-gray-200",children:[e.jsx(T,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No activities yet"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Activity logs will appear here as users make changes"})]})}function Ze(){const[t,s]=_.useState([]),[n,r]=_.useState([]),[o,c]=_.useState(!0),[a,h]=_.useState("chronological"),[m,j]=_.useState(""),[d,x]=_.useState({entityType:"all",action:"all",dateFrom:null,dateTo:null,actor:"all"}),[l,g]=_.useState({page:1,perPage:50,total:0});_.useEffect(()=>{N()},[d,l.page]),_.useEffect(()=>{if(m.trim()){const i=Ce(t,m);r(i)}else r(t)},[m,t]);const N=async()=>{c(!0);try{const i={page:l.page,per_page:l.perPage};d.entityType!=="all"&&(i.entity_type=d.entityType),d.action!=="all"&&(i.log_action=d.action),d.dateFrom&&(i.date_from=d.dateFrom),d.dateTo&&(i.date_to=d.dateTo),d.actor!=="all"&&(i.actor_user_id=d.actor);const y=(await ee.get("/activity_logs",{params:i})).data.data||{},C=y.activity_logs||[],f=y.pagination||{},v=C.map(u=>({id:u.id,actor_name:u.actor||u.actor_name||"System",entity_type:u.entity_type,entity_id:u.entity_id,action:u.action,summary:u.summary||"",details:u.details||u.details_json||null,created_at:u.when||u.created_at||u.created_at_utc,before_json:u.before_json||{},after_json:u.after_json||{}}));s(v),r(v),g(u=>({...u,total:f.total_count||v.length}))}catch(i){console.error("Error loading activities:",i)}finally{c(!1)}},b=()=>{const i=we(n);return e.jsx("div",{className:"space-y-6",children:Object.entries(i).map(([w,y])=>e.jsx($e,{date:w,activities:y,searchQuery:m},w))})},p=()=>{const i=ve(n);return e.jsx("div",{className:"space-y-4",children:Object.entries(i).map(([w,y])=>e.jsx(Te,{entityType:y.type,entityName:y.name,activities:y.activities,searchQuery:m},w))})},$=d.entityType!=="all"||d.action!=="all"||d.dateFrom||d.dateTo;return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(fe,{searchQuery:m,onSearchChange:j,totalLogs:l.total,showingLogs:n.length,activities:n}),e.jsx(ye,{filters:d,onFiltersChange:x,onRefresh:N}),e.jsx(je,{viewMode:a,onViewModeChange:h}),e.jsx("div",{className:"mt-6",children:o?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(re,{className:"h-8 w-8 animate-spin text-teal-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading activities..."})]}):n.length===0?e.jsx(Ee,{searchQuery:m,hasFilters:$}):e.jsxs(e.Fragment,{children:[a==="chronological"&&b(),a==="grouped"&&p()]})}),!o&&n.length>0&&e.jsxs("div",{className:"mt-8 flex items-center justify-between border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",(l.page-1)*l.perPage+1," to"," ",Math.min(l.page*l.perPage,l.total)," of"," ",l.total," activities"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[l.total>1e3&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"jump-to-date",className:"text-sm text-gray-600",children:"Jump to date:"}),e.jsx("input",{id:"jump-to-date",type:"date",onChange:i=>{if(i.target.value){const w=new Date(i.target.value),y=n.findIndex(C=>new Date(C.created_at)>=w);if(y>=0){const C=Math.floor(y/l.perPage)+1;g(f=>({...f,page:C})),window.scrollTo({top:0,behavior:"smooth"})}}},className:"px-3 py-1.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>g(i=>({...i,page:i.page-1})),disabled:l.page===1,className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>g(i=>({...i,page:i.page+1})),disabled:l.page*l.perPage>=l.total,className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})]})})}export{Ze as ActivityLog};
