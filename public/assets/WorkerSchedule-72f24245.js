import{d as Z,r as u,j as e,L as f}from"./application.js";import{g as J}from"./workersApi.js";import{u as K}from"./useAssignments.js";import{A as Q}from"./AssignmentStatusBadge.js";import{L as T,E as X}from"./ErrorMessage2.js";import{t as Y,c as ee,s as se,f as h}from"./format.js";import{e as te,C as ae,M as re,D as ie}from"./map-pin.js";import{c as F}from"./createLucideIcon.js";import{a as ne,C as le}from"./clock.js";import{C as L}from"./calendar.js";import{C as b}from"./circle-alert.js";import{p as w}from"./parseISO.js";import"./api.js";function ce(l,r,m){const x=Y(l,m?.in);return isNaN(r)?ee(l,NaN):(r&&x.setDate(x.getDate()+r),x)}function P(l,r,m){return ce(l,r*7,m)}function de(l,r,m){return P(l,-1,m)}/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],me=F("download",oe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],xe=F("funnel",he),Se=()=>{const{id:l}=Z(),[r,m]=u.useState(null),[x,_]=u.useState(!0),[k,R]=u.useState(""),[g,N]=u.useState(new Date),[C,O]=u.useState(""),D=se(g,{weekStartsOn:0}),S=te(g,{weekStartsOn:0}),{assignments:c,loading:H}=K({worker_id:l?parseInt(l):void 0,start_date:h(D,"yyyy-MM-dd"),end_date:h(S,"yyyy-MM-dd"),status:C||void 0});u.useEffect(()=>{l&&$(parseInt(l))},[l]);const $=async s=>{try{_(!0);const t=await J(s);m(t.data)}catch(t){R("Failed to load worker"),console.error("Error loading worker:",t)}finally{_(!1)}},I=s=>{try{return h(w(s),"EEE, MMM d")}catch{return s}},o=s=>{try{return h(w(s),"h:mm a")}catch{return s}},W=()=>c.reduce((s,t)=>{if(t.status==="cancelled")return s;const i=new Date(t.shift.start_time_utc),a=(new Date(t.shift.end_time_utc).getTime()-i.getTime())/(1e3*60*60);return s+a},0),y=()=>c.reduce((s,t)=>{if(t.status==="cancelled"||!t.shift.pay_rate)return s;const i=new Date(t.shift.start_time_utc),a=(new Date(t.shift.end_time_utc).getTime()-i.getTime())/(1e3*60*60);return s+a*t.shift.pay_rate},0),U=()=>{const s=new Date;return c.filter(t=>new Date(t.shift.start_time_utc)>s&&t.status==="assigned")},V=()=>c.filter(s=>s.status==="completed"),v=(()=>{const s=[],t=c.filter(i=>i.status==="assigned");for(let i=0;i<t.length;i++)for(let n=i+1;n<t.length;n++){const a=t[i],d=t[n],A=new Date(a.shift.start_time_utc),j=new Date(a.shift.end_time_utc),p=new Date(d.shift.start_time_utc),q=new Date(d.shift.end_time_utc);A<q&&p<j&&s.push({type:"time_overlap",assignments:[a,d],message:`Time conflict: ${a.shift.client_name} (${o(a.shift.start_time_utc)}-${o(a.shift.end_time_utc)}) overlaps with ${d.shift.client_name} (${o(d.shift.start_time_utc)}-${o(d.shift.end_time_utc)})`})}return s})(),z=()=>{N(de(g))},B=()=>{N(P(g,1))},E=()=>{N(new Date)},M=()=>`${h(D,"MMM d")} - ${h(S,"MMM d, yyyy")}`,G=()=>{if(!r)return;const s=[["Date","Start Time","End Time","Client","Role","Location","Status","Pay Rate","Hours","Estimated Pay"].join(","),...c.map(a=>{const d=new Date(a.shift.start_time_utc),j=(new Date(a.shift.end_time_utc).getTime()-d.getTime())/(1e3*60*60),p=a.shift.pay_rate?(j*a.shift.pay_rate).toFixed(2):"N/A";return[h(w(a.shift.start_time_utc),"yyyy-MM-dd"),o(a.shift.start_time_utc),o(a.shift.end_time_utc),`"${a.shift.client_name}"`,`"${a.shift.role_needed}"`,`"${a.shift.location||"N/A"}"`,a.status,a.shift.pay_rate?`$${a.shift.pay_rate}`:"N/A",j.toFixed(1),p?`$${p}`:"N/A"].join(",")}),["","","","","","","TOTAL","",W().toFixed(1),`$${y().toFixed(2)}`].join(",")].join(`
`),t=new Blob([s],{type:"text/csv;charset=utf-8;"}),i=window.URL.createObjectURL(t),n=document.createElement("a");n.href=i,n.download=`${r.first_name}_${r.last_name}_schedule_${M().replace(/[^a-zA-Z0-9]/g,"_")}.csv`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(i)};return x?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(T,{message:"Loading worker schedule..."})}):k||!r?e.jsx("div",{className:"py-8",children:e.jsx(X,{message:k||"Worker not found",onRetry:()=>l&&$(parseInt(l))})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-4",children:[e.jsx(f,{to:"/dashboard",className:"hover:text-gray-900",children:"Home"}),e.jsx("span",{children:"/"}),e.jsx(f,{to:"/workers",className:"hover:text-gray-900",children:"Workers"}),e.jsx("span",{children:"/"}),e.jsxs(f,{to:`/workers/${r.id}`,className:"hover:text-gray-900",children:[r.first_name," ",r.last_name]}),e.jsx("span",{children:"/"}),e.jsx("span",{className:"text-gray-900 font-medium",children:"Schedule"})]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:[r.first_name," ",r.last_name,"'s Schedule"]}),e.jsx("p",{className:"text-gray-500 mt-1",children:r.email})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:G,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"Export"]}),e.jsx(f,{to:`/workers/${r.id}`,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"View Profile"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:z,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Previous Week"]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:M()}),e.jsx("button",{onClick:E,className:"text-sm text-blue-600 hover:text-blue-700 mt-1",children:"Go to Current Week"})]}),e.jsxs("button",{onClick:B,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2",children:["Next Week",e.jsx(ne,{className:"h-4 w-4"})]})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx(xe,{className:"h-4 w-4 text-gray-400"}),e.jsxs("select",{value:C,onChange:s=>O(s.target.value),className:"px-3 py-1 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"no_show",children:"No Show"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-3 space-y-4",children:H?e.jsx("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:e.jsx(T,{message:"Loading assignments..."})}):c.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(L,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No shifts this week"}),e.jsxs("p",{className:"text-gray-500 mb-6",children:[r.first_name," doesn't have any scheduled shifts for this week. Try selecting a different week or create a new shift assignment."]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:E,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Go to Current Week"}),e.jsx(f,{to:"/shifts",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"View All Shifts"})]})]}):e.jsxs("div",{className:"space-y-4",children:[v.length>0&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(b,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-red-900 mb-2",children:"Schedule Conflicts Detected"}),e.jsx("div",{className:"space-y-2",children:v.map((s,t)=>e.jsx("div",{className:"text-sm text-red-700",children:s.message},t))}),e.jsx("p",{className:"text-sm text-red-600 mt-2",children:"Please resolve these conflicts by adjusting shift times or reassigning workers."})]})]})}),c.map(s=>{const t=v.some(i=>i.assignments.some(n=>n.id===s.id));return e.jsx("div",{className:`rounded-lg shadow p-6 hover:shadow-md transition-shadow ${t?"bg-red-50 border border-red-200":"bg-white"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[t&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 mb-2",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Schedule Conflict"})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-900",children:[e.jsx(L,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"font-semibold",children:I(s.shift.start_time_utc)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm",children:[o(s.shift.start_time_utc)," - ",o(s.shift.end_time_utc)]})]})]}),e.jsx(f,{to:`/shifts/${s.shift.id}`,className:"text-lg font-semibold text-blue-600 hover:text-blue-700 mb-2 block",children:s.shift.client_name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:s.shift.role_needed}),s.shift.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"h-4 w-4"}),s.shift.location]}),s.shift.pay_rate&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"h-4 w-4"}),"$",s.shift.pay_rate,"/hr"]})]})]}),e.jsx("div",{className:"ml-6",children:e.jsx(Q,{status:s.status})})]})},s.id)})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Week Summary"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Total Shifts"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:c.length})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Upcoming"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:U().length})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Completed"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:V().length})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Total Hours"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:W().toFixed(1)})]}),y()>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Est. Earnings"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["$",y().toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Worker Info"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Phone"}),e.jsx("div",{className:"text-gray-900",children:r.phone||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Email"}),e.jsx("div",{className:"text-gray-900 text-sm break-words",children:r.email})]}),r.skills_json&&r.skills_json.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-2",children:"Skills"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:r.skills_json.map(s=>e.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded-full",children:s},s))})]})]})]}),c.some(s=>{const t=new Date(s.shift.start_time_utc),i=new Date(s.shift.end_time_utc);return c.some(n=>{if(n.id===s.id)return!1;const a=new Date(n.shift.start_time_utc),d=new Date(n.shift.end_time_utc);return t<d&&i>a})})&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(b,{className:"h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-yellow-900",children:"Scheduling Conflicts"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"This worker has overlapping shift assignments this week."})]})]})})]})]})]})};export{Se as default};
//# sourceMappingURL=/assets/WorkerSchedule-f5028e14.js.map
