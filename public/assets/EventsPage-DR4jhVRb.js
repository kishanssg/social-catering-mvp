import{c as $e,j as e,X as ye,a as X,A as ue,b as Be,C as Ke}from"./index-Bi-BJyN8.js";import{r as d,b as ze,f as Je}from"./vendor-79DyBOV9.js";import{C as pe,c as ve}from"./utils-Bj9OoSq3.js";import{f as Ze,a as Ue}from"./dateUtils-CHmZs4Ub.js";import{C as fe}from"./clock-DpE_MSCI.js";import{M as Fe}from"./map-pin-B8mZsddi.js";import{U as Ee}from"./users-Bd20dinE.js";import{S as Re,T as Ce,L as Te,C as Le}from"./ConfirmationModal-9AEmUkYG.js";import{D as We}from"./dollar-sign-BBDblJf6.js";import{T as Ve}from"./Toast-dn9bk8Kn.js";import{C as Xe}from"./x-circle-B6gnlrLF.js";import{b as Ye,a as Ge,c as es,e as ss,p as ts}from"./Prep Cook-CE8OFMb5.js";import{P as Ie}from"./pen-square-C_MVfj1r.js";import{P as De}from"./plus-CqQqIMYG.js";import{f as he}from"./index-C_slYh2M.js";import{p as ce}from"./index-BK_MyBzW.js";import{C as Ae}from"./calendar-En7B9OgW.js";import{C as as}from"./chevron-down-BIBYl3Il.js";import{C as rs}from"./chevron-right-CI3flmPJ.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=$e("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=$e("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=$e("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=$e("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);function He(s,m=0){const N=typeof s=="string"?Number(s):s;return Number.isFinite(N)?N:m}function ae(s,m=2,N="0"){const r=He(s,NaN);if(!Number.isFinite(r))return N;try{return r.toFixed(m)}catch{return N}}const is={sm:"max-w-md",md:"max-w-2xl",lg:"max-w-4xl",xl:"max-w-6xl"},Pe=({isOpen:s,onClose:m,title:N,subtitle:r,children:O,footer:i,size:J="md",closeOnOverlayClick:h=!0})=>{if(d.useEffect(()=>(s?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[s]),d.useEffect(()=>{const w=R=>{R.key==="Escape"&&s&&m()};return document.addEventListener("keydown",w),()=>document.removeEventListener("keydown",w)},[s,m]),!s)return null;const D=w=>{w.target===w.currentTarget&&h&&m()};return e.jsx("div",{className:"modal-overlay",onClick:D,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:e.jsxs("div",{className:`modal-container ${is[J]}`,children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{id:"modal-title",className:"text-xl font-semibold text-gray-900 font-manrope",children:N}),r&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:r})]}),e.jsx("button",{onClick:m,className:"p-1.5 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors","aria-label":"Close modal",children:e.jsx(ye,{size:20,className:"text-gray-600"})})]}),e.jsx("div",{className:"modal-body",children:O}),i&&e.jsx("div",{className:"modal-footer",children:i})]})})};function os({shiftId:s,onClose:m,onSuccess:N}){var L,o;const[r,O]=d.useState(null),[i,J]=d.useState([]),[h,D]=d.useState([]),[w,R]=d.useState(""),[Q,Y]=d.useState(null),[q,te]=d.useState({}),[f,I]=d.useState(!0),[v,A]=d.useState(!1),[g,P]=d.useState(null),z=(n,x)=>{te(C=>({...C,[n]:x}))};d.useEffect(()=>{W()},[s]),d.useEffect(()=>{r&&k()},[r]),d.useEffect(()=>{if(!w)D(i);else{const n=w.toLowerCase();D(i.filter(x=>{var C;return x.first_name.toLowerCase().includes(n)||x.last_name.toLowerCase().includes(n)||x.email.toLowerCase().includes(n)||((C=x.skills_json)==null?void 0:C.some(u=>u.toLowerCase().includes(n)))}))}},[w,i]);async function W(){try{const n=await X.get(`/shifts/${s}`);n.data.status==="success"?O(n.data.data):P("Failed to load shift details")}catch(n){console.error("Failed to load shift details:",n),P("Failed to load shift details")}}async function k(){var n;try{const x=new Set;if(r!=null&&r.event_id)try{const p=((n=(await X.get(`/events/${r.event_id}`)).data)==null?void 0:n.data)||{};if(p.shifts_by_role){const M=p.shifts_by_role.find($=>$.skill_name===r.role_needed||$.role_name===r.role_needed);M!=null&&M.shifts&&M.shifts.forEach($=>{$.assignments&&$.assignments.forEach(b=>{var _;const l=b.worker_id||((_=b.worker)==null?void 0:_.id),c=b.status;l&&c!=="cancelled"&&c!=="no_show"&&x.add(l)})})}}catch(u){console.log("Could not fetch event to filter assigned workers:",u)}console.log(`AssignmentModal: Found ${x.size} already assigned workers for "${r==null?void 0:r.role_needed}"`);const C=await X.get("/workers?active=true");if(C.data.status==="success"){const u=C.data.data.workers||C.data.data;if(r!=null&&r.role_needed){const p=u.filter(M=>{var $;return(($=M.skills_json)==null?void 0:$.includes(r.role_needed))&&!x.has(M.id)});console.log(`AssignmentModal: Showing ${p.length} eligible workers`),J(p)}else{const p=u.filter(M=>!x.has(M.id));J(p)}}else P("Failed to load workers")}catch(x){console.error("Failed to load workers:",x),P("Failed to load workers")}finally{I(!1)}}async function B(){var n,x,C,u,p,M;if(!(!Q||!r)){A(!0),P(null);try{const b=(await X.post("/staffing",{assignment:{shift_id:r.id,worker_id:Q.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:q[Q.id]||Number(r.pay_rate)||0}})).data;if(b.status==="success")N();else{let l=b.message||"Failed to assign worker";b.details&&b.details.length>0?l+=`

Details:
â€¢ `+b.details.join(`
â€¢ `):b.errors&&(l+=`

Details:
â€¢ `+b.errors.join(`
â€¢ `)),P(l)}}catch($){console.error("Failed to assign worker:",$);let b="Failed to assign worker";if((x=(n=$.response)==null?void 0:n.data)!=null&&x.details&&$.response.data.details.length>0){const l=$.response.data.details.map(c=>(c.includes("conflicting shift"),c));b+=`

`+l.join(`
`)}else(u=(C=$.response)==null?void 0:C.data)!=null&&u.errors?b+=`

`+$.response.data.errors.join(`
`):(M=(p=$.response)==null?void 0:p.data)!=null&&M.message?b=$.response.data.message:$.message&&(b=$.message);P(b)}finally{A(!1)}}}if(f)return e.jsx(Pe,{isOpen:!0,onClose:m,title:"Assign Worker",size:"lg",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-600"})})});const U=e.jsxs(e.Fragment,{children:[g&&e.jsxs("div",{className:"mb-4 p-3 bg-gradient-to-r from-red-50 to-amber-50 border-l-4 border-red-500 rounded-r-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsx("h4",{className:"text-sm font-semibold text-red-900",children:"âš ï¸ Scheduling Conflict Detected"})]}),e.jsx("p",{className:"text-xs text-gray-600 ml-8",children:"Please resolve the conflict before attempting to assign this worker"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:m,disabled:v,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:B,disabled:!Q||v||!!g,className:`btn-primary ${g?"opacity-50 cursor-not-allowed":""}`,title:g?"Cannot assign due to scheduling conflict":"",children:v?"Assigning Worker...":"Assign Worker"})]})]});return e.jsx(Pe,{isOpen:!0,onClose:m,title:r?`${r.client_name} â€¢ ${r.role_needed}`:"Assign Worker",size:"xl",footer:U,children:e.jsxs("div",{className:"flex h-[600px]",children:[e.jsx("div",{className:"w-1/3 border-r border-gray-200 p-6 bg-gray-50",children:r?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Shift Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(fe,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:Ze(r.start_time_utc)}),e.jsxs("div",{className:"text-sm text-gray-600",children:[Ue(r.start_time_utc)," - ",Ue(r.end_time_utc)]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Fe,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"text-sm text-gray-900",children:r.location||((o=(L=r.event)==null?void 0:L.venue)==null?void 0:o.formatted_address)||"Location not specified"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ee,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900",children:r.role_needed}),r.required_skill&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Requires: ",r.required_skill]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Pay Rate:"})," $",(Number(r.pay_rate)||0).toFixed(2),"/hour"]}),r.uniform_name&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",r.uniform_name]})]}),r.notes&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Notes:"}),e.jsx("div",{className:"mt-1 whitespace-pre-line",children:r.notes.split("Uniform:").map((n,x)=>x===0?n.trim():e.jsxs("div",{children:[e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",n.trim()]},x))})]})})]})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ue,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Failed to load shift details"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search workers...",value:w,onChange:n=>R(n.target.value),className:"w-full pl-9 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-teal-500 focus:border-teal-500"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:g?e.jsx("div",{className:"p-6 flex items-center justify-center h-full",children:e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 rounded-lg p-5 shadow-sm w-full max-w-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(ue,{size:20,className:"text-red-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg font-semibold text-red-900 mb-1",children:"âš ï¸ Scheduling Conflict"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"This worker cannot be assigned due to a scheduling conflict"}),e.jsx("div",{className:"bg-white border border-red-200 rounded p-3 mt-3",children:e.jsx("div",{className:"text-sm text-red-800 font-mono",children:g.split(`
`).map((n,x)=>n.trim()===""?null:n.startsWith("â€¢")?e.jsxs("div",{className:"mt-1 flex items-start gap-2",children:[e.jsx("span",{className:"text-red-500",children:"â—"}),e.jsx("span",{className:"flex-1",children:n.replace("â€¢","").trim()})]},x):n.startsWith("Details:")?null:n.includes("conflicting shift")?e.jsx("div",{className:"mt-1 text-red-700 font-medium",children:n},x):e.jsx("div",{className:"text-gray-700",children:n},x))})})]})]})})}):h.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ee,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:w?"No workers found matching your search":r!=null&&r.role_needed?`No workers found with "${r.role_needed}" skill`:"No available workers"}),(r==null?void 0:r.role_needed)&&!w&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:['Try adding "',r.role_needed,'" skill to workers or select a different shift.']})]}):e.jsx("ul",{children:h.map(n=>{const x=(Q==null?void 0:Q.id)===n.id,C=q[n.id]||Number(r.pay_rate)||0,u=q[n.id]&&q[n.id]!==(Number(r.pay_rate)||0);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${x?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[n.first_name[0],n.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[n.first_name," ",n.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(n.skills_json||[]).map((p,M)=>{const $=p===(r==null?void 0:r.role_needed);return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${$?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:p},M)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[u&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(We,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:(Number(r.pay_rate)||0).toString(),value:C||"",onChange:p=>{const M=p.target.value;(M===""||/^\d*\.?\d*$/.test(M))&&z(n.id,parseFloat(M)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:p=>p.stopPropagation(),onFocus:p=>p.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>Y(n),className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${x?"bg-teal-600 text-white border-teal-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:x?"Selected":"Select"})]})]},n.id)})})})]})]})})}function ds({isOpen:s,eventId:m,roleName:N,unfilledShiftIds:r,defaultPayRate:O,onClose:i,onDone:J}){const[h,D]=d.useState([]),[w,R]=d.useState([]),[Q,Y]=d.useState(""),[q,te]=d.useState(!1),[f,I]=d.useState(!1),[v,A]=d.useState({}),[g,P]=d.useState(0),z=(o,n)=>{A(x=>({...x,[o]:n}))};d.useEffect(()=>{s&&(D([]),R([]),Y(""),A({}),te(!0),(async()=>{var o,n;try{const C=((o=(await X.get(`/events/${m}`)).data)==null?void 0:o.data)||{};console.log("QuickFill: Full event data:",JSON.stringify(C,null,2)),console.log("QuickFill: Looking for role:",N),console.log("QuickFill: shifts_by_role:",C.shifts_by_role);const u=new Set;if(C.shifts_by_role){const b=C.shifts_by_role.find(l=>(console.log("QuickFill: Checking role:",l.skill_name,l.role_name,"vs",N),l.skill_name===N||l.role_name===N));b?(console.log("QuickFill: Found role shifts:",b),b.shifts&&b.shifts.forEach(l=>{l.assignments&&(console.log("QuickFill: Shift has assignments:",l.assignments),l.assignments.forEach(c=>{var V;const _=c.worker_id||((V=c.worker)==null?void 0:V.id),j=c.status;_&&j!=="cancelled"&&(u.add(_),console.log("QuickFill: Adding worker_id to exclude:",_,"status:",j))}))})):console.log("QuickFill: No role shifts found for:",N)}console.log(`QuickFill: Found ${u.size} already assigned worker IDs:`,Array.from(u));const p=await X.get("/workers?active=true"),$=(((n=p.data)==null?void 0:n.data)||p.data||[]).filter(b=>{const l=(b.skills_json||[]).includes(N),c=u.has(b.id);return c&&console.log(`QuickFill: Excluding ${b.first_name} ${b.last_name} (ID: ${b.id}) - already assigned`),l&&!c});if(console.log(`QuickFill: Found ${$.length} eligible workers for "${N}"`),console.log("QuickFill: Eligible workers:",$.map(b=>`${b.first_name} ${b.last_name}`)),D($),O){const b=Number(O)||0;P(b),console.log(`QuickFill: Default pay rate for ${N}: $${b}/hr`)}else console.log(`QuickFill: No default pay rate provided for ${N}`)}catch(x){console.error("Error loading workers:",x)}finally{te(!1)}})())},[s,m,N,O]);const W=d.useMemo(()=>{const o=Q.trim().toLowerCase(),n=h;return o?n.filter(x=>`${x.first_name} ${x.last_name}`.toLowerCase().includes(o)||(x.email||"").toLowerCase().includes(o)):n},[h,Q]),k=r.length,B=o=>{R(n=>n.includes(o)?n.filter(x=>x!==o):n.length>=k?n:[...n,o])},U=async()=>{var C,u,p,M,$,b,l,c,_,j,V,E,Z,ie,be;if(w.length===0||k===0)return;I(!0);let o=0,n=0;const x=[];try{const ge=w.map(a=>h.find(T=>T.id===a)).filter(Boolean),we=[...r];let je=0;for(;we.length>0&&ge.length>0;){const a=ge[je%ge.length],T=we.shift();try{const F=v[a.id]||Number(g)||0||0,G=await X.post("/staffing",{assignment:{shift_id:T,worker_id:a.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:F}});if(((C=G.data)==null?void 0:C.status)==="success")o+=1;else{n+=1;const K=`${a.first_name} ${a.last_name}`,me=((u=G.data)==null?void 0:u.message)||((M=(p=G.data)==null?void 0:p.error)==null?void 0:M.message)||((b=($=G.data)==null?void 0:$.errors)==null?void 0:b.join(", "))||"Unknown error";let ee="Unable to assign";const t=String(me).toLowerCase();t.includes("overlapping")||t.includes("conflict")?ee="Has overlapping shift":t.includes("capacity")||t.includes("full")?ee="Shift is full":t.includes("skill")||t.includes("certification")||t.includes("requirement")?ee="Missing required skill":t.includes("status")?ee="Cannot be assigned":ee="Unable to assign",x.push(`${K}: ${ee}`)}}catch(F){n+=1;const G=`${a.first_name} ${a.last_name}`;let K="Unable to assign";const me=((c=(l=F.response)==null?void 0:l.data)==null?void 0:c.message)||((V=(j=(_=F.response)==null?void 0:_.data)==null?void 0:j.error)==null?void 0:V.message)||((ie=(Z=(E=F.response)==null?void 0:E.data)==null?void 0:Z.errors)==null?void 0:ie.join(", "))||null;if(me){const ee=String(me).toLowerCase();ee.includes("overlapping")||ee.includes("conflict")?K="Has overlapping shift":ee.includes("capacity")||ee.includes("full")?K="Shift is full":ee.includes("skill")||ee.includes("certification")||ee.includes("requirement")?K="Missing required skill":ee.includes("status")?K="Cannot be assigned":K="Unable to assign"}else((be=F.response)==null?void 0:be.status)===422?K="Unable to assign":F.message&&!F.message.includes("status code")&&(K=F.message);x.push(`${G}: ${K}`)}je+=1}let _e="";n>0&&x.length>0&&(_e=x.join(", ")),J({assigned:o,conflicts:n,details:_e})}finally{I(!1)}};if(!s)return null;const L=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:i,disabled:f,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:U,disabled:f||w.length===0||k===0,className:"btn-primary",children:f?"Filling Shifts...":w.length===1?`Assign worker to ${k} shift${k!==1?"s":""}`:`Assign ${w.length} workers to ${k} shifts`})]});return e.jsxs(Pe,{isOpen:s,onClose:i,title:`Quick Fill â€” ${N}`,subtitle:`Unfilled shifts: ${k}`,size:"lg",footer:L,children:[e.jsxs("div",{className:"relative",children:[e.jsx(Re,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{value:Q,onChange:o=>Y(o.target.value),placeholder:"Search eligible workersâ€¦",className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsx("div",{className:"max-h-[340px] overflow-y-auto border border-gray-200 rounded-lg",children:q?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loadingâ€¦"}):W.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"No eligible workers"}):e.jsx("ul",{children:W.map(o=>{const n=w.includes(o.id);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${n?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[o.first_name[0],o.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[o.first_name," ",o.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(o.skills_json||[]).map((x,C)=>{const u=x===N;return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${u?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:x},C)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[v[o.id]&&v[o.id]!==(Number(g)||0)&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(We,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:Number(g)?(Number(g)||0).toString():"Rate",value:v[o.id]||Number(g)||0||"",onChange:x=>{const C=x.target.value;(C===""||/^\d*\.?\d*$/.test(C))&&z(o.id,parseFloat(C)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:x=>x.stopPropagation(),onFocus:x=>x.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>B(o.id),disabled:!n&&w.length>=k,className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${n?"bg-teal-600 text-white border-teal-600":w.length>=k?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:n?"Selected":"Select"})]})]},o.id)})})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(Xe,{size:16,className:"text-teal-600"}),e.jsxs("span",{children:["Will assign ",e.jsx("strong",{children:w.length})," worker",w.length!==1?"s":""," to ",e.jsx("strong",{children:k})," shift",k!==1?"s":"","."]})]}),(Number(g)||0)>0&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Default rate for ",N,":"]}),e.jsxs("span",{className:"font-medium",children:["$",(Number(g)||0).toFixed(2),"/hr"]})]}),Object.keys(v).length>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["ðŸ’¡ Empty fields will use default rate ($",(Number(g)||0).toFixed(2),"/hr)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(Be,{size:14,className:"text-yellow-600"}),"Conflicts and already-filled shifts will be skipped automatically."]})]})}function cs({event:s,isOpen:m,onClose:N,onSuccess:r}){var $,b;const O=ze(),[i,J]=d.useState(!1),[h,D]=d.useState([]),[w,R]=d.useState(!1),[Q,Y]=d.useState(!1),[q,te]=d.useState(null),[f,I]=d.useState(null),[v,A]=d.useState({isVisible:!1,message:"",type:"error"}),[g,P]=d.useState(null),[z,W]=d.useState(!1);d.useEffect(()=>{m&&s.id&&k()},[m,s.id]);const k=async()=>{Y(!0);try{const l=await X.get(`/events/${s.id}`);l.data.status==="success"&&te(l.data.data)}catch(l){console.error("Failed to load full event details:",l),te(s)}finally{Y(!1)}},B=()=>{N(),O(`/events/${s.id}/edit`)},U=[{name:"Bartender",icon:Ye},{name:"Banquet Server/Runner",icon:Ge},{name:"Captain",icon:es},{name:"Event Helper",icon:ss},{name:"Prep Cook",icon:ts}],L=q||s,o=q||s;d.useEffect(()=>{if(L){if(L.skill_requirements&&Array.isArray(L.skill_requirements)){const l=L.skill_requirements.map(c=>{var V,E;const _=(V=L.shifts_by_role)==null?void 0:V.find(Z=>(Z.skill_name||Z.role_name)===c.skill_name),j=((E=_==null?void 0:_.shifts)==null?void 0:E.length)||(_==null?void 0:_.total_shifts)||c.needed_workers||1;return{skill_name:c.skill_name,needed_workers:j,pay_rate:c.pay_rate||15,description:c.description||"",uniform_id:void 0,cert_id:void 0}});D(l)}else if(L.shifts_by_role&&Array.isArray(L.shifts_by_role)){const l=L.shifts_by_role.map(c=>{const _=c.shifts?c.shifts.length:c.total_shifts||1;return{skill_name:c.skill_name||c.role_name||"",needed_workers:_,pay_rate:c.pay_rate||15,description:"",uniform_id:void 0,cert_id:void 0}});D(l)}}},[L]),d.useEffect(()=>{const l=q||s;l!=null&&l.schedule&&P({start_time_utc:l.schedule.start_time_utc,end_time_utc:l.schedule.end_time_utc,break_minutes:l.schedule.break_minutes||0})},[q,s]);const n=(l,c,_)=>{if(l<0||l>=h.length)return;const j=[...h];j[l]={...j[l],[c]:_},D(j)},x=()=>{D([...h,{skill_name:"",needed_workers:1,pay_rate:15,description:"",uniform_id:void 0,cert_id:void 0}])},C=l=>{var _;if(l<0||l>=h.length)return;const c=h[l];if((c==null?void 0:c.needed_workers)>0){const j=(_=o==null?void 0:o.shifts_by_role)==null?void 0:_[l];if(((j==null?void 0:j.assigned_workers)||(j==null?void 0:j.filled_shifts)||0)>0){A({isVisible:!0,message:"Cannot remove role with assigned workers. Please unassign workers first.",type:"error"});return}}D(h.filter((j,V)=>V!==l))},u=(l,c)=>{if(l<0||l>=h.length)return;U.find(j=>j.name===c);const _=[...h];_[l]={..._[l],skill_name:c},D(_),I(null)},p=async()=>{var c,_,j;const l=q||s;if(l.schedule&&new Date(l.schedule.start_time_utc)<=new Date){A({isVisible:!0,message:"Cannot edit event that has already started",type:"error"});return}R(!0);try{const V=q||s,E=await X.patch(`/events/${V.id}`,{event:{roles:h.map(Z=>({skill_name:Z.skill_name,needed:Z.needed_workers,pay_rate:Z.pay_rate,description:Z.description,uniform_id:Z.uniform_id,cert_id:Z.cert_id})),schedule:g?{start_time_utc:g.start_time_utc,end_time_utc:g.end_time_utc,break_minutes:g.break_minutes}:V.schedule?{start_time_utc:V.schedule.start_time_utc,end_time_utc:V.schedule.end_time_utc,break_minutes:V.schedule.break_minutes||0}:void 0}});E.data.status==="success"?(A({isVisible:!0,message:E.data.message||"Event updated successfully",type:"success"}),r(),N()):A({isVisible:!0,message:E.data.message||"Failed to update event",type:"error"})}catch(V){console.error("Failed to update event:",V);const E=(c=V==null?void 0:V.response)==null?void 0:c.data;if((E==null?void 0:E.status)==="validation_error"&&((j=(_=E==null?void 0:E.data)==null?void 0:_.conflicts)!=null&&j.length)){const Z=E.data.conflicts.map(ie=>{const be=new Date(ie.conflicting_shift_start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),ge=new Date(ie.conflicting_shift_end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});return`${ie.worker_name} conflicts with ${ie.conflicting_event_title} (${be} â€“ ${ge})`});A({isVisible:!0,message:`Can't save changes: ${Z.length} worker${Z.length!==1?"s":""} would be double-booked
â€¢ `+Z.join(`
â€¢ `),type:"error"})}else A({isVisible:!0,message:(E==null?void 0:E.message)||"Failed to update event",type:"error"})}finally{R(!1)}},M=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:N,disabled:w,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:p,disabled:w,className:"btn-primary",children:w?"Saving...":"Save Changes"})]});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-0 sm:p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white w-full h-full sm:h-auto sm:max-w-4xl sm:rounded-lg shadow-xl overflow-hidden flex flex-col sm:max-h-[90vh]",children:[e.jsxs("div",{className:"sticky top-0 bg-white px-4 sm:px-6 py-4 border-b border-gray-200 flex items-center justify-between z-10",children:[e.jsxs("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-gray-900 truncate",children:["Edit Event: ",o.title]}),e.jsx("button",{onClick:N,className:"p-2 text-gray-400 hover:text-gray-600 min-h-touch min-w-touch","aria-label":"Close",children:e.jsx(ye,{className:"h-5 w-5 sm:h-6 sm:w-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 sm:px-6 py-4 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Event Details"}),e.jsxs("button",{onClick:B,className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-white border border-gray-300 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all shadow-sm",children:[e.jsx(Ie,{size:14}),"Edit"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Venue"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:($=o.venue)==null?void 0:$.name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:o.schedule&&new Date(o.schedule.start_time_utc).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"space-y-1 md:col-span-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Location"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900 leading-relaxed",children:(b=o.venue)==null?void 0:b.formatted_address})]}),e.jsxs("div",{className:"space-y-1 md:col-start-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Time"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:o.schedule&&e.jsxs(e.Fragment,{children:[new Date(o.schedule.start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})," - ",new Date(o.schedule.end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})]})})]}),e.jsx("div",{})]})]}),e.jsxs("div",{className:"col-span-2 bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 uppercase tracking-wide",children:"Event Schedule"}),e.jsx("button",{type:"button",onClick:()=>W(!z),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:z?"Cancel":"Edit Schedule"})]}),z?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Start Time"}),e.jsx("input",{type:"datetime-local",value:g!=null&&g.start_time_utc?new Date(g.start_time_utc).toISOString().slice(0,16):"",onChange:l=>P(c=>c?{...c,start_time_utc:new Date(l.target.value).toISOString()}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"End Time"}),e.jsx("input",{type:"datetime-local",value:g!=null&&g.end_time_utc?new Date(g.end_time_utc).toISOString().slice(0,16):"",onChange:l=>P(c=>c?{...c,end_time_utc:new Date(l.target.value).toISOString()}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Break Minutes"}),e.jsx("input",{type:"number",min:"0",value:(g==null?void 0:g.break_minutes)||0,onChange:l=>P(c=>c?{...c,break_minutes:parseInt(l.target.value)||0}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3",children:e.jsx("p",{className:"text-xs text-blue-800",children:"âš ï¸ Changing schedule times will update ALL shifts and worker schedules for this event."})})]}):e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:o.schedule&&new Date(o.schedule.start_time_utc).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Time"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:g&&e.jsxs(e.Fragment,{children:[new Date(g.start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})," -",new Date(g.end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})]})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Break"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[(g==null?void 0:g.break_minutes)||0," minutes"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"Roles"}),e.jsxs("button",{onClick:x,className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white text-sm font-semibold rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(De,{size:16}),"Add Role"]})]}),h.map((l,c)=>{var _;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[e.jsxs("div",{className:"flex-1 relative overflow-visible",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Role Name *"}),e.jsxs("div",{className:"relative",style:{zIndex:f===c?1e3:1},children:[e.jsxs("button",{type:"button",onClick:()=>I(f===c?null:c),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white text-left flex items-center justify-between",children:[l.skill_name?e.jsxs("div",{className:"flex items-center gap-2",children:[((_=U.find(j=>j.name===l.skill_name))==null?void 0:_.icon)&&e.jsx("img",{src:U.find(j=>j.name===l.skill_name).icon,alt:l.skill_name,className:"w-5 h-5"}),e.jsx("span",{className:"text-gray-900",children:l.skill_name})]}):e.jsx("span",{className:"text-gray-400",children:"Pick the Skills the Worker Has"}),e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M19 9l-7 7-7-7"})})]}),f===c&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border-2 border-gray-200 rounded-xl shadow-2xl z-[9999] max-h-[300px] overflow-y-auto w-full min-w-max",children:U.filter(j=>!h.some((V,E)=>E!==c&&V.skill_name===j.name)).map(j=>e.jsxs("div",{onClick:()=>u(c,j.name),className:"flex items-center gap-3 px-4 py-3 cursor-pointer hover:bg-teal-50 border-b border-gray-100 last:border-0",children:[e.jsx("img",{src:j.icon,width:"24",height:"24",alt:j.name,className:"flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:j.name})]},j.name))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Needed Workers *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(c,"needed_workers",Math.max(1,l.needed_workers-1)),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"-"}),e.jsx("input",{type:"number",value:l.needed_workers,onChange:j=>n(c,"needed_workers",parseInt(j.target.value)||1),min:"1",className:"w-16 px-2 py-2 border border-gray-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-teal-500 font-medium"}),e.jsx("button",{onClick:()=>n(c,"needed_workers",l.needed_workers+1),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"+"}),e.jsx("button",{onClick:()=>C(c),className:"ml-2 w-8 h-8 flex items-center justify-center text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove role",children:e.jsx(Ce,{size:18})})]})]})]}),(()=>{var E;const j=(E=o==null?void 0:o.shifts_by_role)==null?void 0:E[c],V=(j==null?void 0:j.assigned_workers)||(j==null?void 0:j.filled_shifts)||0;return V>0?e.jsxs("div",{className:"text-sm text-amber-600 font-semibold bg-amber-50 px-3 py-2 rounded-lg",children:[V," worker(s) assigned"]}):null})()]},c)})]})]}),e.jsx("div",{className:"sticky bottom-0 bg-white px-4 sm:px-6 py-4 border-t border-gray-200 flex flex-col sm:flex-row gap-3 sm:justify-end z-10",children:M})]})}),e.jsx(Ve,{isVisible:v.isVisible,message:v.message,type:v.type,onClose:()=>A({...v,isVisible:!1})})]})}function ms({assignment:s,isEditing:m,editHours:N,isSavingEdit:r,wasApprovedBeforeEdit:O,isSelected:i,canSelect:J,onToggleSelect:h,onStartEdit:D,onSaveEdit:w,onCancelEdit:R,onEditHoursChange:Q,onEditKeyDown:Y,calculateLiveTotal:q,onNoShow:te,onRemove:f,onReEdit:I}){const[v,A]=d.useState(!1),g=u=>{if(!u)return"N/A";try{const p=ce(u);return he(p,"MMM d, yyyy h:mm a")}catch{try{return new Date(u).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}catch{return"N/A"}}},P=u=>{const p=["bg-blue-500","bg-green-500","bg-purple-500","bg-pink-500","bg-orange-500","bg-teal-500","bg-indigo-500","bg-cyan-500"];if(!u)return p[0];const M=u.charCodeAt(0)||0;return p[M%p.length]},z=u=>{if(!u)return"??";const p=u.trim().split(" ");return p.length===1?p[0].substring(0,2).toUpperCase():(p[0][0]+p[p.length-1][0]).toUpperCase()},W=u=>{if(!u)return"";try{const p=ce(u);return he(p,"h:mm a")}catch{return new Date(u).toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}},k=()=>{const u=s.actual_start||s.scheduled_start,p=s.actual_end||s.scheduled_end;return!u||!p?"Not set":`${W(u)} - ${W(p)}`},B=()=>{const u=s.actual_start||s.scheduled_start,p=s.actual_end||s.scheduled_end;if(!u||!p)return 0;try{const M=ce(u),l=(ce(p).getTime()-M.getTime())/(1e3*60*60);return Math.round(l*10)/10}catch{return 0}},U=u=>{const p=parseFloat(N)||0,M=Math.max(0,Math.min(24,p+u));Q(M.toFixed(2))},L=s.approved,o=z(s.worker_name),n=P(s.worker_name),x=k(),C=B();return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:ve("hidden sm:table-row group transition-all duration-150 ease-in-out border-b",L&&!m&&"bg-green-50/30 hover:bg-green-50/50",!L&&!m&&s.status==="no_show"&&"bg-red-50/30",!L&&!m&&s.status==="cancelled"&&"bg-gray-50/30",!L&&!m&&"bg-white hover:bg-gray-50",m&&"bg-slate-50"),onMouseEnter:()=>A(!0),onMouseLeave:()=>A(!1),children:[e.jsx("td",{className:"py-4 px-3 w-12",children:J&&e.jsx("input",{type:"checkbox",checked:i,onChange:()=>h(s.id),className:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded cursor-pointer",onClick:u=>u.stopPropagation()})}),e.jsx("td",{className:"py-4 px-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:ve("h-9 w-9 rounded-full flex items-center justify-center text-white font-semibold text-sm flex-shrink-0",n),children:o}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:s.worker_name}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Scheduled: ",ae(s.scheduled_hours,2,"0.00"),"h"]}),L&&!m&&s.approved_by_name&&e.jsxs("div",{className:"mt-1 text-xs text-green-700 font-medium",children:["Approved by ",s.approved_by_name.split("@")[0]," on"," ",s.approved_at?g(s.approved_at):"N/A"]})]})]})}),e.jsx("td",{className:"py-4 px-3 text-sm text-gray-700",children:s.shift_role||"N/A"}),e.jsx("td",{className:"py-4 px-3",children:e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-gray-700",children:[e.jsx(fe,{className:"h-3.5 w-3.5 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"whitespace-nowrap",children:x})]})}),e.jsxs("td",{className:"py-4 px-3 text-sm font-medium text-gray-900 text-right",children:[ae(s.effective_hours,2,"0.00"),"h",s.edited_at&&e.jsx("span",{className:"ml-1 text-xs text-orange-600",title:"Edited",children:e.jsx(Ne,{className:"h-3 w-3 inline"})})]}),e.jsxs("td",{className:"py-4 px-3 text-sm text-gray-700 text-right",children:["$",ae(s.effective_hourly_rate,2,"0.00"),"/h"]}),e.jsxs("td",{className:"py-4 px-3 text-sm font-semibold text-gray-900 text-right",children:["$",ae(s.effective_pay,2,"0.00")]}),e.jsx("td",{className:"py-4 text-right",children:m?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-blue-700 bg-blue-100 rounded",children:[e.jsx(Ne,{className:"h-3.5 w-3.5"}),"Editing"]}):e.jsx("div",{className:"flex items-center justify-end gap-2",children:s.status==="no_show"?e.jsx(e.Fragment,{children:e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-red-700",children:[e.jsx(Oe,{className:"h-3.5 w-3.5"}),"No-Show"]})}):s.status==="cancelled"?e.jsx(e.Fragment,{children:e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-gray-700",children:[e.jsx(ye,{className:"h-3.5 w-3.5"}),"Cancelled"]})}):e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[L?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 bg-green-100 rounded flex-shrink-0",children:[e.jsx(pe,{className:"h-3.5 w-3.5"}),"Approved"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-amber-700 bg-amber-100 rounded flex-shrink-0",children:[e.jsx(fe,{className:"h-3.5 w-3.5"}),"Pending"]}),s.can_edit_hours&&e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>L?I(s):D(s),className:"p-1.5 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors",title:L?"Re-edit":"Edit",children:e.jsx(Ne,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>te(s),className:"p-1.5 text-gray-600 hover:text-orange-600 hover:bg-orange-50 rounded transition-colors",title:"No-Show",children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>f(s),className:"p-1.5 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"Remove",children:e.jsx(Ce,{className:"h-4 w-4"})})]})]})})})]}),m&&e.jsx("tr",{className:"bg-slate-50",children:e.jsx("td",{colSpan:8,className:"px-3 py-0",children:e.jsx("div",{className:"overflow-hidden transition-all duration-300 ease-in-out",children:e.jsx("div",{className:"py-3",children:e.jsxs("div",{className:"bg-white border border-slate-300 rounded-lg p-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ne,{className:"h-4 w-4 text-slate-600"}),e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Edit Hours Worked"})]}),e.jsxs("div",{className:"mb-3 flex items-center gap-2 text-xs text-gray-600 bg-gray-50 px-3 py-1.5 rounded",children:[e.jsx(fe,{className:"h-3.5 w-3.5 text-gray-400"}),e.jsx("span",{children:x}),C>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"Â·"}),e.jsxs("span",{children:[C," hour shift"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>U(-1),disabled:r,className:"p-1.5 border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",type:"button",title:"Decrease by 1 hour",children:e.jsx(ls,{className:"h-4 w-4 text-gray-600"})}),e.jsx("input",{type:"number",step:"0.25",min:"0",max:"24",value:N,onChange:u=>Q(u.target.value),onKeyDown:Y,disabled:r,className:"flex-1 px-3 py-1.5 border border-gray-300 rounded-lg text-center text-base font-semibold focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",placeholder:"0.0",autoFocus:!0}),e.jsx("button",{onClick:()=>U(1),disabled:r,className:"p-1.5 border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",type:"button",title:"Increase by 1 hour",children:e.jsx(De,{className:"h-4 w-4 text-gray-600"})})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Quick:"}),e.jsx("button",{onClick:()=>U(-1),disabled:r,className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 transition-colors",children:"-1h"}),e.jsx("button",{onClick:()=>U(-.5),disabled:r,className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 transition-colors",children:"-0.5h"}),e.jsx("button",{onClick:()=>U(.5),disabled:r,className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 transition-colors",children:"+0.5h"}),e.jsx("button",{onClick:()=>U(1),disabled:r,className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 transition-colors",children:"+1h"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Updated Total"}),e.jsxs("div",{className:"text-lg font-bold text-blue-600",children:["$",q(N,s.effective_hourly_rate||0)]})]}),O&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-amber-50 border-l-2 border-amber-400 rounded text-xs text-amber-800",children:[e.jsx(ue,{className:"h-3.5 w-3.5 text-amber-600 flex-shrink-0"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Note:"})," Re-editing will un-approve these hours."]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("button",{onClick:()=>{te(s),R()},disabled:r,className:"px-2.5 py-1.5 text-xs font-medium text-orange-700 bg-orange-50 border border-orange-200 rounded hover:bg-orange-100 flex items-center gap-1 disabled:opacity-50 transition-colors",children:[e.jsx(ue,{className:"h-3.5 w-3.5"}),"No-Show"]}),e.jsxs("button",{onClick:()=>{f(s),R()},disabled:r,className:"px-2.5 py-1.5 text-xs font-medium text-red-700 bg-red-50 border border-red-200 rounded hover:bg-red-100 flex items-center gap-1 disabled:opacity-50 transition-colors",children:[e.jsx(Ce,{className:"h-3.5 w-3.5"}),"Remove"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:R,disabled:r,className:"px-3 py-1.5 text-sm font-medium text-gray-700 hover:text-gray-900 disabled:opacity-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:w,disabled:r,className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white text-sm font-medium rounded-lg shadow-sm flex items-center gap-1.5 transition-colors",children:r?e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-4 w-4"}),"Save Changes"]})})]})]})]})]})})})})}),e.jsx("tr",{className:"sm:hidden",children:e.jsx("td",{colSpan:8,className:"py-3 px-3",children:e.jsxs("div",{className:ve("p-3 rounded-lg space-y-2 transition-all duration-150",m&&"bg-blue-50 border-2 border-blue-500",!m&&L&&"bg-green-50 border border-green-200",!m&&s.status==="no_show"&&"bg-red-50 border border-red-200",!m&&s.status==="cancelled"&&"bg-gray-50 border border-gray-200",!m&&"bg-white border border-gray-200"),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:ve("h-8 w-8 rounded-full flex items-center justify-center text-white font-semibold text-xs flex-shrink-0",n),children:o}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:s.worker_name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.shift_role||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-600 mt-1 ml-10",children:[e.jsx(fe,{className:"h-3 w-3 text-gray-400 flex-shrink-0"}),e.jsx("span",{children:x})]}),L&&!m&&s.approved_by_name&&e.jsxs("div",{className:"text-xs text-green-700 mt-1 ml-10 font-medium",children:["Approved by ",s.approved_by_name.split("@")[0]," on"," ",s.approved_at?g(s.approved_at):"N/A"]})]}),s.approved?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-green-700",children:[e.jsx(pe,{className:"h-3.5 w-3.5"}),"Approved"]}):s.status==="no_show"?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-red-700",children:[e.jsx(Oe,{className:"h-3.5 w-3.5"}),"No-Show"]}):s.status==="cancelled"?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-gray-700",children:[e.jsx(ye,{className:"h-3.5 w-3.5"}),"Cancelled"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-amber-700 bg-amber-50 rounded",children:[e.jsx(fe,{className:"h-3.5 w-3.5"}),"Pending"]})]}),m&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"bg-white border-2 border-blue-400 rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ne,{className:"h-4 w-4 text-blue-600"}),e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Edit Hours Worked"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Hours Worked"}),e.jsx("input",{type:"number",step:"0.25",min:"0",max:"24",value:N,onChange:u=>Q(u.target.value),onKeyDown:Y,disabled:r,className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",autoFocus:!0})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Updated Total"}),e.jsxs("div",{className:"text-lg font-bold text-blue-600",children:["$",q(N,s.effective_hourly_rate||0)]})]}),O&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx(ue,{className:"h-4 w-4 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-amber-800",children:[e.jsx("strong",{children:"Note:"})," Re-editing will un-approve these hours."]})]}),e.jsxs("div",{className:"flex gap-2 pt-2 border-t",children:[e.jsx("button",{onClick:R,disabled:r,className:"flex-1 px-3 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:w,disabled:r,className:"flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg flex items-center justify-center gap-2 disabled:bg-blue-400",children:r?e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-4 w-4"}),"Save Changes"]})})]})]})]})}),!m&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm pt-2 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Hours"}),e.jsxs("div",{className:"font-medium",children:[ae(s.effective_hours,2,"0.00"),"h",s.edited_at&&e.jsx("span",{className:"ml-1 text-xs text-orange-600",title:"Edited",children:e.jsx(Ne,{className:"h-3 w-3 inline"})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Rate"}),e.jsxs("div",{className:"font-medium",children:["$",ae(s.effective_hourly_rate,2,"0.00"),"/h"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Total"}),e.jsxs("div",{className:"font-semibold",children:["$",ae(s.effective_pay,2,"0.00")]})]})]}),s.can_edit_hours&&s.status!=="no_show"&&s.status!=="cancelled"&&e.jsx("div",{className:"flex items-center gap-2 pt-2 border-t border-gray-200",children:s.approved?e.jsx("button",{onClick:()=>I(s),className:"w-full px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-100 rounded hover:bg-gray-200 transition-colors",children:"Re-edit"}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>D(s),className:"flex-1 px-3 py-1.5 text-xs font-medium text-blue-700 bg-blue-50 rounded hover:bg-blue-100 transition-colors flex items-center justify-center gap-1",children:[e.jsx(Ne,{className:"h-3.5 w-3.5"}),"Edit"]}),e.jsxs("button",{onClick:()=>te(s),className:"flex-1 px-3 py-1.5 text-xs font-medium text-orange-700 bg-orange-50 rounded hover:bg-orange-100 transition-colors flex items-center justify-center gap-1",children:[e.jsx(ue,{className:"h-3.5 w-3.5"}),"No-Show"]}),e.jsx("button",{onClick:()=>f(s),className:"px-3 py-1.5 text-xs font-medium text-red-700 bg-red-50 rounded hover:bg-red-100 transition-colors",children:e.jsx(Ce,{className:"h-3.5 w-3.5"})})]})})]})]})})})]})}function xs({event:s,isOpen:m,onClose:N,onSuccess:r}){const[O,i]=d.useState([]),[J,h]=d.useState(null),[D,w]=d.useState(!1),[R,Q]=d.useState(null),[Y,q]=d.useState(""),[te,f]=d.useState(!1),[I,v]=d.useState(!1),[A,g]=d.useState(!1),[P,z]=d.useState(new Set),[W,k]=d.useState({isVisible:!1,message:"",type:"success"}),[B,U]=d.useState({open:!1,title:"",variant:"default"});d.useEffect(()=>{m&&s&&(L(),z(new Set))},[m,s]);const L=async()=>{var a,T;if(s!=null&&s.id){w(!0);try{const F=await X.get(`/events/${s.id}/approvals`);i(F.data.data.assignments||[]),h(F.data.data.cost_summary||null)}catch(F){console.error("Error loading assignments:",F),k({isVisible:!0,type:"error",message:((T=(a=F.response)==null?void 0:a.data)==null?void 0:T.error)||F.message||"Unable to load assignments for approval"}),i([]),h(null)}finally{w(!1)}}},o=a=>{Q(a.id),q(String(a.effective_hours||a.hours_worked||a.scheduled_hours||"0")),v(!1)},n=()=>{Q(null),q(""),v(!1)},x=async()=>{var T,F,G;if(!R)return;const a=parseFloat(Y);if(isNaN(a)||a<0){k({isVisible:!0,type:"error",message:"Please enter a valid number of hours"});return}if(a>24){k({isVisible:!0,type:"error",message:"Hours cannot exceed 24 per shift"});return}f(!0);try{const K=await X.patch(`/approvals/${R}/update_hours`,{hours_worked:a});await L(),n(),(T=K.data)!=null&&T.message?k({isVisible:!0,type:"success",message:K.data.message}):k({isVisible:!0,type:"success",message:"Hours updated successfully"})}catch(K){console.error("Error updating hours:",K),k({isVisible:!0,type:"error",message:((G=(F=K.response)==null?void 0:F.data)==null?void 0:G.message)||"Failed to update hours. Please try again."})}finally{f(!1)}},C=a=>{a.key==="Enter"?(a.preventDefault(),x()):a.key==="Escape"&&(a.preventDefault(),n())},u=(a,T)=>{const F=parseFloat(a);return isNaN(F)?"0.00":(F*T).toFixed(2)},p=a=>{U({open:!0,title:"Re-Edit Approved Hours",message:`Re-editing will un-approve ${a.worker_name}'s hours. The assignment will need to be re-approved after you make changes. Continue?`,variant:"warning",onConfirm:async()=>{U({open:!1,title:""}),Q(a.id),q(String(a.effective_hours||a.hours_worked||a.scheduled_hours||"0")),v(!0),k({isVisible:!0,type:"success",message:"Hours un-approved. Make your changes and save."})}})},M=async a=>{U({open:!0,title:"Mark No-Show",message:`Mark ${a.worker_name} as no-show? This will set hours to 0.`,requireNote:!0,note:"",variant:"warning",onConfirm:async T=>{var G,K;const F=T||B.note||"";U({open:!1,title:""});try{await X.post(`/approvals/${a.id}/mark_no_show`,{notes:F}),await L(),k({isVisible:!0,type:"success",message:"Marked as no-show"})}catch(me){console.error("Error marking no-show:",me),k({isVisible:!0,type:"error",message:((K=(G=me.response)==null?void 0:G.data)==null?void 0:K.message)||"Failed to mark no-show"})}}})},$=async a=>{U({open:!0,title:"Remove from Job",message:`Remove ${a.worker_name} from this job? This cannot be undone.`,requireNote:!0,note:"",variant:"danger",onConfirm:async T=>{var G,K;const F=T||B.note||"";U({open:!1,title:""});try{await X.delete(`/approvals/${a.id}/remove`,{data:{notes:F}}),await L(),k({isVisible:!0,type:"success",message:"Assignment removed"})}catch(me){console.error("Error removing assignment:",me),k({isVisible:!0,type:"error",message:((K=(G=me.response)==null?void 0:G.data)==null?void 0:K.message)||"Failed to remove assignment"})}}})},b=O.filter(a=>!a.approved&&a.can_approve&&a.status!=="no_show"&&a.status!=="cancelled"),l=b.filter(a=>P.has(a.id)),c=a=>{z(T=>{const F=new Set(T);return F.has(a)?F.delete(a):F.add(a),F})},_=()=>{l.length===b.length&&b.length>0?z(new Set):z(new Set(b.map(a=>a.id)))},j=async()=>{if(l.length===0){k({isVisible:!0,type:"error",message:"Please select at least one assignment to approve"});return}U({open:!0,title:"Approve Selected Hours",message:`Approve hours for ${l.length} selected ${l.length===1?"worker":"workers"}?`,onConfirm:async()=>{var a,T;g(!0);try{await X.post(`/events/${s.id}/approve_selected`,{assignment_ids:Array.from(l.map(F=>F.id))}),await L(),z(new Set),r(),k({isVisible:!0,type:"success",message:`Approved ${l.length} ${l.length===1?"assignment":"assignments"}`})}catch(F){console.error("Error approving selected:",F),k({isVisible:!0,type:"error",message:((T=(a=F.response)==null?void 0:a.data)==null?void 0:T.message)||"Failed to approve selected hours"})}finally{g(!1),U({open:!1,title:""})}}})},V=async()=>{const a=b.length;U({open:!0,title:"Approve All Hours",message:`Approve hours for all ${a} eligible workers?`,onConfirm:async()=>{var T,F;g(!0);try{await X.post(`/events/${s.id}/approve_all`),await L(),z(new Set),r(),k({isVisible:!0,type:"success",message:`Approved ${a} assignments`})}catch(G){console.error("Error approving all:",G),k({isVisible:!0,type:"error",message:((F=(T=G.response)==null?void 0:T.data)==null?void 0:F.message)||"Failed to approve all hours"})}finally{g(!1),U({open:!1,title:""})}}})};if(!m)return null;const E=O.filter(a=>a.status!=="no_show"&&a.status!=="cancelled"),Z=E.filter(a=>!a.approved).length;E.filter(a=>a.approved).length;const ie=E.length,be=E.filter(a=>!a.approved).reduce((a,T)=>a+Number(T.effective_pay||0),0),ge=E.filter(a=>a.approved).reduce((a,T)=>a+Number(T.effective_pay||0),0),we=be+ge,je=E.reduce((a,T)=>a+Number(T.effective_hours||0),0),_e=a=>{if(!a)return"";try{return he(ce(a),"MMM d, yyyy")}catch{return new Date(a).toLocaleDateString()}};return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-0 sm:p-4 overflow-y-auto",children:[e.jsx(Ve,{isVisible:W.isVisible,message:W.message,type:W.type,onClose:()=>k({...W,isVisible:!1})}),e.jsxs("div",{className:"bg-white w-full h-full sm:h-auto sm:max-w-5xl sm:rounded-lg shadow-xl overflow-hidden flex flex-col sm:max-h-[90vh] my-0 sm:my-4",children:[e.jsx("header",{className:"border-b px-6 py-4 bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Approve Hours"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-0.5",children:[s==null?void 0:s.title," Â· ",s!=null&&s.event_date?_e(s.event_date):""]})]}),e.jsx("button",{onClick:N,className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close modal",children:e.jsx(ye,{className:"h-5 w-5"})})]})}),Z>0&&e.jsx("div",{className:"bg-amber-50 border-l-4 border-amber-400 px-6 py-3 flex-shrink-0",children:e.jsxs("p",{className:"text-sm text-amber-800 flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("strong",{children:Z})," ",Z===1?"assignment":"assignments"," pending approval"]})}),e.jsx("div",{className:"flex-1 overflow-auto px-3 sm:px-6 py-4",children:D?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading assignments..."})]}):O.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ue,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No assignments found for this event."})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b border-gray-200 hidden sm:table-header-group",children:e.jsxs("tr",{className:"text-left",children:[e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider w-12 px-3",children:b.length>0&&e.jsx("input",{type:"checkbox",checked:l.length===b.length&&b.length>0,onChange:_,className:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded cursor-pointer",title:l.length===b.length?"Deselect all":"Select all"})}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider w-[25%]",children:"Worker"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider w-[15%]",children:"Role"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider w-[18%]",children:"Time Worked"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right w-[10%]",children:"Hours"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right w-[10%]",children:"Rate"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right w-[12%]",children:"Total"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right w-[10%]",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:O.map(a=>{const T=!a.approved&&a.can_approve&&a.status!=="no_show"&&a.status!=="cancelled";return e.jsx(ms,{assignment:a,isEditing:R===a.id,editHours:Y,isSavingEdit:te,wasApprovedBeforeEdit:I,isSelected:P.has(a.id),canSelect:T,onToggleSelect:c,onStartEdit:o,onSaveEdit:x,onCancelEdit:n,onEditHoursChange:q,onEditKeyDown:C,calculateLiveTotal:u,onNoShow:M,onRemove:$,onReEdit:p},a.id)})})]})}),e.jsx("footer",{className:"border-t bg-gray-50 px-3 sm:px-6 py-4 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-600",children:Z===0?"Final approved cost:":"Total cost:"}),e.jsxs("span",{className:"ml-2 text-lg font-bold text-gray-900",children:["$",ae(we,2,"0.00")]}),e.jsxs("span",{className:"ml-1 text-gray-600",children:["(",ie," ",ie===1?"worker":"workers",", ",ae(je,2,"0.00"),"h)"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:N,className:"px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 transition-colors",children:"Close"}),Z>0&&e.jsx("button",{onClick:()=>{l.length>0?j():V()},disabled:A,className:"px-5 py-2.5 bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white text-sm font-semibold rounded-lg shadow-sm flex items-center gap-2 transition-colors",children:A?e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"h-4 w-4 animate-spin"}),"Approving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-4 w-4"}),l.length>0?"Approve Selected":"Approve All"]})})]})]})})]}),B.open&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>U({open:!1,title:""})}),e.jsxs("div",{className:"relative bg-white w-full max-w-md rounded-lg shadow-xl p-5",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:B.title}),B.message&&e.jsx("p",{className:"mt-2 text-sm text-gray-700",children:B.message}),B.requireNote&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes (optional)"}),e.jsx("textarea",{value:B.note||"",onChange:a=>U(T=>({...T,note:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]}),e.jsxs("div",{className:"mt-5 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>U({open:!1,title:""}),className:"px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-200",children:"Cancel"}),e.jsx("button",{onClick:async()=>{const a=B.note||"";B.onConfirm&&await B.onConfirm(a)},className:"px-4 py-2 text-white text-sm font-medium rounded-md "+(B.variant==="danger"?"bg-red-600 hover:bg-red-700":B.variant==="warning"?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:"Confirm"})]})]})]})]})}function de({className:s="",count:m=1}){return e.jsx(e.Fragment,{children:Array.from({length:m}).map((N,r)=>e.jsx("div",{className:`animate-pulse bg-gray-200 rounded-lg ${s}`},r))})}function Me(){return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(de,{className:"h-6 w-48 mb-2"}),e.jsx(de,{className:"h-4 w-32"})]}),e.jsx(de,{className:"h-8 w-8 rounded-full"})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4 rounded"}),e.jsx(de,{className:"h-4 w-40"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4 rounded"}),e.jsx(de,{className:"h-4 w-36"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4 rounded"}),e.jsx(de,{className:"h-4 w-32"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(de,{className:"h-2 w-full rounded-full mb-2"}),e.jsx(de,{className:"h-3 w-24"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(de,{className:"h-9 w-24 rounded-md"}),e.jsx(de,{className:"h-9 w-24 rounded-md"})]})]})})}function us(s,m=500){const[N,r]=d.useState(s);return d.useEffect(()=>{const O=setTimeout(()=>{r(s)},m);return()=>{clearTimeout(O)}},[s,m]),N}function Ps(){const s=ze(),[m,N]=Je(),r=(m.get("tab")==="completed"?"completed":m.get("tab"))||"active",O=m.get("filter")||"needs_workers",[i,J]=d.useState(r),[h,D]=d.useState(O),[w,R]=d.useState(""),Q=us(w,500),[Y,q]=d.useState("date"),[te,f]=d.useState(!0),[I,v]=d.useState([]),[A,g]=d.useState(new Set),[P,z]=d.useState(new Set),[W,k]=d.useState({isOpen:!1}),[B,U]=d.useState({isOpen:!1}),[L,o]=d.useState({isVisible:!1,message:"",type:"success"}),[n,x]=d.useState({isOpen:!1,isLoading:!1}),[C,u]=d.useState({isOpen:!1,isLoading:!1}),[p,M]=d.useState({isOpen:!1,isLoading:!1}),[$,b]=d.useState({isOpen:!1,unfilledShiftIds:[]}),[l,c]=d.useState({isOpen:!1});d.useEffect(()=>{_()},[i,h,m]),d.useEffect(()=>{const t=(m.get("tab")==="completed"?"completed":m.get("tab"))||"active",y=m.get("filter")||"all";t!==i&&J(t),y!==h&&D(y)},[m,i,h]),d.useEffect(()=>{const t=m.get("event_id"),y=m.get("shift_id");if(t){const S=parseInt(t);isNaN(S)||(g(new Set([S])),y&&console.log(`Auto-expanding event ${S} with shift ${y}`))}},[m]),d.useEffect(()=>{const t=m.get("event_id");if(!t)return;const y=parseInt(t);if(isNaN(y))return;const S=I.find(H=>H.id===y);S&&(!S.shifts_by_role||S.shifts_by_role.length===0)&&(E(y),g(new Set([y])))},[m,I]);async function _(){f(!0);try{const t=i==="completed"?"completed":i,y=m.get("date");let S=`/events?tab=${t}`;h!=="all"&&(S+=`&filter=${h}`),y&&(S+=`&date=${y}`),console.log("Loading events with URL:",S,"filterStatus:",h,"date:",y);const H=await X.get(S);if(H.data.status==="success"){console.log("Received events:",H.data.data.length);const re=H.data.data;if(i==="completed"){const le=await Promise.all(re.map(async ne=>{var xe;try{const se=await X.get(`/events/${ne.id}/approvals`);if(((xe=se.data)==null?void 0:xe.status)==="success"){const oe=se.data.data.assignments||[],ke=oe.length,Se=oe.filter(qe=>qe.approved).length,Qe=se.data.data.cost_summary||null;return{...ne,approval_status:{total:ke,approved:Se,pending:ke-Se},cost_summary:Qe}}}catch(se){console.warn(`Failed to load approval status for event ${ne.id}:`,se)}return ne}));v(le)}else{const le=Array.from(A);v(ne=>{const xe=new Map(ne.map(se=>[se.id,se]));return re.map(se=>{const oe=xe.get(se.id);return le.includes(se.id)&&(oe!=null&&oe.shifts_by_role)&&oe.shifts_by_role.length>0?{...se,shifts_by_role:oe.shifts_by_role,full_details:oe.full_details||oe}:se})}),le.length>0&&Promise.all(le.map(ne=>E(ne))).catch(ne=>{console.error("Failed to refresh expanded event details:",ne)})}}}catch(t){console.error("Failed to load events:",t)}finally{f(!1)}}const j=t=>{J(t),N({tab:t}),D(t==="active"?"needs_workers":"all")},V=t=>{D(t);const y=new URLSearchParams;y.set("tab",i),t!=="all"&&y.set("filter",t),N(y)},E=async t=>{var y,S;z(H=>new Set(H).add(t));try{const[H,re]=await Promise.all([X.get(`/events/${t}`),X.get(`/events/${t}/approvals`).catch(()=>null)]);if(((y=H.data)==null?void 0:y.status)==="success"){const le=H.data.data;if(((S=re==null?void 0:re.data)==null?void 0:S.status)==="success"){const ne=re.data.data.assignments||[],xe=new Map(ne.map(se=>[se.id,se]));le.shifts_by_role&&(le.shifts_by_role=le.shifts_by_role.map(se=>({...se,shifts:se.shifts.map(oe=>({...oe,assignments:oe.assignments.map(ke=>{const Se=xe.get(ke.id);return Se&&typeof Se=="object"?{...ke,...Se}:ke})}))})))}v(ne=>ne.map(xe=>xe.id===t?{...xe,...le}:xe))}}catch(H){console.error("Failed to load event details",H)}finally{z(H=>{const re=new Set(H);return re.delete(t),re})}},Z=t=>{const y=new Set(A);if(y.has(t))y.delete(t),z(S=>{const H=new Set(S);return H.delete(t),H});else{y.add(t);const S=I.find(le=>le.id===t),H=P.has(t),re=(S==null?void 0:S.shifts_by_role)&&S.shifts_by_role.length>0;!H&&!re&&E(t)}g(y)};async function ie(t){const y=I==null?void 0:I.find(S=>S.id===t);M({isOpen:!0,isLoading:!1,eventId:t,eventTitle:y==null?void 0:y.title})}async function be(){if(p.eventId){M(t=>({...t,isLoading:!0}));try{const t=await X.delete(`/events/${p.eventId}`);t.data.status==="success"?(M({isOpen:!1,isLoading:!1}),o({isVisible:!0,message:`"${t.data.event_title}" moved to trash`,type:"success",action:{label:"Undo",onClick:()=>ge(t.data.event_id),variant:"primary"}}),_()):o({isVisible:!0,message:t.data.message||"Unable to delete event",type:"error"})}catch(t){console.error("Failed to delete event:",t),o({isVisible:!0,message:"Unable to delete event",type:"error"})}finally{M(t=>({...t,isLoading:!1}))}}}async function ge(t){try{const y=await X.post(`/events/${t}/restore`);y.data.status==="success"?(o({isVisible:!0,message:"Event restored to draft",type:"success"}),_()):o({isVisible:!0,message:y.data.message||"Unable to restore event",type:"error"})}catch(y){console.error("Failed to restore event:",y),o({isVisible:!0,message:"Unable to restore event",type:"error"})}}function we(){M({isOpen:!1,isLoading:!1})}function je(t){x({isOpen:!0,eventId:t,isLoading:!1})}async function _e(){if(n.eventId){x(t=>({...t,isLoading:!0}));try{const t=await X.post(`/events/${n.eventId}/publish`);t.data.status==="success"?(o({isVisible:!0,message:"Event published successfully",type:"success"}),x({isOpen:!1,isLoading:!1}),_()):(o({isVisible:!0,message:t.data.message||"Unable to publish event",type:"error"}),x({isOpen:!1,isLoading:!1}))}catch(t){console.error("Failed to publish event:",t),o({isVisible:!0,message:"Unable to publish event",type:"error"}),x({isOpen:!1,isLoading:!1})}}}function a(){x({isOpen:!1,isLoading:!1})}function T(t,y){u({isOpen:!0,assignmentId:t,isLoading:!1,workerName:y})}async function F(){var t,y;if(C.assignmentId){u(S=>({...S,isLoading:!0}));try{const S=await X.delete(`/staffing/${C.assignmentId}`);((t=S.data)==null?void 0:t.status)==="success"?(o({isVisible:!0,message:"Worker unassigned successfully",type:"success"}),u({isOpen:!1,isLoading:!1}),_()):(o({isVisible:!0,message:((y=S.data)==null?void 0:y.message)||"Unable to unassign worker",type:"error"}),u({isOpen:!1,isLoading:!1}))}catch(S){console.error("Failed to unassign worker:",S),o({isVisible:!0,message:"Unable to unassign worker",type:"error"}),u({isOpen:!1,isLoading:!1})}}}const G=t=>{U({isOpen:!0,shiftId:t})},K=()=>{U({isOpen:!1})},me=()=>{K(),o({isVisible:!0,message:"Worker assigned",type:"success"}),_()},ee=I.filter(t=>{var y;if(Q){const S=Q.toLowerCase();if(!(t.title.toLowerCase().includes(S)||((y=t.venue)==null?void 0:y.name.toLowerCase().includes(S))))return!1}if(i==="active")switch(h){case"needs_workers":return t.unfilled_roles_count>0;case"partially_filled":return t.unfilled_roles_count>0&&t.assigned_workers_count>0;case"fully_staffed":return t.unfilled_roles_count===0&&t.assigned_workers_count>0;case"all":default:return!0}return!0}).sort((t,y)=>{var S,H;switch(Y){case"name":return t.title.localeCompare(y.title);case"staffing":return t.staffing_percentage-y.staffing_percentage;case"date":default:const re=((S=t.schedule)==null?void 0:S.start_time_utc)||t.created_at,le=((H=y.schedule)==null?void 0:H.start_time_utc)||y.created_at;return new Date(re).getTime()-new Date(le).getTime()}});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold text-gray-900",children:"Events"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage events and assign workers"})]}),e.jsxs("button",{onClick:()=>s("/events/create"),className:"w-full sm:w-auto inline-flex items-center justify-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors shadow-sm min-h-touch",children:[e.jsx(De,{size:20}),"Create New Event"]})]}),m.get("date")&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-teal-50 border border-teal-200 rounded-lg",children:[e.jsx(Ae,{size:16,className:"text-teal-600"}),e.jsxs("span",{className:"text-sm font-medium text-teal-900",children:["Showing events for ",he(ce(m.get("date")),"EEEE, MMMM d, yyyy")]}),e.jsx("button",{onClick:()=>{const t=new URLSearchParams(m);t.delete("date"),N(t)},className:"ml-auto text-teal-600 hover:text-teal-700",title:"Clear date filter",children:e.jsx(ye,{size:16})})]})]}),e.jsxs("div",{className:"flex gap-6 border-b border-gray-200 mb-6",children:[e.jsx("button",{onClick:()=>j("draft"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${i==="draft"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Draft Events"}),e.jsx("button",{onClick:()=>j("active"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${i==="active"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Active Events"}),e.jsx("button",{onClick:()=>j("completed"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${i==="completed"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Completed Events"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-3 sm:gap-4 mb-6",children:[e.jsxs("div",{className:"w-full md:flex-1 md:max-w-md relative",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search events or venues...",value:w,onChange:t=>R(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),e.jsxs("select",{value:Y,onChange:t=>q(t.target.value),className:"w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"name",children:"Sort by Name"}),i!=="draft"&&e.jsx("option",{value:"staffing",children:"Sort by Staffing"})]}),i==="active"&&e.jsxs("div",{className:"w-full sm:w-auto flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>V("all"),className:`w-full sm:w-auto px-3 py-2 text-sm font-medium rounded-lg transition ${h==="all"?"bg-gray-100 text-gray-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"All"}),e.jsx("button",{onClick:()=>V("needs_workers"),className:`w-full sm:w-auto px-3 py-2 text-sm font-medium rounded-lg transition ${h==="needs_workers"?"bg-red-100 text-red-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Needs Workers"}),e.jsx("button",{onClick:()=>V("fully_staffed"),className:`w-full sm:w-auto px-3 py-2 text-sm font-medium rounded-lg transition ${h==="fully_staffed"?"bg-green-100 text-green-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Ready"})]})]}),te?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Me,{}),e.jsx(Me,{}),e.jsx(Me,{})]}):e.jsxs(e.Fragment,{children:[i==="draft"&&e.jsx(hs,{events:ee,onDelete:ie,onPublish:je,onNavigate:t=>s(t),searchQuery:w}),i==="active"&&e.jsx(gs,{events:ee,expandedEvents:A,loadingEventDetails:P,onToggleEvent:Z,onAssignWorker:G,onUnassign:T,onQuickFill:(t,y,S,H)=>b({isOpen:!0,eventId:t,roleName:y,unfilledShiftIds:S,payRate:H}),onPublish:je,onDelete:ie,onEdit:t=>c({isOpen:!0,event:t}),searchQuery:w}),i==="completed"&&e.jsx(fs,{events:ee,searchQuery:w,onApproveHours:t=>k({isOpen:!0,event:t})})]})]}),B.isOpen&&B.shiftId&&e.jsx(os,{shiftId:B.shiftId,onClose:K,onSuccess:me}),e.jsx(Ve,{isVisible:L.isVisible,message:L.message,type:L.type,action:L.action,onClose:()=>o({...L,isVisible:!1})}),e.jsx(Le,{isOpen:n.isOpen,onClose:a,onConfirm:_e,title:"Publish Event",message:"Ready to publish? This will create shifts and make them available for worker assignment.",confirmText:n.isLoading?"Publishingâ€¦":"Publish",cancelText:"Cancel",isLoading:n.isLoading,isDestructive:!1}),e.jsx(Le,{isOpen:C.isOpen,onClose:()=>u({isOpen:!1,isLoading:!1}),onConfirm:F,title:"Unassign Worker",message:`Remove ${C.workerName||"this worker"} from this shift?`,confirmText:C.isLoading?"Removingâ€¦":"Unassign",cancelText:"Cancel",isLoading:C.isLoading,isDestructive:!0}),e.jsx(Le,{isOpen:p.isOpen,onClose:we,onConfirm:be,title:"Delete Event",message:`Delete "${p.eventTitle}"? This action cannot be undone.`,confirmText:p.isLoading?"Deletingâ€¦":"Delete",cancelText:"Cancel",isLoading:p.isLoading,isDestructive:!0}),e.jsx(ds,{isOpen:$.isOpen,eventId:$.eventId||0,roleName:$.roleName||"",unfilledShiftIds:$.unfilledShiftIds,defaultPayRate:$.payRate,onClose:()=>b({isOpen:!1,unfilledShiftIds:[]}),onDone:({assigned:t,conflicts:y,details:S})=>{b({isOpen:!1,unfilledShiftIds:[]});let H=`Assigned ${t} workers â€¢ ${y} skipped`;y>0&&S&&(H+=`: ${S}`),o({isVisible:!0,message:H,type:y>0?"error":"success"}),_()}}),l.event&&e.jsx(cs,{event:l.event,isOpen:l.isOpen,onClose:()=>c({isOpen:!1,event:void 0}),onSuccess:()=>{_(),c({isOpen:!1,event:void 0})}}),W.isOpen&&W.event&&e.jsx(xs,{event:W.event,isOpen:W.isOpen,onClose:()=>{k({isOpen:!1}),_()},onSuccess:()=>{_(),k({isOpen:!1})}})]})}function hs({events:s,onDelete:m,onPublish:N,onNavigate:r,searchQuery:O}){const i=h=>{if(!h)return"No date set";const D=ce(h);return he(D,"MMM d, yyyy")},J=h=>{if(!h)return"";const D=ce(h);return he(D,"h:mm a")};return s.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:O?"No draft events found":"No draft events yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:O?"Try adjusting your search query":"Create your first event to get started"}),!O&&e.jsxs("button",{onClick:()=>r("/events/create"),className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:[e.jsx(De,{size:20}),"Create Event"]})]}):e.jsx("div",{className:"space-y-4",children:s.map(h=>{var D;return e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[h.title,h.schedule&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-600",children:["â€¢ ",J(h.schedule.start_time_utc),"â€“",J(h.schedule.end_time_utc)]})]})}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Draft"})]}),h.venue&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[e.jsx(Fe,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:((D=h.venue)==null?void 0:D.name)||"No venue"})]}),h.schedule&&e.jsx("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{children:i(h.schedule.start_time_utc)})]})}),h.total_workers_needed>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Ee,{size:16,className:"text-gray-400"}),e.jsxs("span",{children:[h.total_workers_needed," workers needed"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>r(`/events/${h.id}/edit`),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Edit",children:e.jsx(Ie,{size:18})})})]})})},h.id)})})}function gs({events:s,expandedEvents:m,loadingEventDetails:N,onToggleEvent:r,onAssignWorker:O,onUnassign:i,onQuickFill:J,onPublish:h,onDelete:D,onEdit:w,searchQuery:R}){const Q=f=>{const I=ce(f);return he(I,"EEE, MMM d, yyyy")},Y=f=>{const I=ce(f);return he(I,"h:mm a")},q=f=>{if(!f.schedule)return!1;const v=(ce(f.schedule.start_time_utc).getTime()-new Date().getTime())/(1e3*60*60);return v>0&&v<=48},te=f=>{switch(f){case"fully_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[e.jsx(pe,{size:14}),"Ready"]});case"partially_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full",children:[e.jsx(ue,{size:14}),"Partial"]});case"needs_workers":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[e.jsx(ye,{size:14}),"Needs Workers"]});default:return null}};return s.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:R?"No active events found":"No active events"}),e.jsx("p",{className:"text-gray-600",children:R?"Try adjusting your search query or filters":"Publish draft events to see them here"})]}):e.jsx("div",{className:"space-y-4",children:s.map(f=>{const I=m.has(f.id);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-5 hover:border-gray-300 hover:shadow-sm transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1 truncate",children:f.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 flex-wrap",children:[f.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ae,{className:"h-4 w-4 flex-shrink-0"}),Q(f.schedule.start_time_utc)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"h-4 w-4 flex-shrink-0"}),Y(f.schedule.start_time_utc)," - ",Y(f.schedule.end_time_utc),q(f)&&e.jsx("span",{className:"bg-red-600 text-white text-xs font-semibold px-2 py-0.5 rounded-full ml-2","aria-label":"Urgent: starts within 48 hours",children:"Urgent"})]})]}),f.venue&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Fe,{className:"h-4 w-4 flex-shrink-0"}),f.venue.name]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 ml-4",children:[te(f.staffing_status),w&&f.status==="published"&&e.jsx("button",{onClick:v=>{v.stopPropagation(),w(f)},title:"Edit Event",className:"p-1.5 text-teal-600 hover:text-teal-700 hover:bg-teal-50 rounded transition-colors",children:e.jsx(ns,{size:14})}),D&&e.jsx("button",{onClick:v=>{v.stopPropagation(),D(f.id)},title:"Delete",className:"p-1.5 text-red-600 hover:text-red-700 hover:bg-red-50 rounded transition-colors",children:e.jsx(Ce,{size:14})}),e.jsx("button",{onClick:()=>r(f.id),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:I?e.jsx(Ke,{size:20,className:"text-gray-600"}):e.jsx(as,{size:20,className:"text-gray-600"})})]})]}),e.jsx("div",{className:"py-3 border-y border-gray-100 space-y-2",children:(()=>{const v=f.assigned_workers_count||0,A=f.total_workers_needed||0,g=A>0?Math.round(v/A*100):0;f.unfilled_roles_count;const P=(()=>{const W=f.estimated_cost??f.total_cost??f.total_pay_amount??0;return ae(W,2,"0.00")})(),z=()=>g>=100?"bg-green-500":g>=75?"bg-amber-500":g>=50?"bg-orange-500":"bg-red-500";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 whitespace-nowrap",children:[v," of ",A," roles filled"]}),e.jsx("div",{className:"flex-1 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:ve("h-full rounded-full transition-all duration-300",z()),style:{width:`${g}%`}})}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900 whitespace-nowrap",children:[g,"%"]})]}),e.jsxs("div",{className:"text-sm font-medium text-gray-700",children:[v,"/",A," hired"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{children:"Est. Cost: "}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["$",P]})]})]})})()}),I&&e.jsx("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:N.has(f.id)?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-teal-600 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading assignments..."})]})}):f.shifts_by_role&&f.shifts_by_role.length>0?e.jsx("div",{className:"space-y-4",children:f.shifts_by_role.map(v=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:v.role_name}),e.jsxs("span",{className:"text-sm text-gray-600",children:[v.filled_shifts,"/",v.total_shifts," hired"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[v.filled_shifts<v.total_shifts&&e.jsxs("span",{className:"px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[v.total_shifts-v.filled_shifts," needed"]}),v.filled_shifts<v.total_shifts&&e.jsx("button",{onClick:A=>{var z;A.stopPropagation();const g=v.shifts.filter(W=>W.staffing_progress.percentage<100).sort((W,k)=>new Date(W.start_time_utc).getTime()-new Date(k.start_time_utc).getTime()).map(W=>W.id),P=(z=v.shifts[0])==null?void 0:z.pay_rate;J(f.id,v.role_name,g,P)},className:"px-2.5 py-1 text-xs font-semibold bg-teal-600 text-white rounded hover:bg-teal-700",title:"Quick Fill by Skill",children:"Quick Fill by Skill"})]})]}),e.jsx("div",{className:"space-y-2",children:v.shifts.map((A,g)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 text-gray-700 rounded-md flex items-center justify-center text-xs font-medium",children:g+1}),e.jsxs("span",{className:"text-sm text-gray-700",children:[Y(A.start_time_utc)," - ",Y(A.end_time_utc)]}),A.assignments.length>0&&e.jsx("div",{className:"flex items-center gap-1 flex-wrap",children:A.assignments.map(P=>{const z=`${P.worker.first_name} ${P.worker.last_name}`,W=Number(P.hourly_rate||A.pay_rate||0);return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"bg-white text-black border border-gray-200 rounded-full px-2.5 py-1 text-sm font-medium shadow-sm max-w-[140px] truncate",title:`${z} â€¢ $${ae(W,0,"0")}/hr`,children:z}),e.jsx("button",{onClick:k=>{k.stopPropagation(),i(P.id,z)},className:"w-5 h-5 flex items-center justify-center text-red-600 hover:text-red-700 hover:bg-red-50 rounded",title:"Unassign worker",children:e.jsx(ye,{size:12})})]},P.id)})})]}),A.staffing_progress.percentage===100?e.jsxs("span",{className:"flex items-center gap-1.5 text-sm font-medium text-green-600",children:[e.jsx(pe,{size:16}),"Assigned"]}):e.jsx("button",{onClick:P=>{P.stopPropagation(),O(A.id)},className:"px-3 py-1.5 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Assign Worker"})]},A.id))})]},v.role_name))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:f.status==="draft"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"This event is still in draft status"}),e.jsx("p",{className:"text-sm",children:"Publish the event to generate shifts and assign workers"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"No shifts available"}),e.jsx("p",{className:"text-sm",children:"This event may not have any shifts generated yet"})]})}),e.jsx("div",{className:"flex items-center justify-center gap-3",children:f.status==="draft"&&e.jsx("button",{onClick:()=>h(f.id),className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors",children:"Publish Event"})})]})})]},f.id)})})}function fs({events:s,searchQuery:m,onApproveHours:N}){const r=i=>{const J=ce(i);return he(J,"MMM d, yyyy")},O=i=>{const J=ce(i);return he(J,"h:mm a")};return s.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“‹"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:m?"No past events found":"No past events yet"}),e.jsx("p",{className:"text-gray-600",children:m?"Try adjusting your search query":"Completed events will appear here"})]}):e.jsx("div",{className:"space-y-4",children:s.map(i=>{var h;const J=He(i.total_hours??i.total_hours_worked??0);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-5 hover:border-gray-300 hover:shadow-sm transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1 truncate",children:i.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 flex-wrap",children:[i.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ae,{className:"h-4 w-4 flex-shrink-0"}),r(i.schedule.start_time_utc)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"h-4 w-4 flex-shrink-0"}),O(i.schedule.start_time_utc)," - ",O(i.schedule.end_time_utc)]})]}),i.venue&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Fe,{className:"h-4 w-4 flex-shrink-0"}),i.venue.name]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 ml-4",children:[e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-700 rounded",children:"Completed"}),i.approval_status&&i.approval_status.pending>0&&e.jsxs("span",{className:"px-2 py-1 text-xs font-medium bg-amber-100 text-amber-700 rounded",children:[i.approval_status.pending," Pending"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 py-3 border-y border-gray-100",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Workers"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:i.assigned_workers_count||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Hours"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:ae(J,2,"0.00")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Cost"}),e.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:["$",(h=i.cost_summary)!=null&&h.total_estimated_cost?ae(i.cost_summary.total_estimated_cost,2,"0.00"):i.total_pay_amount?ae(i.total_pay_amount,2,"0.00"):"0.00"]}),i.approval_status&&i.approval_status.pending>0&&i.cost_summary&&e.jsxs("div",{className:"text-xs text-amber-600 font-medium mt-0.5",children:["$",ae(i.cost_summary.pending_cost,2,"0.00")," pending"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Staffing"}),(()=>{const D=i.total_workers_needed||0,w=i.assigned_workers_count||0;if(D===0&&w===0)return e.jsx("div",{className:"text-lg font-semibold text-gray-400",children:"Not staffed"});const R=i.staffing_percentage||(D>0?Math.round(w/D*100):0);return e.jsxs("div",{className:ve("text-lg font-semibold",R===100?"text-green-600":R>0?"text-yellow-600":"text-red-600"),children:[R,"%"]})})()]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:N&&(()=>{const D=i.total_workers_needed||0,w=i.assigned_workers_count||0,R=i.approval_status&&i.approval_status.total>0;return D===0&&w===0&&!R?null:e.jsxs("button",{onClick:()=>N(i),className:ve("px-4 py-2 text-sm font-medium rounded-lg flex items-center gap-2 transition-colors shadow-sm",i.approval_status&&i.approval_status.pending>0?"bg-amber-600 hover:bg-amber-700 text-white":i.approval_status&&i.approval_status.approved===i.approval_status.total&&R||R?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"),disabled:!R,children:[i.approval_status&&i.approval_status.pending>0?e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"h-4 w-4"}),"Approve Hours (",i.approval_status.pending,")"]}):R?e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-4 w-4"}),"Approved"]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-4 w-4"}),"No assignments"]}),e.jsx(rs,{className:"h-4 w-4"})]})})()})]},i.id)})})}export{Ps as EventsPage};
