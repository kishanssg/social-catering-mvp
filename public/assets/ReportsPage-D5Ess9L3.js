import{c as J,a as T,j as e}from"./index-D9AVL-2E.js";import{r as d,R as Q}from"./vendor-79DyBOV9.js";import{T as q}from"./Toast-DV0rDIw3.js";import{r as A,t as K,a as F,f as l}from"./index-C_slYh2M.js";import{F as $}from"./file-text-CH2Azp5U.js";import{D as W}from"./dollar-sign-mGPq8Lc1.js";import{U as X}from"./users-DdnaKi6b.js";import{C}from"./calendar-DwUI4oPE.js";import{C as Z}from"./clock-hCYGkKbU.js";import{D as L}from"./download-DczYGuh2.js";import{A as ee}from"./alert-circle-RCM2JQiw.js";import{e as U,s as I}from"./index-6Qs-loHP.js";import"./x-circle--ZXhmoXj.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=J("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);function te(t,c){A(2,arguments);var i=K(t),n=F(c);return isNaN(n)?new Date(NaN):(n&&i.setDate(i.getDate()+n),i)}function v(t,c){A(2,arguments);var i=F(c);return te(t,-i)}function ge(){const[t,c]=d.useState(null),[i,n]=d.useState("last_7_days"),[u,p]=d.useState({start:l(v(new Date,7),"yyyy-MM-dd"),end:l(new Date,"yyyy-MM-dd")}),[m,_]=d.useState(null),[h,P]=d.useState(null),[b,z]=d.useState(null),[y,R]=d.useState(!1),[O,H]=d.useState([]),[V,B]=d.useState([]),[Y,G]=d.useState([]),[N,S]=d.useState({isVisible:!1,message:"",type:"success"});Q.useEffect(()=>{(async()=>{var s,o,a;try{const r=await T.get("/workers?active=true"),g=(((o=(s=r.data)==null?void 0:s.data)==null?void 0:o.workers)||((a=r.data)==null?void 0:a.data)||[]).map(x=>({id:x.id,name:`${x.first_name} ${x.last_name}`,skills_json:x.skills_json||[]}));H(g);const D=new Set;g.forEach(x=>(x.skills_json||[]).forEach(k=>D.add(k))),G(Array.from(D).sort())}catch(r){console.error("Failed to load workers for filters",r)}})(),(async()=>{var s;try{const a=((s=(await T.get("/events?tab=active")).data)==null?void 0:s.data)||[];B(a.map(r=>({id:r.id,title:r.title})))}catch(o){console.error("Failed to load events for filters",o)}})()},[]);const M=()=>{const s=new Date;switch(i){case"today":return{start:l(s,"yyyy-MM-dd"),end:l(s,"yyyy-MM-dd")};case"yesterday":const o=v(s,1);return{start:l(o,"yyyy-MM-dd"),end:l(o,"yyyy-MM-dd")};case"last_7_days":return{start:l(v(s,7),"yyyy-MM-dd"),end:l(s,"yyyy-MM-dd")};case"last_30_days":return{start:l(v(s,30),"yyyy-MM-dd"),end:l(s,"yyyy-MM-dd")};case"this_month":return{start:l(I(s),"yyyy-MM-dd"),end:l(U(s),"yyyy-MM-dd")};case"last_month":const a=new Date(s.getFullYear(),s.getMonth()-1,1);return{start:l(I(a),"yyyy-MM-dd"),end:l(U(a),"yyyy-MM-dd")};case"custom":return u;default:return u}};async function f(s){var o;if(!t){S({isVisible:!0,message:"Please select a report type first",type:"error"});return}R(!0);try{const a=M();let r="";switch(s){case"timesheet":r=`/reports/timesheet?start_date=${a.start}&end_date=${a.end}`,h&&(r+=`&event_id=${h}`),m&&(r+=`&worker_id=${m}`),b&&(r+=`&skill_name=${encodeURIComponent(b)}`);break;case"payroll":r=`/reports/payroll?start_date=${a.start}&end_date=${a.end}`,h&&(r+=`&event_id=${h}`),m&&(r+=`&worker_id=${m}`);break;case"worker_hours":r=`/reports/worker_hours?start_date=${a.start}&end_date=${a.end}`,m&&(r+=`&worker_id=${m}`),b&&(r+=`&skill_name=${encodeURIComponent(b)}`);break;case"event_summary":r=`/reports/event_summary?start_date=${a.start}&end_date=${a.end}`,h&&(r+=`&event_id=${h}`);break}const E=await T.get(r,{responseType:"blob"}),g=E.headers["content-disposition"],x=((o=g==null?void 0:g.match(/filename="?([^";]+)"?/i))==null?void 0:o[1])||`report_${a.start}_to_${a.end}.csv`,k=window.URL.createObjectURL(new Blob([E.data])),j=document.createElement("a");j.href=k,j.setAttribute("download",x),document.body.appendChild(j),j.click(),j.remove(),window.URL.revokeObjectURL(k)}catch(a){console.error("Failed to export:",a),S({isVisible:!0,message:"Failed to export report",type:"error"})}finally{R(!1)}}return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Reports"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Export timesheets and payroll data for processing"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsx(w,{icon:e.jsx($,{size:24}),title:"Weekly Timesheet",description:"Detailed time records with clock-in/clock-out times. Use as backup documentation if needed.",color:"teal",lastExport:"Last 7 days",onExport:()=>{n("last_7_days"),f("timesheet")},exporting:y}),e.jsx(w,{icon:e.jsx(W,{size:24}),title:"Payroll Summary",description:"See total hours and compensation per worker. Perfect for processing weekly or monthly payroll.",color:"indigo",lastExport:"Last 7 days",onExport:()=>{n("last_7_days"),f("payroll")},exporting:y}),e.jsx(w,{icon:e.jsx(X,{size:24}),title:"Worker Hours Report",description:"Individual worker breakdown showing all shifts worked. Good for performance reviews and audits.",color:"blue",lastExport:"This month",onExport:()=>{n("this_month"),f("worker_hours")},exporting:y}),e.jsx(w,{icon:e.jsx(C,{size:24}),title:"Event Summary",description:"Track labor costs per event. See which events are most expensive and monitor monthly spending.",color:"purple",lastExport:"Last 30 days",onExport:()=>{n("last_30_days"),f("event_summary")},exporting:y})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Advanced Export Options"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Select Report Type"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[e.jsx("button",{onClick:()=>c("timesheet"),className:`p-4 rounded-lg border-2 transition-all text-left ${t==="timesheet"?"border-teal-600 bg-teal-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${t==="timesheet"?"bg-teal-100 text-teal-600":"bg-gray-100 text-gray-600"}`,children:e.jsx($,{size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Timesheet Report"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Job ID, Worker, Role, Hours, Break Time, Supervisor"})]})]})}),e.jsx("button",{onClick:()=>c("payroll"),className:`p-4 rounded-lg border-2 transition-all text-left ${t==="payroll"?"border-indigo-600 bg-indigo-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${t==="payroll"?"bg-indigo-100 text-indigo-600":"bg-gray-100 text-gray-600"}`,children:e.jsx(W,{size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Payroll Summary"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Date, Event, Worker, Hours, Rate, Total Pay"})]})]})}),e.jsx("button",{onClick:()=>c("worker_hours"),className:`p-4 rounded-lg border-2 transition-all text-left ${t==="worker_hours"?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${t==="worker_hours"?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600"}`,children:e.jsx(Z,{size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Worker Hours"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Total hours by worker for period"})]})]})}),e.jsx("button",{onClick:()=>c("event_summary"),className:`p-4 rounded-lg border-2 transition-all text-left ${t==="event_summary"?"border-purple-600 bg-purple-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${t==="event_summary"?"bg-purple-100 text-purple-600":"bg-gray-100 text-gray-600"}`,children:e.jsx(se,{size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Event Summary"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Complete staffing details by event"})]})]})})]})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Date Range"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 mb-4",children:[{value:"today",label:"Today"},{value:"yesterday",label:"Yesterday"},{value:"last_7_days",label:"Last 7 Days"},{value:"last_30_days",label:"Last 30 Days"},{value:"this_month",label:"This Month"},{value:"last_month",label:"Last Month"},{value:"custom",label:"Custom Range"}].map(s=>e.jsx("button",{onClick:()=>{n(s.value),s.value!=="custom"&&p({start:l(v(new Date,7),"yyyy-MM-dd"),end:l(new Date,"yyyy-MM-dd")})},className:`px-3 py-2 text-sm font-medium rounded-lg transition-colors ${i===s.value?"bg-teal-100 text-teal-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:s.label},s.value))}),i==="custom"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:u.start,onChange:s=>p(o=>({...o,start:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsx("div",{className:"pt-6",children:e.jsx("span",{className:"text-gray-500",children:"to"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:u.end,onChange:s=>p(o=>({...o,end:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]})]}),e.jsx("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-700",children:[e.jsx(C,{size:16}),e.jsxs("span",{className:"font-medium",children:["Selected Range: ",l(new Date(M().start),"MMM d, yyyy")," - ",l(new Date(M().end),"MMM d, yyyy")]})]})})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Optional Filters"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(t==="timesheet"||t==="payroll"||t==="worker_hours")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-2",children:"Filter by Worker (optional)"}),e.jsxs("select",{value:m||"",onChange:s=>_(s.target.value?parseInt(s.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500",children:[e.jsx("option",{value:"",children:"All Workers"}),O.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),(t==="timesheet"||t==="payroll"||t==="event_summary")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-2",children:"Filter by Event (optional)"}),e.jsxs("select",{value:h||"",onChange:s=>P(s.target.value?parseInt(s.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500",children:[e.jsx("option",{value:"",children:"All Events"}),V.map(s=>e.jsx("option",{value:s.id,children:s.title},s.id))]})]}),(t==="timesheet"||t==="worker_hours")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-2",children:"Filter by Skill (optional)"}),e.jsxs("select",{value:b||"",onChange:s=>z(s.target.value||null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500",children:[e.jsx("option",{value:"",children:"All Skills"}),Y.map(s=>e.jsx("option",{value:s,children:s},s))]})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("button",{onClick:()=>t&&f(t),disabled:y,className:"w-full md:w-auto px-6 py-3 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(L,{size:20}),y?"Exporting...":"Export CSV Report"]}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ee,{size:18,className:"text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-700",children:[e.jsx("p",{className:"font-medium text-blue-800 mb-2",children:"Export Information:"}),e.jsxs("ul",{className:"space-y-1 text-xs",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Timesheet Format:"})," Matches your sample exactly (JOB_ID, SKILL_NAME, etc.)"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Break Policy:"})," 30 minutes (0.5 hours) per shift by default"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Hours Calculation:"})," (End Time - Start Time) - Break Time"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Status Filter:"})," Only completed/approved shifts are exported"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Date Format:"})," MM/DD/YYYY, Times in 12-hour format (AM/PM)"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Overnight Shifts:"})," Use start date for shift date"]})]})]})]})})]})]})]})]}),e.jsxs("div",{className:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ðŸ“‹ Which Report Should I Use?"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white rounded-lg p-4 border border-blue-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0 mt-1",children:e.jsx("span",{className:"text-indigo-600 font-semibold",children:"ðŸ’°"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"Payroll Summary"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("strong",{children:"Use this to pay your workers."})," Shows one row per worker with total hours and total amount you owe them."]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[e.jsx("strong",{children:"Columns:"})," Worker Name, Total Hours, Average Rate, Total Compensation, Shifts Worked, Events"]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border border-blue-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center flex-shrink-0 mt-1",children:e.jsx("span",{className:"text-purple-600 font-semibold",children:"ðŸ“Š"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"Event Summary"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("strong",{children:"Use this to track event costs."})," Shows how many workers per event and total labor cost. Perfect for monthly cost tracking."]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[e.jsx("strong",{children:"Columns:"})," Event Title, Date, Venue, Workers Needed/Assigned, Total Event Cost, Supervisor"]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border border-blue-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center flex-shrink-0 mt-1",children:e.jsx("span",{className:"text-teal-600 font-semibold",children:"ðŸ•"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"Weekly Timesheet"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("strong",{children:"Detailed time tracking."})," Shows clock-in/clock-out times for each shift. Use this as backup if a worker disputes their hours."]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[e.jsx("strong",{children:"Columns:"})," Worker Name, Shift Date, Start Time, End Time, Break Time, Total Hours, Supervisor"]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border border-blue-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0 mt-1",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:"ðŸ‘¤"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"Worker Hours Report"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("strong",{children:"Individual worker breakdown."})," Shows all shifts for specific workers. Good for performance reviews or checking one person's work history."]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[e.jsx("strong",{children:"Columns:"})," Worker Name, Event Name, Date, Role, Hours, Pay Rate, Payout (with TOTAL row)"]})]})]})})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-blue-200",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2 text-sm",children:"ðŸ’¡ Quick Tips:"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Weekly payroll?"}),' Use "Payroll Summary" with "Last 7 days"']}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Monthly cost review?"}),' Use "Event Summary" with "This month"']}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Worker disputed hours?"}),' Use "Weekly Timesheet" to show proof']}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"All reports open in Excel/Numbers"})," - just download and use!"]})]})]})]})]}),e.jsx(q,{isVisible:N.isVisible,message:N.message,type:N.type,onClose:()=>S({...N,isVisible:!1})})]})}function w({icon:t,title:c,description:i,color:n,lastExport:u,onExport:p,exporting:m}){const _={teal:"bg-teal-100 text-teal-600",indigo:"bg-indigo-100 text-indigo-600",blue:"bg-blue-100 text-blue-600",purple:"bg-purple-100 text-purple-600"};return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg ${_[n]} flex items-center justify-center`,children:t}),e.jsx("button",{onClick:p,disabled:m,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition disabled:opacity-50",title:"Quick export",children:e.jsx(L,{size:20})})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:c}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:i}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(C,{size:16}),e.jsx("span",{children:u})]})]})}export{ge as ReportsPage};
