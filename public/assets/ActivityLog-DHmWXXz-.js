import{b as U,r as y}from"./vendor-79DyBOV9.js";import{c as j,j as e,X as Y,R as Z,a as J}from"./index-BSQvxD4w.js";import{F as S}from"./file-text-C5v1BpPa.js";import{S as F,T as K,L as Q}from"./trash-2-CiDlR8i1.js";import{C as w}from"./calendar-CJI-DvSb.js";import{c as _}from"./utils-DuMXYCiK.js";import{X as ee,C as T}from"./x-circle-BqzUjruS.js";import{c as R,d as te}from"./dateUtils-BuSgYwNE.js";import{U as $}from"./user-Bn4fpn8V.js";import{r as L,C as se,f as E}from"./index-CBpAUuX1.js";import{D as W}from"./dollar-sign-D3gb1ToI.js";import{C as q}from"./chevron-down-BAv9ijFH.js";import{C as O}from"./chevron-right-DtOU4xGS.js";import{p as G}from"./index-DEbmhAsf.js";import{i as re,b as ae,a as ne}from"./index-CF9MLOkT.js";import{s as le}from"./index-Bam5Dd5J.js";import{s as D}from"./index-DOe2smbO.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=j("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=j("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=j("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=j("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=j("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=j("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=j("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=j("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=j("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=j("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);function me(t,r,a){L(2,arguments);var s=D(t,a),n=D(r,a);return s.getTime()===n.getTime()}function ge(t){return L(1,arguments),re(Date.now(),t)}function pe(t,r){return L(1,arguments),me(t,Date.now(),r)}function he(t){return L(1,arguments),ae(t,le(Date.now(),1))}function ue({searchQuery:t,onSearchChange:r,totalLogs:a,showingLogs:s}){return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(S,{className:"h-6 w-6 text-teal-600"}),"Activity Log"]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Track all actions and changes in the system"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-blue-50 text-blue-700 rounded-lg",children:[e.jsx(S,{className:"h-4 w-4"}),e.jsxs("span",{className:"font-medium",children:["Total Logs: ",a.toLocaleString()]})]}),t&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-teal-50 text-teal-700 rounded-lg",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsxs("span",{className:"font-medium",children:["Showing: ",s," of ",a]})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(F,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",value:t,onChange:n=>r(n.target.value),placeholder:"Search by worker name, event name, or action...",className:"block w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 text-sm"}),t&&e.jsx("button",{onClick:()=>r(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx(Y,{className:"h-5 w-5 text-gray-400 hover:text-gray-600"})})]}),t&&e.jsx("div",{className:"mt-2 text-xs text-gray-500",children:'ðŸ’¡ Tip: Search for "Charlie Williams" to see all activities for that worker, or "Wedding Reception" for all event activities'})]})}function fe({filters:t,onFiltersChange:r,onRefresh:a}){return e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 font-medium",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Filters:"})]}),e.jsxs("select",{value:t.entityType,onChange:s=>r({...t,entityType:s.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500",children:[e.jsx("option",{value:"all",children:"All Entity Types"}),e.jsx("option",{value:"Worker",children:"Workers"}),e.jsx("option",{value:"Event",children:"Events"}),e.jsx("option",{value:"Assignment",children:"Assignments"}),e.jsx("option",{value:"Shift",children:"Shifts"})]}),e.jsxs("select",{value:t.action,onChange:s=>r({...t,action:s.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500",children:[e.jsx("option",{value:"all",children:"All Actions"}),e.jsx("option",{value:"created",children:"Created"}),e.jsx("option",{value:"updated",children:"Updated"}),e.jsx("option",{value:"deleted",children:"Deleted"}),e.jsx("option",{value:"assigned_worker",children:"Assigned"}),e.jsx("option",{value:"marked_no_show",children:"No Show"}),e.jsx("option",{value:"hours_re_edited",children:"Hours Edited"}),e.jsx("option",{value:"event_hours_approved_selected",children:"Hours Approved"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-gray-500"}),e.jsx("input",{type:"date",value:t.dateFrom||"",onChange:s=>r({...t,dateFrom:s.target.value||null}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500"}),e.jsx("span",{className:"text-gray-500 text-sm",children:"to"}),e.jsx("input",{type:"date",value:t.dateTo||"",onChange:s=>r({...t,dateTo:s.target.value||null}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500"})]}),e.jsxs("button",{onClick:a,className:"ml-auto px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),"Refresh"]})]})})}function be({viewMode:t,onViewModeChange:r}){return e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"View:"}),e.jsxs("div",{className:"flex gap-1 bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>r("chronological"),className:_("px-4 py-1.5 rounded-md text-sm font-medium transition-colors flex items-center gap-2",t==="chronological"?"bg-white text-teal-700 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[e.jsx(ie,{className:"h-4 w-4"}),"Chronological"]}),e.jsxs("button",{onClick:()=>r("grouped"),className:_("px-4 py-1.5 rounded-md text-sm font-medium transition-colors flex items-center gap-2",t==="grouped"?"bg-white text-teal-700 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[e.jsx(de,{className:"h-4 w-4"}),"Grouped by Entity"]})]})]})})}function ye(t){return{event_hours_approved_selected:{icon:T,bgColor:"bg-green-50",textColor:"text-green-600",borderColor:"border-green-500",label:"Hours Approved"},event_hours_approved:{icon:T,bgColor:"bg-green-50",textColor:"text-green-600",borderColor:"border-green-500",label:"All Hours Approved"},approved:{icon:T,bgColor:"bg-green-50",textColor:"text-green-600",borderColor:"border-green-500",label:"Approved"},hours_re_edited:{icon:M,bgColor:"bg-blue-50",textColor:"text-blue-600",borderColor:"border-blue-500",label:"Hours Edited"},hours_updated:{icon:M,bgColor:"bg-blue-50",textColor:"text-blue-600",borderColor:"border-blue-500",label:"Hours Updated"},updated:{icon:M,bgColor:"bg-blue-50",textColor:"text-blue-600",borderColor:"border-blue-500",label:"Updated"},assigned_worker:{icon:P,bgColor:"bg-purple-50",textColor:"text-purple-600",borderColor:"border-purple-500",label:"Worker Assigned"},created:{icon:P,bgColor:"bg-purple-50",textColor:"text-purple-600",borderColor:"border-purple-500",label:"Created"},unassigned_worker:{icon:I,bgColor:"bg-amber-50",textColor:"text-amber-600",borderColor:"border-amber-500",label:"Worker Removed"},removed_from_job:{icon:I,bgColor:"bg-amber-50",textColor:"text-amber-600",borderColor:"border-amber-500",label:"Removed from Job"},marked_no_show:{icon:ee,bgColor:"bg-red-50",textColor:"text-red-600",borderColor:"border-red-500",label:"No Show"},deleted:{icon:K,bgColor:"bg-red-50",textColor:"text-red-600",borderColor:"border-red-500",label:"Deleted"},restored_from_cancelled:{icon:ce,bgColor:"bg-teal-50",textColor:"text-teal-600",borderColor:"border-teal-500",label:"Restored"},hours_reopened_for_editing:{icon:xe,bgColor:"bg-teal-50",textColor:"text-teal-600",borderColor:"border-teal-500",label:"Reopened for Editing"},totals_recalculated:{icon:oe,bgColor:"bg-gray-50",textColor:"text-gray-600",borderColor:"border-gray-500",label:"Totals Recalculated"}}[t]||{icon:S,bgColor:"bg-gray-50",textColor:"text-gray-600",borderColor:"border-gray-500",label:t.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}}function je({activity:t}){var a,s,n,i,c,u,m,b,l;const r=U();return e.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 px-4 py-3",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wider mb-3",children:"Full Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx($,{className:"h-4 w-4 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Action by"}),e.jsx("div",{className:"font-medium text-gray-900",children:t.actor_name})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Timestamp"}),e.jsx("div",{className:"font-medium text-gray-900",children:R(t.created_at)})]})]}),((a=t.details)==null?void 0:a.worker_name)&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx($,{className:"h-4 w-4 text-teal-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Worker"}),t.details.worker_id?e.jsxs("button",{onClick:()=>{var o;return r(`/workers/${(o=t.details)==null?void 0:o.worker_id}`)},className:"font-medium text-teal-600 hover:underline flex items-center gap-1",children:[t.details.worker_name,e.jsx(H,{className:"h-3 w-3"})]}):e.jsx("div",{className:"font-medium text-gray-900",children:t.details.worker_name})]})]}),((s=t.details)==null?void 0:s.event_name)&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Event"}),t.details.event_id?e.jsxs("button",{onClick:()=>{var o;return r(`/events/${(o=t.details)==null?void 0:o.event_id}`)},className:"font-medium text-blue-600 hover:underline flex items-center gap-1",children:[t.details.event_name,e.jsx(H,{className:"h-3 w-3"})]}):e.jsx("div",{className:"font-medium text-gray-900",children:t.details.event_name})]})]}),((n=t.details)==null?void 0:n.before_hours)!==void 0&&((i=t.details)==null?void 0:i.after_hours)!==void 0&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(se,{className:"h-4 w-4 text-purple-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Hours"}),e.jsxs("div",{className:"font-medium text-gray-900",children:[Number(t.details.before_hours||0).toFixed(1),"h â†’ ",Number(t.details.after_hours||0).toFixed(1),"h",e.jsx("span",{className:"text-xs text-gray-500 ml-1",children:(()=>{const o=Number(t.details.before_hours||0),g=Number(t.details.after_hours||0)-o;return g>0?`+${g.toFixed(1)}h`:`${g.toFixed(1)}h`})()})]})]})]}),((c=t.details)==null?void 0:c.before_pay)!==void 0&&((u=t.details)==null?void 0:u.after_pay)!==void 0&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Pay"}),e.jsxs("div",{className:"font-medium text-gray-900",children:["$",Number(t.details.before_pay||0).toFixed(2)," â†’ $",Number(t.details.after_pay||0).toFixed(2),e.jsx("span",{className:"text-xs text-gray-500 ml-1",children:(()=>{const o=Number(t.details.before_pay||0),g=Number(t.details.after_pay||0)-o;return g>0?`+$${g.toFixed(2)}`:`$${g.toFixed(2)}`})()})]})]})]}),((m=t.details)==null?void 0:m.before_rate)!==void 0&&((b=t.details)==null?void 0:b.after_rate)!==void 0&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-amber-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Hourly Rate"}),e.jsxs("div",{className:"font-medium text-gray-900",children:["$",Number(t.details.before_rate||0).toFixed(2),"/h â†’ $",Number(t.details.after_rate||0).toFixed(2),"/h"]})]})]}),((l=t.details)==null?void 0:l.role)&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx($,{className:"h-4 w-4 text-purple-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Role"}),e.jsx("div",{className:"font-medium text-gray-900",children:t.details.role})]})]})]}),!1]})}function z({activity:t,searchQuery:r=""}){const[a,s]=y.useState(!1),n=U(),{icon:i,bgColor:c,textColor:u,borderColor:m}=ye(t.action),b=()=>{let l=t.summary;const o=t.details,x=r.trim();if(o!=null&&o.worker_name){const f=o.worker_name,p=new RegExp(`\\b${f.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`,"gi");l=l.replace(p,`<span class="font-semibold text-teal-600 hover:underline cursor-pointer" data-worker-id="${o.worker_id||""}">${f}</span>`)}if(o!=null&&o.event_name){const f=o.event_name,p=new RegExp(`\\b${f.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`,"gi");l=l.replace(p,`<span class="font-semibold text-blue-600 hover:underline cursor-pointer" data-event-id="${o.event_id||""}">${f}</span>`)}let g=l;return x&&(g=g.split(/(<[^>]+>)/).map((p,k)=>{if(p.startsWith("<"))return p;const N=new RegExp(`(${x.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return p.replace(N,'<mark class="bg-yellow-200 font-semibold">$1</mark>')}).join("")),e.jsx("div",{dangerouslySetInnerHTML:{__html:g},onClick:f=>{const p=f.target;p.dataset.workerId?n(`/workers/${p.dataset.workerId}`):p.dataset.eventId&&n(`/events/${p.dataset.eventId}`)}})};return e.jsxs("div",{className:_("bg-white rounded-lg shadow-sm border-l-4 hover:shadow-md transition-all duration-200",m),children:[e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:_("flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center",c),children:e.jsx(i,{className:_("h-5 w-5",u)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm text-gray-900 mb-2",children:b()}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[e.jsx("span",{className:"flex items-center gap-1 px-2 py-0.5 bg-gray-100 rounded",children:t.entity_type}),e.jsx("span",{title:R(t.created_at),children:te(t.created_at)}),e.jsx("span",{className:"hidden sm:inline",children:R(t.created_at)})]}),t.details&&Object.keys(t.details).length>0&&e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[t.details.worker_name&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-teal-50 text-teal-700 rounded text-xs",children:[e.jsx("span",{className:"font-medium",children:"Worker:"}),e.jsx("span",{children:t.details.worker_name})]}),t.details.event_name&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs",children:[e.jsx("span",{className:"font-medium",children:"Event:"}),e.jsx("span",{children:t.details.event_name})]}),t.details.role&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-purple-50 text-purple-700 rounded text-xs",children:[e.jsx("span",{className:"font-medium",children:"Role:"}),e.jsx("span",{children:t.details.role})]}),t.details.before_pay!==void 0&&t.details.after_pay!==void 0&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-green-50 text-green-700 rounded text-xs",children:[e.jsx("span",{className:"font-medium",children:"Pay:"}),e.jsxs("span",{children:["$",t.details.before_pay.toFixed(2)," â†’ $",t.details.after_pay.toFixed(2)]})]})]})]}),e.jsx("button",{onClick:()=>s(!a),className:"flex-shrink-0 p-1 hover:bg-gray-100 rounded transition-colors",children:a?e.jsx(q,{className:"h-5 w-5 text-gray-400"}):e.jsx(O,{className:"h-5 w-5 text-gray-400"})})]})}),a&&e.jsx(je,{activity:t})]})}function Ne(t){const r={};t.forEach(s=>{const n=E(G(s.created_at),"yyyy-MM-dd");r[n]||(r[n]=[]),r[n].push(s)});const a={};return Object.keys(r).sort((s,n)=>n.localeCompare(s)).forEach(s=>{a[s]=r[s]}),a}function ve(t){const r={};t.forEach(s=>{var u,m,b,l,o,x,g,f,p,k;let n,i,c;if((u=s.details)!=null&&u.event_name)n=`event-${s.details.event_id||s.entity_id}`,i=s.details.event_name,c="Event";else if((m=s.details)!=null&&m.worker_name)n=`worker-${s.details.worker_id||s.entity_id}`,i=s.details.worker_name,c="Worker";else if(s.entity_type==="Assignment"){const N=((b=s.details)==null?void 0:b.worker_name)||((l=s.after_json)==null?void 0:l.worker_name)||((o=s.before_json)==null?void 0:o.worker_name),d=((x=s.details)==null?void 0:x.event_name)||((g=s.after_json)==null?void 0:g.event_name)||((f=s.before_json)==null?void 0:f.event_name)||((p=s.after_json)==null?void 0:p.shift_name)||((k=s.before_json)==null?void 0:k.shift_name);N&&d?(n=`assignment-${s.entity_id}`,i=`${N} - ${d}`,c="Assignment"):N?(n=`assignment-${s.entity_id}`,i=`${N} - Assignment`,c="Assignment"):d?(n=`assignment-${s.entity_id}`,i=`${d} - Assignment`,c="Assignment"):(n=`assignment-${s.entity_id}`,i=`Assignment #${s.entity_id}`,c="Assignment")}else n=`${s.entity_type.toLowerCase()}-${s.entity_id}`,i=`${s.entity_type} #${s.entity_id}`,c=s.entity_type;r[n]||(r[n]={type:c,name:i,activities:[]}),r[n].activities.push(s)});const a={};return Object.keys(r).sort((s,n)=>{var u,m;const i=((u=r[s].activities[0])==null?void 0:u.created_at)||"";return(((m=r[n].activities[0])==null?void 0:m.created_at)||"").localeCompare(i)}).forEach(s=>{a[s]=r[s]}),a}function we(t){try{const r=G(t);return ne(r)?"Today":he(r)?"Yesterday":pe(r)?E(r,"EEEE"):ge(r)?E(r,"MMMM d"):E(r,"MMMM d, yyyy")}catch(r){return console.error("Error formatting date:",r),t}}function _e(t,r){if(!r.trim())return t;const a=r.toLowerCase();return t.filter(s=>{var n,i,c;return!!(s.summary.toLowerCase().includes(a)||s.details&&((n=s.details.worker_name)!=null&&n.toLowerCase().includes(a)||(i=s.details.event_name)!=null&&i.toLowerCase().includes(a)||(c=s.details.role)!=null&&c.toLowerCase().includes(a))||s.actor_name.toLowerCase().includes(a))})}function ke({date:t,activities:r,searchQuery:a=""}){return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(w,{className:"h-4 w-4 text-gray-400"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wider",children:we(t)}),e.jsx("div",{className:"flex-1 h-px bg-gray-200"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[r.length," ",r.length===1?"activity":"activities"]})]}),e.jsx("div",{className:"space-y-3 ml-6",children:r.map(s=>e.jsx(z,{activity:s,searchQuery:a},s.id))})]})}function Ce({entityType:t,entityName:r,activities:a,searchQuery:s=""}){const[n,i]=y.useState(!1),c=()=>{switch(t){case"Event":return w;case"Worker":return $;default:return w}},u=()=>{switch(t){case"Event":return"text-blue-600 bg-blue-50";case"Worker":return"text-teal-600 bg-teal-50";default:return"text-gray-600 bg-gray-50"}},m=c(),b=u();return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("button",{onClick:()=>i(!n),className:"w-full px-4 py-3 flex items-center gap-3 hover:bg-gray-50 transition-colors",children:[n?e.jsx(q,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}):e.jsx(O,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),e.jsx("div",{className:_("w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0",b),children:e.jsx(m,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:r}),e.jsxs("div",{className:"text-xs text-gray-500",children:[a.length," ",a.length===1?"activity":"activities"]})]}),e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs font-medium rounded",children:t})]}),n&&e.jsx("div",{className:"border-t border-gray-200 p-4 bg-gray-50 space-y-3",children:a.map(l=>e.jsx(z,{activity:l,searchQuery:s},l.id))})]})}function $e({searchQuery:t,hasFilters:r}){return t?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border border-gray-200",children:[e.jsx(F,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:['No results found for "',t,'"']}),e.jsx("p",{className:"text-sm text-gray-500",children:"Try searching for a different worker name or event name"})]}):r?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border border-gray-200",children:[e.jsx(V,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No activities match your filters"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Try adjusting your filters to see more results"})]}):e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border border-gray-200",children:[e.jsx(w,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No activities yet"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Activity logs will appear here as users make changes"})]})}function Ve(){const[t,r]=y.useState([]),[a,s]=y.useState([]),[n,i]=y.useState(!0),[c,u]=y.useState("chronological"),[m,b]=y.useState(""),[l,o]=y.useState({entityType:"all",action:"all",dateFrom:null,dateTo:null,actor:"all"}),[x,g]=y.useState({page:1,perPage:50,total:0});y.useEffect(()=>{f()},[l,x.page]),y.useEffect(()=>{if(m.trim()){const d=_e(t,m);s(d)}else s(t)},[m,t]);const f=async()=>{i(!0);try{const d={page:x.page,per_page:x.perPage};l.entityType!=="all"&&(d.entity_type=l.entityType),l.action!=="all"&&(d.log_action=l.action),l.dateFrom&&(d.date_from=l.dateFrom),l.dateTo&&(d.date_to=l.dateTo),l.actor!=="all"&&(d.actor_user_id=l.actor);const v=(await J.get("/activity_logs",{params:d})).data.data||{},X=v.activity_logs||[],B=v.pagination||{},A=X.map(h=>({id:h.id,actor_name:h.actor||h.actor_name||"System",entity_type:h.entity_type,entity_id:h.entity_id,action:h.action,summary:h.summary||"",details:h.details||h.details_json||null,created_at:h.when||h.created_at||h.created_at_utc,before_json:h.before_json||{},after_json:h.after_json||{}}));r(A),s(A),g(h=>({...h,total:B.total_count||A.length}))}catch(d){console.error("Error loading activities:",d)}finally{i(!1)}},p=()=>{const d=Ne(a);return e.jsx("div",{className:"space-y-6",children:Object.entries(d).map(([C,v])=>e.jsx(ke,{date:C,activities:v,searchQuery:m},C))})},k=()=>{const d=ve(a);return e.jsx("div",{className:"space-y-4",children:Object.entries(d).map(([C,v])=>e.jsx(Ce,{entityType:v.type,entityName:v.name,activities:v.activities,searchQuery:m},C))})},N=l.entityType!=="all"||l.action!=="all"||l.dateFrom||l.dateTo;return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(ue,{searchQuery:m,onSearchChange:b,totalLogs:x.total,showingLogs:a.length}),e.jsx(fe,{filters:l,onFiltersChange:o,onRefresh:f}),e.jsx(be,{viewMode:c,onViewModeChange:u}),e.jsx("div",{className:"mt-6",children:n?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Q,{className:"h-8 w-8 animate-spin text-teal-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading activities..."})]}):a.length===0?e.jsx($e,{searchQuery:m,hasFilters:N}):e.jsxs(e.Fragment,{children:[c==="chronological"&&p(),c==="grouped"&&k()]})}),!n&&a.length>0&&e.jsxs("div",{className:"mt-8 flex items-center justify-between border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",(x.page-1)*x.perPage+1," to"," ",Math.min(x.page*x.perPage,x.total)," of"," ",x.total," activities"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>g(d=>({...d,page:d.page-1})),disabled:x.page===1,className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>g(d=>({...d,page:d.page+1})),disabled:x.page*x.perPage>=x.total,className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})})}export{Ve as ActivityLog};
