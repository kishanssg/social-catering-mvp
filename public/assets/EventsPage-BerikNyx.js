import{c as $e,j as e,X as ye,a as G,A as ue,b as Ke,C as Je}from"./index-D9pbLmiA.js";import{r as d,b as We,f as Ze}from"./vendor-79DyBOV9.js";import{C as pe,c as Ce}from"./utils-l3IOu9-K.js";import{f as Xe,a as Ue}from"./dateUtils-CHmZs4Ub.js";import{C as fe}from"./clock-PaeSrwLJ.js";import{M as Fe}from"./map-pin-qnvslNCK.js";import{U as Ee}from"./users-Bpw8SfyM.js";import{S as Re,T as Se,L as Te,A as Oe,C as Le}from"./Avatar-00lJDIxY.js";import{D as Ie}from"./dollar-sign-Dh2Z36sv.js";import{T as Ve}from"./Toast-Bfzzj13o.js";import{C as Ye}from"./x-circle-DaW8cp21.js";import{b as Ge,a as es,c as ss,e as ts,p as as}from"./Prep Cook-li-JR_eG.js";import{P as qe}from"./pen-square-qV40A2Y6.js";import{P as Ae}from"./plus-N2pkB9Tb.js";import{f as he}from"./index-C_slYh2M.js";import{p as me}from"./index-BK_MyBzW.js";import{C as De}from"./calendar-Bhy7Hugm.js";import{C as rs}from"./chevron-down-CUvDBEi7.js";import{C as ls}from"./chevron-right-CUk_Etjo.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=$e("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=$e("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=$e("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=$e("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);function He(s,m=0){const y=typeof s=="string"?Number(s):s;return Number.isFinite(y)?y:m}function re(s,m=2,y="0"){const r=He(s,NaN);if(!Number.isFinite(r))return y;try{return r.toFixed(m)}catch{return y}}const os={sm:"max-w-md",md:"max-w-2xl",lg:"max-w-4xl",xl:"max-w-6xl"},Pe=({isOpen:s,onClose:m,title:y,subtitle:r,children:U,footer:o,size:J="md",closeOnOverlayClick:u=!0})=>{if(d.useEffect(()=>(s?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[s]),d.useEffect(()=>{const v=P=>{P.key==="Escape"&&s&&m()};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[s,m]),!s)return null;const C=v=>{v.target===v.currentTarget&&u&&m()};return e.jsx("div",{className:"modal-overlay",onClick:C,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:e.jsxs("div",{className:`modal-container ${os[J]}`,children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{id:"modal-title",className:"text-xl font-semibold text-gray-900 font-manrope",children:y}),r&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:r})]}),e.jsx("button",{onClick:m,className:"p-1.5 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors","aria-label":"Close modal",children:e.jsx(ye,{size:20,className:"text-gray-600"})})]}),e.jsx("div",{className:"modal-body",children:U}),o&&e.jsx("div",{className:"modal-footer",children:o})]})})};function ds({shiftId:s,onClose:m,onSuccess:y}){var O,n;const[r,U]=d.useState(null),[o,J]=d.useState([]),[u,C]=d.useState([]),[v,P]=d.useState(""),[B,ee]=d.useState(null),[K,te]=d.useState({}),[g,I]=d.useState(!0),[j,$]=d.useState(!1),[h,L]=d.useState(null),z=(l,x)=>{te(F=>({...F,[l]:x}))};d.useEffect(()=>{q()},[s]),d.useEffect(()=>{r&&N()},[r]),d.useEffect(()=>{if(!v)C(o);else{const l=v.toLowerCase();C(o.filter(x=>{var F;return x.first_name.toLowerCase().includes(l)||x.last_name.toLowerCase().includes(l)||x.email.toLowerCase().includes(l)||((F=x.skills_json)==null?void 0:F.some(T=>T.toLowerCase().includes(l)))}))}},[v,o]);async function q(){try{const l=await G.get(`/shifts/${s}`);l.data.status==="success"?U(l.data.data):L("Failed to load shift details")}catch(l){console.error("Failed to load shift details:",l),L("Failed to load shift details")}}async function N(){var l;try{const x=new Set;if(r!=null&&r.event_id)try{const A=((l=(await G.get(`/events/${r.event_id}`)).data)==null?void 0:l.data)||{};if(A.shifts_by_role){const V=A.shifts_by_role.find(S=>S.skill_name===r.role_needed||S.role_name===r.role_needed);V!=null&&V.shifts&&V.shifts.forEach(S=>{S.assignments&&S.assignments.forEach(p=>{var w;const i=p.worker_id||((w=p.worker)==null?void 0:w.id),c=p.status;i&&c!=="cancelled"&&c!=="no_show"&&x.add(i)})})}}catch(T){console.log("Could not fetch event to filter assigned workers:",T)}console.log(`AssignmentModal: Found ${x.size} already assigned workers for "${r==null?void 0:r.role_needed}"`);const F=await G.get("/workers?active=true");if(F.data.status==="success"){const T=F.data.data.workers||F.data.data;if(r!=null&&r.role_needed){const A=T.filter(V=>{var S;return((S=V.skills_json)==null?void 0:S.includes(r.role_needed))&&!x.has(V.id)});console.log(`AssignmentModal: Showing ${A.length} eligible workers`),J(A)}else{const A=T.filter(V=>!x.has(V.id));J(A)}}else L("Failed to load workers")}catch(x){console.error("Failed to load workers:",x),L("Failed to load workers")}finally{I(!1)}}async function E(){var l,x,F,T,A,V;if(!(!B||!r)){$(!0),L(null);try{const p=(await G.post("/staffing",{assignment:{shift_id:r.id,worker_id:B.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:K[B.id]||Number(r.pay_rate)||0}})).data;if(p.status==="success")y();else{let i=p.message||"Failed to assign worker";p.details&&p.details.length>0?i+=`

Details:
â€¢ `+p.details.join(`
â€¢ `):p.errors&&(i+=`

Details:
â€¢ `+p.errors.join(`
â€¢ `)),L(i)}}catch(S){console.error("Failed to assign worker:",S);let p="Failed to assign worker";if((x=(l=S.response)==null?void 0:l.data)!=null&&x.details&&S.response.data.details.length>0){const i=S.response.data.details.map(c=>(c.includes("conflicting shift"),c));p+=`

`+i.join(`
`)}else(T=(F=S.response)==null?void 0:F.data)!=null&&T.errors?p+=`

`+S.response.data.errors.join(`
`):(V=(A=S.response)==null?void 0:A.data)!=null&&V.message?p=S.response.data.message:S.message&&(p=S.message);L(p)}finally{$(!1)}}}if(g)return e.jsx(Pe,{isOpen:!0,onClose:m,title:"Assign Worker",size:"lg",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-600"})})});const W=e.jsxs(e.Fragment,{children:[h&&e.jsxs("div",{className:"mb-4 p-3 bg-gradient-to-r from-red-50 to-amber-50 border-l-4 border-red-500 rounded-r-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsx("h4",{className:"text-sm font-semibold text-red-900",children:"âš ï¸ Scheduling Conflict Detected"})]}),e.jsx("p",{className:"text-xs text-gray-600 ml-8",children:"Please resolve the conflict before attempting to assign this worker"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:m,disabled:j,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:E,disabled:!B||j||!!h,className:`btn-primary ${h?"opacity-50 cursor-not-allowed":""}`,title:h?"Cannot assign due to scheduling conflict":"",children:j?"Assigning Worker...":"Assign Worker"})]})]});return e.jsx(Pe,{isOpen:!0,onClose:m,title:r?`${r.client_name} â€¢ ${r.role_needed}`:"Assign Worker",size:"xl",footer:W,children:e.jsxs("div",{className:"flex h-[600px]",children:[e.jsx("div",{className:"w-1/3 border-r border-gray-200 p-6 bg-gray-50",children:r?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Shift Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(fe,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:Xe(r.start_time_utc)}),e.jsxs("div",{className:"text-sm text-gray-600",children:[Ue(r.start_time_utc)," - ",Ue(r.end_time_utc)]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Fe,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"text-sm text-gray-900",children:r.location||((n=(O=r.event)==null?void 0:O.venue)==null?void 0:n.formatted_address)||"Location not specified"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ee,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900",children:r.role_needed}),r.required_skill&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Requires: ",r.required_skill]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Pay Rate:"})," $",(Number(r.pay_rate)||0).toFixed(2),"/hour"]}),r.uniform_name&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",r.uniform_name]})]}),r.notes&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Notes:"}),e.jsx("div",{className:"mt-1 whitespace-pre-line",children:r.notes.split("Uniform:").map((l,x)=>x===0?l.trim():e.jsxs("div",{children:[e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",l.trim()]},x))})]})})]})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ue,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Failed to load shift details"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search workers...",value:v,onChange:l=>P(l.target.value),className:"w-full pl-9 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-teal-500 focus:border-teal-500"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:h?e.jsx("div",{className:"p-6 flex items-center justify-center h-full",children:e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 rounded-lg p-5 shadow-sm w-full max-w-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(ue,{size:20,className:"text-red-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg font-semibold text-red-900 mb-1",children:"âš ï¸ Scheduling Conflict"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"This worker cannot be assigned due to a scheduling conflict"}),e.jsx("div",{className:"bg-white border border-red-200 rounded p-3 mt-3",children:e.jsx("div",{className:"text-sm text-red-800 font-mono",children:h.split(`
`).map((l,x)=>l.trim()===""?null:l.startsWith("â€¢")?e.jsxs("div",{className:"mt-1 flex items-start gap-2",children:[e.jsx("span",{className:"text-red-500",children:"â—"}),e.jsx("span",{className:"flex-1",children:l.replace("â€¢","").trim()})]},x):l.startsWith("Details:")?null:l.includes("conflicting shift")?e.jsx("div",{className:"mt-1 text-red-700 font-medium",children:l},x):e.jsx("div",{className:"text-gray-700",children:l},x))})})]})]})})}):u.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ee,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:v?"No workers found matching your search":r!=null&&r.role_needed?`No workers found with "${r.role_needed}" skill`:"No available workers"}),(r==null?void 0:r.role_needed)&&!v&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:['Try adding "',r.role_needed,'" skill to workers or select a different shift.']})]}):e.jsx("ul",{children:u.map(l=>{const x=(B==null?void 0:B.id)===l.id,F=K[l.id]||Number(r.pay_rate)||0,T=K[l.id]&&K[l.id]!==(Number(r.pay_rate)||0);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${x?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[l.first_name[0],l.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[l.first_name," ",l.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(l.skills_json||[]).map((A,V)=>{const S=A===(r==null?void 0:r.role_needed);return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${S?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:A},V)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[T&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ie,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:(Number(r.pay_rate)||0).toString(),value:F||"",onChange:A=>{const V=A.target.value;(V===""||/^\d*\.?\d*$/.test(V))&&z(l.id,parseFloat(V)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:A=>A.stopPropagation(),onFocus:A=>A.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>ee(l),className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${x?"bg-teal-600 text-white border-teal-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:x?"Selected":"Select"})]})]},l.id)})})})]})]})})}function cs({isOpen:s,eventId:m,roleName:y,unfilledShiftIds:r,defaultPayRate:U,onClose:o,onDone:J}){const[u,C]=d.useState([]),[v,P]=d.useState([]),[B,ee]=d.useState(""),[K,te]=d.useState(!1),[g,I]=d.useState(!1),[j,$]=d.useState({}),[h,L]=d.useState(0),z=(n,l)=>{$(x=>({...x,[n]:l}))};d.useEffect(()=>{s&&(C([]),P([]),ee(""),$({}),te(!0),(async()=>{var n,l;try{const F=((n=(await G.get(`/events/${m}`)).data)==null?void 0:n.data)||{};console.log("QuickFill: Full event data:",JSON.stringify(F,null,2)),console.log("QuickFill: Looking for role:",y),console.log("QuickFill: shifts_by_role:",F.shifts_by_role);const T=new Set;if(F.shifts_by_role){const p=F.shifts_by_role.find(i=>(console.log("QuickFill: Checking role:",i.skill_name,i.role_name,"vs",y),i.skill_name===y||i.role_name===y));p?(console.log("QuickFill: Found role shifts:",p),p.shifts&&p.shifts.forEach(i=>{i.assignments&&(console.log("QuickFill: Shift has assignments:",i.assignments),i.assignments.forEach(c=>{var R;const w=c.worker_id||((R=c.worker)==null?void 0:R.id),b=c.status;w&&b!=="cancelled"&&(T.add(w),console.log("QuickFill: Adding worker_id to exclude:",w,"status:",b))}))})):console.log("QuickFill: No role shifts found for:",y)}console.log(`QuickFill: Found ${T.size} already assigned worker IDs:`,Array.from(T));const A=await G.get("/workers?active=true"),S=(((l=A.data)==null?void 0:l.data)||A.data||[]).filter(p=>{const i=(p.skills_json||[]).includes(y),c=T.has(p.id);return c&&console.log(`QuickFill: Excluding ${p.first_name} ${p.last_name} (ID: ${p.id}) - already assigned`),i&&!c});if(console.log(`QuickFill: Found ${S.length} eligible workers for "${y}"`),console.log("QuickFill: Eligible workers:",S.map(p=>`${p.first_name} ${p.last_name}`)),C(S),U){const p=Number(U)||0;L(p),console.log(`QuickFill: Default pay rate for ${y}: $${p}/hr`)}else console.log(`QuickFill: No default pay rate provided for ${y}`)}catch(x){console.error("Error loading workers:",x)}finally{te(!1)}})())},[s,m,y,U]);const q=d.useMemo(()=>{const n=B.trim().toLowerCase(),l=u;return n?l.filter(x=>`${x.first_name} ${x.last_name}`.toLowerCase().includes(n)||(x.email||"").toLowerCase().includes(n)):l},[u,B]),N=r.length,E=n=>{P(l=>l.includes(n)?l.filter(x=>x!==n):l.length>=N?l:[...l,n])},W=async()=>{var F,T,A,V,S,p,i,c,w,b,R,D,Z,oe,be;if(v.length===0||N===0)return;I(!0);let n=0,l=0;const x=[];try{const ge=v.map(a=>u.find(M=>M.id===a)).filter(Boolean),ve=[...r];let je=0;for(;ve.length>0&&ge.length>0;){const a=ge[je%ge.length],M=ve.shift();try{const k=j[a.id]||Number(h)||0||0,X=await G.post("/staffing",{assignment:{shift_id:M,worker_id:a.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:k}});if(((F=X.data)==null?void 0:F.status)==="success")n+=1;else{l+=1;const H=`${a.first_name} ${a.last_name}`,ae=((T=X.data)==null?void 0:T.message)||((V=(A=X.data)==null?void 0:A.error)==null?void 0:V.message)||((p=(S=X.data)==null?void 0:S.errors)==null?void 0:p.join(", "))||"Unknown error";let Y="Unable to assign";const t=String(ae).toLowerCase();t.includes("overlapping")||t.includes("conflict")?Y="Has overlapping shift":t.includes("capacity")||t.includes("full")?Y="Shift is full":t.includes("skill")||t.includes("certification")||t.includes("requirement")?Y="Missing required skill":t.includes("status")?Y="Cannot be assigned":Y="Unable to assign",x.push(`${H}: ${Y}`)}}catch(k){l+=1;const X=`${a.first_name} ${a.last_name}`;let H="Unable to assign";const ae=((c=(i=k.response)==null?void 0:i.data)==null?void 0:c.message)||((R=(b=(w=k.response)==null?void 0:w.data)==null?void 0:b.error)==null?void 0:R.message)||((oe=(Z=(D=k.response)==null?void 0:D.data)==null?void 0:Z.errors)==null?void 0:oe.join(", "))||null;if(ae){const Y=String(ae).toLowerCase();Y.includes("overlapping")||Y.includes("conflict")?H="Has overlapping shift":Y.includes("capacity")||Y.includes("full")?H="Shift is full":Y.includes("skill")||Y.includes("certification")||Y.includes("requirement")?H="Missing required skill":Y.includes("status")?H="Cannot be assigned":H="Unable to assign"}else((be=k.response)==null?void 0:be.status)===422?H="Unable to assign":k.message&&!k.message.includes("status code")&&(H=k.message);x.push(`${X}: ${H}`)}je+=1}let we="";l>0&&x.length>0&&(we=x.join(", ")),J({assigned:n,conflicts:l,details:we})}finally{I(!1)}};if(!s)return null;const O=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:o,disabled:g,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:W,disabled:g||v.length===0||N===0,className:"btn-primary",children:g?"Filling Shifts...":v.length===1?`Assign worker to ${N} shift${N!==1?"s":""}`:`Assign ${v.length} workers to ${N} shifts`})]});return e.jsxs(Pe,{isOpen:s,onClose:o,title:`Quick Fill â€” ${y}`,subtitle:`Unfilled shifts: ${N}`,size:"lg",footer:O,children:[e.jsxs("div",{className:"relative",children:[e.jsx(Re,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{value:B,onChange:n=>ee(n.target.value),placeholder:"Search eligible workersâ€¦",className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsx("div",{className:"max-h-[340px] overflow-y-auto border border-gray-200 rounded-lg",children:K?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loadingâ€¦"}):q.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"No eligible workers"}):e.jsx("ul",{children:q.map(n=>{const l=v.includes(n.id);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${l?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[n.first_name[0],n.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[n.first_name," ",n.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(n.skills_json||[]).map((x,F)=>{const T=x===y;return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${T?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:x},F)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[j[n.id]&&j[n.id]!==(Number(h)||0)&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ie,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:Number(h)?(Number(h)||0).toString():"Rate",value:j[n.id]||Number(h)||0||"",onChange:x=>{const F=x.target.value;(F===""||/^\d*\.?\d*$/.test(F))&&z(n.id,parseFloat(F)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:x=>x.stopPropagation(),onFocus:x=>x.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>E(n.id),disabled:!l&&v.length>=N,className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${l?"bg-teal-600 text-white border-teal-600":v.length>=N?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:l?"Selected":"Select"})]})]},n.id)})})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(Ye,{size:16,className:"text-teal-600"}),e.jsxs("span",{children:["Will assign ",e.jsx("strong",{children:v.length})," worker",v.length!==1?"s":""," to ",e.jsx("strong",{children:N})," shift",N!==1?"s":"","."]})]}),(Number(h)||0)>0&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Default rate for ",y,":"]}),e.jsxs("span",{className:"font-medium",children:["$",(Number(h)||0).toFixed(2),"/hr"]})]}),Object.keys(j).length>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["ðŸ’¡ Empty fields will use default rate ($",(Number(h)||0).toFixed(2),"/hr)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(Ke,{size:14,className:"text-yellow-600"}),"Conflicts and already-filled shifts will be skipped automatically."]})]})}function ms({event:s,isOpen:m,onClose:y,onSuccess:r}){var S,p;const U=We(),[o,J]=d.useState(!1),[u,C]=d.useState([]),[v,P]=d.useState(!1),[B,ee]=d.useState(!1),[K,te]=d.useState(null),[g,I]=d.useState(null),[j,$]=d.useState({isVisible:!1,message:"",type:"error"}),[h,L]=d.useState(null),[z,q]=d.useState(!1);d.useEffect(()=>{m&&s.id&&N()},[m,s.id]);const N=async()=>{ee(!0);try{const i=await G.get(`/events/${s.id}`);i.data.status==="success"&&te(i.data.data)}catch(i){console.error("Failed to load full event details:",i),te(s)}finally{ee(!1)}},E=()=>{y(),U(`/events/${s.id}/edit`)},W=[{name:"Bartender",icon:Ge},{name:"Banquet Server/Runner",icon:es},{name:"Captain",icon:ss},{name:"Event Helper",icon:ts},{name:"Prep Cook",icon:as}],O=K||s,n=K||s;d.useEffect(()=>{if(O){if(O.skill_requirements&&Array.isArray(O.skill_requirements)){const i=O.skill_requirements.map(c=>{var R,D;const w=(R=O.shifts_by_role)==null?void 0:R.find(Z=>(Z.skill_name||Z.role_name)===c.skill_name),b=((D=w==null?void 0:w.shifts)==null?void 0:D.length)||(w==null?void 0:w.total_shifts)||c.needed_workers||1;return{skill_name:c.skill_name,needed_workers:b,pay_rate:c.pay_rate||15,description:c.description||"",uniform_id:void 0,cert_id:void 0}});C(i)}else if(O.shifts_by_role&&Array.isArray(O.shifts_by_role)){const i=O.shifts_by_role.map(c=>{const w=c.shifts?c.shifts.length:c.total_shifts||1;return{skill_name:c.skill_name||c.role_name||"",needed_workers:w,pay_rate:c.pay_rate||15,description:"",uniform_id:void 0,cert_id:void 0}});C(i)}}},[O]),d.useEffect(()=>{const i=K||s;i!=null&&i.schedule&&L({start_time_utc:i.schedule.start_time_utc,end_time_utc:i.schedule.end_time_utc,break_minutes:i.schedule.break_minutes||0})},[K,s]);const l=(i,c,w)=>{if(i<0||i>=u.length)return;const b=[...u];b[i]={...b[i],[c]:w},C(b)},x=()=>{C([...u,{skill_name:"",needed_workers:1,pay_rate:15,description:"",uniform_id:void 0,cert_id:void 0}])},F=i=>{var w;if(i<0||i>=u.length)return;const c=u[i];if((c==null?void 0:c.needed_workers)>0){const b=(w=n==null?void 0:n.shifts_by_role)==null?void 0:w[i];if(((b==null?void 0:b.assigned_workers)||(b==null?void 0:b.filled_shifts)||0)>0){$({isVisible:!0,message:"Cannot remove role with assigned workers. Please unassign workers first.",type:"error"});return}}C(u.filter((b,R)=>R!==i))},T=(i,c)=>{if(i<0||i>=u.length)return;W.find(b=>b.name===c);const w=[...u];w[i]={...w[i],skill_name:c},C(w),I(null)},A=async()=>{var c,w,b;const i=K||s;if(i.schedule&&new Date(i.schedule.start_time_utc)<=new Date){$({isVisible:!0,message:"Cannot edit event that has already started",type:"error"});return}P(!0);try{const R=K||s,D=await G.patch(`/events/${R.id}`,{event:{roles:u.map(Z=>({skill_name:Z.skill_name,needed:Z.needed_workers,pay_rate:Z.pay_rate,description:Z.description,uniform_id:Z.uniform_id,cert_id:Z.cert_id})),schedule:h?{start_time_utc:h.start_time_utc,end_time_utc:h.end_time_utc,break_minutes:h.break_minutes}:R.schedule?{start_time_utc:R.schedule.start_time_utc,end_time_utc:R.schedule.end_time_utc,break_minutes:R.schedule.break_minutes||0}:void 0}});D.data.status==="success"?($({isVisible:!0,message:D.data.message||"Event updated successfully",type:"success"}),r(),y()):$({isVisible:!0,message:D.data.message||"Failed to update event",type:"error"})}catch(R){console.error("Failed to update event:",R);const D=(c=R==null?void 0:R.response)==null?void 0:c.data;if((D==null?void 0:D.status)==="validation_error"&&((b=(w=D==null?void 0:D.data)==null?void 0:w.conflicts)!=null&&b.length)){const Z=D.data.conflicts.map(oe=>{const be=new Date(oe.conflicting_shift_start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),ge=new Date(oe.conflicting_shift_end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});return`${oe.worker_name} conflicts with ${oe.conflicting_event_title} (${be} â€“ ${ge})`});$({isVisible:!0,message:`Can't save changes: ${Z.length} worker${Z.length!==1?"s":""} would be double-booked
â€¢ `+Z.join(`
â€¢ `),type:"error"})}else $({isVisible:!0,message:(D==null?void 0:D.message)||"Failed to update event",type:"error"})}finally{P(!1)}},V=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:y,disabled:v,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:A,disabled:v,className:"btn-primary",children:v?"Saving...":"Save Changes"})]});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-0 sm:p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white w-full h-full sm:h-auto sm:max-w-4xl sm:rounded-lg shadow-xl overflow-hidden flex flex-col sm:max-h-[90vh]",children:[e.jsxs("div",{className:"sticky top-0 bg-white px-4 sm:px-6 py-4 border-b border-gray-200 flex items-center justify-between z-10",children:[e.jsxs("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-gray-900 truncate",children:["Edit Event: ",n.title]}),e.jsx("button",{onClick:y,className:"p-2 text-gray-400 hover:text-gray-600 min-h-touch min-w-touch","aria-label":"Close",children:e.jsx(ye,{className:"h-5 w-5 sm:h-6 sm:w-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 sm:px-6 py-4 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Event Details"}),e.jsxs("button",{onClick:E,className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-white border border-gray-300 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all shadow-sm",children:[e.jsx(qe,{size:14}),"Edit"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Venue"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:(S=n.venue)==null?void 0:S.name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:n.schedule&&new Date(n.schedule.start_time_utc).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"space-y-1 md:col-span-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Location"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900 leading-relaxed",children:(p=n.venue)==null?void 0:p.formatted_address})]}),e.jsxs("div",{className:"space-y-1 md:col-start-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Time"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:n.schedule&&e.jsxs(e.Fragment,{children:[new Date(n.schedule.start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})," - ",new Date(n.schedule.end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})]})})]}),e.jsx("div",{})]})]}),e.jsxs("div",{className:"col-span-2 bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 uppercase tracking-wide",children:"Event Schedule"}),e.jsx("button",{type:"button",onClick:()=>q(!z),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:z?"Cancel":"Edit Schedule"})]}),z?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Start Time"}),e.jsx("input",{type:"datetime-local",value:h!=null&&h.start_time_utc?new Date(h.start_time_utc).toISOString().slice(0,16):"",onChange:i=>L(c=>c?{...c,start_time_utc:new Date(i.target.value).toISOString()}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"End Time"}),e.jsx("input",{type:"datetime-local",value:h!=null&&h.end_time_utc?new Date(h.end_time_utc).toISOString().slice(0,16):"",onChange:i=>L(c=>c?{...c,end_time_utc:new Date(i.target.value).toISOString()}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Break Minutes"}),e.jsx("input",{type:"number",min:"0",value:(h==null?void 0:h.break_minutes)||0,onChange:i=>L(c=>c?{...c,break_minutes:parseInt(i.target.value)||0}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3",children:e.jsx("p",{className:"text-xs text-blue-800",children:"âš ï¸ Changing schedule times will update ALL shifts and worker schedules for this event."})})]}):e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:n.schedule&&new Date(n.schedule.start_time_utc).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Time"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:h&&e.jsxs(e.Fragment,{children:[new Date(h.start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})," -",new Date(h.end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})]})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Break"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[(h==null?void 0:h.break_minutes)||0," minutes"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"Roles"}),e.jsxs("button",{onClick:x,className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white text-sm font-semibold rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(Ae,{size:16}),"Add Role"]})]}),u.map((i,c)=>{var w;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[e.jsxs("div",{className:"flex-1 relative overflow-visible",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Role Name *"}),e.jsxs("div",{className:"relative",style:{zIndex:g===c?1e3:1},children:[e.jsxs("button",{type:"button",onClick:()=>I(g===c?null:c),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white text-left flex items-center justify-between",children:[i.skill_name?e.jsxs("div",{className:"flex items-center gap-2",children:[((w=W.find(b=>b.name===i.skill_name))==null?void 0:w.icon)&&e.jsx("img",{src:W.find(b=>b.name===i.skill_name).icon,alt:i.skill_name,className:"w-5 h-5"}),e.jsx("span",{className:"text-gray-900",children:i.skill_name})]}):e.jsx("span",{className:"text-gray-400",children:"Pick the Skills the Worker Has"}),e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M19 9l-7 7-7-7"})})]}),g===c&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border-2 border-gray-200 rounded-xl shadow-2xl z-[9999] max-h-[300px] overflow-y-auto w-full min-w-max",children:W.filter(b=>!u.some((R,D)=>D!==c&&R.skill_name===b.name)).map(b=>e.jsxs("div",{onClick:()=>T(c,b.name),className:"flex items-center gap-3 px-4 py-3 cursor-pointer hover:bg-teal-50 border-b border-gray-100 last:border-0",children:[e.jsx("img",{src:b.icon,width:"24",height:"24",alt:b.name,className:"flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:b.name})]},b.name))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Needed Workers *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>l(c,"needed_workers",Math.max(1,i.needed_workers-1)),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"-"}),e.jsx("input",{type:"number",value:i.needed_workers,onChange:b=>l(c,"needed_workers",parseInt(b.target.value)||1),min:"1",className:"w-16 px-2 py-2 border border-gray-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-teal-500 font-medium"}),e.jsx("button",{onClick:()=>l(c,"needed_workers",i.needed_workers+1),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"+"}),e.jsx("button",{onClick:()=>F(c),className:"ml-2 w-8 h-8 flex items-center justify-center text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove role",children:e.jsx(Se,{size:18})})]})]})]}),(()=>{var D;const b=(D=n==null?void 0:n.shifts_by_role)==null?void 0:D[c],R=(b==null?void 0:b.assigned_workers)||(b==null?void 0:b.filled_shifts)||0;return R>0?e.jsxs("div",{className:"text-sm text-amber-600 font-semibold bg-amber-50 px-3 py-2 rounded-lg",children:[R," worker(s) assigned"]}):null})()]},c)})]})]}),e.jsx("div",{className:"sticky bottom-0 bg-white px-4 sm:px-6 py-4 border-t border-gray-200 flex flex-col sm:flex-row gap-3 sm:justify-end z-10",children:V})]})}),e.jsx(Ve,{isVisible:j.isVisible,message:j.message,type:j.type,onClose:()=>$({...j,isVisible:!1})})]})}function xs({assignment:s,isEditing:m,editHours:y,isSavingEdit:r,wasApprovedBeforeEdit:U,isSelected:o,canSelect:J,onToggleSelect:u,onStartEdit:C,onSaveEdit:v,onCancelEdit:P,onEditHoursChange:B,onEditKeyDown:ee,calculateLiveTotal:K,onNoShow:te,onRemove:g,onReEdit:I}){const[j,$]=d.useState(!1),h=n=>{if(!n)return"N/A";try{const l=me(n);return he(l,"MMM d, yyyy h:mm a")}catch{try{return new Date(n).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}catch{return"N/A"}}},L=n=>{if(!n)return"";try{const l=me(n);return he(l,"h:mm a")}catch{return new Date(n).toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}},z=()=>{const n=s.actual_start||s.scheduled_start,l=s.actual_end||s.scheduled_end;return!n||!l?"Not set":`${L(n)} - ${L(l)}`},q=()=>{const n=s.actual_start||s.scheduled_start,l=s.actual_end||s.scheduled_end;if(!n||!l)return 0;try{const x=me(n),A=(me(l).getTime()-x.getTime())/(1e3*60*60);return Math.round(A*10)/10}catch{return 0}},N=n=>{const l=parseFloat(y)||0,x=Math.max(0,Math.min(24,l+n));B(x.toFixed(2))},E=s.approved,W=z(),O=q();return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:Ce("hidden sm:table-row group transition-all duration-150 ease-in-out border-b",E&&!m&&"bg-green-50/30 hover:bg-green-50/50",!E&&!m&&s.status==="no_show"&&"bg-red-50/30",!E&&!m&&s.status==="cancelled"&&"bg-gray-50/30",!E&&!m&&"bg-white hover:bg-gray-50",m&&"bg-slate-50"),onMouseEnter:()=>$(!0),onMouseLeave:()=>$(!1),children:[e.jsx("td",{className:"py-4 px-3 w-12",children:J&&e.jsx("input",{type:"checkbox",checked:o,onChange:()=>u(s.id),className:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded cursor-pointer",onClick:n=>n.stopPropagation()})}),e.jsx("td",{className:"py-4 px-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Oe,{name:s.worker_name,src:s.worker_profile_photo_url,size:36}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:s.worker_name}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Scheduled: ",re(s.scheduled_hours,2,"0.00"),"h"]}),E&&!m&&s.approved_by_name&&e.jsxs("div",{className:"mt-1 text-xs text-green-700 font-medium",children:["Approved by ",s.approved_by_name.split("@")[0]," on"," ",s.approved_at?h(s.approved_at):"N/A"]})]})]})}),e.jsx("td",{className:"py-4 px-3 text-sm text-gray-700",children:s.shift_role||"N/A"}),e.jsx("td",{className:"py-4 px-3",children:e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-gray-700",children:[e.jsx(fe,{className:"h-3.5 w-3.5 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"whitespace-nowrap",children:W})]})}),e.jsxs("td",{className:"py-4 px-3 text-sm font-medium text-gray-900 text-right",children:[re(s.effective_hours,2,"0.00"),"h",s.edited_at&&e.jsx("span",{className:"ml-1 text-xs text-orange-600",title:"Edited",children:e.jsx(Ne,{className:"h-3 w-3 inline"})})]}),e.jsxs("td",{className:"py-4 px-3 text-sm text-gray-700 text-right",children:["$",re(s.effective_hourly_rate,2,"0.00"),"/h"]}),e.jsxs("td",{className:"py-4 px-3 text-sm font-semibold text-gray-900 text-right",children:["$",re(s.effective_pay,2,"0.00")]}),e.jsx("td",{className:"py-4 text-right",children:m?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-blue-700 bg-blue-100 rounded",children:[e.jsx(Ne,{className:"h-3.5 w-3.5"}),"Editing"]}):e.jsx("div",{className:"flex items-center justify-end gap-2",children:s.status==="no_show"?e.jsx(e.Fragment,{children:e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-red-700",children:[e.jsx(ze,{className:"h-3.5 w-3.5"}),"No-Show"]})}):s.status==="cancelled"?e.jsx(e.Fragment,{children:e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-gray-700",children:[e.jsx(ye,{className:"h-3.5 w-3.5"}),"Cancelled"]})}):e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[E?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 bg-green-100 rounded flex-shrink-0",children:[e.jsx(pe,{className:"h-3.5 w-3.5"}),"Approved"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-amber-700 bg-amber-100 rounded flex-shrink-0",children:[e.jsx(fe,{className:"h-3.5 w-3.5"}),"Pending"]}),s.can_edit_hours&&e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>E?I(s):C(s),className:"p-1.5 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors",title:E?"Re-edit":"Edit",children:e.jsx(Ne,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>te(s),className:"p-1.5 text-gray-600 hover:text-orange-600 hover:bg-orange-50 rounded transition-colors",title:"No-Show",children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>g(s),className:"p-1.5 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"Remove",children:e.jsx(Se,{className:"h-4 w-4"})})]})]})})})]}),m&&e.jsx("tr",{className:"bg-slate-50",children:e.jsx("td",{colSpan:8,className:"px-3 py-0",children:e.jsx("div",{className:"overflow-hidden transition-all duration-300 ease-in-out",children:e.jsx("div",{className:"py-3",children:e.jsxs("div",{className:"bg-white border border-slate-300 rounded-lg p-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ne,{className:"h-4 w-4 text-slate-600"}),e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Edit Hours Worked"})]}),e.jsxs("div",{className:"mb-3 flex items-center gap-2 text-xs text-gray-600 bg-gray-50 px-3 py-1.5 rounded",children:[e.jsx(fe,{className:"h-3.5 w-3.5 text-gray-400"}),e.jsx("span",{children:W}),O>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"Â·"}),e.jsxs("span",{children:[O," hour shift"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>N(-1),disabled:r,className:"p-1.5 border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",type:"button",title:"Decrease by 1 hour",children:e.jsx(ns,{className:"h-4 w-4 text-gray-600"})}),e.jsx("input",{type:"number",step:"0.25",min:"0",max:"24",value:y,onChange:n=>B(n.target.value),onKeyDown:ee,disabled:r,className:"flex-1 px-3 py-1.5 border border-gray-300 rounded-lg text-center text-base font-semibold focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",placeholder:"0.0",autoFocus:!0}),e.jsx("button",{onClick:()=>N(1),disabled:r,className:"p-1.5 border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",type:"button",title:"Increase by 1 hour",children:e.jsx(Ae,{className:"h-4 w-4 text-gray-600"})})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Quick:"}),e.jsx("button",{onClick:()=>N(-1),disabled:r,className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 transition-colors",children:"-1h"}),e.jsx("button",{onClick:()=>N(-.5),disabled:r,className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 transition-colors",children:"-0.5h"}),e.jsx("button",{onClick:()=>N(.5),disabled:r,className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 transition-colors",children:"+0.5h"}),e.jsx("button",{onClick:()=>N(1),disabled:r,className:"px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 transition-colors",children:"+1h"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Updated Total"}),e.jsxs("div",{className:"text-lg font-bold text-blue-600",children:["$",K(y,s.effective_hourly_rate||0)]})]}),U&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-amber-50 border-l-2 border-amber-400 rounded text-xs text-amber-800",children:[e.jsx(ue,{className:"h-3.5 w-3.5 text-amber-600 flex-shrink-0"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Note:"})," Re-editing will un-approve these hours."]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("button",{onClick:()=>{te(s),P()},disabled:r,className:"px-2.5 py-1.5 text-xs font-medium text-orange-700 bg-orange-50 border border-orange-200 rounded hover:bg-orange-100 flex items-center gap-1 disabled:opacity-50 transition-colors",children:[e.jsx(ue,{className:"h-3.5 w-3.5"}),"No-Show"]}),e.jsxs("button",{onClick:()=>{g(s),P()},disabled:r,className:"px-2.5 py-1.5 text-xs font-medium text-red-700 bg-red-50 border border-red-200 rounded hover:bg-red-100 flex items-center gap-1 disabled:opacity-50 transition-colors",children:[e.jsx(Se,{className:"h-3.5 w-3.5"}),"Remove"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:P,disabled:r,className:"px-3 py-1.5 text-sm font-medium text-gray-700 hover:text-gray-900 disabled:opacity-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:v,disabled:r,className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white text-sm font-medium rounded-lg shadow-sm flex items-center gap-1.5 transition-colors",children:r?e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-4 w-4"}),"Save Changes"]})})]})]})]})]})})})})}),e.jsx("tr",{className:"sm:hidden",children:e.jsx("td",{colSpan:8,className:"py-3 px-3",children:e.jsxs("div",{className:Ce("p-3 rounded-lg space-y-2 transition-all duration-150",m&&"bg-blue-50 border-2 border-blue-500",!m&&E&&"bg-green-50 border border-green-200",!m&&s.status==="no_show"&&"bg-red-50 border border-red-200",!m&&s.status==="cancelled"&&"bg-gray-50 border border-gray-200",!m&&"bg-white border border-gray-200"),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{name:s.worker_name,src:s.worker_profile_photo_url,size:32}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:s.worker_name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.shift_role||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-600 mt-1 ml-10",children:[e.jsx(fe,{className:"h-3 w-3 text-gray-400 flex-shrink-0"}),e.jsx("span",{children:W})]}),E&&!m&&s.approved_by_name&&e.jsxs("div",{className:"text-xs text-green-700 mt-1 ml-10 font-medium",children:["Approved by ",s.approved_by_name.split("@")[0]," on"," ",s.approved_at?h(s.approved_at):"N/A"]})]}),s.approved?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-green-700",children:[e.jsx(pe,{className:"h-3.5 w-3.5"}),"Approved"]}):s.status==="no_show"?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-red-700",children:[e.jsx(ze,{className:"h-3.5 w-3.5"}),"No-Show"]}):s.status==="cancelled"?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-gray-700",children:[e.jsx(ye,{className:"h-3.5 w-3.5"}),"Cancelled"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-amber-700 bg-amber-50 rounded",children:[e.jsx(fe,{className:"h-3.5 w-3.5"}),"Pending"]})]}),m&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"bg-white border-2 border-blue-400 rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ne,{className:"h-4 w-4 text-blue-600"}),e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Edit Hours Worked"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Hours Worked"}),e.jsx("input",{type:"number",step:"0.25",min:"0",max:"24",value:y,onChange:n=>B(n.target.value),onKeyDown:ee,disabled:r,className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",autoFocus:!0})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Updated Total"}),e.jsxs("div",{className:"text-lg font-bold text-blue-600",children:["$",K(y,s.effective_hourly_rate||0)]})]}),U&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx(ue,{className:"h-4 w-4 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-amber-800",children:[e.jsx("strong",{children:"Note:"})," Re-editing will un-approve these hours."]})]}),e.jsxs("div",{className:"flex gap-2 pt-2 border-t",children:[e.jsx("button",{onClick:P,disabled:r,className:"flex-1 px-3 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:v,disabled:r,className:"flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg flex items-center justify-center gap-2 disabled:bg-blue-400",children:r?e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-4 w-4"}),"Save Changes"]})})]})]})]})}),!m&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm pt-2 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Hours"}),e.jsxs("div",{className:"font-medium",children:[re(s.effective_hours,2,"0.00"),"h",s.edited_at&&e.jsx("span",{className:"ml-1 text-xs text-orange-600",title:"Edited",children:e.jsx(Ne,{className:"h-3 w-3 inline"})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Rate"}),e.jsxs("div",{className:"font-medium",children:["$",re(s.effective_hourly_rate,2,"0.00"),"/h"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Total"}),e.jsxs("div",{className:"font-semibold",children:["$",re(s.effective_pay,2,"0.00")]})]})]}),s.can_edit_hours&&s.status!=="no_show"&&s.status!=="cancelled"&&e.jsx("div",{className:"flex items-center gap-2 pt-2 border-t border-gray-200",children:s.approved?e.jsx("button",{onClick:()=>I(s),className:"w-full px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-100 rounded hover:bg-gray-200 transition-colors",children:"Re-edit"}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>C(s),className:"flex-1 px-3 py-1.5 text-xs font-medium text-blue-700 bg-blue-50 rounded hover:bg-blue-100 transition-colors flex items-center justify-center gap-1",children:[e.jsx(Ne,{className:"h-3.5 w-3.5"}),"Edit"]}),e.jsxs("button",{onClick:()=>te(s),className:"flex-1 px-3 py-1.5 text-xs font-medium text-orange-700 bg-orange-50 rounded hover:bg-orange-100 transition-colors flex items-center justify-center gap-1",children:[e.jsx(ue,{className:"h-3.5 w-3.5"}),"No-Show"]}),e.jsx("button",{onClick:()=>g(s),className:"px-3 py-1.5 text-xs font-medium text-red-700 bg-red-50 rounded hover:bg-red-100 transition-colors",children:e.jsx(Se,{className:"h-3.5 w-3.5"})})]})})]})]})})})]})}function us({event:s,isOpen:m,onClose:y,onSuccess:r}){const[U,o]=d.useState([]),[J,u]=d.useState(null),[C,v]=d.useState(!1),[P,B]=d.useState(null),[ee,K]=d.useState(""),[te,g]=d.useState(!1),[I,j]=d.useState(!1),[$,h]=d.useState(!1),[L,z]=d.useState(new Set),[q,N]=d.useState({isVisible:!1,message:"",type:"success"}),[E,W]=d.useState({open:!1,title:"",variant:"default"});d.useEffect(()=>{m&&s&&(O(),z(new Set))},[m,s]);const O=async()=>{var a,M;if(s!=null&&s.id){v(!0);try{const k=await G.get(`/events/${s.id}/approvals`),X=k.data.data.assignments||[],H=Array.from(new Map(X.map(t=>[t.id,t])).values()),ae=Array.from(new Map(H.map(t=>[`${t.shift_id}-${t.worker_id}`,t])).values()),Y=Array.from(new Map(ae.sort((t,f)=>f.id-t.id).map(t=>[`${t.worker_id}-${t.shift_role}-${t.scheduled_start}-${t.scheduled_end}`,t])).values());console.log(`Loaded ${X.length} assignments, deduplicated to ${Y.length}`,{before:X.length,afterById:H.length,afterByShiftWorker:ae.length,final:Y.length}),o(Y),u(k.data.data.cost_summary||null)}catch(k){console.error("Error loading assignments:",k),N({isVisible:!0,type:"error",message:((M=(a=k.response)==null?void 0:a.data)==null?void 0:M.error)||k.message||"Unable to load assignments for approval"}),o([]),u(null)}finally{v(!1)}}},n=a=>{B(a.id),K(String(a.effective_hours||a.hours_worked||a.scheduled_hours||"0")),j(!1)},l=()=>{B(null),K(""),j(!1)},x=async()=>{var M,k,X;if(!P)return;const a=parseFloat(ee);if(isNaN(a)||a<0){N({isVisible:!0,type:"error",message:"Please enter a valid number of hours"});return}if(a>24){N({isVisible:!0,type:"error",message:"Hours cannot exceed 24 per shift"});return}g(!0);try{const H=await G.patch(`/approvals/${P}/update_hours`,{hours_worked:a});await O(),l(),(M=H.data)!=null&&M.message?N({isVisible:!0,type:"success",message:H.data.message}):N({isVisible:!0,type:"success",message:"Hours updated successfully"})}catch(H){console.error("Error updating hours:",H),N({isVisible:!0,type:"error",message:((X=(k=H.response)==null?void 0:k.data)==null?void 0:X.message)||"Failed to update hours. Please try again."})}finally{g(!1)}},F=a=>{a.key==="Enter"?(a.preventDefault(),x()):a.key==="Escape"&&(a.preventDefault(),l())},T=(a,M)=>{const k=parseFloat(a);return isNaN(k)?"0.00":(k*M).toFixed(2)},A=a=>{W({open:!0,title:"Re-Edit Approved Hours",message:`Re-editing will un-approve ${a.worker_name}'s hours. The assignment will need to be re-approved after you make changes. Continue?`,variant:"warning",onConfirm:async()=>{W({open:!1,title:""}),B(a.id),K(String(a.effective_hours||a.hours_worked||a.scheduled_hours||"0")),j(!0),N({isVisible:!0,type:"success",message:"Hours un-approved. Make your changes and save."})}})},V=async a=>{W({open:!0,title:"Mark No-Show",message:`Mark ${a.worker_name} as no-show? This will set hours to 0.`,requireNote:!0,note:"",variant:"warning",onConfirm:async M=>{var X,H;const k=M||E.note||"";W({open:!1,title:""});try{await G.post(`/approvals/${a.id}/mark_no_show`,{notes:k}),await O(),N({isVisible:!0,type:"success",message:"Marked as no-show"})}catch(ae){console.error("Error marking no-show:",ae),N({isVisible:!0,type:"error",message:((H=(X=ae.response)==null?void 0:X.data)==null?void 0:H.message)||"Failed to mark no-show"})}}})},S=async a=>{W({open:!0,title:"Remove from Job",message:`Remove ${a.worker_name} from this job? This cannot be undone.`,requireNote:!0,note:"",variant:"danger",onConfirm:async M=>{var X,H;const k=M||E.note||"";W({open:!1,title:""});try{await G.delete(`/approvals/${a.id}/remove`,{data:{notes:k}}),await O(),N({isVisible:!0,type:"success",message:"Assignment removed"})}catch(ae){console.error("Error removing assignment:",ae),N({isVisible:!0,type:"error",message:((H=(X=ae.response)==null?void 0:X.data)==null?void 0:H.message)||"Failed to remove assignment"})}}})},p=U.filter(a=>!a.approved&&a.can_approve&&a.status!=="no_show"&&a.status!=="cancelled"),i=p.filter(a=>L.has(a.id)),c=a=>{z(M=>{const k=new Set(M);return k.has(a)?k.delete(a):k.add(a),k})},w=()=>{i.length===p.length&&p.length>0?z(new Set):z(new Set(p.map(a=>a.id)))},b=async()=>{if(i.length===0){N({isVisible:!0,type:"error",message:"Please select at least one assignment to approve"});return}W({open:!0,title:"Approve Selected Hours",message:`Approve hours for ${i.length} selected ${i.length===1?"worker":"workers"}?`,onConfirm:async()=>{var a,M;h(!0);try{await G.post(`/events/${s.id}/approve_selected`,{assignment_ids:Array.from(i.map(k=>k.id))}),await O(),z(new Set),r(),N({isVisible:!0,type:"success",message:`Approved ${i.length} ${i.length===1?"assignment":"assignments"}`})}catch(k){console.error("Error approving selected:",k),N({isVisible:!0,type:"error",message:((M=(a=k.response)==null?void 0:a.data)==null?void 0:M.message)||"Failed to approve selected hours"})}finally{h(!1),W({open:!1,title:""})}}})},R=async()=>{const a=p.length;W({open:!0,title:"Approve All Hours",message:`Approve hours for all ${a} eligible workers?`,onConfirm:async()=>{var M,k;h(!0);try{await G.post(`/events/${s.id}/approve_all`),await O(),z(new Set),r(),N({isVisible:!0,type:"success",message:`Approved ${a} assignments`})}catch(X){console.error("Error approving all:",X),N({isVisible:!0,type:"error",message:((k=(M=X.response)==null?void 0:M.data)==null?void 0:k.message)||"Failed to approve all hours"})}finally{h(!1),W({open:!1,title:""})}}})};if(!m)return null;const D=U.filter(a=>a.status!=="no_show"&&a.status!=="cancelled"),Z=D.filter(a=>!a.approved).length;D.filter(a=>a.approved).length;const oe=D.length,be=D.filter(a=>!a.approved).reduce((a,M)=>a+Number(M.effective_pay||0),0),ge=D.filter(a=>a.approved).reduce((a,M)=>a+Number(M.effective_pay||0),0),ve=be+ge,je=D.reduce((a,M)=>a+Number(M.effective_hours||0),0),we=a=>{if(!a)return"";try{return he(me(a),"MMM d, yyyy")}catch{return new Date(a).toLocaleDateString()}};return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-0 sm:p-4 overflow-y-auto",children:[e.jsx(Ve,{isVisible:q.isVisible,message:q.message,type:q.type,onClose:()=>N({...q,isVisible:!1})}),e.jsxs("div",{className:"bg-white w-full h-full sm:h-auto sm:max-w-5xl sm:rounded-lg shadow-xl overflow-hidden flex flex-col sm:max-h-[90vh] my-0 sm:my-4",children:[e.jsx("header",{className:"border-b px-6 py-4 bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Approve Hours"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-0.5",children:[s==null?void 0:s.title," Â· ",s!=null&&s.event_date?we(s.event_date):""]})]}),e.jsx("button",{onClick:y,className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close modal",children:e.jsx(ye,{className:"h-5 w-5"})})]})}),Z>0&&e.jsx("div",{className:"bg-amber-50 border-l-4 border-amber-400 px-6 py-3 flex-shrink-0",children:e.jsxs("p",{className:"text-sm text-amber-800 flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("strong",{children:Z})," ",Z===1?"assignment":"assignments"," pending approval"]})}),e.jsx("div",{className:"flex-1 overflow-auto px-3 sm:px-6 py-4",children:C?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading assignments..."})]}):U.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ue,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No assignments found for this event."})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b border-gray-200 hidden sm:table-header-group",children:e.jsxs("tr",{className:"text-left",children:[e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider w-12 px-3",children:p.length>0&&e.jsx("input",{type:"checkbox",checked:i.length===p.length&&p.length>0,onChange:w,className:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded cursor-pointer",title:i.length===p.length?"Deselect all":"Select all"})}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider w-[25%]",children:"Worker"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider w-[15%]",children:"Role"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider w-[18%]",children:"Time Worked"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right w-[10%]",children:"Hours"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right w-[10%]",children:"Rate"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right w-[12%]",children:"Total"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right w-[10%]",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:U.map(a=>{const M=!a.approved&&a.can_approve&&a.status!=="no_show"&&a.status!=="cancelled";return e.jsx(xs,{assignment:a,isEditing:P===a.id,editHours:ee,isSavingEdit:te,wasApprovedBeforeEdit:I,isSelected:L.has(a.id),canSelect:M,onToggleSelect:c,onStartEdit:n,onSaveEdit:x,onCancelEdit:l,onEditHoursChange:K,onEditKeyDown:F,calculateLiveTotal:T,onNoShow:V,onRemove:S,onReEdit:A},a.id)})})]})}),e.jsx("footer",{className:"border-t bg-gray-50 px-3 sm:px-6 py-4 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-600",children:Z===0?"Final approved cost:":"Total cost:"}),e.jsxs("span",{className:"ml-2 text-lg font-bold text-gray-900",children:["$",re(ve,2,"0.00")]}),e.jsxs("span",{className:"ml-1 text-gray-600",children:["(",oe," ",oe===1?"worker":"workers",", ",re(je,2,"0.00"),"h)"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:y,className:"px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 transition-colors",children:"Close"}),Z>0&&e.jsx("button",{onClick:()=>{i.length>0?b():R()},disabled:$,className:"px-5 py-2.5 bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white text-sm font-semibold rounded-lg shadow-sm flex items-center gap-2 transition-colors",children:$?e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"h-4 w-4 animate-spin"}),"Approving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-4 w-4"}),i.length>0?"Approve Selected":"Approve All"]})})]})]})})]}),E.open&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>W({open:!1,title:""})}),e.jsxs("div",{className:"relative bg-white w-full max-w-md rounded-lg shadow-xl p-5",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:E.title}),E.message&&e.jsx("p",{className:"mt-2 text-sm text-gray-700",children:E.message}),E.requireNote&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes (optional)"}),e.jsx("textarea",{value:E.note||"",onChange:a=>W(M=>({...M,note:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]}),e.jsxs("div",{className:"mt-5 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>W({open:!1,title:""}),className:"px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-200",children:"Cancel"}),e.jsx("button",{onClick:async()=>{const a=E.note||"";E.onConfirm&&await E.onConfirm(a)},className:"px-4 py-2 text-white text-sm font-medium rounded-md "+(E.variant==="danger"?"bg-red-600 hover:bg-red-700":E.variant==="warning"?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:"Confirm"})]})]})]})]})}function ce({className:s="",count:m=1}){return e.jsx(e.Fragment,{children:Array.from({length:m}).map((y,r)=>e.jsx("div",{className:`animate-pulse bg-gray-200 rounded-lg ${s}`},r))})}function Me(){return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(ce,{className:"h-6 w-48 mb-2"}),e.jsx(ce,{className:"h-4 w-32"})]}),e.jsx(ce,{className:"h-8 w-8 rounded-full"})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4 rounded"}),e.jsx(ce,{className:"h-4 w-40"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4 rounded"}),e.jsx(ce,{className:"h-4 w-36"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4 rounded"}),e.jsx(ce,{className:"h-4 w-32"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(ce,{className:"h-2 w-full rounded-full mb-2"}),e.jsx(ce,{className:"h-3 w-24"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ce,{className:"h-9 w-24 rounded-md"}),e.jsx(ce,{className:"h-9 w-24 rounded-md"})]})]})})}function hs(s,m=500){const[y,r]=d.useState(s);return d.useEffect(()=>{const U=setTimeout(()=>{r(s)},m);return()=>{clearTimeout(U)}},[s,m]),y}function Rs(){const s=We(),[m,y]=Ze(),r=(m.get("tab")==="completed"?"completed":m.get("tab"))||"active",U=m.get("filter")||"needs_workers",[o,J]=d.useState(r),[u,C]=d.useState(U),[v,P]=d.useState(""),B=hs(v,500),[ee,K]=d.useState("date"),[te,g]=d.useState(!0),[I,j]=d.useState([]),[$,h]=d.useState(new Set),[L,z]=d.useState(new Set),[q,N]=d.useState({isOpen:!1}),[E,W]=d.useState({isOpen:!1}),[O,n]=d.useState({isVisible:!1,message:"",type:"success"}),[l,x]=d.useState({isOpen:!1,isLoading:!1}),[F,T]=d.useState({isOpen:!1,isLoading:!1}),[A,V]=d.useState({isOpen:!1,isLoading:!1}),[S,p]=d.useState({isOpen:!1,unfilledShiftIds:[]}),[i,c]=d.useState({isOpen:!1});d.useEffect(()=>{w()},[o,u,m]),d.useEffect(()=>{const t=(m.get("tab")==="completed"?"completed":m.get("tab"))||"active",f=m.get("filter")||"all";t!==o&&J(t),f!==u&&C(f)},[m,o,u]),d.useEffect(()=>{const t=m.get("event_id"),f=m.get("shift_id");if(t){const _=parseInt(t);isNaN(_)||(h(new Set([_])),f&&console.log(`Auto-expanding event ${_} with shift ${f}`))}},[m]),d.useEffect(()=>{const t=m.get("event_id");if(!t)return;const f=parseInt(t);if(isNaN(f))return;const _=I.find(Q=>Q.id===f);_&&(!_.shifts_by_role||_.shifts_by_role.length===0)&&(D(f),h(new Set([f])))},[m,I]);async function w(){g(!0);try{const t=o==="completed"?"completed":o,f=m.get("date");let _=`/events?tab=${t}`;u!=="all"&&(_+=`&filter=${u}`),f&&(_+=`&date=${f}`),console.log("Loading events with URL:",_,"filterStatus:",u,"date:",f);const Q=await G.get(_);if(Q.data.status==="success"){console.log("Received events:",Q.data.data.length);const le=Q.data.data;if(o==="completed"){const ne=await Promise.all(le.map(async ie=>{var xe;try{const se=await G.get(`/events/${ie.id}/approvals`);if(((xe=se.data)==null?void 0:xe.status)==="success"){const de=se.data.data.assignments||[],_e=de.length,ke=de.filter(Be=>Be.approved).length,Qe=se.data.data.cost_summary||null;return{...ie,approval_status:{total:_e,approved:ke,pending:_e-ke},cost_summary:Qe}}}catch(se){console.warn(`Failed to load approval status for event ${ie.id}:`,se)}return ie}));j(ne)}else{const ne=Array.from($);j(ie=>{const xe=new Map(ie.map(se=>[se.id,se]));return le.map(se=>{const de=xe.get(se.id);return ne.includes(se.id)&&(de!=null&&de.shifts_by_role)&&de.shifts_by_role.length>0?{...se,shifts_by_role:de.shifts_by_role,full_details:de.full_details||de}:se})}),ne.length>0&&Promise.all(ne.map(ie=>D(ie))).catch(ie=>{console.error("Failed to refresh expanded event details:",ie)})}}}catch(t){console.error("Failed to load events:",t)}finally{g(!1)}}const b=t=>{J(t),y({tab:t}),C(t==="active"?"needs_workers":"all")},R=t=>{C(t);const f=new URLSearchParams;f.set("tab",o),t!=="all"&&f.set("filter",t),y(f)},D=async t=>{var f,_;z(Q=>new Set(Q).add(t));try{const[Q,le]=await Promise.all([G.get(`/events/${t}`),G.get(`/events/${t}/approvals`).catch(()=>null)]);if(((f=Q.data)==null?void 0:f.status)==="success"){const ne=Q.data.data;if(((_=le==null?void 0:le.data)==null?void 0:_.status)==="success"){const ie=le.data.data.assignments||[],xe=new Map(ie.map(se=>[se.id,se]));ne.shifts_by_role&&(ne.shifts_by_role=ne.shifts_by_role.map(se=>({...se,shifts:se.shifts.map(de=>({...de,assignments:de.assignments.map(_e=>{const ke=xe.get(_e.id);return ke&&typeof ke=="object"?{..._e,...ke}:_e})}))})))}j(ie=>ie.map(xe=>xe.id===t?{...xe,...ne}:xe))}}catch(Q){console.error("Failed to load event details",Q)}finally{z(Q=>{const le=new Set(Q);return le.delete(t),le})}},Z=t=>{const f=new Set($);if(f.has(t))f.delete(t),z(_=>{const Q=new Set(_);return Q.delete(t),Q});else{f.add(t);const _=I.find(ne=>ne.id===t),Q=L.has(t),le=(_==null?void 0:_.shifts_by_role)&&_.shifts_by_role.length>0;!Q&&!le&&D(t)}h(f)};async function oe(t){const f=I==null?void 0:I.find(_=>_.id===t);V({isOpen:!0,isLoading:!1,eventId:t,eventTitle:f==null?void 0:f.title})}async function be(){if(A.eventId){V(t=>({...t,isLoading:!0}));try{const t=await G.delete(`/events/${A.eventId}`);t.data.status==="success"?(V({isOpen:!1,isLoading:!1}),n({isVisible:!0,message:`"${t.data.event_title}" moved to trash`,type:"success",action:{label:"Undo",onClick:()=>ge(t.data.event_id),variant:"primary"}}),w()):n({isVisible:!0,message:t.data.message||"Unable to delete event",type:"error"})}catch(t){console.error("Failed to delete event:",t),n({isVisible:!0,message:"Unable to delete event",type:"error"})}finally{V(t=>({...t,isLoading:!1}))}}}async function ge(t){try{const f=await G.post(`/events/${t}/restore`);f.data.status==="success"?(n({isVisible:!0,message:"Event restored to draft",type:"success"}),w()):n({isVisible:!0,message:f.data.message||"Unable to restore event",type:"error"})}catch(f){console.error("Failed to restore event:",f),n({isVisible:!0,message:"Unable to restore event",type:"error"})}}function ve(){V({isOpen:!1,isLoading:!1})}function je(t){x({isOpen:!0,eventId:t,isLoading:!1})}async function we(){if(l.eventId){x(t=>({...t,isLoading:!0}));try{const t=await G.post(`/events/${l.eventId}/publish`);t.data.status==="success"?(n({isVisible:!0,message:"Event published successfully",type:"success"}),x({isOpen:!1,isLoading:!1}),w()):(n({isVisible:!0,message:t.data.message||"Unable to publish event",type:"error"}),x({isOpen:!1,isLoading:!1}))}catch(t){console.error("Failed to publish event:",t),n({isVisible:!0,message:"Unable to publish event",type:"error"}),x({isOpen:!1,isLoading:!1})}}}function a(){x({isOpen:!1,isLoading:!1})}function M(t,f){T({isOpen:!0,assignmentId:t,isLoading:!1,workerName:f})}async function k(){var t,f;if(F.assignmentId){T(_=>({..._,isLoading:!0}));try{const _=await G.delete(`/staffing/${F.assignmentId}`);((t=_.data)==null?void 0:t.status)==="success"?(n({isVisible:!0,message:"Worker unassigned successfully",type:"success"}),T({isOpen:!1,isLoading:!1}),w()):(n({isVisible:!0,message:((f=_.data)==null?void 0:f.message)||"Unable to unassign worker",type:"error"}),T({isOpen:!1,isLoading:!1}))}catch(_){console.error("Failed to unassign worker:",_),n({isVisible:!0,message:"Unable to unassign worker",type:"error"}),T({isOpen:!1,isLoading:!1})}}}const X=t=>{W({isOpen:!0,shiftId:t})},H=()=>{W({isOpen:!1})},ae=()=>{H(),n({isVisible:!0,message:"Worker assigned",type:"success"}),w()},Y=I.filter(t=>{var f;if(B){const _=B.toLowerCase();if(!(t.title.toLowerCase().includes(_)||((f=t.venue)==null?void 0:f.name.toLowerCase().includes(_))))return!1}if(o==="active")switch(u){case"needs_workers":return t.unfilled_roles_count>0;case"partially_filled":return t.unfilled_roles_count>0&&t.assigned_workers_count>0;case"fully_staffed":return t.unfilled_roles_count===0&&t.assigned_workers_count>0;case"all":default:return!0}return!0}).sort((t,f)=>{var _,Q;switch(ee){case"name":return t.title.localeCompare(f.title);case"staffing":return t.staffing_percentage-f.staffing_percentage;case"date":default:const le=((_=t.schedule)==null?void 0:_.start_time_utc)||t.created_at,ne=((Q=f.schedule)==null?void 0:Q.start_time_utc)||f.created_at;return new Date(le).getTime()-new Date(ne).getTime()}});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold text-gray-900",children:"Events"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage events and assign workers"})]}),e.jsxs("button",{onClick:()=>s("/events/create"),className:"w-full sm:w-auto inline-flex items-center justify-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors shadow-sm min-h-touch",children:[e.jsx(Ae,{size:20}),"Create New Event"]})]}),m.get("date")&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-teal-50 border border-teal-200 rounded-lg",children:[e.jsx(De,{size:16,className:"text-teal-600"}),e.jsxs("span",{className:"text-sm font-medium text-teal-900",children:["Showing events for ",he(me(m.get("date")),"EEEE, MMMM d, yyyy")]}),e.jsx("button",{onClick:()=>{const t=new URLSearchParams(m);t.delete("date"),y(t)},className:"ml-auto text-teal-600 hover:text-teal-700",title:"Clear date filter",children:e.jsx(ye,{size:16})})]})]}),e.jsxs("div",{className:"flex gap-6 border-b border-gray-200 mb-6",children:[e.jsx("button",{onClick:()=>b("draft"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${o==="draft"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Draft Events"}),e.jsx("button",{onClick:()=>b("active"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${o==="active"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Active Events"}),e.jsx("button",{onClick:()=>b("completed"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${o==="completed"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Completed Events"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-3 sm:gap-4 mb-6",children:[e.jsxs("div",{className:"w-full md:flex-1 md:max-w-md relative",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search events or venues...",value:v,onChange:t=>P(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),e.jsxs("select",{value:ee,onChange:t=>K(t.target.value),className:"w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"name",children:"Sort by Name"}),o!=="draft"&&e.jsx("option",{value:"staffing",children:"Sort by Staffing"})]}),o==="active"&&e.jsxs("div",{className:"w-full sm:w-auto flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>R("all"),className:`w-full sm:w-auto px-3 py-2 text-sm font-medium rounded-lg transition ${u==="all"?"bg-gray-100 text-gray-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"All"}),e.jsx("button",{onClick:()=>R("needs_workers"),className:`w-full sm:w-auto px-3 py-2 text-sm font-medium rounded-lg transition ${u==="needs_workers"?"bg-red-100 text-red-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Needs Workers"}),e.jsx("button",{onClick:()=>R("fully_staffed"),className:`w-full sm:w-auto px-3 py-2 text-sm font-medium rounded-lg transition ${u==="fully_staffed"?"bg-green-100 text-green-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Ready"})]})]}),te?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Me,{}),e.jsx(Me,{}),e.jsx(Me,{})]}):e.jsxs(e.Fragment,{children:[o==="draft"&&e.jsx(gs,{events:Y,onDelete:oe,onPublish:je,onNavigate:t=>s(t),searchQuery:v}),o==="active"&&e.jsx(fs,{events:Y,expandedEvents:$,loadingEventDetails:L,onToggleEvent:Z,onAssignWorker:X,onUnassign:M,onQuickFill:(t,f,_,Q)=>p({isOpen:!0,eventId:t,roleName:f,unfilledShiftIds:_,payRate:Q}),onPublish:je,onDelete:oe,onEdit:t=>c({isOpen:!0,event:t}),searchQuery:v}),o==="completed"&&e.jsx(ps,{events:Y,searchQuery:v,onApproveHours:t=>N({isOpen:!0,event:t})})]})]}),E.isOpen&&E.shiftId&&e.jsx(ds,{shiftId:E.shiftId,onClose:H,onSuccess:ae}),e.jsx(Ve,{isVisible:O.isVisible,message:O.message,type:O.type,action:O.action,onClose:()=>n({...O,isVisible:!1})}),e.jsx(Le,{isOpen:l.isOpen,onClose:a,onConfirm:we,title:"Publish Event",message:"Ready to publish? This will create shifts and make them available for worker assignment.",confirmText:l.isLoading?"Publishingâ€¦":"Publish",cancelText:"Cancel",isLoading:l.isLoading,isDestructive:!1}),e.jsx(Le,{isOpen:F.isOpen,onClose:()=>T({isOpen:!1,isLoading:!1}),onConfirm:k,title:"Unassign Worker",message:`Remove ${F.workerName||"this worker"} from this shift?`,confirmText:F.isLoading?"Removingâ€¦":"Unassign",cancelText:"Cancel",isLoading:F.isLoading,isDestructive:!0}),e.jsx(Le,{isOpen:A.isOpen,onClose:ve,onConfirm:be,title:"Delete Event",message:`Delete "${A.eventTitle}"? This action cannot be undone.`,confirmText:A.isLoading?"Deletingâ€¦":"Delete",cancelText:"Cancel",isLoading:A.isLoading,isDestructive:!0}),e.jsx(cs,{isOpen:S.isOpen,eventId:S.eventId||0,roleName:S.roleName||"",unfilledShiftIds:S.unfilledShiftIds,defaultPayRate:S.payRate,onClose:()=>p({isOpen:!1,unfilledShiftIds:[]}),onDone:({assigned:t,conflicts:f,details:_})=>{p({isOpen:!1,unfilledShiftIds:[]});let Q=`Assigned ${t} workers â€¢ ${f} skipped`;f>0&&_&&(Q+=`: ${_}`),n({isVisible:!0,message:Q,type:f>0?"error":"success"}),w()}}),i.event&&e.jsx(ms,{event:i.event,isOpen:i.isOpen,onClose:()=>c({isOpen:!1,event:void 0}),onSuccess:()=>{w(),c({isOpen:!1,event:void 0})}}),q.isOpen&&q.event&&e.jsx(us,{event:q.event,isOpen:q.isOpen,onClose:()=>{N({isOpen:!1}),w()},onSuccess:()=>{w(),N({isOpen:!1})}})]})}function gs({events:s,onDelete:m,onPublish:y,onNavigate:r,searchQuery:U}){const o=u=>{if(!u)return"No date set";const C=me(u);return he(C,"MMM d, yyyy")},J=u=>{if(!u)return"";const C=me(u);return he(C,"h:mm a")};return s.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:U?"No draft events found":"No draft events yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:U?"Try adjusting your search query":"Create your first event to get started"}),!U&&e.jsxs("button",{onClick:()=>r("/events/create"),className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:[e.jsx(Ae,{size:20}),"Create Event"]})]}):e.jsx("div",{className:"space-y-4",children:s.map(u=>{var C;return e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[u.title,u.schedule&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-600",children:["â€¢ ",J(u.schedule.start_time_utc),"â€“",J(u.schedule.end_time_utc)]})]})}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Draft"})]}),u.venue&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[e.jsx(Fe,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:((C=u.venue)==null?void 0:C.name)||"No venue"})]}),u.schedule&&e.jsx("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{children:o(u.schedule.start_time_utc)})]})}),u.total_workers_needed>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Ee,{size:16,className:"text-gray-400"}),e.jsxs("span",{children:[u.total_workers_needed," workers needed"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>r(`/events/${u.id}/edit`),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Edit",children:e.jsx(qe,{size:18})})})]})})},u.id)})})}function fs({events:s,expandedEvents:m,loadingEventDetails:y,onToggleEvent:r,onAssignWorker:U,onUnassign:o,onQuickFill:J,onPublish:u,onDelete:C,onEdit:v,searchQuery:P}){const B=g=>{const I=me(g);return he(I,"EEE, MMM d, yyyy")},ee=g=>{const I=me(g);return he(I,"h:mm a")},K=g=>{if(!g.schedule)return!1;const j=(me(g.schedule.start_time_utc).getTime()-new Date().getTime())/(1e3*60*60);return j>0&&j<=48},te=g=>{switch(g){case"fully_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[e.jsx(pe,{size:14}),"Ready"]});case"partially_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full",children:[e.jsx(ue,{size:14}),"Partial"]});case"needs_workers":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[e.jsx(ye,{size:14}),"Needs Workers"]});default:return null}};return s.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:P?"No active events found":"No active events"}),e.jsx("p",{className:"text-gray-600",children:P?"Try adjusting your search query or filters":"Publish draft events to see them here"})]}):e.jsx("div",{className:"space-y-4",children:s.map(g=>{const I=m.has(g.id);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-5 hover:border-gray-300 hover:shadow-sm transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1 truncate",children:g.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 flex-wrap",children:[g.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"h-4 w-4 flex-shrink-0"}),B(g.schedule.start_time_utc)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"h-4 w-4 flex-shrink-0"}),ee(g.schedule.start_time_utc)," - ",ee(g.schedule.end_time_utc),K(g)&&e.jsxs("span",{className:"bg-red-50 text-red-800 text-xs font-bold px-2.5 py-1 rounded-full ml-2 inline-flex items-center gap-1.5","aria-label":"Urgent: starts within 48 hours",children:[e.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full"}),"URGENT"]})]})]}),g.venue&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Fe,{className:"h-4 w-4 flex-shrink-0"}),g.venue.name]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 ml-4",children:[te(g.staffing_status),v&&g.status==="published"&&e.jsx("button",{onClick:j=>{j.stopPropagation(),v(g)},title:"Edit Event",className:"p-1.5 text-teal-600 hover:text-teal-700 hover:bg-teal-50 rounded transition-colors",children:e.jsx(is,{size:14})}),C&&e.jsx("button",{onClick:j=>{j.stopPropagation(),C(g.id)},title:"Delete",className:"p-1.5 text-red-600 hover:text-red-700 hover:bg-red-50 rounded transition-colors",children:e.jsx(Se,{size:14})}),e.jsx("button",{onClick:()=>r(g.id),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:I?e.jsx(Je,{size:20,className:"text-gray-600"}):e.jsx(rs,{size:20,className:"text-gray-600"})})]})]}),e.jsx("div",{className:"py-3 border-y border-gray-100 space-y-2",children:(()=>{const j=g.assigned_workers_count||0,$=g.total_workers_needed||0,h=$>0?Math.round(j/$*100):0;g.unfilled_roles_count;const L=(()=>{const q=g.estimated_cost??g.total_cost??g.total_pay_amount??0;return re(q,2,"0.00")})(),z=()=>h>=100?"bg-green-500":h>=75?"bg-amber-500":h>=50?"bg-orange-500":"bg-red-500";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 whitespace-nowrap",children:[j," of ",$," roles filled"]}),e.jsx("div",{className:"flex-1 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:Ce("h-full rounded-full transition-all duration-300",z()),style:{width:`${h}%`}})}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900 whitespace-nowrap",children:[h,"%"]})]}),e.jsxs("div",{className:"text-sm font-medium text-gray-700",children:[j,"/",$," hired"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{children:"Est. Cost: "}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["$",L]})]})]})})()}),I&&e.jsx("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:y.has(g.id)?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-teal-600 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading assignments..."})]})}):g.shifts_by_role&&g.shifts_by_role.length>0?e.jsx("div",{className:"space-y-4",children:g.shifts_by_role.map(j=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:j.role_name}),e.jsxs("span",{className:"text-sm text-gray-600",children:[j.filled_shifts,"/",j.total_shifts," hired"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[j.filled_shifts<j.total_shifts&&e.jsxs("span",{className:"px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[j.total_shifts-j.filled_shifts," needed"]}),j.filled_shifts<j.total_shifts&&e.jsx("button",{onClick:$=>{var z;$.stopPropagation();const h=j.shifts.filter(q=>q.staffing_progress.percentage<100).sort((q,N)=>new Date(q.start_time_utc).getTime()-new Date(N.start_time_utc).getTime()).map(q=>q.id),L=(z=j.shifts[0])==null?void 0:z.pay_rate;J(g.id,j.role_name,h,L)},className:"px-2.5 py-1 text-xs font-semibold bg-teal-600 text-white rounded hover:bg-teal-700",title:"Quick Fill by Skill",children:"Quick Fill by Skill"})]})]}),e.jsx("div",{className:"space-y-2",children:j.shifts.map(($,h)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 text-gray-700 rounded-md flex items-center justify-center text-xs font-medium",children:h+1}),e.jsxs("span",{className:"text-sm text-gray-700",children:[ee($.start_time_utc)," - ",ee($.end_time_utc)]}),$.assignments.length>0&&e.jsx("div",{className:"flex items-center gap-1 flex-wrap",children:$.assignments.map(L=>{const z=`${L.worker.first_name} ${L.worker.last_name}`,q=Number(L.hourly_rate||$.pay_rate||0);return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"bg-white text-black border border-gray-200 rounded-full px-2.5 py-1 text-sm font-medium shadow-sm max-w-[140px] truncate",title:`${z} â€¢ $${re(q,0,"0")}/hr`,children:z}),e.jsx("button",{onClick:N=>{N.stopPropagation(),o(L.id,z)},className:"w-5 h-5 flex items-center justify-center text-red-600 hover:text-red-700 hover:bg-red-50 rounded",title:"Unassign worker",children:e.jsx(ye,{size:12})})]},L.id)})})]}),$.staffing_progress.percentage===100?e.jsxs("span",{className:"flex items-center gap-1.5 text-sm font-medium text-green-600",children:[e.jsx(pe,{size:16}),"Assigned"]}):e.jsx("button",{onClick:L=>{L.stopPropagation(),U($.id)},className:"px-3 py-1.5 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Assign Worker"})]},$.id))})]},j.role_name))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:g.status==="draft"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"This event is still in draft status"}),e.jsx("p",{className:"text-sm",children:"Publish the event to generate shifts and assign workers"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"No shifts available"}),e.jsx("p",{className:"text-sm",children:"This event may not have any shifts generated yet"})]})}),e.jsx("div",{className:"flex items-center justify-center gap-3",children:g.status==="draft"&&e.jsx("button",{onClick:()=>u(g.id),className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors",children:"Publish Event"})})]})})]},g.id)})})}function ps({events:s,searchQuery:m,onApproveHours:y}){const r=o=>{const J=me(o);return he(J,"MMM d, yyyy")},U=o=>{const J=me(o);return he(J,"h:mm a")};return s.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“‹"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:m?"No past events found":"No past events yet"}),e.jsx("p",{className:"text-gray-600",children:m?"Try adjusting your search query":"Completed events will appear here"})]}):e.jsx("div",{className:"space-y-4",children:s.map(o=>{var u;const J=He(o.total_hours??o.total_hours_worked??0);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-5 hover:border-gray-300 hover:shadow-sm transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1 truncate",children:o.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 flex-wrap",children:[o.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"h-4 w-4 flex-shrink-0"}),r(o.schedule.start_time_utc)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"h-4 w-4 flex-shrink-0"}),U(o.schedule.start_time_utc)," - ",U(o.schedule.end_time_utc)]})]}),o.venue&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Fe,{className:"h-4 w-4 flex-shrink-0"}),o.venue.name]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 ml-4",children:[e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-700 rounded",children:"Completed"}),o.approval_status&&o.approval_status.pending>0&&e.jsxs("span",{className:"px-2 py-1 text-xs font-medium bg-amber-100 text-amber-700 rounded",children:[o.approval_status.pending," Pending"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 py-3 border-y border-gray-100",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Workers"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:o.assigned_workers_count||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Hours"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:re(J,2,"0.00")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Cost"}),e.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:["$",(u=o.cost_summary)!=null&&u.total_estimated_cost?re(o.cost_summary.total_estimated_cost,2,"0.00"):o.total_pay_amount?re(o.total_pay_amount,2,"0.00"):"0.00"]}),o.approval_status&&o.approval_status.pending>0&&o.cost_summary&&e.jsxs("div",{className:"text-xs text-amber-600 font-medium mt-0.5",children:["$",re(o.cost_summary.pending_cost,2,"0.00")," pending"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Staffing"}),(()=>{const C=o.total_workers_needed||0,v=o.assigned_workers_count||0;if(C===0&&v===0)return e.jsx("div",{className:"text-lg font-semibold text-gray-400",children:"Not staffed"});const P=o.staffing_percentage||(C>0?Math.round(v/C*100):0);return e.jsxs("div",{className:Ce("text-lg font-semibold",P===100?"text-green-600":P>0?"text-yellow-600":"text-red-600"),children:[P,"%"]})})()]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:y&&(()=>{const C=o.total_workers_needed||0,v=o.assigned_workers_count||0,P=o.approval_status&&o.approval_status.total>0;return C===0&&v===0&&!P?null:e.jsxs("button",{onClick:()=>y(o),className:Ce("px-4 py-2 text-sm font-medium rounded-lg flex items-center gap-2 transition-colors shadow-sm",o.approval_status&&o.approval_status.pending>0?"bg-amber-600 hover:bg-amber-700 text-white":o.approval_status&&o.approval_status.approved===o.approval_status.total&&P||P?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"),disabled:!P,children:[o.approval_status&&o.approval_status.pending>0?e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"h-4 w-4"}),"Approve Hours (",o.approval_status.pending,")"]}):P?e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-4 w-4"}),"Approved"]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-4 w-4"}),"No assignments"]}),e.jsx(ls,{className:"h-4 w-4"})]})})()})]},o.id)})})}export{Rs as EventsPage};
