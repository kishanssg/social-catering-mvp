import{j as e,a as v}from"./index-CdyANOxy.js";import{b as a}from"./vendor-Clbca2a1.js";import{L as Q,E as V}from"./ErrorMessage-DzF5vYGs.js";import{X as w}from"./x-BVsZF-Y_.js";import{C as Y}from"./circle-alert-CTHc8KB9.js";import{c as k}from"./createLucideIcon-3h5MTQgh.js";import{C as f}from"./chevron-right-CWS8j0Ws.js";import{U as Z}from"./users-CyY_3fZx.js";import{C as ee}from"./calendar-6vummjVo.js";import{C as se}from"./clock-BFS8HtoJ.js";import{f as R}from"./format-BqWGv6kL.js";import{p as T}from"./parseISO-DAzH-w3Y.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],p=k("check",te);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],ae=k("info",re);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],B=k("triangle-alert",le),ne=({message:d,type:h="success",onClose:t,duration:m=3e3})=>{a.useEffect(()=>{const n=setTimeout(()=>{t()},m);return()=>clearTimeout(n)},[m,t]);const l={success:"bg-green-50 border-green-200 text-green-900",error:"bg-red-50 border-red-200 text-red-900",info:"bg-blue-50 border-blue-200 text-blue-900",warning:"bg-yellow-50 border-yellow-200 text-yellow-900"},j={success:e.jsx(p,{className:"h-5 w-5 text-green-600"}),error:e.jsx(w,{className:"h-5 w-5 text-red-600"}),info:e.jsx(ae,{className:"h-5 w-5 text-blue-600"}),warning:e.jsx(Y,{className:"h-5 w-5 text-yellow-600"})};return e.jsx("div",{className:"fixed top-4 right-4 z-50 animate-slide-in",children:e.jsxs("div",{className:`flex items-center gap-3 px-4 py-3 rounded-lg border shadow-lg ${l[h]} min-w-[300px] max-w-[500px]`,children:[j[h],e.jsx("p",{className:"flex-1",children:d}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700",children:e.jsx(w,{className:"h-4 w-4"})})]})})},ye=({onClose:d,onSuccess:h})=>{const[t,m]=a.useState("select-worker"),[l,j]=a.useState(null),[n,S]=a.useState([]),[D,z]=a.useState([]),[I,U]=a.useState([]),[q,_]=a.useState(!0),[b,C]=a.useState(!1),[L,y]=a.useState(""),[o,O]=a.useState([]),[g,P]=a.useState(""),[u,X]=a.useState(""),[N,A]=a.useState(null);a.useEffect(()=>{$()},[]);const $=async()=>{try{_(!0),y("");const[s,r]=await Promise.all([v.getWorkers(),v.getShifts({status:"published"})]),i=s.data?.workers||[];z(i.filter(x=>x.active));const c=r.data?.shifts||[];U(c.filter(x=>(x.assignments?.length||0)<x.capacity&&x.status==="published"))}catch(s){const r=s?.response?.data?.error||"Failed to load data";y(r),console.error("Error loading data:",s)}finally{_(!1)}},G=s=>{j(s),m("select-shifts")},H=s=>{S(r=>r.find(c=>c.id===s.id)?r.filter(c=>c.id!==s.id):[...r,s])},J=async()=>{if(!l||n.length===0)return;C(!0),y("");const s=[];for(const r of n)try{await v.createAssignment({shift_id:r.id,worker_id:l.id}),s.push({shift:r,success:!0})}catch(i){const c=i.response?.data?.error||"Failed to assign";s.push({shift:r,success:!1,error:c})}O(s),C(!1),m("confirm")},K=()=>{const s=o.filter(i=>i.success).length,r=o.length;s>0&&A({message:`Successfully assigned ${l?.first_name} to ${s} of ${r} shifts!`,type:"success"}),h(),d()},M=s=>{try{return R(T(s),"EEE, MMM d, yyyy")}catch{return s}},E=s=>{try{return R(T(s),"h:mm a")}catch{return s}},W=D.filter(s=>s.first_name.toLowerCase().includes(g.toLowerCase())||s.last_name.toLowerCase().includes(g.toLowerCase())||s.email.toLowerCase().includes(g.toLowerCase())),F=I.filter(s=>s.client_name.toLowerCase().includes(u.toLowerCase())||s.role_needed.toLowerCase().includes(u.toLowerCase()));return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Bulk Assign Worker"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Assign one worker to multiple shifts at once"})]}),e.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600",children:e.jsx(w,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"px-6 py-4 border-b bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("div",{className:`flex items-center gap-2 ${t==="select-worker"?"text-blue-600":t==="select-shifts"||t==="confirm"?"text-green-600":"text-gray-400"}`,children:[e.jsx("div",{className:`h-8 w-8 rounded-full flex items-center justify-center ${t==="select-worker"?"bg-blue-600 text-white":t==="select-shifts"||t==="confirm"?"bg-green-600 text-white":"bg-gray-200"}`,children:t==="select-shifts"||t==="confirm"?e.jsx(p,{className:"h-5 w-5"}):"1"}),e.jsx("span",{className:"text-sm font-medium hidden sm:inline",children:"Select Worker"})]}),e.jsx(f,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{className:`flex items-center gap-2 ${t==="select-shifts"?"text-blue-600":t==="confirm"?"text-green-600":"text-gray-400"}`,children:[e.jsx("div",{className:`h-8 w-8 rounded-full flex items-center justify-center ${t==="select-shifts"?"bg-blue-600 text-white":t==="confirm"?"bg-green-600 text-white":"bg-gray-200"}`,children:t==="confirm"?e.jsx(p,{className:"h-5 w-5"}):"2"}),e.jsx("span",{className:"text-sm font-medium hidden sm:inline",children:"Select Shifts"})]}),e.jsx(f,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{className:`flex items-center gap-2 ${t==="confirm"?"text-blue-600":"text-gray-400"}`,children:[e.jsx("div",{className:`h-8 w-8 rounded-full flex items-center justify-center ${t==="confirm"?"bg-blue-600 text-white":"bg-gray-200"}`,children:"3"}),e.jsx("span",{className:"text-sm font-medium hidden sm:inline",children:"Confirm"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:q?e.jsx(Q,{message:"Loading workers and shifts..."}):L?e.jsx(V,{message:L,onRetry:$}):t==="select-worker"?e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Select the worker you want to assign to multiple shifts:"}),e.jsx("input",{type:"text",placeholder:"Search workers...",value:g,onChange:s=>P(s.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:W.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No workers found"}):W.map(s=>e.jsx("button",{onClick:()=>G(s),className:"w-full p-4 border rounded-lg hover:border-blue-500 hover:bg-blue-50 text-left transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:e.jsxs("span",{className:"text-blue-600 font-medium",children:[s.first_name[0],s.last_name[0]]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[s.first_name," ",s.last_name]}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:s.email}),s.skills_json&&s.skills_json.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[s.skills_json.slice(0,3).map(r=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-100 text-gray-600 rounded",children:r},r)),s.skills_json.length>3&&e.jsxs("span",{className:"px-2 py-0.5 text-xs text-gray-500",children:["+",s.skills_json.length-3]})]})]}),e.jsx(f,{className:"h-5 w-5 text-gray-400"})]})},s.id))})]}):t==="select-shifts"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Select shifts to assign ",e.jsxs("strong",{children:[l?.first_name," ",l?.last_name]}),":"]}),e.jsxs("div",{className:"text-sm font-medium text-blue-600",children:[n.length," selected"]})]}),e.jsx("input",{type:"text",placeholder:"Search shifts...",value:u,onChange:s=>X(s.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),F.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:u?"No shifts match your search":"No shifts available for assignment"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:F.map(s=>{const r=n.some(c=>c.id===s.id),i=s.assignments?.length||0;return e.jsx("label",{className:`block p-4 border rounded-lg cursor-pointer transition-colors ${r?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:()=>H(s),className:"mt-1"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.client_name}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:s.role_needed}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-gray-500 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"h-3 w-3"}),M(s.start_time_utc)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"h-3 w-3"}),E(s.start_time_utc)," - ",E(s.end_time_utc)]}),e.jsxs("span",{className:"text-xs px-2 py-0.5 bg-gray-100 rounded",children:[i,"/",s.capacity," assigned"]})]})]})]})},s.id)})})]}):e.jsx("div",{className:"space-y-4",children:b?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Assigning worker to shifts..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"This may take a moment"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-1",children:"Assignment Results"}),e.jsxs("p",{className:"text-sm text-blue-700",children:[l?.first_name," ",l?.last_name," was assigned to ",o.filter(s=>s.success).length," of ",o.length," shifts"]})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:o.map((s,r)=>e.jsx("div",{className:`p-4 border rounded-lg ${s.success?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[s.success?e.jsx(p,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}):e.jsx(B,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.shift.client_name}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[s.shift.role_needed," • ",M(s.shift.start_time_utc)]}),s.error&&e.jsxs("div",{className:"text-sm text-red-700 mt-2 flex items-start gap-1",children:[e.jsx(B,{className:"h-4 w-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:s.error})]})]})]})},r))}),e.jsx("div",{className:"pt-4 border-t mt-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:o.filter(s=>s.success).length}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Successful"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:o.filter(s=>!s.success).length}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Failed"})]})]})})]})})}),e.jsx("div",{className:"flex items-center justify-between p-6 border-t bg-gray-50",children:t==="select-worker"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Step 1 of 3"}),e.jsx("button",{onClick:d,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-white",children:"Cancel"})]}):t==="select-shifts"?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{m("select-worker"),S([])},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-white",children:"← Back"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:d,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-white",children:"Cancel"}),e.jsx("button",{onClick:J,disabled:n.length===0||b,className:"btn-green disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Assigning..."]}):e.jsxs(e.Fragment,{children:["Assign to ",n.length," ",n.length===1?"Shift":"Shifts",e.jsx(f,{className:"h-4 w-4"})]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Assignment complete"}),e.jsx("button",{onClick:K,className:"btn-green",children:"Done"})]})})]}),N&&e.jsx(ne,{message:N.message,type:N.type,onClose:()=>A(null)})]})};export{ye as B,p as C,ne as T};
