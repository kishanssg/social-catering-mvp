import{c as Ue,j as e,X as je,a as G,A as Se,b as Ze,C as Ke}from"./index-KhVmBWkd.js";import{r as c,b as We,R as Ye,f as Ge}from"./vendor-79DyBOV9.js";import{f as es,a as Oe,g as ss}from"./dateUtils-DugSZKu1.js";import{s as xe,a as pe}from"./number-BA3fu1JD.js";import{c as we,C as _e}from"./utils-BKQg_Jcy.js";import{C as $e}from"./clock-DsRXUc3K.js";import{M as ke}from"./map-pin-MplePgWj.js";import{U as De}from"./users--QnFGOq6.js";import{S as Pe,A as ts,L as Ie,C as Ae}from"./Avatar-DrRz8lB2.js";import{D as He}from"./dollar-sign-JSAk01Ts.js";import{T as Re}from"./Toast-Ci5vKDlA.js";import{C as Ce}from"./x-circle-Cp6q6EpJ.js";import{b as as,a as rs,c as ls,e as ns,p as is}from"./Prep Cook-li-JR_eG.js";import{P as qe}from"./pen-square-C9Qwcg18.js";import{P as Te}from"./plus-Khcs-esC.js";import{T as Qe}from"./trash-2-C7JqN4GI.js";import{f as he}from"./index-C_slYh2M.js";import{p as ue}from"./index-BK_MyBzW.js";import{C as Ee}from"./calendar--j_Gr9CF.js";import{C as os}from"./chevron-down-CoMj5msX.js";import{C as Ve}from"./chevron-right-SEmCqTcs.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=Ue("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=Ue("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),ms={sm:"max-w-md",md:"max-w-2xl",lg:"max-w-4xl",xl:"max-w-6xl"},Me=({isOpen:a,onClose:u,title:N,subtitle:T,children:l,footer:d,size:j="md",closeOnOverlayClick:m=!0})=>{if(c.useEffect(()=>(a?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[a]),c.useEffect(()=>{const D=X=>{X.key==="Escape"&&a&&u()};return document.addEventListener("keydown",D),()=>document.removeEventListener("keydown",D)},[a,u]),!a)return null;const L=D=>{D.target===D.currentTarget&&m&&u()};return e.jsx("div",{className:"modal-overlay",onClick:L,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:e.jsxs("div",{className:`modal-container ${ms[j]}`,children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{id:"modal-title",className:"text-xl font-semibold text-gray-900 font-manrope",children:N}),T&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:T})]}),e.jsx("button",{onClick:u,className:"p-1.5 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors","aria-label":"Close modal",children:e.jsx(je,{size:20,className:"text-gray-600"})})]}),e.jsx("div",{className:"modal-body",children:l}),d&&e.jsx("div",{className:"modal-footer",children:d})]})})};function us({shiftId:a,suggestedPayRate:u,onClose:N,onSuccess:T}){var o,k;const[l,d]=c.useState(null),[j,m]=c.useState([]),[L,D]=c.useState([]),[X,ie]=c.useState(""),[Z,re]=c.useState(null),[ee,x]=c.useState({}),[Q,w]=c.useState(!0),[E,v]=c.useState(!1),[S,U]=c.useState(null),W=(n,f)=>{x(R=>({...R,[n]:f}))};c.useEffect(()=>{M()},[a]),c.useEffect(()=>{l&&K()},[l]),c.useEffect(()=>{if(!X)D(j);else{const n=X.toLowerCase();D(j.filter(f=>{var R;return f.first_name.toLowerCase().includes(n)||f.last_name.toLowerCase().includes(n)||f.email.toLowerCase().includes(n)||((R=f.skills_json)==null?void 0:R.some(q=>q.toLowerCase().includes(n)))}))}},[X,j]);async function M(){try{const n=await G.get(`/shifts/${a}`);n.data.status==="success"?d(n.data.data):U("Failed to load shift details")}catch(n){console.error("Failed to load shift details:",n),U("Failed to load shift details")}}async function K(){var n;try{const f=new Set;if(l!=null&&l.event_id)try{const J=((n=(await G.get(`/events/${l.event_id}`)).data)==null?void 0:n.data)||{};if(J.shifts_by_role){const A=J.shifts_by_role.find(y=>y.skill_name===l.role_needed||y.role_name===l.role_needed);A!=null&&A.shifts&&A.shifts.forEach(y=>{y.assignments&&y.assignments.forEach(r=>{var b;const i=r.worker_id||((b=r.worker)==null?void 0:b.id),p=r.status;i&&p!=="cancelled"&&p!=="no_show"&&f.add(i)})})}}catch(q){console.log("Could not fetch event to filter assigned workers:",q)}console.log(`AssignmentModal: Found ${f.size} already assigned workers for "${l==null?void 0:l.role_needed}"`);const R=await G.get("/workers?active=true");if(R.data.status==="success"){const q=R.data.data.workers||R.data.data;if(l!=null&&l.role_needed){const J=q.filter(A=>{var y;return((y=A.skills_json)==null?void 0:y.includes(l.role_needed))&&!f.has(A.id)});console.log(`AssignmentModal: Showing ${J.length} eligible workers`),m(J)}else{const J=q.filter(A=>!f.has(A.id));m(J)}}else U("Failed to load workers")}catch(f){console.error("Failed to load workers:",f),U("Failed to load workers")}finally{w(!1)}}async function B(){var n,f,R,q,J,A;if(!(!Z||!l)){v(!0),U(null);try{const r=(await G.post("/staffing",{assignment:{shift_id:l.id,worker_id:Z.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:ee[Z.id]||u||Number(l.pay_rate)||0}})).data;if(r.status==="success")T();else{let i=r.message||"Failed to assign worker";r.details&&r.details.length>0?i+=`

Details:
â€¢ `+r.details.join(`
â€¢ `):r.errors&&(i+=`

Details:
â€¢ `+r.errors.join(`
â€¢ `)),U(i)}}catch(y){console.error("Failed to assign worker:",y);let r="Failed to assign worker";if((f=(n=y.response)==null?void 0:n.data)!=null&&f.details&&y.response.data.details.length>0){const i=y.response.data.details.map(p=>(p.includes("conflicting shift"),p));r+=`

`+i.join(`
`)}else(q=(R=y.response)==null?void 0:R.data)!=null&&q.errors?r+=`

`+y.response.data.errors.join(`
`):(A=(J=y.response)==null?void 0:J.data)!=null&&A.message?r=y.response.data.message:y.message&&(r=y.message);U(r)}finally{v(!1)}}}if(Q)return e.jsx(Me,{isOpen:!0,onClose:N,title:"Assign Worker",size:"lg",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-600"})})});const V=e.jsxs(e.Fragment,{children:[S&&e.jsxs("div",{className:"mb-4 p-3 bg-gradient-to-r from-red-50 to-amber-50 border-l-4 border-red-500 rounded-r-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsx("h4",{className:"text-sm font-semibold text-red-900",children:"âš ï¸ Scheduling Conflict Detected"})]}),e.jsx("p",{className:"text-xs text-gray-600 ml-8",children:"Please resolve the conflict before attempting to assign this worker"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:N,disabled:E,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:B,disabled:!Z||E||!!S,className:`btn-primary ${S?"opacity-50 cursor-not-allowed":""}`,title:S?"Cannot assign due to scheduling conflict":"",children:E?"Assigning Worker...":"Assign Worker"})]})]});return e.jsx(Me,{isOpen:!0,onClose:N,title:l?`${l.client_name} â€¢ ${l.role_needed}`:"Assign Worker",size:"xl",footer:V,children:e.jsxs("div",{className:"flex h-[600px]",children:[e.jsx("div",{className:"w-1/3 border-r border-gray-200 p-6 bg-gray-50",children:l?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Shift Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($e,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:es(l.start_time_utc)}),e.jsxs("div",{className:"text-sm text-gray-600",children:[Oe(l.start_time_utc)," - ",Oe(l.end_time_utc)]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ke,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"text-sm text-gray-900",children:l.location||((k=(o=l.event)==null?void 0:o.venue)==null?void 0:k.formatted_address)||"Location not specified"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(De,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900",children:l.role_needed}),l.required_skill&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Requires: ",l.required_skill]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Pay Rate:"})," $",(u||Number(l.pay_rate)||0).toFixed(2),"/hour"]}),l.uniform_name&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",l.uniform_name]})]}),l.notes&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Notes:"}),e.jsx("div",{className:"mt-1 whitespace-pre-line",children:l.notes.split("Uniform:").map((n,f)=>f===0?n.trim():e.jsxs("div",{children:[e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",n.trim()]},f))})]})})]})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Se,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Failed to load shift details"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(Pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search workers...",value:X,onChange:n=>ie(n.target.value),className:"w-full pl-9 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-teal-500 focus:border-teal-500"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:S?e.jsx("div",{className:"p-6 flex items-center justify-center h-full",children:e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 rounded-lg p-5 shadow-sm w-full max-w-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(Se,{size:20,className:"text-red-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg font-semibold text-red-900 mb-1",children:"âš ï¸ Scheduling Conflict"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"This worker cannot be assigned due to a scheduling conflict"}),e.jsx("div",{className:"bg-white border border-red-200 rounded p-3 mt-3",children:e.jsx("div",{className:"text-sm text-red-800 font-mono",children:S.split(`
`).map((n,f)=>n.trim()===""?null:n.startsWith("â€¢")?e.jsxs("div",{className:"mt-1 flex items-start gap-2",children:[e.jsx("span",{className:"text-red-500",children:"â—"}),e.jsx("span",{className:"flex-1",children:n.replace("â€¢","").trim()})]},f):n.startsWith("Details:")?null:n.includes("conflicting shift")?e.jsx("div",{className:"mt-1 text-red-700 font-medium",children:n},f):e.jsx("div",{className:"text-gray-700",children:n},f))})})]})]})})}):L.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(De,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:X?"No workers found matching your search":l!=null&&l.role_needed?`No workers found with "${l.role_needed}" skill`:"No available workers"}),(l==null?void 0:l.role_needed)&&!X&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:['Try adding "',l.role_needed,'" skill to workers or select a different shift.']})]}):e.jsx("ul",{children:L.map(n=>{const f=(Z==null?void 0:Z.id)===n.id,R=u||Number(l.pay_rate)||0,q=ee[n.id]||R,J=ee[n.id]&&ee[n.id]!==R;return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${f?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[n.first_name[0],n.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[n.first_name," ",n.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(n.skills_json||[]).map((A,y)=>{const r=A===(l==null?void 0:l.role_needed);return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${r?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:A},y)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[J&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(He,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:(u||Number(l.pay_rate)||0).toString(),value:q||"",onChange:A=>{const y=A.target.value;(y===""||/^\d*\.?\d*$/.test(y))&&W(n.id,parseFloat(y)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:A=>A.stopPropagation(),onFocus:A=>A.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>re(n),className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${f?"bg-teal-600 text-white border-teal-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:f?"Selected":"Select"})]})]},n.id)})})})]})]})})}function xs({isOpen:a,eventId:u,roleName:N,unfilledShiftIds:T,defaultPayRate:l,onClose:d,onDone:j}){const[m,L]=c.useState([]),[D,X]=c.useState([]),[ie,Z]=c.useState(""),[re,ee]=c.useState(!1),[x,Q]=c.useState(!1),[w,E]=c.useState({}),[v,S]=c.useState(0),U=(o,k)=>{E(n=>({...n,[o]:k}))};c.useEffect(()=>{a&&(L([]),X([]),Z(""),E({}),ee(!0),(async()=>{var o,k;try{const f=((o=(await G.get(`/events/${u}`)).data)==null?void 0:o.data)||{};console.log("QuickFill: Full event data:",JSON.stringify(f,null,2)),console.log("QuickFill: Looking for role:",N),console.log("QuickFill: shifts_by_role:",f.shifts_by_role);const R=new Set;if(f.shifts_by_role){const y=f.shifts_by_role.find(r=>(console.log("QuickFill: Checking role:",r.skill_name,r.role_name,"vs",N),r.skill_name===N||r.role_name===N));y?(console.log("QuickFill: Found role shifts:",y),y.shifts&&y.shifts.forEach(r=>{r.assignments&&(console.log("QuickFill: Shift has assignments:",r.assignments),r.assignments.forEach(i=>{var z;const p=i.worker_id||((z=i.worker)==null?void 0:z.id),b=i.status;p&&b!=="cancelled"&&(R.add(p),console.log("QuickFill: Adding worker_id to exclude:",p,"status:",b))}))})):console.log("QuickFill: No role shifts found for:",N)}console.log(`QuickFill: Found ${R.size} already assigned worker IDs:`,Array.from(R));const q=await G.get("/workers?active=true"),A=(((k=q.data)==null?void 0:k.data)||q.data||[]).filter(y=>{const r=(y.skills_json||[]).includes(N),i=R.has(y.id);return i&&console.log(`QuickFill: Excluding ${y.first_name} ${y.last_name} (ID: ${y.id}) - already assigned`),r&&!i});if(console.log(`QuickFill: Found ${A.length} eligible workers for "${N}"`),console.log("QuickFill: Eligible workers:",A.map(y=>`${y.first_name} ${y.last_name}`)),L(A),l){const y=Number(l)||0;S(y),console.log(`QuickFill: Default pay rate for ${N}: $${y}/hr`)}else console.log(`QuickFill: No default pay rate provided for ${N}`)}catch(n){console.error("Error loading workers:",n)}finally{ee(!1)}})())},[a,u,N,l]);const W=c.useMemo(()=>{const o=ie.trim().toLowerCase(),k=m;return o?k.filter(n=>`${n.first_name} ${n.last_name}`.toLowerCase().includes(o)||(n.email||"").toLowerCase().includes(o)):k},[m,ie]),M=T.length,K=o=>{X(k=>k.includes(o)?k.filter(n=>n!==o):k.length>=M?k:[...k,o])},B=async()=>{var f,R,q,J,A,y,r,i,p,b,z,H,se,le,ge;if(D.length===0||M===0)return;Q(!0);let o=0,k=0;const n=[];try{const ne=D.map(s=>m.find(g=>g.id===s)).filter(Boolean),ye=[...T];let fe=0;for(;ye.length>0&&ne.length>0;){const s=ne[fe%ne.length],g=ye.shift();try{const _=w[s.id]||Number(v)||0||0,$=await G.post("/staffing",{assignment:{shift_id:g,worker_id:s.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:_}});if(((f=$.data)==null?void 0:f.status)==="success")o+=1;else{k+=1;const P=`${s.first_name} ${s.last_name}`,O=((R=$.data)==null?void 0:R.message)||((J=(q=$.data)==null?void 0:q.error)==null?void 0:J.message)||((y=(A=$.data)==null?void 0:A.errors)==null?void 0:y.join(", "))||"Unknown error";let F="Unable to assign";const t=String(O).toLowerCase();t.includes("overlapping")||t.includes("conflict")?F="Has overlapping shift":t.includes("capacity")||t.includes("full")?F="Shift is full":t.includes("skill")||t.includes("certification")||t.includes("requirement")?F="Missing required skill":t.includes("status")?F="Cannot be assigned":F="Unable to assign",n.push(`${P}: ${F}`)}}catch(_){k+=1;const $=`${s.first_name} ${s.last_name}`;let P="Unable to assign";const O=((i=(r=_.response)==null?void 0:r.data)==null?void 0:i.message)||((z=(b=(p=_.response)==null?void 0:p.data)==null?void 0:b.error)==null?void 0:z.message)||((le=(se=(H=_.response)==null?void 0:H.data)==null?void 0:se.errors)==null?void 0:le.join(", "))||null;if(O){const F=String(O).toLowerCase();F.includes("overlapping")||F.includes("conflict")?P="Has overlapping shift":F.includes("capacity")||F.includes("full")?P="Shift is full":F.includes("skill")||F.includes("certification")||F.includes("requirement")?P="Missing required skill":F.includes("status")?P="Cannot be assigned":P="Unable to assign"}else((ge=_.response)==null?void 0:ge.status)===422?P="Unable to assign":_.message&&!_.message.includes("status code")&&(P=_.message);n.push(`${$}: ${P}`)}fe+=1}let be="";k>0&&n.length>0&&(be=n.join(", ")),j({assigned:o,conflicts:k,details:be})}finally{Q(!1)}};if(!a)return null;const V=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:d,disabled:x,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:B,disabled:x||D.length===0||M===0,className:"btn-primary",children:x?"Filling Shifts...":D.length===1?`Assign worker to ${M} shift${M!==1?"s":""}`:`Assign ${D.length} workers to ${M} shifts`})]});return e.jsxs(Me,{isOpen:a,onClose:d,title:`Quick Fill â€” ${N}`,subtitle:`Unfilled shifts: ${M}`,size:"lg",footer:V,children:[e.jsxs("div",{className:"relative",children:[e.jsx(Pe,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{value:ie,onChange:o=>Z(o.target.value),placeholder:"Search eligible workersâ€¦",className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsx("div",{className:"max-h-[340px] overflow-y-auto border border-gray-200 rounded-lg",children:re?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loadingâ€¦"}):W.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"No eligible workers"}):e.jsx("ul",{children:W.map(o=>{const k=D.includes(o.id);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${k?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[o.first_name[0],o.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[o.first_name," ",o.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(o.skills_json||[]).map((n,f)=>{const R=n===N;return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${R?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:n},f)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[w[o.id]&&w[o.id]!==(Number(v)||0)&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(He,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:Number(v)?(Number(v)||0).toString():"Rate",value:w[o.id]||Number(v)||0||"",onChange:n=>{const f=n.target.value;(f===""||/^\d*\.?\d*$/.test(f))&&U(o.id,parseFloat(f)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:n=>n.stopPropagation(),onFocus:n=>n.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>K(o.id),disabled:!k&&D.length>=M,className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${k?"bg-teal-600 text-white border-teal-600":D.length>=M?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:k?"Selected":"Select"})]})]},o.id)})})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(Ce,{size:16,className:"text-teal-600"}),e.jsxs("span",{children:["Will assign ",e.jsx("strong",{children:D.length})," worker",D.length!==1?"s":""," to ",e.jsx("strong",{children:M})," shift",M!==1?"s":"","."]})]}),(Number(v)||0)>0&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Default rate for ",N,":"]}),e.jsxs("span",{className:"font-medium",children:["$",(Number(v)||0).toFixed(2),"/hr"]})]}),Object.keys(w).length>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["ðŸ’¡ Empty fields will use default rate ($",(Number(v)||0).toFixed(2),"/hr)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(Ze,{size:14,className:"text-yellow-600"}),"Conflicts and already-filled shifts will be skipped automatically."]})]})}function hs({event:a,isOpen:u,onClose:N,onSuccess:T}){var A,y;const l=We(),[d,j]=c.useState(!1),[m,L]=c.useState([]),[D,X]=c.useState(!1),[ie,Z]=c.useState(!1),[re,ee]=c.useState(null),[x,Q]=c.useState(null),[w,E]=c.useState({isVisible:!1,message:"",type:"error"}),[v,S]=c.useState(null),[U,W]=c.useState(!1);c.useEffect(()=>{u&&a.id&&M()},[u,a.id]);const M=async()=>{Z(!0);try{const r=await G.get(`/events/${a.id}`);r.data.status==="success"&&ee(r.data.data)}catch(r){console.error("Failed to load full event details:",r),ee(a)}finally{Z(!1)}},K=()=>{N(),l(`/events/${a.id}/edit`)},B=[{name:"Bartender",icon:as},{name:"Banquet Server/Runner",icon:rs},{name:"Captain",icon:ls},{name:"Event Helper",icon:ns},{name:"Prep Cook",icon:is}],V=re||a,o=re||a;c.useEffect(()=>{if(V){if(V.skill_requirements&&Array.isArray(V.skill_requirements)){const r=V.skill_requirements.map(i=>{var z,H;const p=(z=V.shifts_by_role)==null?void 0:z.find(se=>(se.skill_name||se.role_name)===i.skill_name),b=((H=p==null?void 0:p.shifts)==null?void 0:H.length)||(p==null?void 0:p.total_shifts)||i.needed_workers||1;return{skill_name:i.skill_name,needed_workers:b,pay_rate:i.pay_rate||15,description:i.description||"",uniform_id:void 0,cert_id:void 0}});L(r)}else if(V.shifts_by_role&&Array.isArray(V.shifts_by_role)){const r=V.shifts_by_role.map(i=>{const p=i.shifts?i.shifts.length:i.total_shifts||1;return{skill_name:i.skill_name||i.role_name||"",needed_workers:p,pay_rate:i.pay_rate||15,description:"",uniform_id:void 0,cert_id:void 0}});L(r)}}},[V]),c.useEffect(()=>{const r=re||a;r!=null&&r.schedule&&S({start_time_utc:r.schedule.start_time_utc,end_time_utc:r.schedule.end_time_utc,break_minutes:r.schedule.break_minutes||0})},[re,a]);const k=(r,i,p)=>{if(r<0||r>=m.length)return;const b=[...m];b[r]={...b[r],[i]:p},L(b)},n=()=>{L([...m,{skill_name:"",needed_workers:1,pay_rate:15,description:"",uniform_id:void 0,cert_id:void 0}])},f=r=>{var p;if(r<0||r>=m.length)return;const i=m[r];if((i==null?void 0:i.needed_workers)>0){const b=(p=o==null?void 0:o.shifts_by_role)==null?void 0:p[r];if(((b==null?void 0:b.assigned_workers)||(b==null?void 0:b.filled_shifts)||0)>0){E({isVisible:!0,message:"Cannot remove role with assigned workers. Please unassign workers first.",type:"error"});return}}L(m.filter((b,z)=>z!==r))},R=(r,i)=>{if(r<0||r>=m.length)return;B.find(b=>b.name===i);const p=[...m];p[r]={...p[r],skill_name:i},L(p),Q(null)},q=async()=>{var i,p,b;const r=re||a;if(r.schedule&&new Date(r.schedule.start_time_utc)<=new Date){E({isVisible:!0,message:"Cannot edit event that has already started",type:"error"});return}X(!0);try{const z=re||a,H=await G.patch(`/events/${z.id}`,{event:{roles:m.map(se=>({skill_name:se.skill_name,needed:se.needed_workers,pay_rate:se.pay_rate,description:se.description,uniform_id:se.uniform_id,cert_id:se.cert_id})),schedule:v?{start_time_utc:v.start_time_utc,end_time_utc:v.end_time_utc,break_minutes:v.break_minutes}:z.schedule?{start_time_utc:z.schedule.start_time_utc,end_time_utc:z.schedule.end_time_utc,break_minutes:z.schedule.break_minutes||0}:void 0}});H.data.status==="success"?(E({isVisible:!0,message:H.data.message||"Event updated successfully",type:"success"}),T(),N()):E({isVisible:!0,message:H.data.message||"Failed to update event",type:"error"})}catch(z){console.error("Failed to update event:",z);const H=(i=z==null?void 0:z.response)==null?void 0:i.data;if((H==null?void 0:H.status)==="validation_error"&&((b=(p=H==null?void 0:H.data)==null?void 0:p.conflicts)!=null&&b.length)){const se=H.data.conflicts.map(le=>{const ge=new Date(le.conflicting_shift_start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),ne=new Date(le.conflicting_shift_end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});return`${le.worker_name} conflicts with ${le.conflicting_event_title} (${ge} â€“ ${ne})`});E({isVisible:!0,message:`Can't save changes: ${se.length} worker${se.length!==1?"s":""} would be double-booked
â€¢ `+se.join(`
â€¢ `),type:"error"})}else E({isVisible:!0,message:(H==null?void 0:H.message)||"Failed to update event",type:"error"})}finally{X(!1)}},J=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:N,disabled:D,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:q,disabled:D,className:"btn-primary",children:D?"Saving...":"Save Changes"})]});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-0 sm:p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white w-full h-full sm:h-auto sm:max-w-4xl sm:rounded-lg shadow-xl overflow-hidden flex flex-col sm:max-h-[90vh]",children:[e.jsxs("div",{className:"sticky top-0 bg-white px-4 sm:px-6 py-4 border-b border-gray-200 flex items-center justify-between z-10",children:[e.jsxs("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-gray-900 truncate",children:["Edit Event: ",o.title]}),e.jsx("button",{onClick:N,className:"p-2 text-gray-400 hover:text-gray-600 min-h-touch min-w-touch","aria-label":"Close",children:e.jsx(je,{className:"h-5 w-5 sm:h-6 sm:w-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 sm:px-6 py-4 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Event Details"}),e.jsxs("button",{onClick:K,className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-white border border-gray-300 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all shadow-sm",children:[e.jsx(qe,{size:14}),"Edit"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Venue"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:(A=o.venue)==null?void 0:A.name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:o.schedule&&new Date(o.schedule.start_time_utc).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"space-y-1 md:col-span-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Location"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900 leading-relaxed",children:(y=o.venue)==null?void 0:y.formatted_address})]}),e.jsxs("div",{className:"space-y-1 md:col-start-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Time"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:o.schedule&&e.jsxs(e.Fragment,{children:[new Date(o.schedule.start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})," - ",new Date(o.schedule.end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})]})})]}),e.jsx("div",{})]})]}),e.jsxs("div",{className:"col-span-2 bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 uppercase tracking-wide",children:"Event Schedule"}),e.jsx("button",{type:"button",onClick:()=>W(!U),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:U?"Cancel":"Edit Schedule"})]}),U?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Start Time"}),e.jsx("input",{type:"datetime-local",value:v!=null&&v.start_time_utc?new Date(v.start_time_utc).toISOString().slice(0,16):"",onChange:r=>S(i=>i?{...i,start_time_utc:new Date(r.target.value).toISOString()}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"End Time"}),e.jsx("input",{type:"datetime-local",value:v!=null&&v.end_time_utc?new Date(v.end_time_utc).toISOString().slice(0,16):"",onChange:r=>S(i=>i?{...i,end_time_utc:new Date(r.target.value).toISOString()}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Break Minutes"}),e.jsx("input",{type:"number",min:"0",value:(v==null?void 0:v.break_minutes)||0,onChange:r=>S(i=>i?{...i,break_minutes:parseInt(r.target.value)||0}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3",children:e.jsx("p",{className:"text-xs text-blue-800",children:"âš ï¸ Changing schedule times will update ALL shifts and worker schedules for this event."})})]}):e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:o.schedule&&new Date(o.schedule.start_time_utc).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Time"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:v&&e.jsxs(e.Fragment,{children:[new Date(v.start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})," -",new Date(v.end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})]})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Break"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[(v==null?void 0:v.break_minutes)||0," minutes"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"Roles"}),e.jsxs("button",{onClick:n,className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white text-sm font-semibold rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(Te,{size:16}),"Add Role"]})]}),m.map((r,i)=>{var p;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[e.jsxs("div",{className:"flex-1 relative overflow-visible",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Role Name *"}),e.jsxs("div",{className:"relative",style:{zIndex:x===i?1e3:1},children:[e.jsxs("button",{type:"button",onClick:()=>Q(x===i?null:i),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white text-left flex items-center justify-between",children:[r.skill_name?e.jsxs("div",{className:"flex items-center gap-2",children:[((p=B.find(b=>b.name===r.skill_name))==null?void 0:p.icon)&&e.jsx("img",{src:B.find(b=>b.name===r.skill_name).icon,alt:r.skill_name,className:"w-5 h-5"}),e.jsx("span",{className:"text-gray-900",children:r.skill_name})]}):e.jsx("span",{className:"text-gray-400",children:"Pick the Skills the Worker Has"}),e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M19 9l-7 7-7-7"})})]}),x===i&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border-2 border-gray-200 rounded-xl shadow-2xl z-[9999] max-h-[300px] overflow-y-auto w-full min-w-max",children:B.filter(b=>!m.some((z,H)=>H!==i&&z.skill_name===b.name)).map(b=>e.jsxs("div",{onClick:()=>R(i,b.name),className:"flex items-center gap-3 px-4 py-3 cursor-pointer hover:bg-teal-50 border-b border-gray-100 last:border-0",children:[e.jsx("img",{src:b.icon,width:"24",height:"24",alt:b.name,className:"flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:b.name})]},b.name))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Needed Workers *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>k(i,"needed_workers",Math.max(1,r.needed_workers-1)),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"-"}),e.jsx("input",{type:"number",value:r.needed_workers,onChange:b=>k(i,"needed_workers",parseInt(b.target.value)||1),min:"1",className:"w-16 px-2 py-2 border border-gray-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-teal-500 font-medium"}),e.jsx("button",{onClick:()=>k(i,"needed_workers",r.needed_workers+1),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"+"}),e.jsx("button",{onClick:()=>f(i),className:"ml-2 w-8 h-8 flex items-center justify-center text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove role",children:e.jsx(Qe,{size:18})})]})]})]}),(()=>{var H;const b=(H=o==null?void 0:o.shifts_by_role)==null?void 0:H[i],z=(b==null?void 0:b.assigned_workers)||(b==null?void 0:b.filled_shifts)||0;return z>0?e.jsxs("div",{className:"text-sm text-amber-600 font-semibold bg-amber-50 px-3 py-2 rounded-lg",children:[z," worker(s) assigned"]}):null})()]},i)})]})]}),e.jsx("div",{className:"sticky bottom-0 bg-white px-4 sm:px-6 py-4 border-t border-gray-200 flex flex-col sm:flex-row gap-3 sm:justify-end z-10",children:J})]})}),e.jsx(Re,{isVisible:w.isVisible,message:w.message,type:w.type,onClose:()=>E({...w,isVisible:!1})})]})}function gs({event:a,isOpen:u,onClose:N,onSuccess:T}){var ye,fe,be;const[l,d]=c.useState([]),[j,m]=c.useState(null),[L,D]=c.useState(!1),[X,ie]=c.useState(null),[Z,re]=c.useState(""),[ee,x]=c.useState(!1),[Q,w]=c.useState(!1),[E,v]=c.useState({}),[S,U]=c.useState(!1),[W,M]=c.useState(new Set),[K,B]=c.useState({isVisible:!1,message:"",type:"success"}),[V,o]=c.useState({open:!1,title:"",variant:"default"}),[k,n]=c.useState({});c.useEffect(()=>{u&&a&&(f(),M(new Set),n({}))},[u,a]);const f=async()=>{var s,g;if(a!=null&&a.id){D(!0);try{const _=await G.get(`/events/${a.id}/approvals`),$=_.data.data.assignments||[],P=Array.from(new Map($.map(t=>[t.id,t])).values()),O=Array.from(new Map(P.map(t=>[`${t.shift_id}-${t.worker_id}`,t])).values()),F=Array.from(new Map(O.sort((t,h)=>h.id-t.id).map(t=>[`${t.worker_id}-${t.shift_role}-${t.scheduled_start}-${t.scheduled_end}`,t])).values());console.log(`Loaded ${$.length} assignments, deduplicated to ${F.length}`,{before:$.length,afterById:P.length,afterByShiftWorker:O.length,final:F.length}),d(F),m(_.data.data.cost_summary||null)}catch(_){console.error("Error loading assignments:",_),B({isVisible:!0,type:"error",message:((g=(s=_.response)==null?void 0:s.data)==null?void 0:g.error)||_.message||"Unable to load assignments for approval"}),d([]),m(null)}finally{D(!1)}}},R=s=>{var O;const g=k[s.id]||{},_=g.timeIn||s.scheduled_start,$=g.timeOut||s.scheduled_end,P=g.breakMinutes??(((O=a==null?void 0:a.schedule)==null?void 0:O.break_minutes)||0);if(s.status==="no_show"||s.status==="cancelled"||s.status==="removed")return 0;try{const F=new Date(_),C=(new Date($).getTime()-F.getTime())/(1e3*60*60),I=P/60;return Math.max(0,C-I)}catch(F){return console.error("Error calculating hours:",F),s.effective_hours||0}},q=s=>{const g=k[s.id]||{},_=R(s),$=g.hourlyRate??s.effective_hourly_rate;return _*$},J=s=>{try{const g=new Date(s),_=g.getHours().toString().padStart(2,"0"),$=g.getMinutes().toString().padStart(2,"0");return`${_}:${$}`}catch(g){return console.error("Error formatting time:",g),"09:00"}},A=(s,g,_)=>{const $=l.find(P=>P.id===s);if($){if(g==="timeIn"||g==="timeOut"){const[P,O]=_.split(":").map(Number),F=g==="timeIn"?new Date($.scheduled_start):new Date($.scheduled_end);F.setHours(P,O,0,0),_=F.toISOString()}n(P=>({...P,[s]:{...P[s],[g]:_}}))}},y=async()=>{var g,_;const s=Object.keys(k).map(Number);if(s.length!==0){x(!0);try{await Promise.all(s.map(async $=>{var Y;const P=l.find(te=>te.id===$);if(!P)return;const O=k[$],F=O.timeIn||P.scheduled_start,t=O.timeOut||P.scheduled_end,h=O.breakMinutes??(((Y=a==null?void 0:a.schedule)==null?void 0:Y.break_minutes)||0),I={hours_worked:R(P)};return O.hourlyRate!==void 0&&(I.hourly_rate=O.hourlyRate),O.notes!==void 0&&(I.approval_notes=O.notes),G.patch(`/approvals/${$}/update_hours`,I)})),B({isVisible:!0,type:"success",message:`Saved changes for ${s.length} assignment(s)`}),await f(),n({})}catch($){console.error("Error saving changes:",$),B({isVisible:!0,type:"error",message:((_=(g=$.response)==null?void 0:g.data)==null?void 0:_.message)||"Failed to save changes"})}finally{x(!1)}}},r=async s=>{var g,_;try{await G.post(`/events/${a.id}/approve_selected`,{assignment_ids:[s]}),await f(),T(),B({isVisible:!0,type:"success",message:"Assignment approved"})}catch($){console.error("Error approving assignment:",$),B({isVisible:!0,type:"error",message:((_=(g=$.response)==null?void 0:g.data)==null?void 0:_.message)||"Failed to approve assignment"})}},i=l.filter(s=>!s.approved&&s.can_approve&&s.status!=="no_show"&&s.status!=="cancelled"),p=i.filter(s=>W.has(s.id)),b=s=>{M(g=>{const _=new Set(g);return _.has(s)?_.delete(s):_.add(s),_})},z=()=>{p.length===i.length&&i.length>0?M(new Set):M(new Set(i.map(s=>s.id)))},H=async()=>{const s=i.length;o({open:!0,title:"Approve All Hours",message:`Approve hours for all ${s} eligible workers?`,onConfirm:async()=>{var g,_;U(!0);try{await G.post(`/events/${a.id}/approve_all`),await f(),M(new Set),T(),B({isVisible:!0,type:"success",message:`Approved ${s} assignments`})}catch($){console.error("Error approving all:",$),B({isVisible:!0,type:"error",message:((_=(g=$.response)==null?void 0:g.data)==null?void 0:_.message)||"Failed to approve all hours"})}finally{U(!1),o({open:!1,title:""})}}})};if(!u)return null;const se=l,le=l.filter(s=>s.status!=="no_show"&&s.status!=="cancelled"&&s.status!=="removed");l.filter(s=>s.status==="no_show"),l.filter(s=>s.status==="cancelled"||s.status==="removed"),le.filter(s=>!s.approved).length,le.filter(s=>s.approved).length,le.length,se.length,le.filter(s=>!s.approved).reduce((s,g)=>s+Number(g.effective_pay||0),0),le.filter(s=>s.approved).reduce((s,g)=>s+Number(g.effective_pay||0),0),le.reduce((s,g)=>s+Number(g.effective_hours||0),0),le.filter(s=>s.approved).reduce((s,g)=>s+Number(g.effective_hours||0),0);const ge=s=>{if(!s)return"";try{return he(ue(s),"MMM d, yyyy")}catch{return new Date(s).toLocaleDateString()}},ne=Ye.useMemo(()=>{let s=0,g=0,_=0,$=0,P=0;return l.forEach(O=>{const F=R(O),t=q(O);s+=F,g+=t,O.approved&&(_+=t,$++),(O.status==="no_show"||O.status==="cancelled"||O.status==="removed")&&P++}),{totalHours:s.toFixed(2),totalPay:g.toFixed(2),approvedPay:_.toFixed(2),approvedCount:$,deniedCount:P,pendingCount:l.length-$-P}},[l,k,(ye=a==null?void 0:a.schedule)==null?void 0:ye.break_minutes]);return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-0 sm:p-4 overflow-y-auto",children:[e.jsx(Re,{isVisible:K.isVisible,message:K.message,type:K.type,onClose:()=>B({...K,isVisible:!1})}),e.jsxs("div",{className:"bg-white w-full h-full sm:h-auto sm:max-w-7xl sm:rounded-lg shadow-xl overflow-hidden flex flex-col sm:max-h-[90vh] my-0 sm:my-4",children:[e.jsxs("header",{className:"border-b px-6 py-4 bg-white flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Approve Hours"}),e.jsxs("div",{className:"mt-1.5 flex flex-wrap items-center gap-3 text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium text-gray-900",children:a==null?void 0:a.title}),((fe=a==null?void 0:a.schedule)==null?void 0:fe.start_time_utc)&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($e,{className:"h-3.5 w-3.5 text-gray-400"}),he(ue(a.schedule.start_time_utc),"MMM d, yyyy")]}),((be=a==null?void 0:a.venue)==null?void 0:be.name)&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ke,{className:"h-3.5 w-3.5 text-gray-400"}),a.venue.name]})]})]}),e.jsx("button",{onClick:N,className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close modal",children:e.jsx(je,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"mt-4 flex gap-6 text-sm",children:[e.jsxs("span",{className:"text-green-600 font-medium",children:[ne.approvedCount," Approved"]}),e.jsxs("span",{className:"text-red-600 font-medium",children:[ne.deniedCount," Denied"]}),e.jsxs("span",{className:"text-amber-600 font-medium",children:[ne.pendingCount," Pending"]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto px-3 sm:px-6 py-4",children:L?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading assignments..."})]}):l.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Se,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No assignments found for this event."})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:e.jsxs("tr",{className:"text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:[e.jsx("th",{className:"px-4 py-3 w-10",children:i.length>0&&e.jsx("input",{type:"checkbox",checked:p.length===i.length&&i.length>0,onChange:z,className:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded cursor-pointer",title:p.length===i.length?"Deselect all":"Select all"})}),e.jsx("th",{className:"px-4 py-3",children:"Name"}),e.jsx("th",{className:"px-4 py-3",children:"Position"}),e.jsx("th",{className:"px-4 py-3",children:"Date"}),e.jsx("th",{className:"px-4 py-3 w-24",children:"Time In"}),e.jsx("th",{className:"px-4 py-3 w-24",children:"Time Out"}),e.jsx("th",{className:"px-4 py-3 w-20",children:"Break"}),e.jsx("th",{className:"px-4 py-3 w-20",children:"Total"}),e.jsx("th",{className:"px-4 py-3 w-24",children:"Rate"}),e.jsx("th",{className:"px-4 py-3 w-28",children:"Pay"}),e.jsx("th",{className:"px-4 py-3 w-32",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map(s=>{var O;const g=k[s.id]||{},_=R(s),$=q(s),P=!s.approved&&s.can_approve&&s.status!=="no_show"&&s.status!=="cancelled";return e.jsxs("tr",{className:we("hover:bg-gray-50 transition-colors",s.approved&&"bg-green-50",s.status==="no_show"&&"bg-red-50"),children:[e.jsx("td",{className:"px-4 py-3",children:P&&e.jsx("input",{type:"checkbox",checked:W.has(s.id),onChange:()=>b(s.id),className:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded cursor-pointer"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{name:s.worker_name,src:s.worker_profile_photo_url,size:32}),e.jsx("div",{children:e.jsx("div",{className:we("font-medium text-gray-900",(s.status==="cancelled"||s.status==="removed")&&"line-through text-gray-500",s.status==="no_show"&&"text-gray-700"),children:s.worker_name})})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:s.shift_role||"N/A"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:ge(s.shift_date||s.scheduled_start)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"time",value:J(g.timeIn||s.scheduled_start),onChange:F=>A(s.id,"timeIn",F.target.value),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-teal-500 focus:border-transparent"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"time",value:J(g.timeOut||s.scheduled_end),onChange:F=>A(s.id,"timeOut",F.target.value),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-teal-500 focus:border-transparent"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"number",min:"0",step:"15",value:g.breakMinutes??(((O=a==null?void 0:a.schedule)==null?void 0:O.break_minutes)||0),onChange:F=>A(s.id,"breakMinutes",parseInt(F.target.value)||0),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-teal-500 focus:border-transparent"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-gray-900",children:[xe(_,2,"0.00"),"h"]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-2 top-1 text-gray-500 text-sm",children:"$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:g.hourlyRate??s.effective_hourly_rate,onChange:F=>A(s.id,"hourlyRate",parseFloat(F.target.value)||0),className:"w-full pl-6 pr-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-bold text-gray-900",children:["$",xe($,2,"0.00")]}),e.jsx("td",{className:"px-4 py-3",children:s.approved?e.jsxs("div",{className:"flex items-center gap-1 text-green-600 text-sm font-medium",children:[e.jsx(Ce,{className:"h-4 w-4"}),"Approved"]}):s.status==="no_show"?e.jsx("div",{className:"text-red-600 text-sm font-medium",children:"No Show"}):e.jsx("button",{onClick:()=>r(s.id),className:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 font-medium",children:"Approve"})})]},s.id)})})]})}),e.jsxs("footer",{className:"border-t bg-gray-50 px-6 py-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex gap-3 mb-4",children:[ne.pendingCount>0&&e.jsx("button",{onClick:H,disabled:S,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 font-medium flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:S?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"h-4 w-4 animate-spin"}),"Approving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"h-4 w-4"}),"Approve All Pending (",ne.pendingCount,")"]})}),p.length>0&&e.jsxs("button",{onClick:()=>{const s=Array.from(p.map(g=>g.id));o({open:!0,title:"Mark Selected as No-Show",message:`Mark ${s.length} selected ${s.length===1?"worker":"workers"} as no-show?`,requireNote:!0,note:"",variant:"warning",onConfirm:async g=>{var $,P;const _=g||V.note||"";o({open:!1,title:""});try{await Promise.all(s.map(O=>G.post(`/approvals/${O}/mark_no_show`,{notes:_}))),await f(),M(new Set),B({isVisible:!0,type:"success",message:`Marked ${s.length} as no-show`})}catch(O){console.error("Error marking no-show:",O),B({isVisible:!0,type:"error",message:((P=($=O.response)==null?void 0:$.data)==null?void 0:P.message)||"Failed to mark as no-show"})}}})},disabled:p.length===0,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 font-medium flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(je,{className:"h-4 w-4"}),"Mark Selected as No-Show (",p.length,")"]}),Object.keys(k).length>0&&e.jsx("button",{onClick:y,disabled:ee,className:"px-4 py-2 bg-teal-600 text-white rounded-md hover:bg-teal-700 font-medium flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:ee?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"h-4 w-4"}),"Save All Changes (",Object.keys(k).length,")"]})})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm border-t border-gray-200 pt-4",children:[e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("span",{className:"text-gray-600",children:["Total Hours: ",e.jsx("span",{className:"font-semibold text-gray-900",children:ne.totalHours})]}),e.jsxs("span",{className:"text-gray-600",children:["Total Pay: ",e.jsxs("span",{className:"font-semibold text-gray-900",children:["$",ne.totalPay]})]}),e.jsxs("span",{className:"text-green-600",children:["Approved: ",e.jsxs("span",{className:"font-semibold",children:["$",ne.approvedPay]})]}),e.jsxs("span",{className:"text-amber-600",children:["Pending: ",e.jsxs("span",{className:"font-semibold",children:["$",(parseFloat(ne.totalPay)-parseFloat(ne.approvedPay)).toFixed(2)]})]})]}),e.jsx("button",{onClick:N,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 font-medium",children:"Close"})]})]})]}),V.open&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>o({open:!1,title:""})}),e.jsxs("div",{className:"relative bg-white w-full max-w-md rounded-lg shadow-xl p-5",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:V.title}),V.message&&e.jsx("p",{className:"mt-2 text-sm text-gray-700",children:V.message}),V.requireNote&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes (optional)"}),e.jsx("textarea",{value:V.note||"",onChange:s=>o(g=>({...g,note:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]}),e.jsxs("div",{className:"mt-5 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>o({open:!1,title:""}),className:"px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-200",children:"Cancel"}),e.jsx("button",{onClick:async()=>{const s=V.note||"";V.onConfirm&&await V.onConfirm(s)},className:"px-4 py-2 text-white text-sm font-medium rounded-md "+(V.variant==="danger"?"bg-red-600 hover:bg-red-700":V.variant==="warning"?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:"Confirm"})]})]})]})]})}function ce({className:a="",count:u=1}){return e.jsx(e.Fragment,{children:Array.from({length:u}).map((N,T)=>e.jsx("div",{className:`animate-pulse bg-gray-200 rounded-lg ${a}`},T))})}function Fe(){return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(ce,{className:"h-6 w-48 mb-2"}),e.jsx(ce,{className:"h-4 w-32"})]}),e.jsx(ce,{className:"h-8 w-8 rounded-full"})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4 rounded"}),e.jsx(ce,{className:"h-4 w-40"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4 rounded"}),e.jsx(ce,{className:"h-4 w-36"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4 rounded"}),e.jsx(ce,{className:"h-4 w-32"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(ce,{className:"h-2 w-full rounded-full mb-2"}),e.jsx(ce,{className:"h-3 w-24"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ce,{className:"h-9 w-24 rounded-md"}),e.jsx(ce,{className:"h-9 w-24 rounded-md"})]})]})})}function fs(a,u=500){const[N,T]=c.useState(a);return c.useEffect(()=>{const l=setTimeout(()=>{T(a)},u);return()=>{clearTimeout(l)}},[a,u]),N}const ze=a=>{var l,d;if(a.cost_summary){const{all_approved:j,total_count:m=0,pending_count:L=0}=a.cost_summary,D=m>0||(a.assigned_workers_count??0)>0;if(typeof j=="boolean"&&j||L===0&&D)return!0}if(a.approval_status){const{total:j=0,pending:m=0}=a.approval_status,L=j>0||(((l=a.cost_summary)==null?void 0:l.total_count)??0)>0||(a.assigned_workers_count??0)>0;if(m===0&&L)return!0}const u=((d=a.shifts_by_role)==null?void 0:d.flatMap(j=>j.shifts||[]))||[];if(!(Array.isArray(u)&&u.length>0))return!1;const T=u.flatMap(j=>j.assignments||[]);return T.length===0?!1:T.every(j=>j.approved===!0||j.status==="no_show"||j.status==="cancelled"||j.status==="removed"||j.status==="denied"||j.denied===!0)},ps=a=>{var T,l,d;if(((T=a.approval_status)==null?void 0:T.pending)!==void 0)return a.approval_status.pending;if(((l=a.cost_summary)==null?void 0:l.pending_count)!==void 0)return a.cost_summary.pending_count;const u=((d=a.shifts_by_role)==null?void 0:d.flatMap(j=>j.shifts||[]))||[];if(u.length===0)return 0;const N=u.flatMap(j=>j.assignments||[]);return N.length===0?0:N.filter(j=>!(j.approved===!0||j.status==="no_show"||j.status==="cancelled"||j.status==="removed"||j.status==="denied"||j.denied===!0)).length},Le=a=>{const u=a.schedule||a.event_schedule||{},N=u.start_time_utc||u.start_time||a.start_time_utc,T=u.end_time_utc||u.end_time||a.end_time_utc;return{start:N,end:T}},Be=(a,u=new Date)=>{const{end:N}=Le(a);if(!N)return!1;try{const T=new Date(N);return isNaN(T.getTime())?!1:T<u}catch{return console.warn("Invalid end time for event:",a.id,N),!1}},ys=a=>a.status==="published"&&!Be(a),bs=a=>a.status==="archived"||a.status==="completed"||a.status==="published"&&Be(a);function Hs(){const a=We(),[u,N]=Ge(),T=(u.get("tab")==="completed"?"completed":u.get("tab"))||"active",l=u.get("filter")||"all",[d,j]=c.useState(T),[m,L]=c.useState(l),[D,X]=c.useState(""),ie=fs(D,500),[Z,re]=c.useState("date"),[ee,x]=c.useState(!0),[Q,w]=c.useState([]),[E,v]=c.useState(new Set),[S,U]=c.useState(new Set),[W,M]=c.useState({isOpen:!1}),[K,B]=c.useState({isOpen:!1}),[V,o]=c.useState({isVisible:!1,message:"",type:"success"}),[k,n]=c.useState({isOpen:!1,isLoading:!1}),[f,R]=c.useState({isOpen:!1,isLoading:!1}),[q,J]=c.useState({isOpen:!1,isLoading:!1}),[A,y]=c.useState({isOpen:!1,unfilledShiftIds:[]}),[r,i]=c.useState({isOpen:!1});c.useEffect(()=>{p()},[d,m,u]),c.useEffect(()=>{const t=(u.get("tab")==="completed"?"completed":u.get("tab"))||"active",h=u.get("filter")||"all";t!==d&&j(t),h!==m&&L(h)},[u,d,m]),c.useEffect(()=>{const t=u.get("event_id"),h=u.get("shift_id");if(t){const C=parseInt(t);isNaN(C)||(v(new Set([C])),h&&console.log(`Auto-expanding event ${C} with shift ${h}`))}},[u]),c.useEffect(()=>{const t=u.get("event_id");if(!t)return;const h=parseInt(t);if(isNaN(h))return;const C=Q.find(I=>I.id===h);C&&(!C.shifts_by_role||C.shifts_by_role.length===0)&&(H(h),v(new Set([h])))},[u,Q]);async function p(){x(!0);try{const t=d==="completed"?"completed":d,h=u.get("date");let C=`/events?tab=${t}`;m!=="all"&&(d==="active"||d==="draft")&&(C+=`&filter=${m}`),h&&(C+=`&date=${h}`),console.log("Loading events with URL:",C,"filterStatus:",m,"date:",h);const I=await G.get(C);if(I.data.status==="success"){console.log("Received events:",I.data.data.length);const Y=I.data.data;if(d==="completed"){const te=await Promise.all(Y.map(async oe=>{var me;try{const ae=await G.get(`/events/${oe.id}/approvals`);if(((me=ae.data)==null?void 0:me.status)==="success"){const de=ae.data.data.assignments||[],Ne=de.length,ve=de.filter(Xe=>Xe.approved).length,Je=ae.data.data.cost_summary||null;return{...oe,approval_status:{total:Ne,approved:ve,pending:Ne-ve},cost_summary:Je}}}catch(ae){console.warn(`Failed to load approval status for event ${oe.id}:`,ae)}return oe}));w(te)}else{const te=Array.from(E);w(oe=>{const me=new Map(oe.map(ae=>[ae.id,ae]));return Y.map(ae=>{const de=me.get(ae.id);return te.includes(ae.id)&&(de!=null&&de.shifts_by_role)&&de.shifts_by_role.length>0?{...ae,shifts_by_role:de.shifts_by_role,full_details:de.full_details||de}:ae})}),te.length>0&&Promise.all(te.map(oe=>H(oe))).catch(oe=>{console.error("Failed to refresh expanded event details:",oe)})}}}catch(t){console.error("Failed to load events:",t),Q.length===0&&w([])}finally{x(!1)}}const b=t=>{j(t),N({tab:t}),L(t==="active"?"needs_workers":"all")},z=t=>{L(t);const h=new URLSearchParams;h.set("tab",d),t!=="all"&&h.set("filter",t),N(h)},H=async t=>{var h,C;U(I=>new Set(I).add(t));try{const[I,Y]=await Promise.all([G.get(`/events/${t}`),G.get(`/events/${t}/approvals`).catch(()=>null)]);if(((h=I.data)==null?void 0:h.status)==="success"){const te=I.data.data;if(((C=Y==null?void 0:Y.data)==null?void 0:C.status)==="success"){const oe=Y.data.data.assignments||[],me=new Map(oe.map(ae=>[ae.id,ae]));te.shifts_by_role&&(te.shifts_by_role=te.shifts_by_role.map(ae=>({...ae,shifts:ae.shifts.map(de=>({...de,assignments:de.assignments.map(Ne=>{const ve=me.get(Ne.id);return ve&&typeof ve=="object"?{...Ne,...ve}:Ne})}))})))}w(oe=>oe.map(me=>me.id===t?{...me,...te}:me))}}catch(I){console.error("Failed to load event details",I)}finally{U(I=>{const Y=new Set(I);return Y.delete(t),Y})}},se=t=>{const h=new Set(E);if(h.has(t))h.delete(t),U(C=>{const I=new Set(C);return I.delete(t),I});else{h.add(t);const C=Q.find(te=>te.id===t),I=S.has(t),Y=(C==null?void 0:C.shifts_by_role)&&C.shifts_by_role.length>0;!I&&!Y&&H(t)}v(h)};async function le(t){const h=Q==null?void 0:Q.find(C=>C.id===t);J({isOpen:!0,isLoading:!1,eventId:t,eventTitle:h==null?void 0:h.title})}async function ge(){if(q.eventId){J(t=>({...t,isLoading:!0}));try{const t=await G.delete(`/events/${q.eventId}`);t.data.status==="success"?(J({isOpen:!1,isLoading:!1}),o({isVisible:!0,message:`"${t.data.event_title}" moved to trash`,type:"success",action:{label:"Undo",onClick:()=>ne(t.data.event_id),variant:"primary"}}),p()):o({isVisible:!0,message:t.data.message||"Unable to delete event",type:"error"})}catch(t){console.error("Failed to delete event:",t),o({isVisible:!0,message:"Unable to delete event",type:"error"})}finally{J(t=>({...t,isLoading:!1}))}}}async function ne(t){try{const h=await G.post(`/events/${t}/restore`);h.data.status==="success"?(o({isVisible:!0,message:"Event restored to draft",type:"success"}),p()):o({isVisible:!0,message:h.data.message||"Unable to restore event",type:"error"})}catch(h){console.error("Failed to restore event:",h),o({isVisible:!0,message:"Unable to restore event",type:"error"})}}function ye(){J({isOpen:!1,isLoading:!1})}function fe(t){n({isOpen:!0,eventId:t,isLoading:!1})}async function be(){if(k.eventId){n(t=>({...t,isLoading:!0}));try{const t=await G.post(`/events/${k.eventId}/publish`);t.data.status==="success"?(o({isVisible:!0,message:"Event published successfully",type:"success"}),n({isOpen:!1,isLoading:!1}),p()):(o({isVisible:!0,message:t.data.message||"Unable to publish event",type:"error"}),n({isOpen:!1,isLoading:!1}))}catch(t){console.error("Failed to publish event:",t),o({isVisible:!0,message:"Unable to publish event",type:"error"}),n({isOpen:!1,isLoading:!1})}}}function s(){n({isOpen:!1,isLoading:!1})}function g(t,h){R({isOpen:!0,assignmentId:t,isLoading:!1,workerName:h})}async function _(){var t,h;if(f.assignmentId){R(C=>({...C,isLoading:!0}));try{const C=await G.delete(`/staffing/${f.assignmentId}`);((t=C.data)==null?void 0:t.status)==="success"?(o({isVisible:!0,message:"Worker unassigned successfully",type:"success"}),R({isOpen:!1,isLoading:!1}),p()):(o({isVisible:!0,message:((h=C.data)==null?void 0:h.message)||"Unable to unassign worker",type:"error"}),R({isOpen:!1,isLoading:!1}))}catch(C){console.error("Failed to unassign worker:",C),o({isVisible:!0,message:"Unable to unassign worker",type:"error"}),R({isOpen:!1,isLoading:!1})}}}const $=(t,h)=>{B({isOpen:!0,shiftId:t,suggestedPayRate:h})},P=()=>{B({isOpen:!1})},O=()=>{P(),o({isVisible:!0,message:"Worker assigned",type:"success"}),p()},F=c.useMemo(()=>Q.filter(t=>{var h,C,I;if(ie){const Y=ie.toLowerCase();if(!(((h=t.title)==null?void 0:h.toLowerCase().includes(Y))||((I=(C=t.venue)==null?void 0:C.name)==null?void 0:I.toLowerCase().includes(Y))))return!1}if(d==="active"){if(!ys(t))return!1;if(m&&m!=="all")switch(m){case"needs_workers":return t.unfilled_roles_count>0;case"partially_filled":return t.unfilled_roles_count>0&&t.assigned_workers_count>0;case"fully_staffed":return t.unfilled_roles_count===0&&t.assigned_workers_count>0;default:return!0}}return!(d==="completed"&&!bs(t))}).sort((t,h)=>{switch(Z){case"name":return t.title.localeCompare(h.title);case"staffing":return t.staffing_percentage-h.staffing_percentage;case"date":default:const C=Le(t),I=Le(h),Y=C.start||C.end||t.created_at,te=I.start||I.end||h.created_at;return!Y&&!te?0:Y?te?new Date(Y).getTime()-new Date(te).getTime():-1:1}}),[Q,d,m,ie,Z]);return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold text-gray-900",children:"Events"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage events and assign workers"})]}),e.jsxs("button",{onClick:()=>a("/events/create"),className:"w-full sm:w-auto inline-flex items-center justify-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors shadow-sm min-h-touch",children:[e.jsx(Te,{size:20}),"Create New Event"]})]}),u.get("date")&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-teal-50 border border-teal-200 rounded-lg",children:[e.jsx(Ee,{size:16,className:"text-teal-600"}),e.jsxs("span",{className:"text-sm font-medium text-teal-900",children:["Showing events for ",he(ue(u.get("date")),"EEEE, MMMM d, yyyy")]}),e.jsx("button",{onClick:()=>{const t=new URLSearchParams(u);t.delete("date"),N(t)},className:"ml-auto text-teal-600 hover:text-teal-700",title:"Clear date filter",children:e.jsx(je,{size:16})})]})]}),e.jsxs("div",{className:"flex gap-6 border-b border-gray-200 mb-6",children:[e.jsx("button",{onClick:()=>b("draft"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${d==="draft"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Draft Events"}),e.jsx("button",{onClick:()=>b("active"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${d==="active"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Active Events"}),e.jsx("button",{onClick:()=>b("completed"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${d==="completed"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Completed Events"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-3 sm:gap-4 mb-6",children:[e.jsxs("div",{className:"w-full md:flex-1 md:max-w-md relative",children:[e.jsx(Pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search events or venues...",value:D,onChange:t=>X(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),e.jsxs("select",{value:Z,onChange:t=>re(t.target.value),className:"w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"name",children:"Sort by Name"}),d!=="draft"&&e.jsx("option",{value:"staffing",children:"Sort by Staffing"})]}),d==="active"&&e.jsxs("div",{className:"w-full sm:w-auto flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>z("all"),className:`w-full sm:w-auto px-3 py-2 text-sm font-medium rounded-lg transition ${m==="all"?"bg-gray-100 text-gray-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"All"}),e.jsx("button",{onClick:()=>z("needs_workers"),className:`w-full sm:w-auto px-3 py-2 text-sm font-medium rounded-lg transition ${m==="needs_workers"?"bg-red-100 text-red-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Needs Workers"}),e.jsx("button",{onClick:()=>z("fully_staffed"),className:`w-full sm:w-auto px-3 py-2 text-sm font-medium rounded-lg transition ${m==="fully_staffed"?"bg-green-100 text-green-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Ready"})]})]}),ee?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Fe,{}),e.jsx(Fe,{}),e.jsx(Fe,{})]}):e.jsxs(e.Fragment,{children:[d==="draft"&&e.jsx(js,{events:F,onDelete:le,onPublish:fe,onNavigate:t=>a(t),searchQuery:D}),d==="active"&&e.jsx(Ns,{events:F,expandedEvents:E,loadingEventDetails:S,onToggleEvent:se,onAssignWorker:$,onUnassign:g,onQuickFill:(t,h,C,I)=>y({isOpen:!0,eventId:t,roleName:h,unfilledShiftIds:C,payRate:I}),onPublish:fe,onDelete:le,onEdit:t=>i({isOpen:!0,event:t}),searchQuery:D}),d==="completed"&&e.jsx(vs,{events:F,searchQuery:D,onApproveHours:t=>M({isOpen:!0,event:t})})]})]}),K.isOpen&&K.shiftId&&e.jsx(us,{shiftId:K.shiftId,suggestedPayRate:K.suggestedPayRate,onClose:P,onSuccess:O}),e.jsx(Re,{isVisible:V.isVisible,message:V.message,type:V.type,action:V.action,onClose:()=>o({...V,isVisible:!1})}),e.jsx(Ae,{isOpen:k.isOpen,onClose:s,onConfirm:be,title:"Publish Event",message:"Ready to publish? This will create shifts and make them available for worker assignment.",confirmText:k.isLoading?"Publishingâ€¦":"Publish",cancelText:"Cancel",isLoading:k.isLoading,isDestructive:!1}),e.jsx(Ae,{isOpen:f.isOpen,onClose:()=>R({isOpen:!1,isLoading:!1}),onConfirm:_,title:"Unassign Worker",message:`Remove ${f.workerName||"this worker"} from this shift?`,confirmText:f.isLoading?"Removingâ€¦":"Unassign",cancelText:"Cancel",isLoading:f.isLoading,isDestructive:!0}),e.jsx(Ae,{isOpen:q.isOpen,onClose:ye,onConfirm:ge,title:"Delete Event",message:`Delete "${q.eventTitle}"? This action cannot be undone.`,confirmText:q.isLoading?"Deletingâ€¦":"Delete",cancelText:"Cancel",isLoading:q.isLoading,isDestructive:!0}),e.jsx(xs,{isOpen:A.isOpen,eventId:A.eventId||0,roleName:A.roleName||"",unfilledShiftIds:A.unfilledShiftIds,defaultPayRate:A.payRate,onClose:()=>y({isOpen:!1,unfilledShiftIds:[]}),onDone:({assigned:t,conflicts:h,details:C})=>{y({isOpen:!1,unfilledShiftIds:[]});let I=`Assigned ${t} workers â€¢ ${h} skipped`;h>0&&C&&(I+=`: ${C}`),o({isVisible:!0,message:I,type:h>0?"error":"success"}),p()}}),r.event&&e.jsx(hs,{event:r.event,isOpen:r.isOpen,onClose:()=>i({isOpen:!1,event:void 0}),onSuccess:()=>{p(),i({isOpen:!1,event:void 0})}}),W.isOpen&&W.event&&e.jsx(gs,{event:W.event,isOpen:W.isOpen,onClose:()=>{M({isOpen:!1}),p()},onSuccess:()=>{p(),M({isOpen:!1})}})]})}function js({events:a,onDelete:u,onPublish:N,onNavigate:T,searchQuery:l}){const d=m=>{if(!m)return"No date set";const L=ue(m);return he(L,"MMM d, yyyy")},j=m=>{if(!m)return"";const L=ue(m);return he(L,"h:mm a")};return a.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:l?"No draft events found":"No draft events yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:l?"Try adjusting your search query":"Create your first event to get started"}),!l&&e.jsxs("button",{onClick:()=>T("/events/create"),className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:[e.jsx(Te,{size:20}),"Create Event"]})]}):e.jsx("div",{className:"space-y-4",children:a.map(m=>{var L;return e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[m.title,m.schedule&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-600",children:["â€¢ ",j(m.schedule.start_time_utc),"â€“",j(m.schedule.end_time_utc)]})]})}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Draft"})]}),m.venue&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[e.jsx(ke,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:((L=m.venue)==null?void 0:L.name)||"No venue"})]}),m.schedule&&e.jsx("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{children:d(m.schedule.start_time_utc)})]})}),m.total_workers_needed>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(De,{size:16,className:"text-gray-400"}),e.jsxs("span",{children:[m.total_workers_needed," workers needed"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>T(`/events/${m.id}/edit`),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Edit",children:e.jsx(qe,{size:18})})})]})})},m.id)})})}function Ns({events:a,expandedEvents:u,loadingEventDetails:N,onToggleEvent:T,onAssignWorker:l,onUnassign:d,onQuickFill:j,onPublish:m,onDelete:L,onEdit:D,searchQuery:X}){const ie=x=>{const Q=ue(x);return he(Q,"EEE, MMM d, yyyy")},Z=x=>{const Q=ue(x);return he(Q,"h:mm a")},re=x=>{if(!x.schedule)return!1;const w=(ue(x.schedule.start_time_utc).getTime()-new Date().getTime())/(1e3*60*60);return w>0&&w<=48},ee=x=>{switch(x){case"fully_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[e.jsx(_e,{size:14}),"Ready"]});case"partially_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full",children:[e.jsx(Se,{size:14}),"Partial"]});case"needs_workers":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[e.jsx(je,{size:14}),"Needs Workers"]});default:return null}};return a.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:X?"No active events found":"No active events"}),e.jsx("p",{className:"text-gray-600",children:X?"Try adjusting your search query or filters":"Publish draft events to see them here"})]}):e.jsx("div",{className:"space-y-4",children:a.map(x=>{const Q=u.has(x.id);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-5 hover:border-gray-300 hover:shadow-sm transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1 truncate",children:x.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 flex-wrap",children:[x.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ee,{className:"h-4 w-4 flex-shrink-0"}),ie(x.schedule.start_time_utc)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($e,{className:"h-4 w-4 flex-shrink-0"}),Z(x.schedule.start_time_utc)," - ",Z(x.schedule.end_time_utc),re(x)&&e.jsxs("span",{className:"bg-red-50 text-red-800 text-xs font-bold px-2.5 py-1 rounded-full ml-2 inline-flex items-center gap-1.5","aria-label":"Urgent: starts within 48 hours",children:[e.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full"}),"URGENT"]})]})]}),x.venue&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ke,{className:"h-4 w-4 flex-shrink-0"}),x.venue.name]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 ml-4",children:[ee(x.staffing_status),D&&x.status==="published"&&e.jsx("button",{onClick:w=>{w.stopPropagation(),D(x)},title:"Edit Event",className:"p-1.5 text-teal-600 hover:text-teal-700 hover:bg-teal-50 rounded transition-colors",children:e.jsx(cs,{size:14})}),L&&e.jsx("button",{onClick:w=>{w.stopPropagation(),L(x.id)},title:"Delete",className:"p-1.5 text-red-600 hover:text-red-700 hover:bg-red-50 rounded transition-colors",children:e.jsx(Qe,{size:14})}),e.jsx("button",{onClick:()=>T(x.id),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:Q?e.jsx(Ke,{size:20,className:"text-gray-600"}):e.jsx(os,{size:20,className:"text-gray-600"})})]})]}),e.jsx("div",{className:"py-3 border-y border-gray-100 space-y-2",children:(()=>{const w=x.assigned_workers_count||0,E=x.total_workers_needed||0,v=E>0?Math.round(w/E*100):0;x.unfilled_roles_count;const S=(()=>{if(x.shifts_by_role&&x.shifts_by_role.length>0){const M=x.shifts_by_role.length,K=x.shifts_by_role.filter(B=>{var o;return(o=B.shifts)==null?void 0:o.some(k=>k.assignments&&k.assignments.length>0)}).length;return{totalRoles:M,filledRoles:K}}return null})(),U=(()=>{const M=x.estimated_cost??x.total_cost??x.total_pay_amount??0;return xe(M,2,"0.00")})(),W=()=>v>=100?"bg-green-500":v>=75?"bg-amber-500":v>=50?"bg-orange-500":"bg-red-500";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 whitespace-nowrap",children:S?`${S.filledRoles} of ${S.totalRoles} roles filled`:`${w} of ${E} workers hired`}),e.jsx("div",{className:"flex-1 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:we("h-full rounded-full transition-all duration-300",W()),style:{width:`${v}%`}})}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900 whitespace-nowrap",children:[v,"%"]})]}),e.jsxs("div",{className:"text-sm font-medium text-gray-700",children:[w,"/",E," hired"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{children:"Est. Cost: "}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["$",U]})]})]})})()}),Q&&e.jsx("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:N.has(x.id)?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-teal-600 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading assignments..."})]})}):x.shifts_by_role&&x.shifts_by_role.length>0?e.jsx("div",{className:"space-y-4",children:x.shifts_by_role.map(w=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:w.role_name}),e.jsxs("span",{className:"text-sm text-gray-600",children:[w.filled_shifts,"/",w.total_shifts," hired"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[w.filled_shifts<w.total_shifts&&e.jsxs("span",{className:"px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[w.total_shifts-w.filled_shifts," needed"]}),w.filled_shifts<w.total_shifts&&e.jsx("button",{onClick:E=>{var U;E.stopPropagation();const v=w.shifts.filter(W=>W.staffing_progress.percentage<100).sort((W,M)=>new Date(W.start_time_utc).getTime()-new Date(M.start_time_utc).getTime()).map(W=>W.id),S=pe(w.pay_rate||((U=w.shifts[0])==null?void 0:U.pay_rate)||0);j(x.id,w.role_name,v,S)},className:"px-2.5 py-1 text-xs font-semibold bg-teal-600 text-white rounded hover:bg-teal-700",title:"Quick Fill by Skill",children:"Quick Fill by Skill"})]})]}),e.jsx("div",{className:"space-y-2",children:w.shifts.length===0?e.jsx("div",{className:"py-4 px-3 bg-amber-50 border border-amber-200 rounded text-center",children:e.jsx("p",{className:"text-sm text-amber-700 font-medium",children:"No shifts created yet for this role. Shifts will be generated when the event is published."})}):w.shifts.map((E,v)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 text-gray-700 rounded-md flex items-center justify-center text-xs font-medium",children:v+1}),e.jsxs("span",{className:"text-sm text-gray-700",children:[Z(E.start_time_utc)," - ",Z(E.end_time_utc)]}),E.assignments&&E.assignments.length>0&&e.jsx("div",{className:"flex flex-col gap-1.5",children:E.assignments.map(S=>{const U=`${S.worker.first_name} ${S.worker.last_name}`,W=pe(S.hourly_rate||E.pay_rate||0),M=ss(S),K=M?`${U} â€¢ $${xe(W,0,"0")}/hr â€¢ ${M}`:`${U} â€¢ $${xe(W,0,"0")}/hr`;return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:we("bg-white text-black border rounded-full px-2.5 py-1 text-sm font-medium shadow-sm max-w-[140px] truncate",S.status==="no_show"||S.status==="cancelled"||S.status==="removed"?"border-red-200 opacity-60":S.approved?"border-green-200":"border-gray-200"),title:K,children:U}),e.jsx("button",{onClick:B=>{B.stopPropagation(),d(S.id,U)},className:"w-5 h-5 flex items-center justify-center text-red-600 hover:text-red-700 hover:bg-red-50 rounded",title:"Unassign worker",children:e.jsx(je,{size:12})})]}),M&&e.jsx("div",{className:we("text-xs font-medium ml-2",S.status==="no_show"||S.status==="cancelled"||S.status==="removed"?"text-red-600":S.approved?"text-green-700":"text-gray-500"),children:M})]},S.id)})})]}),E.staffing_progress&&E.staffing_progress.percentage===100?e.jsxs("span",{className:"flex items-center gap-1.5 text-sm font-medium text-green-600",children:[e.jsx(_e,{size:16}),"Assigned"]}):e.jsx("button",{onClick:S=>{S.stopPropagation(),l(E.id,pe(w.pay_rate||E.pay_rate||0))},className:"px-3 py-1.5 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Assign Worker"})]},E.id))})]},w.role_name))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:x.status==="draft"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"This event is still in draft status"}),e.jsx("p",{className:"text-sm",children:"Publish the event to generate shifts and assign workers"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"No shifts available"}),e.jsx("p",{className:"text-sm",children:"This event may not have any shifts generated yet"})]})}),e.jsx("div",{className:"flex items-center justify-center gap-3",children:x.status==="draft"&&e.jsx("button",{onClick:()=>m(x.id),className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors",children:"Publish Event"})})]})})]},x.id)})})}function vs({events:a,searchQuery:u,onApproveHours:N}){const T=d=>{const j=ue(d);return he(j,"MMM d, yyyy")},l=d=>{const j=ue(d);return he(j,"h:mm a")};return a.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“‹"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:u?"No past events found":"No past events yet"}),e.jsx("p",{className:"text-gray-600",children:u?"Try adjusting your search query":"Completed events will appear here"})]}):e.jsx("div",{className:"space-y-4",children:a.map(d=>{var ee,x,Q,w;const j=d.approval_status&&d.approval_status.total>0,m=pe(d.total_hours??d.total_hours_worked??0),L=pe(((ee=d.cost_summary)==null?void 0:ee.total_estimated_cost)??d.total_pay_amount??0),D=pe(((x=d.cost_summary)==null?void 0:x.approved_cost)??0),X=pe(((Q=d.cost_summary)==null?void 0:Q.pending_cost)??0),ie=pe(((w=d.approval_status)==null?void 0:w.pending)??0),Z=d.cost_summary&&L>0&&m>0?D/L*m:m,re=d.cost_summary&&L>0&&m>0&&X>0?X/L*m:0;return e.jsxs("div",{onClick:()=>N&&j&&N(d),className:we("border border-gray-200 rounded-lg p-5 transition-all cursor-pointer",j&&"hover:border-gray-300 hover:shadow-md"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1 truncate",children:d.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 flex-wrap",children:[d.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ee,{className:"h-4 w-4 flex-shrink-0"}),T(d.schedule.start_time_utc)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($e,{className:"h-4 w-4 flex-shrink-0"}),l(d.schedule.start_time_utc)," - ",l(d.schedule.end_time_utc)]})]}),d.venue&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ke,{className:"h-4 w-4 flex-shrink-0"}),d.venue.name]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 ml-4",children:[e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-700 rounded",children:"Completed"}),ze(d)&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-50 text-green-700 text-xs font-medium rounded border border-green-200",children:[e.jsx(Ce,{className:"h-3 w-3"}),"Reviewed"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4 py-3 border-y border-gray-100",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Workers"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:d.assigned_workers_count||0})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Hours"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900 tabular-nums flex items-center justify-end gap-1.5",children:j?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:xe(Z,2,"0.00")}),ie>0&&re>0&&e.jsxs("span",{className:"text-xs font-medium text-amber-600 bg-amber-50 px-1.5 py-0.5 rounded",children:["+",xe(re,2,"0.0"),"h pending"]})]}):e.jsx("span",{className:"text-gray-400",children:"â€”"})})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Cost"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900 tabular-nums flex items-center justify-end gap-1.5",children:j?e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["$",xe(D,2,"0.00")]}),X>0&&e.jsxs("span",{className:"text-xs font-medium text-amber-700 bg-amber-100 px-1.5 py-0.5 rounded",children:["+$",xe(X,2,"0.00")]})]}):e.jsx("span",{className:"text-gray-400",children:"â€”"})})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",onClick:E=>E.stopPropagation(),children:N&&(()=>{var K,B;const E=d.total_workers_needed||0,v=d.assigned_workers_count||0,S=(((K=d.approval_status)==null?void 0:K.total)??0)>0||(((B=d.cost_summary)==null?void 0:B.total_count)??0)>0||v>0,U=ze(d),W=ps(d);if(E===0&&v===0&&!S)return null;if(!S)return e.jsxs("button",{disabled:!0,className:"px-4 py-2 text-sm font-medium rounded-lg flex items-center gap-2 bg-gray-300 text-gray-500 cursor-not-allowed shadow-sm",children:[e.jsx(_e,{className:"h-4 w-4"}),"No assignments"]});const M=()=>N(d);return U?e.jsxs("button",{onClick:M,"aria-label":"Review assignments (already reviewed)",className:"px-4 py-2 text-sm font-medium rounded-lg flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white transition-colors shadow-sm",title:"All assignments reviewed. Click to adjust if needed.",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{children:"Reviewed"}),e.jsx(Ve,{className:"h-4 w-4"})]}):e.jsxs("button",{onClick:M,"aria-label":W>0?`Review and approve ${W} pending assignment${W!==1?"s":""}`:"Review & Approve",className:"px-4 py-2 text-sm font-medium rounded-lg flex items-center gap-2 bg-amber-600 hover:bg-amber-700 text-white transition-colors shadow-sm",children:[e.jsx(ds,{className:"h-4 w-4"}),e.jsx("span",{children:W>0?`Review & Approve (${W})`:"Review & Approve"}),e.jsx(Ve,{className:"h-4 w-4"})]})})()})]},d.id)})})}export{Hs as EventsPage};
