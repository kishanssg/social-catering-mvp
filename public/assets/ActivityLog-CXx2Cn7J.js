import{c as E,j as e,a as O}from"./index-CWRj_2Mk.js";import{r as c}from"./vendor-79DyBOV9.js";import{C as R}from"./calendar-BLr8Yfm1.js";import{F as g}from"./file-text-DqmJSg6_.js";import{C as k}from"./clock-CyCB2a-V.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=E("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),Y=()=>{const[f,S]=c.useState([]),[j,b]=c.useState(!0),[o,A]=c.useState({current_page:1,per_page:50,total_count:0,total_pages:0,has_next_page:!1,has_prev_page:!1}),[x,y]=c.useState(""),[m,N]=c.useState(""),[p,_]=c.useState(""),[h,v]=c.useState(""),C=["Worker","Event"],T=["created","updated","deleted"],u=async(s=1)=>{var t;try{b(!0);const r={page:s,per_page:50};x&&(r.entity_type=x),m&&(r.log_action=m),p&&(r.date_from=p),h&&(r.date_to=h),console.log("Activity Log: Fetching logs with params:",r);const a=await O.get("/activity_logs",{params:r});console.log("Activity Log: API response:",a.data),S(a.data.data.activity_logs||[]),A(a.data.data.pagination||o),console.log("Activity Log: Loaded",((t=a.data.data.activity_logs)==null?void 0:t.length)||0,"logs")}catch(r){console.error("Failed to fetch activity logs:",r)}finally{b(!1)}};c.useEffect(()=>{u(1)},[x,m,p,h]);const w=s=>{switch(s){case"created":return"bg-green-100 text-green-700";case"updated":return"bg-blue-100 text-blue-700";case"deleted":return"bg-red-100 text-red-700";case"assigned_worker":return"bg-purple-100 text-purple-700";case"unassigned_worker":return"bg-orange-100 text-orange-700";default:return"bg-gray-100 text-gray-700"}},F=s=>{switch(s){case"created":return"+";case"updated":return"âœŽ";case"deleted":return"Ã—";case"assigned_worker":return"â†’";case"unassigned_worker":return"â†";default:return"â€¢"}},L=s=>{const t={};if(s.action==="assigned_worker"&&s.after_json?(t.worker=s.after_json.worker_name||"Unknown worker",t.shift=s.after_json.shift_name||"Unknown shift",t.role=s.after_json.role||"Unknown role",t.pay=s.after_json.hourly_rate?`$${Number(s.after_json.hourly_rate)}/hr`:"No rate"):s.action==="unassigned_worker"&&s.before_json&&(t.worker=s.before_json.worker_name||"Unknown worker",t.shift=s.before_json.shift_name||"Unknown shift",t.role=s.before_json.role||"Unknown role"),s.entity_type==="Worker"){const r=s.after_json||s.before_json||{};if(r.first_name&&r.last_name&&(t.name=`${r.first_name} ${r.last_name}`),r.email&&(t.email=r.email),r.phone&&(t.phone=r.phone),s.action==="created"&&r.skills_json)t.skills=Array.isArray(r.skills_json)?r.skills_json.join(", "):r.skills_json;else if(s.action==="updated"&&s.after_json&&s.before_json){const a=Array.isArray(s.before_json.skills_json)?s.before_json.skills_json:JSON.parse(s.before_json.skills_json||"[]"),n=Array.isArray(s.after_json.skills_json)?s.after_json.skills_json:JSON.parse(s.after_json.skills_json||"[]"),l=n.filter(d=>!a.includes(d)),i=a.filter(d=>!n.includes(d));l.length>0&&(t.skill_changes=`Added: ${l.join(", ")}`),i.length>0&&(t.skill_changes=(t.skill_changes||"")+` ${t.skill_changes?"| Removed: ":"Removed: "}${i.join(", ")}`)}}if(s.entity_type==="Event"||s.entity_type==="Shift"){const r=s.after_json||s.before_json||{};if(r.title&&(t.title=r.title),r.client_name&&(t.event=r.client_name),r.location&&(t.location=r.location),r.start_time_utc){const a=new Date(r.start_time_utc);t.date=a.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),t.time=a.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}}return t},D=s=>{if(!s)return"â€”";const t=new Date(s);if(isNaN(t.getTime()))return"â€”";const r=new Date,a=r.getTime()-t.getTime(),n=Math.floor(a/1e3),l=Math.floor(n/60),i=Math.floor(l/60),d=Math.floor(i/24);return n<60?"Just now":l<60?`${l}m ago`:i<24?`${i}h ago`:d<7?`${d}d ago`:t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:t.getFullYear()!==r.getFullYear()?"numeric":void 0})},$=s=>{if(!s||Object.keys(s).length===0)return null;const t=["worker_name","event_name","shift_name","role","pay_rate","email","phone"];return Object.entries(s).filter(([a,n])=>n!=null&&n!==""&&!a.includes("_id")&&!a.includes("json")&&!a.includes("Changes")).sort((a,n)=>{const l=t.indexOf(a[0]),i=t.indexOf(n[0]);return l===-1&&i===-1?0:l===-1?1:i===-1?-1:l-i}).map(([a,n])=>{const l=a.replace(/_/g," ");let i=typeof n=="object"?JSON.stringify(n):String(n);return a==="changes_summary"?e.jsxs("div",{className:"px-3 py-2 text-xs bg-blue-50 text-blue-700 rounded-lg border border-blue-200 flex items-start gap-2 w-full",children:[e.jsx("span",{className:"font-semibold",children:"Changed:"}),e.jsx("span",{children:i})]},a):e.jsxs("span",{className:"px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded-full",children:[e.jsxs("span",{className:"font-medium capitalize",children:[l,":"]})," ",i]},a)})},U=()=>{y(""),N(""),_(""),v("")};return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"px-8 py-6 border-b border-gray-200",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Activity Log"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Track all actions and changes in the system"})]}),e.jsx("div",{className:"px-8 py-6 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filters:"})]}),e.jsxs("select",{value:x,onChange:s=>y(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-color focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Entity Types"}),C.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:m,onChange:s=>N(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-color focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Actions"}),T.map(s=>e.jsx("option",{value:s,children:s.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())},s))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{type:"date",value:p,onChange:s=>_(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-color focus:border-transparent",placeholder:"From"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500",children:"to"}),e.jsx("input",{type:"date",value:h,onChange:s=>v(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-color focus:border-transparent",placeholder:"To"})]}),(x||m||p||h)&&e.jsx("button",{onClick:U,className:"text-sm text-primary-color hover:text-primary-color/80 font-medium",children:"Clear Filters"})]})}),e.jsx("div",{className:"px-8 py-4 border-b border-gray-200 bg-blue-50",children:e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"Total Logs:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:o.total_count})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"Showing:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[f.length," of ",o.total_count]})]})]})}),e.jsxs("div",{className:"px-8 py-6",children:[j?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-color"})}):f.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(g,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No activity logs found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Try adjusting your filters"})]}):e.jsx("div",{className:"space-y-3",children:f.map(s=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow bg-white",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 font-bold text-lg ${w(s.action)}`,children:F(s.action)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.summary||"â€”"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{className:"w-3 h-3"}),e.jsx("span",{className:"capitalize",children:s.entity_type})]}),e.jsx("span",{children:"â€¢"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"w-3 h-3"}),e.jsx("span",{children:D(s.when)})]})]}),Object.keys(s.details||{}).length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:$(s.details)})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${w(s.action)}`,children:s.action.replace("_"," ").toUpperCase()})]}),(()=>{const t=L(s);return Object.keys(t).length>0?e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[t.worker&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-2 flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-purple-100 rounded flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-purple-700 text-xs font-bold",children:"ðŸ‘¤"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-purple-900",children:"Worker"}),e.jsx("p",{className:"text-xs text-purple-700",children:t.worker})]})]}),t.shift&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-2 flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-blue-700 text-xs font-bold",children:"ðŸ“…"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-blue-900",children:"Event"}),e.jsx("p",{className:"text-xs text-blue-700",children:t.shift}),t.date&&e.jsx("p",{className:"text-xs text-blue-600",children:t.date})]})]}),t.role&&e.jsxs("div",{className:"bg-teal-50 border border-teal-200 rounded-lg p-2 flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-teal-100 rounded flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-teal-700 text-xs font-bold",children:"ðŸ“‹"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-teal-900",children:"Role"}),e.jsx("p",{className:"text-xs text-teal-700",children:t.role})]})]}),t.pay&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-2 flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-green-100 rounded flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-green-700 text-xs font-bold",children:"ðŸ’°"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-green-900",children:"Pay Rate"}),e.jsx("p",{className:"text-xs text-green-700 font-bold",children:t.pay})]})]}),t.name&&e.jsxs("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg p-2 flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-indigo-100 rounded flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-indigo-700 text-xs font-bold",children:"ðŸ‘¤"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-indigo-900",children:t.name}),t.email&&e.jsx("p",{className:"text-xs text-indigo-600",children:t.email}),t.phone&&e.jsx("p",{className:"text-xs text-indigo-600",children:t.phone}),t.skills&&e.jsx("p",{className:"text-xs text-indigo-500 mt-1",children:t.skills}),t.skill_changes&&e.jsxs("p",{className:"text-xs text-indigo-600 font-semibold mt-1",children:["Skills: ",t.skill_changes]})]})]}),t.title&&!t.shift&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-2 flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-amber-100 rounded flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-amber-700 text-xs font-bold",children:"ðŸŽ‰"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-amber-900",children:"Event"}),e.jsx("p",{className:"text-xs text-amber-700",children:t.title}),t.location&&e.jsx("p",{className:"text-xs text-amber-600",children:t.location})]})]})]}):null})()]})]})},s.id))}),!j&&f.length>0&&e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Page ",o.current_page," of ",o.total_pages]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u(o.current_page-1),disabled:!o.has_prev_page,className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>u(o.current_page+1),disabled:!o.has_next_page,className:"px-4 py-2 bg-primary-color text-white rounded-lg text-sm font-medium hover:bg-primary-color/90 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})]})};export{Y as ActivityLog};
