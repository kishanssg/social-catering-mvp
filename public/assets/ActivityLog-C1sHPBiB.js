import{c as g,j as e,a as I,A as z}from"./index-CwsK9MYf.js";import{r as d}from"./vendor-79DyBOV9.js";import{C as J}from"./calendar-LlqJRxV2.js";import{F as y}from"./file-text-DmCqo4lt.js";import{C}from"./clock-B5816vcG.js";import{C as W,X as q}from"./x-circle-BIRqSVDP.js";import{B as H}from"./ban-DmbyUqun.js";import{T as B}from"./trash-2-gum_6FCg.js";import{P as A}from"./pen-square-CvCsS7hv.js";import{P as T}from"./plus-lF-09Pfh.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=g("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=g("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=g("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=g("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),ie=()=>{const[f,$]=d.useState([]),[b,N]=d.useState(!0),[c,U]=d.useState({current_page:1,per_page:50,total_count:0,total_pages:0,has_next_page:!1,has_prev_page:!1}),[m,_]=d.useState(""),[h,v]=d.useState(""),[p,w]=d.useState(""),[u,k]=d.useState(""),L=["Worker","Event"],F=["created","updated","deleted"],j=async(s=1)=>{var t;try{N(!0);const r={page:s,per_page:50};m&&(r.entity_type=m),h&&(r.log_action=h),p&&(r.date_from=p),u&&(r.date_to=u),console.log("Activity Log: Fetching logs with params:",r);const a=await I.get("/activity_logs",{params:r});console.log("Activity Log: API response:",a.data),$(a.data.data.activity_logs||[]),U(a.data.data.pagination||c),console.log("Activity Log: Loaded",((t=a.data.data.activity_logs)==null?void 0:t.length)||0,"logs")}catch(r){console.error("Failed to fetch activity logs:",r)}finally{N(!1)}};d.useEffect(()=>{j(1)},[m,h,p,u]);const S=s=>{switch(s){case"created":return"bg-emerald-100 text-emerald-700 border-emerald-200";case"updated":return"bg-blue-100 text-blue-700 border-blue-200";case"deleted":return"bg-red-100 text-red-700 border-red-200";case"assigned_worker":return"bg-purple-100 text-purple-700 border-purple-200";case"unassigned_worker":return"bg-amber-100 text-amber-700 border-amber-200";case"marked_no_show":return"bg-orange-100 text-orange-700 border-orange-200";case"removed_from_job":return"bg-red-100 text-red-700 border-red-200";case"totals_recalculated":return"bg-indigo-100 text-indigo-700 border-indigo-200";case"approved":return"bg-green-100 text-green-700 border-green-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}},D=(s,t)=>{switch(s){case"created":return t==="Worker"?e.jsx(M,{className:"w-4 h-4"}):t==="Event"?e.jsx(T,{className:"w-4 h-4"}):e.jsx(T,{className:"w-4 h-4"});case"updated":return e.jsx(A,{className:"w-4 h-4"});case"deleted":return e.jsx(B,{className:"w-4 h-4"});case"assigned_worker":return e.jsx(M,{className:"w-4 h-4"});case"unassigned_worker":return e.jsx(V,{className:"w-4 h-4"});case"marked_no_show":return e.jsx(H,{className:"w-4 h-4"});case"removed_from_job":return e.jsx(q,{className:"w-4 h-4"});case"totals_recalculated":return e.jsx(X,{className:"w-4 h-4"});case"approved":return e.jsx(W,{className:"w-4 h-4"});default:return e.jsx(z,{className:"w-4 h-4"})}},E=s=>{const t={};if(s.action==="assigned_worker"&&s.after_json?(t.worker=s.after_json.worker_name||"Unknown worker",t.shift=s.after_json.shift_name||"Unknown shift",t.role=s.after_json.role||"Unknown role",t.pay=s.after_json.hourly_rate?`$${Number(s.after_json.hourly_rate)}/hr`:"No rate"):s.action==="unassigned_worker"&&s.before_json&&(t.worker=s.before_json.worker_name||"Unknown worker",t.shift=s.before_json.shift_name||"Unknown shift",t.role=s.before_json.role||"Unknown role"),s.entity_type==="Worker"){const r=s.after_json||s.before_json||{};if(r.first_name&&r.last_name&&(t.name=`${r.first_name} ${r.last_name}`),r.email&&(t.email=r.email),r.phone&&(t.phone=r.phone),s.action==="created"&&r.skills_json)t.skills=Array.isArray(r.skills_json)?r.skills_json.join(", "):r.skills_json;else if(s.action==="updated"&&s.after_json&&s.before_json){const a=Array.isArray(s.before_json.skills_json)?s.before_json.skills_json:JSON.parse(s.before_json.skills_json||"[]"),n=Array.isArray(s.after_json.skills_json)?s.after_json.skills_json:JSON.parse(s.after_json.skills_json||"[]"),i=n.filter(o=>!a.includes(o)),l=a.filter(o=>!n.includes(o));i.length>0&&(t.skill_changes=`Added: ${i.join(", ")}`),l.length>0&&(t.skill_changes=(t.skill_changes||"")+` ${t.skill_changes?"| Removed: ":"Removed: "}${l.join(", ")}`)}}if(s.entity_type==="Event"||s.entity_type==="Shift"){const r=s.after_json||s.before_json||{};if(r.title&&(t.title=r.title),r.client_name&&(t.event=r.client_name),r.location&&(t.location=r.location),r.start_time_utc){const a=new Date(r.start_time_utc);t.date=a.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),t.time=a.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}}return t},P=s=>{if(!s)return"â€”";const t=new Date(s);if(isNaN(t.getTime()))return"â€”";const a=new Date().getTime()-t.getTime(),n=Math.floor(a/1e3),i=Math.floor(n/60),l=Math.floor(i/60),o=Math.floor(l/24),x=t.toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0});return n<60?`Just now â€¢ ${x}`:i<60?`${i}m ago â€¢ ${x}`:l<24?`${l}h ago â€¢ ${x}`:o<7?`${o}d ago â€¢ ${x}`:x},O=s=>{if(!s||Object.keys(s).length===0)return null;const t=["worker_name","event_name","shift_name","role","pay_rate","notes","email","phone"];return Object.entries(s).filter(([a,n])=>a==="changes"||n!=null&&n!==""&&!a.includes("_id")&&!a.includes("json")&&!a.includes("Changes")).sort((a,n)=>{if(a[0]==="changes")return 1;if(n[0]==="changes")return-1;const i=t.indexOf(a[0]),l=t.indexOf(n[0]);return i===-1&&l===-1?0:i===-1?1:l===-1?-1:i-l}).map(([a,n])=>{if(a==="changes"&&Array.isArray(n)&&n.length>0)return e.jsx("div",{className:"w-full space-y-2",children:n.map((o,x)=>e.jsxs("div",{className:"px-3 py-2 text-xs bg-blue-50 text-blue-900 rounded-lg border border-blue-200 flex items-start gap-2",children:[e.jsx(A,{className:"w-3.5 h-3.5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"font-semibold capitalize",children:[o.field,":"]}),e.jsxs("span",{className:"ml-1 text-blue-700",children:["from ",e.jsx("span",{className:"font-medium line-through opacity-75",children:o.from})," to ",e.jsx("span",{className:"font-semibold",children:o.to})]})]})]},x))},a);if(a==="changes_summary")return e.jsxs("div",{className:"px-3 py-2 text-xs bg-blue-50 text-blue-700 rounded-lg border border-blue-200 flex items-start gap-2 w-full",children:[e.jsx("span",{className:"font-semibold",children:"Changed:"}),e.jsx("span",{children:String(n)})]},a);const i=a.replace(/_/g," ");let l=typeof n=="object"?JSON.stringify(n):String(n);return e.jsxs("span",{className:"px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded-full",children:[e.jsxs("span",{className:"font-medium capitalize",children:[i,":"]})," ",l]},a)})},R=()=>{_(""),v(""),w(""),k("")};return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"px-8 py-6 border-b border-gray-200",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Activity Log"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Track all actions and changes in the system"})]}),e.jsx("div",{className:"px-8 py-6 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filters:"})]}),e.jsxs("select",{value:m,onChange:s=>_(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-color focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Entity Types"}),L.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:h,onChange:s=>v(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-color focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Actions"}),F.map(s=>e.jsx("option",{value:s,children:s.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())},s))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{type:"date",value:p,onChange:s=>w(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-color focus:border-transparent",placeholder:"From"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500",children:"to"}),e.jsx("input",{type:"date",value:u,onChange:s=>k(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-color focus:border-transparent",placeholder:"To"})]}),(m||h||p||u)&&e.jsx("button",{onClick:R,className:"text-sm text-primary-color hover:text-primary-color/80 font-medium",children:"Clear Filters"})]})}),e.jsx("div",{className:"px-8 py-4 border-b border-gray-200 bg-blue-50",children:e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"Total Logs:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:c.total_count})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"Showing:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[f.length," of ",c.total_count]})]})]})}),e.jsxs("div",{className:"px-8 py-6",children:[b?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-color"})}):f.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(y,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No activity logs found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Try adjusting your filters"})]}):e.jsx("div",{className:"space-y-3",children:f.map(s=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow bg-white",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 border-2 ${S(s.action)}`,children:D(s.action,s.entity_type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.summary||"â€”"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"w-3 h-3"}),e.jsx("span",{className:"capitalize",children:s.entity_type})]}),e.jsx("span",{children:"â€¢"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(C,{className:"w-3 h-3"}),e.jsx("span",{children:P(s.when)})]})]}),Object.keys(s.details||{}).length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:O(s.details)})]}),e.jsx("span",{className:`px-3 py-1.5 rounded-md text-xs font-semibold border ${S(s.action)}`,children:s.action.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())})]}),(()=>{const t=E(s);return Object.keys(t).length>0?e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[t.worker&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-2 flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-purple-100 rounded flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-purple-700 text-xs font-bold",children:"ðŸ‘¤"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-purple-900",children:"Worker"}),e.jsx("p",{className:"text-xs text-purple-700",children:t.worker})]})]}),t.shift&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-2 flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-blue-700 text-xs font-bold",children:"ðŸ“…"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-blue-900",children:"Event"}),e.jsx("p",{className:"text-xs text-blue-700",children:t.shift}),t.date&&e.jsx("p",{className:"text-xs text-blue-600",children:t.date})]})]}),t.role&&e.jsxs("div",{className:"bg-teal-50 border border-teal-200 rounded-lg p-2 flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-teal-100 rounded flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-teal-700 text-xs font-bold",children:"ðŸ“‹"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-teal-900",children:"Role"}),e.jsx("p",{className:"text-xs text-teal-700",children:t.role})]})]}),t.pay&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-2 flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-green-100 rounded flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-green-700 text-xs font-bold",children:"ðŸ’°"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-green-900",children:"Pay Rate"}),e.jsx("p",{className:"text-xs text-green-700 font-bold",children:t.pay})]})]}),t.name&&e.jsxs("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg p-2 flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-indigo-100 rounded flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-indigo-700 text-xs font-bold",children:"ðŸ‘¤"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-indigo-900",children:t.name}),t.email&&e.jsx("p",{className:"text-xs text-indigo-600",children:t.email}),t.phone&&e.jsx("p",{className:"text-xs text-indigo-600",children:t.phone}),t.skills&&e.jsx("p",{className:"text-xs text-indigo-500 mt-1",children:t.skills}),t.skill_changes&&e.jsxs("p",{className:"text-xs text-indigo-600 font-semibold mt-1",children:["Skills: ",t.skill_changes]})]})]}),t.title&&!t.shift&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-2 flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-amber-100 rounded flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-amber-700 text-xs font-bold",children:"ðŸŽ‰"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-amber-900",children:"Event"}),e.jsx("p",{className:"text-xs text-amber-700",children:t.title}),t.location&&e.jsx("p",{className:"text-xs text-amber-600",children:t.location})]})]})]}):null})()]})]})},s.id))}),!b&&f.length>0&&e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Page ",c.current_page," of ",c.total_pages]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>j(c.current_page-1),disabled:!c.has_prev_page,className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>j(c.current_page+1),disabled:!c.has_next_page,className:"px-4 py-2 bg-primary-color text-white rounded-lg text-sm font-medium hover:bg-primary-color/90 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})]})};export{ie as ActivityLog};
