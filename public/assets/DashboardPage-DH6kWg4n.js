import{c as I,a as z,j as e,A as L}from"./index-DpE5DQnb.js";import{b as G,u as Y,r as v}from"./vendor-79DyBOV9.js";import{S as E,C as K}from"./StaffingStatusBadge-DzAhnaza.js";import{c as J}from"./utils-DuMXYCiK.js";import{s as Q,e as P}from"./index-B4OS2SaP.js";import{p as w}from"./index-DrxdxHnt.js";import{r as W,t as $,a as X,f as N,C as Z}from"./index-CPie9l_s.js";import{s as H}from"./index-CQ1aMm2g.js";import{e as ee}from"./index-Br6DAVzh.js";import{C as te}from"./chevron-right-C9u0fpQv.js";import{i as se,a as ae,s as q,b as re}from"./index-0E1HqSuC.js";import{M as ne}from"./map-pin-CmvXbfiL.js";import"./index-BfcYz2DB.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=I("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=I("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);function A(r,h){W(2,arguments);var i=$(r),o=X(h);if(isNaN(o))return new Date(NaN);if(!o)return i;var n=i.getDate(),l=new Date(i.getTime());l.setMonth(i.getMonth()+o+1,0);var s=l.getDate();return n>=s?l:(i.setFullYear(l.getFullYear(),l.getMonth(),n),i)}function le(r,h){var i;W(1,arguments);var o=r||{},n=$(o.start),l=$(o.end),s=l.getTime();if(!(n.getTime()<=s))throw new RangeError("Invalid interval");var d=[],g=n;g.setHours(0,0,0,0);var b=Number((i=void 0)!==null&&i!==void 0?i:1);if(b<1||isNaN(b))throw new RangeError("`options.step` must be a number greater than 1");for(;g.getTime()<=s;)d.push($(g)),g.setDate(g.getDate()+b),g.setHours(0,0,0,0);return d}function Ne(){const r=G(),h=Y(),[i,o]=v.useState({draft_events:0,published_events:0,completed_events:0,total_workers:0,gaps_to_fill:0,urgent_events:0,month_events:0}),[n,l]=v.useState(new Date),[s,d]=v.useState([]),[g,b]=v.useState([]),[S,C]=v.useState(!0);v.useEffect(()=>{p()},[n]),v.useEffect(()=>{const a=()=>{document.hidden||p()},u=()=>{p()};return document.addEventListener("visibilitychange",a),window.addEventListener("focus",u),()=>{document.removeEventListener("visibilitychange",a),window.removeEventListener("focus",u)}},[n]),v.useEffect(()=>{if(h.pathname==="/dashboard"){const a=setTimeout(()=>{p()},100);return()=>clearTimeout(a)}},[h.pathname]);async function p(){C(!0);try{const a=await z.get("/dashboard");if(a.data.status==="success"){const u=a.data.data;o({draft_events:u.draft_events,published_events:u.published_events,completed_events:u.completed_events,total_workers:u.total_workers,gaps_to_fill:u.gaps_to_fill,urgent_events:u.urgent_events,month_events:u.month_events});const y=await z.get("/events",{params:{tab:"active",limit:200}});if(y.data.status==="success"){const j=y.data.data,O=Q(n),V=P(n),F=j.filter(t=>t.status==="published"),f={};F.forEach(t=>{if(!t.schedule)return;const x=w(t.schedule.start_time_utc);if(x>=O&&x<=V){const m=N(x,"yyyy-MM-dd");f[m]||(f[m]={date:x,status:"fully_staffed",events:[],shifts_count:0,needs_workers_count:0,total_hired_today:0,total_required_today:0});const D=t.assigned_workers_count||0,_=t.total_workers_needed||0;f[m].events.push({id:t.id,title:t.title,unfilled_roles_count:t.unfilled_roles_count||0,hired_count:D,required_count:_}),f[m].shifts_count+=t.total_shifts_count||0,f[m].needs_workers_count+=t.unfilled_roles_count||0,f[m].total_hired_today+=D,f[m].total_required_today+=_,t.staffing_status==="needs_workers"?f[m].status="needs_workers":t.staffing_status==="partially_staffed"&&f[m].status!=="needs_workers"&&(f[m].status="partially_staffed")}}),d(Object.values(f));const R=F.filter(t=>{if(!t.schedule)return console.debug(`[Urgent Queue] Event ${t.id} (${t.title}) filtered: no schedule`),!1;const x=t.unfilled_roles_count||0;if(x===0)return console.debug(`[Urgent Queue] Event ${t.id} (${t.title}) filtered: no unfilled roles (count: ${x})`),!1;const m=w(t.schedule.start_time_utc),D=new Date;if(m<D)return console.debug(`[Urgent Queue] Event ${t.id} (${t.title}) filtered: event is in the past`),!1;const _=(m.getTime()-D.getTime())/(1e3*60*60);return _>0&&_<=48?(console.debug(`[Urgent Queue] Event ${t.id} (${t.title}) included: ${_.toFixed(1)}h until, ${x} unfilled roles`),!0):(console.debug(`[Urgent Queue] Event ${t.id} (${t.title}) filtered: outside 48h window (${_.toFixed(1)}h until)`),!1)}).map(t=>{const m=(w(t.schedule.start_time_utc).getTime()-new Date().getTime())/(1e3*60*60);return{...t,venue:t.venue||{name:"",formatted_address:""},hours_until:m}}).sort((t,x)=>t.hours_until!==x.hours_until?t.hours_until-x.hours_until:t.staffing_percentage-x.staffing_percentage).slice(0,5);console.debug(`[Urgent Queue] Summary: ${F.length} published events checked, ${R.length} urgent events found (within 48h with unfilled roles)`),b(R)}}}catch(a){console.error("Failed to load dashboard data:",a)}finally{C(!1)}}const T=()=>{l(A(n,-1))},U=()=>{l(A(n,1))},c=()=>{l(new Date)},k=a=>{const u=N(a,"yyyy-MM-dd"),y=q(new Date),O=q(a)<y?"completed":"active";r(`/events?tab=${O}&date=${u}`)};return S?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600"})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Overview of events and staffing needs"})]}),e.jsx("button",{onClick:()=>r("/events/create"),className:"px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Create New Event"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsx(M,{label:"Draft Events",value:i.draft_events,onClick:()=>r("/events?tab=draft"),color:"gray"}),e.jsx(M,{label:"Active Events",value:i.published_events,onClick:()=>r("/events?tab=active"),color:"blue"}),e.jsx(M,{label:"Completed Events",value:i.completed_events,onClick:()=>r("/events?tab=completed"),color:"green"}),e.jsx(M,{label:"Unfilled Roles",value:i.gaps_to_fill,onClick:()=>r("/events?tab=active&filter=needs_workers"),color:"red",isHero:!0})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6 mb-8",children:e.jsx(oe,{currentMonth:n,calendarData:s,onPreviousMonth:T,onNextMonth:U,onToday:c,onDayClick:k})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200",children:e.jsx(de,{events:g,onEventClick:a=>r(`/events?tab=active&event_id=${a}`)})})]})})}function M({label:r,value:h,onClick:i,color:o,isHero:n}){const l={gray:"bg-white hover:border-gray-300",blue:"bg-white hover:border-blue-300",green:"bg-white hover:border-green-300",red:n?"bg-red-50 border-red-200 hover:border-red-300":"bg-white hover:border-red-300"},s={gray:"text-gray-900",blue:"text-blue-900",green:"text-green-900",red:"text-red-900"},d={gray:"text-gray-600",blue:"text-blue-600",green:"text-green-600",red:n?"text-red-700":"text-red-600"};return e.jsxs("button",{onClick:i,className:`relative overflow-hidden rounded-lg border p-6 transition-all duration-200 text-left ${l[o]} hover:shadow-lg`,children:[n&&h>5&&e.jsxs("div",{className:"absolute top-0 right-0 w-3 h-3 m-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-red-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`text-sm font-medium mb-1 ${d[o]}`,children:r}),e.jsx("span",{className:`text-4xl font-bold ${s[o]}`,children:h})]}),n&&h>0&&e.jsxs("div",{className:"mt-3 flex items-center gap-1 text-sm font-medium text-red-600",children:[e.jsx(L,{size:16}),e.jsx("span",{children:"Requires attention"})]}),!n&&e.jsxs("div",{className:"mt-3 flex items-center gap-1 text-sm font-medium text-gray-500",children:[e.jsx("span",{children:"View all"}),e.jsx(B,{size:16})]})]})}function oe({currentMonth:r,calendarData:h,onPreviousMonth:i,onNextMonth:o,onToday:n,onDayClick:l}){const s=Q(r),d=P(r),g=H(s,{weekStartsOn:0}),b=ee(d,{weekStartsOn:0}),S=le({start:g,end:b}),C=c=>h.find(k=>re(k.date,c)),p=c=>{switch(c){case"fully_staffed":return"ready";case"partially_staffed":return"partial";case"needs_workers":return"needs_workers";default:return null}},T=c=>{switch(c){case"fully_staffed":return"bg-green-50 border-green-200";case"partially_staffed":return"bg-yellow-50 border-yellow-200";case"needs_workers":return"bg-red-50 border-red-200";default:return""}},U=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:N(r,"MMMM yyyy")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:i,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Previous month",children:e.jsx(ie,{size:20})}),e.jsx("button",{onClick:n,className:"px-3 py-1.5 text-sm font-medium text-teal-600 hover:bg-teal-50 rounded-lg transition",children:"Today"}),e.jsx("button",{onClick:o,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Next month",children:e.jsx(te,{size:20})})]})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[U.map(c=>e.jsx("div",{className:"text-center text-sm font-medium text-gray-600 py-2",children:c},c)),S.map((c,k)=>{const a=C(c),u=se(c,r),y=ae(c),j=a&&a.events.length>0;return e.jsxs("button",{onClick:()=>j&&l(c),disabled:!j,className:`
                relative min-h-[80px] p-2 rounded-lg border transition-all text-left
                ${y?"border-gray-400 bg-white ring-2 ring-gray-300":j?`${T(a.status)} hover:shadow-md cursor-pointer`:"border-gray-100 bg-white"}
                ${u?"":"opacity-40"}
              `,children:[e.jsx("div",{className:`text-sm font-medium mb-1 ${y?"text-gray-700":u?"text-gray-900":"text-gray-400"}`,children:N(c,"d")}),a&&e.jsxs("div",{className:"space-y-1.5",children:[p(a.status)&&e.jsx("div",{className:"flex justify-center",children:e.jsx(E,{status:p(a.status),showLabel:!1,showIcon:!0,size:"xs"})}),a.events.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-center text-gray-600",children:[a.events.length," event",a.events.length!==1?"s":""]}),e.jsxs("div",{className:"text-xs text-center font-medium text-gray-700",children:[a.total_hired_today,"/",a.total_required_today," hired"]})]})]})]},k)})]}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-6 pt-4 border-t border-gray-200",children:[e.jsx(E,{status:"ready",size:"sm"}),e.jsx(E,{status:"partial",size:"sm"}),e.jsx(E,{status:"needs_workers",size:"sm"})]})]})}function de({events:r,onEventClick:h}){const i=s=>{if(!s.schedule)return!1;const g=(w(s.schedule.start_time_utc).getTime()-new Date().getTime())/(1e3*60*60);return g>0&&g<=48},o=()=>e.jsxs("span",{className:"bg-red-50 text-red-800 text-xs font-bold px-2.5 py-1 rounded-full inline-flex items-center gap-1.5","aria-label":"Urgent: starts within 48 hours",children:[e.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full"}),"URGENT"]}),n=s=>{const d=w(s);return N(d,"EEE, MMM d")},l=s=>{const d=w(s);return N(d,"h:mm a")};return r.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽ‰"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"All Caught Up!"}),e.jsx("p",{className:"text-gray-600",children:"No urgent staffing needs at the moment. Great work!"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(L,{className:"h-5 w-5 text-amber-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Priority Staffing Queue"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[r.length," ",r.length===1?"event needs":"events need"," workers Â· Sorted by urgency"]})]}),e.jsx("div",{className:"divide-y divide-gray-200",children:r.map(s=>{var d;return e.jsx("div",{className:"px-6 py-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:n(s.schedule.start_time_utc)}),i(s)&&e.jsx(e.Fragment,{children:o()})]}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-2 truncate",children:s.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3 flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"h-4 w-4 flex-shrink-0 text-gray-400"}),e.jsx("span",{className:"truncate",children:((d=s.venue)==null?void 0:d.name)||"Venue TBD"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-4 w-4 flex-shrink-0 text-gray-400"}),e.jsxs("span",{children:[l(s.schedule.start_time_utc)," - ",l(s.schedule.end_time_utc)]})]})]}),e.jsx("div",{className:"mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:J("h-full rounded-full transition-all duration-300",(s.staffing_percentage||0)>=100?"bg-green-500":(s.staffing_percentage||0)>=75?"bg-amber-500":"bg-red-500"),style:{width:`${s.staffing_percentage||0}%`}})}),e.jsxs("span",{className:"text-xs font-medium text-gray-600 min-w-[3rem] text-right",children:[s.staffing_percentage||0,"%"]})]})}),e.jsx("div",{className:"flex items-center gap-1.5 text-sm",children:s.unfilled_roles_count>0?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 text-red-600 flex-shrink-0"}),e.jsxs("span",{className:"text-red-600 font-medium",children:[s.unfilled_roles_count," ",s.unfilled_roles_count===1?"role":"roles"," still need workers"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-4 w-4 text-green-600 flex-shrink-0"}),e.jsx("span",{className:"text-green-600 font-medium",children:"Fully staffed"})]})})]}),e.jsxs("button",{onClick:()=>h(s.id),className:"px-4 py-2 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors whitespace-nowrap flex items-center gap-2",children:["Assign Workers",e.jsx(B,{size:16})]})]})},s.id)})})]})}export{Ne as DashboardPage};
