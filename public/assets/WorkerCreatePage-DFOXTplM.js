import{c as ye,a as I,j as e,X as ke}from"./index-L5EzzywB.js";import{i as je,b as ve,r as m}from"./vendor-79DyBOV9.js";import{L as we}from"./LoadingSpinner-6xTZRKiK.js";import{T as Ne}from"./Toast-Ds6TrfW7.js";import{c as Ce}from"./check-Bp3f4Z94.js";import{b as E,a as Z,c as ee,e as te,p as re}from"./Prep Cook-li-JR_eG.js";import{C as Se}from"./chevron-right-DraGBriQ.js";import{U as Pe}from"./user-CtoT3oy9.js";import{P as Fe}from"./plus-CS0fsadj.js";import"./x-circle-BPUz5pEw.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=ye("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function ze(){const{id:b}=je(),w=ve(),g=!!b,W=m.useRef(null),[f,B]=m.useState("details"),[R,N]=m.useState(!1),[se,D]=m.useState(!1),[$,M]=m.useState(!1),[V,y]=m.useState(!1),[C,ae]=m.useState([]),[r,l]=m.useState({first_name:"",last_name:"",email:"",phone:"",address_line1:"",address_line2:"",profile_photo_url:"",skills:[],worker_certifications_attributes:[]}),[z,H]=m.useState(null),[k,S]=m.useState(null),[d,ie]=m.useState({}),[j,P]=m.useState({isVisible:!1,message:"",type:"success"}),F=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),A=t=>{const s=t.replace(/\D/g,"");return s.length>=10&&s.length<=15},ne=t=>{const s=t.replace(/\D/g,"");l({...r,phone:s})},O=[{name:"Bartender",icon:E},{name:"Banquet Server/Runner",icon:Z},{name:"Captain",icon:ee},{name:"Event Helper",icon:te},{name:"Prep Cook",icon:re}],oe=t=>({Bartender:E,"Banquet Server/Runner":Z,Captain:ee,"Event Helper":te,"Prep Cook":re})[t]||E;m.useEffect(()=>{(async()=>{var t,s,i;try{const a=await I.get("/certifications"),p=((s=(t=a.data)==null?void 0:t.data)==null?void 0:s.certifications)||((i=a.data)==null?void 0:i.certifications)||[];ae(Array.isArray(p)?p:[])}catch(a){console.error("Failed to load certifications catalog",a)}})(),g&&le()},[b]);async function le(){D(!0);try{const t=await I.get(`/workers/${b}`);if(t.data.status==="success"){const s=t.data.data.worker;let i=[];Array.isArray(s==null?void 0:s.worker_certifications)?i=s.worker_certifications.map(a=>{var p,x;return{worker_certification_id:a.id,certification_id:((p=a.certification)==null?void 0:p.id)??a.certification_id,certification_name:((x=a.certification)==null?void 0:x.name)??a.name,expires_at_utc:a.expires_at_utc}}):Array.isArray(s==null?void 0:s.certifications)&&(i=s.certifications.map(a=>({worker_certification_id:null,certification_id:a.id,certification_name:a.name,expires_at_utc:a.expires_at_utc}))),l({first_name:s.first_name||"",last_name:s.last_name||"",email:s.email||"",phone:s.phone?s.phone.replace(/\D/g,""):"",address_line1:s.address_line1||"",address_line2:s.address_line2||"",profile_photo_url:s.profile_photo_url||"",skills:s.skills_json||[],worker_certifications_attributes:i.filter(a=>a.certification_id!=null&&a.certification_id!==void 0&&a.certification_id!=="").map(a=>({id:a.worker_certification_id||void 0,certification_id:a.certification_id,name:a.certification_name,expires_at_utc:a.expires_at_utc?String(a.expires_at_utc).split("T")[0]:"",_destroy:!1}))}),s.profile_photo_url&&S(s.profile_photo_url)}}catch(t){console.error("Failed to load worker:",t)}finally{D(!1)}}function ce(){var t;(t=W.current)==null||t.click()}function de(t){var a;const s=(a=t.target.files)==null?void 0:a[0];if(!s||!s.type.startsWith("image/")||s.size>5*1024*1024)return;H(s);const i=new FileReader;i.onloadend=()=>S(i.result),i.readAsDataURL(s)}async function me(){var t,s,i,a,p,x,v,T,U,q,G,J,X;N(!0);try{u("first_name",r.first_name),u("last_name",r.last_name),u("email",r.email),u("phone",r.phone);const n=r.first_name.trim().length>=2,h=r.last_name.trim().length>=2,he=!!r.email.trim()&&F(r.email),ge=!!r.phone.trim()&&A(r.phone);if(!n||!h||!he||!ge){N(!1);return}const _e=g?"PATCH":"POST",be=g?`/workers/${b}`:"/workers",c=new FormData;c.append("worker[first_name]",r.first_name||""),c.append("worker[last_name]",r.last_name||""),c.append("worker[email]",r.email||""),c.append("worker[phone]",r.phone||""),r.address_line1&&c.append("worker[address_line1]",r.address_line1),r.address_line2&&c.append("worker[address_line2]",r.address_line2),r.skills.forEach(o=>c.append("worker[skills_json][]",o));const K=r.worker_certifications_attributes.filter(o=>!o._destroy&&o.certification_id!=null&&o.certification_id!==void 0);K.forEach((o,_)=>{o.id!=null&&c.append(`worker[worker_certifications_attributes][${_}][id]`,String(o.id)),c.append(`worker[worker_certifications_attributes][${_}][certification_id]`,String(o.certification_id)),o.expires_at_utc&&c.append(`worker[worker_certifications_attributes][${_}][expires_at_utc]`,o.expires_at_utc)}),r.worker_certifications_attributes.filter(o=>o._destroy&&o.id!=null).forEach((o,_)=>{const Y=K.length+_;c.append(`worker[worker_certifications_attributes][${Y}][id]`,String(o.id)),c.append(`worker[worker_certifications_attributes][${Y}][_destroy]`,"true")}),z&&c.append("profile_photo",z),console.log("Submitting worker form:",{first_name:r.first_name,last_name:r.last_name,email:r.email,phone:r.phone,skills_count:r.skills.length,certifications_count:r.worker_certifications_attributes.length});const Q=await I.request({method:_e,url:be,data:c});Q.data.status==="success"?w("/workers"):P({isVisible:!0,message:((t=Q.data.errors)==null?void 0:t.join(", "))||"Failed to save worker",type:"error"})}catch(n){console.error("Failed to save worker:",n),console.error("Error response:",(s=n.response)==null?void 0:s.data),console.error("Error status:",(i=n.response)==null?void 0:i.status);let h="Failed to save worker";((p=(a=n.response)==null?void 0:a.data)==null?void 0:p.status)==="validation_error"&&((v=(x=n.response)==null?void 0:x.data)!=null&&v.errors)||(U=(T=n.response)==null?void 0:T.data)!=null&&U.errors?h=Array.isArray(n.response.data.errors)?n.response.data.errors.join(", "):String(n.response.data.errors):(G=(q=n.response)==null?void 0:q.data)!=null&&G.message?h=n.response.data.message:(X=(J=n.response)==null?void 0:J.data)!=null&&X.error?h=n.response.data.error:n.message&&(h=n.message),P({isVisible:!0,message:h,type:"error"})}finally{N(!1)}}const pe=(C||[]).filter(t=>!(Array.isArray(r.worker_certifications_attributes)?r.worker_certifications_attributes:[]).some(i=>i.certification_id===t.id&&!i._destroy)),L=[{id:1,title:"Add New Worker",description:"Invite a new user to join as a Worker.",completed:f==="skills",active:f==="details"},{id:2,title:"Add Skills",description:"Specify Worker's Skills.",completed:!1,active:f==="skills"}],u=(t,s)=>{const i={...d};switch(t){case"first_name":s.length<2?i.first_name="First name must be at least 2 characters":delete i.first_name;break;case"last_name":s.length<2?i.last_name="Last name must be at least 2 characters":delete i.last_name;break;case"email":s.trim()?F(s)?delete i.email:i.email="Please enter a valid email address":i.email="Email is required";break;case"phone":s.length>0&&!A(s)?i.phone="Please enter a valid phone number (10-15 digits only, no hyphens or spaces)":delete i.phone;break}ie(i)},fe=()=>{if(f==="details"){const t=r.first_name.trim().length>=2,s=r.last_name.trim().length>=2,i=!!r.email.trim()&&F(r.email),a=!!r.phone.trim()&&A(r.phone);return t&&s&&i&&a}return!0},xe=()=>{f==="details"?B("skills"):me()},ue=()=>{f==="skills"&&B("details")};return se?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(we,{})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-8 py-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("button",{onClick:()=>w("/workers"),className:"hover:text-gray-900 transition",children:"Workers"}),e.jsx(Se,{size:16}),e.jsx("span",{className:"text-gray-900",children:g?"Edit Worker":"Add New Worker"})]})})}),e.jsxs("div",{className:"flex flex-1 justify-center gap-12 px-8 min-h-0",style:{paddingTop:"80px",paddingBottom:"40px"},children:[e.jsx("div",{className:"w-[280px] flex-shrink-0 self-start",children:L.map((t,s)=>e.jsxs("div",{className:"flex gap-4",style:{minHeight:s<L.length-1?"100px":"auto"},children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full flex-shrink-0",style:{backgroundColor:t.completed?"#FFFFFF":t.active?"#000000":"transparent",border:t.completed||t.active?"2px solid #000000":"0.8px solid #292826",boxShadow:t.active||t.completed?"0 2px 8px 0 rgba(0,0,0,0.04)":"none"},children:t.completed?e.jsx("img",{src:Ce,width:"18",height:"18",alt:"Completed",className:"flex-shrink-0"}):t.active?e.jsx("div",{className:"rounded-full bg-white",style:{width:"12px",height:"12px"}}):null}),s<L.length-1&&e.jsx("div",{className:"flex-1",style:{width:"2px",backgroundColor:"rgba(0,0,0,0.5)"}})]}),e.jsxs("div",{className:"flex flex-col gap-1 pt-1",children:[e.jsx("span",{className:"text-sm font-bold font-manrope leading-[140%] text-font-primary",children:t.title}),e.jsx("span",{className:"text-sm font-normal font-manrope leading-[140%] text-font-secondary",children:t.description})]})]},t.id))}),e.jsxs("div",{className:"flex flex-col p-8 rounded-lg border border-primary-color/10 bg-white self-start overflow-visible",style:{boxShadow:"0 2px 8px 0 rgba(0,0,0,0.04)",maxWidth:"850px",width:"100%",minHeight:"600px"},children:[e.jsx("div",{className:"flex flex-col gap-6 flex-1 overflow-visible pr-2",style:{fontFamily:"Manrope, sans-serif"},children:f==="details"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx("h2",{className:"text-xl font-bold text-font-primary",children:"Worker Details"})}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Phone number"}),e.jsx("input",{type:"tel",value:r.phone,onChange:t=>ne(t.target.value),onBlur:()=>u("phone",r.phone),className:`px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent ${d.phone?"border-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"1234567890"}),d.phone&&e.jsx("p",{className:"text-sm text-red-600",children:d.phone})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"First name"}),e.jsx("input",{type:"text",value:r.first_name,onChange:t=>l({...r,first_name:t.target.value}),onBlur:()=>u("first_name",r.first_name),className:`px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent ${d.first_name?"border-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"First name"}),d.first_name&&e.jsx("p",{className:"text-sm text-red-600",children:d.first_name})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Last name"}),e.jsx("input",{type:"text",value:r.last_name,onChange:t=>l({...r,last_name:t.target.value}),onBlur:()=>u("last_name",r.last_name),className:`px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent ${d.last_name?"border-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"Last name"}),d.last_name&&e.jsx("p",{className:"text-sm text-red-600",children:d.last_name})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Email address"}),e.jsx("input",{type:"email",value:r.email,onChange:t=>l({...r,email:t.target.value}),onBlur:()=>u("email",r.email),className:`px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent ${d.email?"border-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"Email address"}),d.email&&e.jsx("p",{className:"text-sm text-red-600",children:d.email})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Home address"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx("input",{type:"text",value:r.address_line1,onChange:t=>l({...r,address_line1:t.target.value}),className:"px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"Address line 1"}),e.jsx("input",{type:"text",value:r.address_line2,onChange:t=>l({...r,address_line2:t.target.value}),className:"px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"Address line 2"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Profile Photo"}),e.jsxs("div",{className:"flex items-center gap-4 p-4 border border-gray-300 rounded-lg",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden",children:k?e.jsx("img",{src:k,alt:"Preview",className:"w-16 h-16 object-cover"}):e.jsx(Pe,{size:24,className:"text-gray-500"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{ref:W,type:"file",accept:"image/*",className:"hidden",onChange:de}),e.jsxs("button",{type:"button",onClick:ce,className:"text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center gap-2",children:[e.jsx(Ae,{size:16}),k?"Change Photo":"Upload Photo"]}),k&&e.jsx("button",{type:"button",onClick:()=>{H(null),S(null)},className:"text-red-600 hover:text-red-700 text-sm",children:"Remove"}),e.jsx("span",{className:"text-xs text-gray-500",children:"JPG, PNG up to 5MB"})]})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx("h2",{className:"text-xl font-bold text-font-primary",children:"Worker Skills"})}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("label",{className:"text-sm font-semibold font-manrope leading-[140%] text-font-primary",children:"Skills"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between h-11 px-4 rounded-lg border border-primary-color/10 bg-white cursor-pointer hover:border-primary-color/30 transition-colors",onClick:()=>M(!$),children:[e.jsx("span",{className:"text-sm font-normal font-manrope leading-[140%] text-primary-color",children:r.skills.length>0?r.skills.join(", "):"Pick the Skills the Worker Has"}),e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M4 6L8 10L12 6",stroke:"#292826",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]}),$&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border border-primary-color/10 rounded-lg shadow-lg z-50 max-h-[200px] overflow-y-auto",children:[O.filter(t=>!r.skills.includes(t.name)).map(t=>e.jsxs("div",{className:"flex items-center gap-3 px-3 py-2.5 cursor-pointer hover:bg-gray-50",onClick:()=>{l({...r,skills:[...r.skills,t.name]}),M(!1)},children:[e.jsx("img",{src:t.icon,width:"20",height:"20",alt:t.name,className:"flex-shrink-0",style:{imageRendering:"crisp-edges"}}),e.jsx("span",{className:"text-sm font-normal font-manrope leading-[140%] text-font-primary",children:t.name})]},t.name)),r.skills.length===O.length&&e.jsx("div",{className:"px-3 py-2.5 text-sm text-gray-500 text-center",children:"All skills selected"})]})]}),r.skills.length>0&&e.jsx("div",{className:"flex flex-col gap-3",children:r.skills.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-primary-color/10 bg-white",style:{boxShadow:"0 1px 2px rgba(0,0,0,0.06)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:oe(t),width:"24",height:"24",alt:t,className:"flex-shrink-0",style:{imageRendering:"crisp-edges"}}),e.jsx("span",{className:"text-sm font-semibold font-manrope leading-[140%] text-font-primary",children:t})]}),e.jsx("button",{onClick:()=>l({...r,skills:r.skills.filter(s=>s!==t)}),className:"flex items-center justify-center w-6 h-6 text-red-500 hover:bg-red-50 rounded",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 4L4 12M4 4L12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]},t))})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Certifications"}),e.jsx("div",{className:"space-y-3",children:(Array.isArray(r.worker_certifications_attributes)?r.worker_certifications_attributes:[]).map((t,s)=>e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("select",{value:t.certification_id||"",onChange:i=>{const a=parseInt(i.target.value||"0",10),p=C.find(v=>v.id===a),x=[...r.worker_certifications_attributes];x[s].certification_id=a,x[s].name=(p==null?void 0:p.name)||"",l({...r,worker_certifications_attributes:x})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"",children:"Select certificationâ€¦"}),C.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"date",value:t.expires_at_utc,onChange:i=>{const a=[...r.worker_certifications_attributes];a[s].expires_at_utc=i.target.value,l({...r,worker_certifications_attributes:a})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})}),e.jsx("button",{type:"button",onClick:()=>{const i=[...r.worker_certifications_attributes];i[s].id?i[s]._destroy=!0:i.splice(s,1),l({...r,worker_certifications_attributes:i})},className:"text-red-600 hover:text-red-800",children:e.jsx(ke,{size:16})})]},s))}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>y(!V),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:[e.jsx(Fe,{size:16}),e.jsx("span",{children:"Add Certification"})]}),V&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-10",children:pe.map(t=>e.jsx("button",{type:"button",onClick:()=>{if(r.worker_certifications_attributes.findIndex(a=>a.certification_id===t.id&&!a._destroy)!==-1){y(!1);return}const i=r.worker_certifications_attributes.findIndex(a=>a.certification_id===t.id&&a._destroy);if(i!==-1){const a=[...r.worker_certifications_attributes];a[i]._destroy=!1,l({...r,worker_certifications_attributes:a}),y(!1);return}l({...r,worker_certifications_attributes:[...r.worker_certifications_attributes,{id:null,certification_id:t.id,name:t.name,expires_at_utc:"",_destroy:!1}]}),y(!1)},className:"w-full text-left px-4 py-2 hover:bg-gray-50 first:rounded-t-lg last:rounded-b-lg",children:t.name},t.id))})]})]})]})]})}),e.jsxs("div",{className:"flex justify-between items-center gap-4 pt-6 border-t border-gray-200",children:[e.jsx("div",{children:f==="skills"&&e.jsxs("button",{onClick:ue,className:"flex items-center gap-2 px-6 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M10 12L6 8L10 4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Back"]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>w("/workers"),className:"px-6 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{onClick:xe,disabled:!fe()||R,className:"px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transition",children:R?"Saving...":f==="details"?"Continue":g?"Update Worker":"Create Worker"})]})]})]})]}),e.jsx(Ne,{isVisible:j.isVisible,message:j.message,type:j.type,onClose:()=>P({...j,isVisible:!1})})]})}export{ze as WorkerCreatePage};
