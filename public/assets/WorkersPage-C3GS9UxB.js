import{u as oe,a as W,j as e}from"./index-CQ22bL_m.js";import{b as ce,u as de,r as m}from"./vendor-D4VeuP1H.js";import{L as G}from"./LoadingSpinner-DGirzV5S.js";import{S as ie,T as me,C as ue,A as te}from"./ConfirmationModal-DK0fDaVu.js";import{T as xe,X as ae}from"./Toast-BmN-G-GD.js";import{P as le}from"./plus-BnDPZ39g.js";import{U as fe}from"./user-CV7Elqaf.js";import{C as he,X as ge}from"./x-circle-DofyPYsN.js";import{C as ne}from"./calendar-BK319pxK.js";import{P as pe}from"./pen-square-g42c1BED.js";import{f as Q,C as ye}from"./index-Brf9gEKf.js";import{p as X}from"./index-MJRzejWf.js";import{B as je}from"./briefcase-C9nQ-u_M.js";import{M as be}from"./map-pin-ClHxqSt1.js";import{D as ve}from"./dollar-sign-82Dl-92q.js";function We(){const o=ce(),E=de(),{isAuthenticated:w,isLoading:h}=oe(),[H,f]=m.useState([]),[P,B]=m.useState(!0),[N,M]=m.useState(""),[L,F]=m.useState("name"),[g,_]=m.useState("all"),[T,C]=m.useState({isOpen:!1}),[ee,R]=m.useState([]),[se,k]=m.useState(null),[b,$]=m.useState({isOpen:!1}),[J,O]=m.useState(!1),[A,z]=m.useState({isVisible:!1,message:"",type:"success"});m.useEffect(()=>{w&&!h&&D()},[w,h]),m.useEffect(()=>{w&&!h&&E.pathname==="/workers"&&D()},[E.pathname,w,h]);async function D(){B(!0);try{const t=await W.get("/workers");if(t.data.status==="success"){const c=t.data.data||[];f(c)}else f([])}catch(t){console.error("Failed to load workers:",t),f([])}finally{B(!1)}}const U=t=>{$({isOpen:!0,worker:t})},K=async()=>{var t;if(b.worker){O(!0);try{(await W.delete(`/workers/${(t=b.worker)==null?void 0:t.id}`)).data.status==="success"&&(z({isVisible:!0,message:`${b.worker.first_name||"Unknown"} ${b.worker.last_name||"Worker"} has been deleted successfully`,type:"success"}),D(),$({isOpen:!1}))}catch(c){console.error("Failed to delete worker:",c),z({isVisible:!0,message:"Failed to delete worker. Please try again.",type:"error"})}finally{O(!1)}}},Y=()=>{$({isOpen:!1})},Z=t=>{C({isOpen:!0,worker:t}),R([]),k(null)},I=()=>{C({isOpen:!1})},V=t=>{console.log("handleBulkAssignSuccess called with message:",t),console.log("Closing modal and showing toast..."),I(),z({isVisible:!0,message:t||"Worker scheduled successfully",type:"success"}),D(),console.log("Modal should now be closed")},q=H.filter(t=>{if(g==="active"&&!t.active||g==="inactive"&&t.active)return!1;if(N){const c=N.toLowerCase();return(t.first_name||"").toLowerCase().includes(c)||(t.last_name||"").toLowerCase().includes(c)||(t.email||"").toLowerCase().includes(c)||(t.phone||"").includes(c)||(t.skills_json||[]).some(v=>(v||"").toLowerCase().includes(c))||(t.certifications||[]).some(v=>((v==null?void 0:v.name)||"").toLowerCase().includes(c))}return!0}).sort((t,c)=>{switch(L){case"name":return`${t.first_name||""} ${t.last_name||""}`.localeCompare(`${c.first_name||""} ${c.last_name||""}`);case"email":return(t.email||"").localeCompare(c.email||"");case"status":return(c.active?1:0)-(t.active?1:0);default:return 0}});return h?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(G,{})}):w?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Workers"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your workforce"})]}),e.jsxs("button",{onClick:()=>o("/workers/create"),className:"flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(le,{size:20}),"Add New Worker"]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 max-w-md relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search workers by name, email, phone, skills, or certifications",value:N,onChange:t=>M(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),e.jsxs("select",{value:L,onChange:t=>F(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"name",children:"Sort by Name"}),e.jsx("option",{value:"email",children:"Sort by Email"}),e.jsx("option",{value:"status",children:"Sort by Status"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>_("all"),className:`px-3 py-2 text-sm font-medium rounded-lg transition-colors ${g==="all"?"bg-teal-100 text-teal-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"All"}),e.jsx("button",{onClick:()=>_("active"),className:`px-3 py-2 text-sm font-medium rounded-lg transition-colors ${g==="active"?"bg-green-100 text-green-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Active"}),e.jsx("button",{onClick:()=>_("inactive"),className:`px-3 py-2 text-sm font-medium rounded-lg transition-colors ${g==="inactive"?"bg-gray-200 text-gray-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Inactive"})]})]}),P?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(G,{})}):q.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(fe,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:N?"No workers found":"No workers yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:N?"Try adjusting your search or filters":"Add your first worker to get started"}),!N&&e.jsxs("button",{onClick:()=>o("/workers/create"),className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:[e.jsx(le,{size:20}),"Add Worker"]})]}):e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Worker Name"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Phone Number"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Email Address"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:q.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>o(`/workers/${t.id}`),children:[e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 font-medium",children:[(t.first_name||"U")[0],(t.last_name||"W")[0]]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[t.first_name||"Unknown"," ",t.last_name||"Worker"]}),t.skills_json&&t.skills_json.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[t.skills_json.slice(0,3).map((c,v)=>e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded",children:c},v)),t.skills_json.length>3&&e.jsxs("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded",children:["+",t.skills_json.length-3]})]})]})]})}),e.jsx("td",{className:"py-4 px-6 text-sm text-gray-600",children:t.phone||"—"}),e.jsx("td",{className:"py-4 px-6 text-sm text-gray-600",children:t.email}),e.jsx("td",{className:"py-4 px-6",children:t.active?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[e.jsx(he,{size:14}),"Active"]}):e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-gray-100 text-gray-600 text-xs font-medium rounded-full",children:[e.jsx(ge,{size:14}),"Inactive"]})}),e.jsx("td",{className:"py-4 px-6 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.active&&e.jsxs("button",{onClick:c=>{c.stopPropagation(),Z(t)},className:"px-3 py-1.5 bg-purple-600 text-white text-sm font-medium rounded-lg hover:bg-purple-700 transition-colors",title:"Schedule Worker",children:[e.jsx(ne,{size:14,className:"inline mr-1"}),"Schedule"]}),e.jsx("button",{onClick:c=>{c.stopPropagation(),o(`/workers/${t.id}/edit`)},className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Edit",children:e.jsx(pe,{size:16})}),e.jsx("button",{onClick:c=>{c.preventDefault(),c.stopPropagation(),U(t)},className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition",title:"Delete",children:e.jsx(me,{size:16})})]})})]},t.id))})]})})]}),T.isOpen&&T.worker&&e.jsx(Ne,{worker:T.worker,onClose:I,onSuccess:V}),e.jsx(ue,{isOpen:b.isOpen,onClose:Y,onConfirm:K,title:"Delete Worker",message:"Are you sure you want to delete this worker?",confirmText:"Delete Worker",cancelText:"Cancel",isLoading:J,isDestructive:!0,workerName:b.worker?`${b.worker.first_name||"Unknown"} ${b.worker.last_name||"Worker"}`:void 0}),e.jsx(xe,{isVisible:A.isVisible,message:A.message,type:A.type,onClose:()=>z({...A,isVisible:!1})})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Authentication Required"}),e.jsx("p",{className:"text-gray-600",children:"Please log in to view workers."})]})})}function Ne({worker:o,onClose:E,onSuccess:w}){var v;const[h,H]=m.useState([]),[f,P]=m.useState(new Set),[B,N]=m.useState(!0),[M,L]=m.useState(!1),[F,g]=m.useState(null),[_,T]=m.useState(""),[C,ee]=m.useState("all"),[R,se]=m.useState([]),[k,b]=m.useState({}),[$,J]=m.useState(new Set),[O,A]=m.useState({});m.useEffect(()=>{o&&o.id&&z()},[o==null?void 0:o.id]),m.useEffect(()=>{o&&o.id&&h.length>0&&D()},[o==null?void 0:o.id,h]);async function z(){if(!(!o||!o.id)){N(!0);try{const s=await W.get("/events",{params:{tab:"active",filter:"needs_workers"}});if(s.data.status==="success"){const l=s.data.data,i=[];l.forEach(d=>{if(d&&d.shifts_by_role){const x={id:d.id,title:d.title||"Untitled Event"};d.shifts_by_role.forEach(a=>{var n;if(a&&o.skills_json&&o.skills_json.includes(a.role_name)&&a.filled_shifts<a.total_shifts){const r=(a.shifts||[]).filter(p=>{const y=p.filled_positions||0;return p.capacity>y});if(r.length===0)return;const u=r[0];if(u){const p=r.map(j=>j.id),y={id:u.id,event:x,role_needed:a.role_name,start_time_utc:u.start_time_utc,end_time_utc:u.end_time_utc,location:((n=d.venue)==null?void 0:n.formatted_address)||"Location TBD",current_status:u.status,pay_rate:u.pay_rate,total_positions:a.total_shifts,filled_positions:a.filled_shifts,available_positions:r.reduce((j,S)=>j+(S.capacity-(S.filled_positions||0)),0),all_shift_ids:p};i.push(y)}}})}}),H(i)}}catch(s){console.error("Failed to load available shifts:",s),g("Failed to load available shifts")}finally{N(!1)}}}async function D(){if(!(!o||!o.id))try{const s=[];if(h.forEach(i=>{i.all_shift_ids&&s.push(...i.all_shift_ids)}),s.length===0)return;const l=await W.post("/staffing/validate_bulk",{worker_id:o.id,shift_ids:s});if(l.data.status==="success"){const{invalid_shifts:i}=l.data.data,d=new Set,x={};i.forEach(a=>{const n=h.find(r=>{var u;return(u=r.all_shift_ids)==null?void 0:u.includes(a.shift_id)});n&&(d.add(n.id),x[n.id]=a.errors.map(r=>r.message))}),J(d),A(x)}}catch(s){console.error("Failed to validate shifts:",s)}}const U=s=>{const l=new Set(f),i=h.find(d=>d.id===s);if(i){if(l.has(s))l.delete(s);else{if($.has(s)){const x=O[s]||["Not available"];g(`Cannot select this shift: ${x.join(", ")}`);return}if(Array.from(l).forEach(x=>{var n,r,u;const a=h.find(p=>p.id===x);if(a&&((n=a.event)==null?void 0:n.id)===((r=i.event)==null?void 0:r.id)&&a.start_time_utc===i.start_time_utc&&a.end_time_utc===i.end_time_utc&&a.role_needed!==i.role_needed){l.delete(x),g(`Selected ${i.role_needed} for ${(u=i.event)==null?void 0:u.title}. Previous role (${a.role_needed}) was unselected.`);return}}),Array.from(l).some(x=>{var j,S;const a=h.find(re=>re.id===x);if(!a||((j=a.event)==null?void 0:j.id)===((S=i.event)==null?void 0:S.id))return!1;const n=new Date(i.start_time_utc).getTime(),r=new Date(i.end_time_utc).getTime(),u=new Date(a.start_time_utc).getTime(),p=new Date(a.end_time_utc).getTime(),y=n<p&&r>u;return console.log("Checking overlap:",{shiftA:`${new Date(n).toISOString()} - ${new Date(r).toISOString()}`,shiftB:`${new Date(u).toISOString()} - ${new Date(p).toISOString()}`,overlaps:y}),y})){g("Cannot select this shift: It overlaps with another selected shift. Please deselect the conflicting shift first.");return}l.add(s)}P(l),g(null)}},K=(s,l)=>{b(i=>({...i,[s]:l}))},Y=()=>{f.size===t.length?P(new Set):P(new Set(t.map(s=>s.id)))};async function Z(){var s;if(f.size===0){g("Please select at least one shift");return}L(!0),g(null);try{const l=[];h.filter(n=>f.has(n.id)).forEach(n=>{n.all_shift_ids&&l.push(...n.all_shift_ids||[])});const x=[...new Set(l)].map(n=>{const r=h.find(p=>{var y;return(y=p.all_shift_ids)==null?void 0:y.includes(n)}),u=k[n]||Number(r==null?void 0:r.pay_rate)||0;return{shift_id:n,worker_id:o.id,hourly_rate:u}}),a=await W.post("/staffing/bulk_create",{assignments:x});if(console.log("Bulk create response:",a.data),g(null),se([]),a.data.status==="success"||a.data.status==="partial_success"){let n=a.data.message;if(a.data.status==="partial_success"&&a.data.data){const{successful:r,failed:u,total_requested:p}=a.data.data,y=r.length,j=u.length,S=p||y+j;n=`Successfully scheduled ${y} of ${S} shift${S!==1?"s":""}`,j>0&&y>0&&(n+=`. ${j} ${j===1?"shift":"shifts"} could not be scheduled.`)}console.log("Success - calling onSuccess with message:",n),w(n)}else if(a.data.status==="error"){let n=a.data.message||"Failed to schedule worker for shifts";a.data.details&&a.data.details.length>0&&(n+=`

Details:
• `+a.data.details.join(`
• `)),g(n)}else console.error("Unknown response status:",a.data.status),g("Unexpected response from server")}catch(l){console.error("Failed to bulk assign:",l);let i="Failed to schedule worker for shifts";(s=l.response)!=null&&s.data&&(l.response.data.message&&(i=l.response.data.message),l.response.data.details&&l.response.data.details.length>0&&(i+=`

Details:
• `+l.response.data.details.join(`
• `))),g(i)}finally{L(!1)}}const I=s=>Q(X(s),"EEE, MMM d, yyyy"),V=s=>Q(X(s),"h:mm a"),q=o.skills_json||[],t=h.filter(s=>{var l;if(C!=="all"&&s.role_needed!==C)return!1;if(_){const i=_.toLowerCase();return(((l=s.event)==null?void 0:l.title)||"").toLowerCase().includes(i)||(s.location||"").toLowerCase().includes(i)}return!0}),c=s=>Array.from(f).some(i=>{var x,a;const d=h.find(n=>n.id===i);return d?((x=d.event)==null?void 0:x.id)===((a=s.event)==null?void 0:a.id)&&d.start_time_utc===s.start_time_utc&&d.end_time_utc===s.end_time_utc&&d.role_needed!==s.role_needed:!1});return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Schedule ",o.first_name," ",o.last_name," for Shifts"]}),e.jsx("button",{onClick:E,className:"p-1 text-gray-400 hover:text-gray-600 rounded transition",children:e.jsx(ae,{size:24})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:(v=o.skills_json)==null?void 0:v.map(s=>e.jsx("span",{className:"px-2.5 py-1 bg-teal-100 text-teal-700 text-xs font-medium rounded",children:s},s))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:B?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(G,{})}):e.jsxs(e.Fragment,{children:[F&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2",children:[e.jsx(ae,{size:18,className:"text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-red-700",children:F.split(`
`).map((s,l)=>e.jsx("p",{className:s.startsWith("•")?"ml-2":"",children:s},l))})]}),R.length>0&&e.jsxs("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"Scheduling Conflicts"}),e.jsx("div",{className:"space-y-2",children:R.map((s,l)=>{var i;return e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"text-yellow-800",children:[e.jsx("strong",{children:((i=s.new_shift)==null?void 0:i.event)||"Unknown Event"})," conflicts with:"]}),e.jsx("ul",{className:"ml-4 mt-1 space-y-1",children:(s.conflicting_with||[]).map((d,x)=>e.jsxs("li",{className:"text-yellow-700",children:[d.event||"Unknown Event"," (",Q(X(d.start_time),"MMM d, h:mm a")," - ",Q(X(d.end_time),"h:mm a"),")"]},x))})]},l)})})]}),e.jsxs("div",{className:"mb-4 flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search events or locations...",value:_,onChange:s=>T(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsxs("select",{value:C,onChange:s=>ee(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"all",children:"All Roles"}),q.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),t.length>0&&e.jsxs("div",{className:"mb-4 flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f.size===t.length&&t.length>0,onChange:Y,className:"w-4 h-4 text-teal-600 rounded focus:ring-teal-500"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Select All (",t.length," shifts)"]})]}),f.size>0&&e.jsxs("span",{className:"text-sm font-medium text-teal-600",children:[f.size," selected"]})]}),t.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(je,{size:48,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"font-medium",children:"No available shifts found"}),e.jsx("p",{className:"text-sm mt-1",children:_||C!=="all"?"Try adjusting your filters":`No shifts matching ${o.first_name}'s skills need workers`})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:t.map(s=>{var n;const l=f.has(s.id),i=c(s),d=$.has(s.id),x=(i||d)&&!l,a=O[s.id]||[];return e.jsxs("button",{onClick:()=>U(s.id),className:`w-full p-4 rounded-lg border-2 transition-all text-left ${l?"border-teal-600 bg-teal-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:l,disabled:x,onChange:()=>U(s.id),className:`mt-1 w-4 h-4 rounded focus:ring-teal-500 ${x?"text-gray-400 cursor-not-allowed":"text-teal-600"}`,onClick:r=>r.stopPropagation()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{children:[e.jsx("h4",{className:`font-medium ${x?"text-gray-500":"text-gray-900"}`,children:((n=s.event)==null?void 0:n.title)||"Untitled Event"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`inline-block px-2 py-0.5 text-xs font-medium rounded ${x?"bg-gray-200 text-gray-500":"bg-purple-100 text-purple-700"}`,children:s.role_needed}),s.total_positions&&s.total_positions>1&&e.jsxs("span",{className:`text-xs ${x?"text-gray-400":"text-gray-500"}`,children:[s.available_positions," of ",s.total_positions," positions available"]}),i&&!l&&e.jsx("span",{className:"text-xs text-red-600 font-medium",children:"(Conflicts with selected role)"}),d&&!l&&e.jsxs("span",{className:"text-xs text-red-600 font-medium flex items-center gap-1",children:[e.jsx(te,{size:12}),"(Not available)"]})]})]})}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{size:14,className:"text-gray-400"}),e.jsx("span",{children:I(s.start_time_utc)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{size:14,className:"text-gray-400"}),e.jsxs("span",{children:[V(s.start_time_utc)," - ",V(s.end_time_utc)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"truncate",children:s.location})]})]})]}),e.jsx("div",{className:"flex flex-col items-end gap-1",onClick:r=>r.stopPropagation(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[k[s.id]&&k[s.id]!==(Number(s.pay_rate)||0)&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"(custom)"}),e.jsx(ve,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"text-gray-500 text-sm",children:"Pay:"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:(Number(s.pay_rate)||0).toString(),value:k[s.id]!==void 0?k[s.id]:Number(s.pay_rate)||0,onChange:r=>{const u=r.target.value;(u===""||/^\d*\.?\d*$/.test(u))&&K(s.id,parseFloat(u)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:r=>r.stopPropagation(),onFocus:r=>r.stopPropagation()}),e.jsx("span",{className:"text-gray-500 text-sm",children:"/hr"})]})})]}),d&&a.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-red-200",children:e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx(te,{size:14,className:"text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-red-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"Cannot assign to this shift:"}),e.jsx("ul",{className:"list-disc list-inside space-y-0.5",children:a.map((r,u)=>e.jsx("li",{children:r},u))})]})]})})]},s.id)})})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:f.size>0?e.jsxs("span",{className:"font-medium",children:[f.size," shift",f.size!==1?"s":""," selected"]}):e.jsxs("span",{children:["Select shifts to assign ",o.first_name," to"]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:E,disabled:M,className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:Z,disabled:f.size===0||M,className:"px-6 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:M?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Scheduling..."]}):e.jsxs(e.Fragment,{children:["Schedule for ",f.size," Shift",f.size!==1?"s":""]})})]})]})]})})}export{We as WorkersPage};
