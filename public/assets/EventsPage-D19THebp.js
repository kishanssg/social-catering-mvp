import{c as je,j as e,a as q,C as Ne}from"./index-CTWeL6Wf.js";import{r as c,b as ve,f as $e}from"./vendor-79DyBOV9.js";import{f as Ee,a as be}from"./dateUtils-CHmZs4Ub.js";import{X as oe,T as _e}from"./Toast-B1kx7aZF.js";import{C as we}from"./clock-CzWzdBS6.js";import{M as ce}from"./map-pin-Dza9bR4d.js";import{U as ue}from"./users-mzzAiPbP.js";import{A as ge}from"./alert-circle-BBNIUpUo.js";import{S as fe,A as Fe,T as he,C as xe}from"./ConfirmationModal-UF8wP9vx.js";import{D as ke}from"./dollar-sign-8WtJ535R.js";import{C as De}from"./x-circle-CiC4NAx0.js";import{b as Le,a as Te,c as Pe,e as Me,p as ze}from"./Prep Cook-CE8OFMb5.js";import{P as Se}from"./pen-square-CBWDrKRs.js";import{P as pe}from"./plus-Cza3wa73.js";import{C as me}from"./calendar-mmb4BC6j.js";import{f as Y}from"./index-C_slYh2M.js";import{p as X}from"./index-BK_MyBzW.js";import{C as Ce}from"./chevron-down-U9mic1pR.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=je("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=je("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),Ue={sm:"max-w-md",md:"max-w-2xl",lg:"max-w-4xl",xl:"max-w-6xl"},de=({isOpen:d,onClose:p,title:w,subtitle:i,children:W,footer:b,size:h="md",closeOnOverlayClick:n=!0})=>{if(c.useEffect(()=>(d?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[d]),c.useEffect(()=>{const g=U=>{U.key==="Escape"&&d&&p()};return document.addEventListener("keydown",g),()=>document.removeEventListener("keydown",g)},[d,p]),!d)return null;const E=g=>{g.target===g.currentTarget&&n&&p()};return e.jsx("div",{className:"modal-overlay",onClick:E,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:e.jsxs("div",{className:`modal-container ${Ue[h]}`,children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{id:"modal-title",className:"text-xl font-semibold text-gray-900 font-manrope",children:w}),i&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:i})]}),e.jsx("button",{onClick:p,className:"p-1.5 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors","aria-label":"Close modal",children:e.jsx(oe,{size:20,className:"text-gray-600"})})]}),e.jsx("div",{className:"modal-body",children:W}),b&&e.jsx("div",{className:"modal-footer",children:b})]})})};function Ae({shiftId:d,onClose:p,onSuccess:w}){var k,a;const[i,W]=c.useState(null),[b,h]=c.useState([]),[n,E]=c.useState([]),[g,U]=c.useState(""),[y,C]=c.useState(null),[O,r]=c.useState({}),[M,f]=c.useState(!0),[$,I]=c.useState(!1),[N,z]=c.useState(null),A=(t,l)=>{r(v=>({...v,[t]:l}))};c.useEffect(()=>{T()},[d]),c.useEffect(()=>{i&&x()},[i]),c.useEffect(()=>{if(!g)E(b);else{const t=g.toLowerCase();E(b.filter(l=>{var v;return l.first_name.toLowerCase().includes(t)||l.last_name.toLowerCase().includes(t)||l.email.toLowerCase().includes(t)||((v=l.skills_json)==null?void 0:v.some(L=>L.toLowerCase().includes(t)))}))}},[g,b]);async function T(){try{const t=await q.get(`/shifts/${d}`);t.data.status==="success"?W(t.data.data):z("Failed to load shift details")}catch(t){console.error("Failed to load shift details:",t),z("Failed to load shift details")}}async function x(){var t;try{const l=new Set;if(i!=null&&i.event_id)try{const D=((t=(await q.get(`/events/${i.event_id}`)).data)==null?void 0:t.data)||{};if(D.shifts_by_role){const S=D.shifts_by_role.find(_=>_.skill_name===i.role_needed||_.role_name===i.role_needed);S!=null&&S.shifts&&S.shifts.forEach(_=>{_.assignments&&_.assignments.forEach(u=>{var B;const P=u.worker_id||((B=u.worker)==null?void 0:B.id),V=u.status;P&&V!=="cancelled"&&V!=="no_show"&&l.add(P)})})}}catch(L){console.log("Could not fetch event to filter assigned workers:",L)}console.log(`AssignmentModal: Found ${l.size} already assigned workers for "${i==null?void 0:i.role_needed}"`);const v=await q.get("/workers?active=true");if(v.data.status==="success"){const L=v.data.data.workers||v.data.data;if(i!=null&&i.role_needed){const D=L.filter(S=>{var _;return((_=S.skills_json)==null?void 0:_.includes(i.role_needed))&&!l.has(S.id)});console.log(`AssignmentModal: Showing ${D.length} eligible workers`),h(D)}else{const D=L.filter(S=>!l.has(S.id));h(D)}}else z("Failed to load workers")}catch(l){console.error("Failed to load workers:",l),z("Failed to load workers")}finally{f(!1)}}async function m(){var t,l,v,L,D,S;if(!(!y||!i)){I(!0),z(null);try{const u=(await q.post("/staffing",{assignment:{shift_id:i.id,worker_id:y.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:O[y.id]||Number(i.pay_rate)||0}})).data;if(u.status==="success")w();else{let P=u.message||"Failed to assign worker";u.details&&u.details.length>0?P+=`

Details:
â€¢ `+u.details.join(`
â€¢ `):u.errors&&(P+=`

Details:
â€¢ `+u.errors.join(`
â€¢ `)),z(P)}}catch(_){console.error("Failed to assign worker:",_);let u="Failed to assign worker";if((l=(t=_.response)==null?void 0:t.data)!=null&&l.details&&_.response.data.details.length>0){const P=_.response.data.details.map(V=>(V.includes("conflicting shift"),V));u+=`

`+P.join(`
`)}else(L=(v=_.response)==null?void 0:v.data)!=null&&L.errors?u+=`

`+_.response.data.errors.join(`
`):(S=(D=_.response)==null?void 0:D.data)!=null&&S.message?u=_.response.data.message:_.message&&(u=_.message);z(u)}finally{I(!1)}}}if(M)return e.jsx(de,{isOpen:!0,onClose:p,title:"Assign Worker",size:"lg",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-600"})})});const F=e.jsxs(e.Fragment,{children:[N&&e.jsxs("div",{className:"mb-4 p-3 bg-gradient-to-r from-red-50 to-amber-50 border-l-4 border-red-500 rounded-r-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsx("h4",{className:"text-sm font-semibold text-red-900",children:"âš ï¸ Scheduling Conflict Detected"})]}),e.jsx("p",{className:"text-xs text-gray-600 ml-8",children:"Please resolve the conflict before attempting to assign this worker"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:p,disabled:$,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:m,disabled:!y||$||!!N,className:`btn-primary ${N?"opacity-50 cursor-not-allowed":""}`,title:N?"Cannot assign due to scheduling conflict":"",children:$?"Assigning Worker...":"Assign Worker"})]})]});return e.jsx(de,{isOpen:!0,onClose:p,title:i?`${i.client_name} â€¢ ${i.role_needed}`:"Assign Worker",size:"xl",footer:F,children:e.jsxs("div",{className:"flex h-[600px]",children:[e.jsx("div",{className:"w-1/3 border-r border-gray-200 p-6 bg-gray-50",children:i?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Shift Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(we,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:Ee(i.start_time_utc)}),e.jsxs("div",{className:"text-sm text-gray-600",children:[be(i.start_time_utc)," - ",be(i.end_time_utc)]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ce,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"text-sm text-gray-900",children:i.location||((a=(k=i.event)==null?void 0:k.venue)==null?void 0:a.formatted_address)||"Location not specified"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ue,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900",children:i.role_needed}),i.required_skill&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Requires: ",i.required_skill]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Pay Rate:"})," $",(Number(i.pay_rate)||0).toFixed(2),"/hour"]}),i.uniform_name&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",i.uniform_name]})]}),i.notes&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Notes:"}),e.jsx("div",{className:"mt-1 whitespace-pre-line",children:i.notes.split("Uniform:").map((t,l)=>l===0?t.trim():e.jsxs("div",{children:[e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",t.trim()]},l))})]})})]})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ge,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Failed to load shift details"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search workers...",value:g,onChange:t=>U(t.target.value),className:"w-full pl-9 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-teal-500 focus:border-teal-500"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:N?e.jsx("div",{className:"p-6 flex items-center justify-center h-full",children:e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 rounded-lg p-5 shadow-sm w-full max-w-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(ge,{size:20,className:"text-red-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg font-semibold text-red-900 mb-1",children:"âš ï¸ Scheduling Conflict"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"This worker cannot be assigned due to a scheduling conflict"}),e.jsx("div",{className:"bg-white border border-red-200 rounded p-3 mt-3",children:e.jsx("div",{className:"text-sm text-red-800 font-mono",children:N.split(`
`).map((t,l)=>t.trim()===""?null:t.startsWith("â€¢")?e.jsxs("div",{className:"mt-1 flex items-start gap-2",children:[e.jsx("span",{className:"text-red-500",children:"â—"}),e.jsx("span",{className:"flex-1",children:t.replace("â€¢","").trim()})]},l):t.startsWith("Details:")?null:t.includes("conflicting shift")?e.jsx("div",{className:"mt-1 text-red-700 font-medium",children:t},l):e.jsx("div",{className:"text-gray-700",children:t},l))})})]})]})})}):n.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ue,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:g?"No workers found matching your search":i!=null&&i.role_needed?`No workers found with "${i.role_needed}" skill`:"No available workers"}),(i==null?void 0:i.role_needed)&&!g&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:['Try adding "',i.role_needed,'" skill to workers or select a different shift.']})]}):e.jsx("ul",{children:n.map(t=>{const l=(y==null?void 0:y.id)===t.id,v=O[t.id]||Number(i.pay_rate)||0,L=O[t.id]&&O[t.id]!==(Number(i.pay_rate)||0);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${l?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[t.first_name[0],t.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[t.first_name," ",t.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(t.skills_json||[]).map((D,S)=>{const _=D===(i==null?void 0:i.role_needed);return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${_?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:D},S)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[L&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ke,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:(Number(i.pay_rate)||0).toString(),value:v||"",onChange:D=>{const S=D.target.value;(S===""||/^\d*\.?\d*$/.test(S))&&A(t.id,parseFloat(S)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:D=>D.stopPropagation(),onFocus:D=>D.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>C(t),className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${l?"bg-teal-600 text-white border-teal-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:l?"Selected":"Select"})]})]},t.id)})})})]})]})})}function Oe({isOpen:d,eventId:p,roleName:w,unfilledShiftIds:i,defaultPayRate:W,onClose:b,onDone:h}){const[n,E]=c.useState([]),[g,U]=c.useState([]),[y,C]=c.useState(""),[O,r]=c.useState(!1),[M,f]=c.useState(!1),[$,I]=c.useState({}),[N,z]=c.useState(0),A=(a,t)=>{I(l=>({...l,[a]:t}))};c.useEffect(()=>{d&&(E([]),U([]),C(""),I({}),r(!0),(async()=>{var a,t;try{const v=((a=(await q.get(`/events/${p}`)).data)==null?void 0:a.data)||{};console.log("QuickFill: Full event data:",JSON.stringify(v,null,2)),console.log("QuickFill: Looking for role:",w),console.log("QuickFill: shifts_by_role:",v.shifts_by_role);const L=new Set;if(v.shifts_by_role){const u=v.shifts_by_role.find(P=>(console.log("QuickFill: Checking role:",P.skill_name,P.role_name,"vs",w),P.skill_name===w||P.role_name===w));u?(console.log("QuickFill: Found role shifts:",u),u.shifts&&u.shifts.forEach(P=>{P.assignments&&(console.log("QuickFill: Shift has assignments:",P.assignments),P.assignments.forEach(V=>{var K;const B=V.worker_id||((K=V.worker)==null?void 0:K.id),Z=V.status;B&&Z!=="cancelled"&&(L.add(B),console.log("QuickFill: Adding worker_id to exclude:",B,"status:",Z))}))})):console.log("QuickFill: No role shifts found for:",w)}console.log(`QuickFill: Found ${L.size} already assigned worker IDs:`,Array.from(L));const D=await q.get("/workers?active=true"),_=(((t=D.data)==null?void 0:t.data)||D.data||[]).filter(u=>{const P=(u.skills_json||[]).includes(w),V=L.has(u.id);return V&&console.log(`QuickFill: Excluding ${u.first_name} ${u.last_name} (ID: ${u.id}) - already assigned`),P&&!V});if(console.log(`QuickFill: Found ${_.length} eligible workers for "${w}"`),console.log("QuickFill: Eligible workers:",_.map(u=>`${u.first_name} ${u.last_name}`)),E(_),W){const u=Number(W)||0;z(u),console.log(`QuickFill: Default pay rate for ${w}: $${u}/hr`)}else console.log(`QuickFill: No default pay rate provided for ${w}`)}catch(l){console.error("Error loading workers:",l)}finally{r(!1)}})())},[d,p,w,W]);const T=c.useMemo(()=>{const a=y.trim().toLowerCase(),t=n;return a?t.filter(l=>`${l.first_name} ${l.last_name}`.toLowerCase().includes(a)||(l.email||"").toLowerCase().includes(a)):t},[n,y]),x=i.length,m=a=>{U(t=>t.includes(a)?t.filter(l=>l!==a):t.length>=x?t:[...t,a])},F=async()=>{var v,L,D,S,_,u,P,V,B,Z,K,ee,ae,re,ie;if(g.length===0||x===0)return;f(!0);let a=0,t=0;const l=[];try{const se=g.map(H=>n.find(s=>s.id===H)).filter(Boolean),le=[...i];let te=0;for(;le.length>0&&se.length>0;){const H=se[te%se.length],s=le.shift();try{const o=$[H.id]||Number(N)||0||0,j=await q.post("/staffing",{assignment:{shift_id:s,worker_id:H.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:o}});if(((v=j.data)==null?void 0:v.status)==="success")a+=1;else{t+=1;const R=`${H.first_name} ${H.last_name}`,G=((L=j.data)==null?void 0:L.message)||((S=(D=j.data)==null?void 0:D.error)==null?void 0:S.message)||((u=(_=j.data)==null?void 0:_.errors)==null?void 0:u.join(", "))||"Unknown error";let Q="Unable to assign";const J=String(G).toLowerCase();J.includes("overlapping")||J.includes("conflict")?Q="Has overlapping shift":J.includes("capacity")||J.includes("full")?Q="Shift is full":J.includes("skill")||J.includes("certification")||J.includes("requirement")?Q="Missing required skill":J.includes("status")?Q="Cannot be assigned":Q="Unable to assign",l.push(`${R}: ${Q}`)}}catch(o){t+=1;const j=`${H.first_name} ${H.last_name}`;let R="Unable to assign";const G=((V=(P=o.response)==null?void 0:P.data)==null?void 0:V.message)||((K=(Z=(B=o.response)==null?void 0:B.data)==null?void 0:Z.error)==null?void 0:K.message)||((re=(ae=(ee=o.response)==null?void 0:ee.data)==null?void 0:ae.errors)==null?void 0:re.join(", "))||null;if(G){const Q=String(G).toLowerCase();Q.includes("overlapping")||Q.includes("conflict")?R="Has overlapping shift":Q.includes("capacity")||Q.includes("full")?R="Shift is full":Q.includes("skill")||Q.includes("certification")||Q.includes("requirement")?R="Missing required skill":Q.includes("status")?R="Cannot be assigned":R="Unable to assign"}else((ie=o.response)==null?void 0:ie.status)===422?R="Unable to assign":o.message&&!o.message.includes("status code")&&(R=o.message);l.push(`${j}: ${R}`)}te+=1}let ne="";t>0&&l.length>0&&(ne=l.join(", ")),h({assigned:a,conflicts:t,details:ne})}finally{f(!1)}};if(!d)return null;const k=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,disabled:M,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:F,disabled:M||g.length===0||x===0,className:"btn-primary",children:M?"Filling Shifts...":g.length===1?`Assign worker to ${x} shift${x!==1?"s":""}`:`Assign ${g.length} workers to ${x} shifts`})]});return e.jsxs(de,{isOpen:d,onClose:b,title:`Quick Fill â€” ${w}`,subtitle:`Unfilled shifts: ${x}`,size:"lg",footer:k,children:[e.jsxs("div",{className:"relative",children:[e.jsx(fe,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{value:y,onChange:a=>C(a.target.value),placeholder:"Search eligible workersâ€¦",className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsx("div",{className:"max-h-[340px] overflow-y-auto border border-gray-200 rounded-lg",children:O?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loadingâ€¦"}):T.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"No eligible workers"}):e.jsx("ul",{children:T.map(a=>{const t=g.includes(a.id);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${t?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[a.first_name[0],a.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[a.first_name," ",a.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(a.skills_json||[]).map((l,v)=>{const L=l===w;return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${L?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:l},v)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[$[a.id]&&$[a.id]!==(Number(N)||0)&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ke,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:Number(N)?(Number(N)||0).toString():"Rate",value:$[a.id]||Number(N)||0||"",onChange:l=>{const v=l.target.value;(v===""||/^\d*\.?\d*$/.test(v))&&A(a.id,parseFloat(v)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:l=>l.stopPropagation(),onFocus:l=>l.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>m(a.id),disabled:!t&&g.length>=x,className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${t?"bg-teal-600 text-white border-teal-600":g.length>=x?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:t?"Selected":"Select"})]})]},a.id)})})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(De,{size:16,className:"text-teal-600"}),e.jsxs("span",{children:["Will assign ",e.jsx("strong",{children:g.length})," worker",g.length!==1?"s":""," to ",e.jsx("strong",{children:x})," shift",x!==1?"s":"","."]})]}),(Number(N)||0)>0&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Default rate for ",w,":"]}),e.jsxs("span",{className:"font-medium",children:["$",(Number(N)||0).toFixed(2),"/hr"]})]}),Object.keys($).length>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["ðŸ’¡ Empty fields will use default rate ($",(Number(N)||0).toFixed(2),"/hr)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(Fe,{size:14,className:"text-yellow-600"}),"Conflicts and already-filled shifts will be skipped automatically."]})]})}function We({event:d,isOpen:p,onClose:w,onSuccess:i}){const W=ve(),[b,h]=c.useState(!1),[n,E]=c.useState([]),[g,U]=c.useState(!1),[y,C]=c.useState(null),[O,r]=c.useState({isVisible:!1,message:"",type:"error"}),M=()=>{w(),W(`/events/${d.id}/edit`)},f=[{name:"Bartender",icon:Le},{name:"Banquet Server/Runner",icon:Te},{name:"Captain",icon:Pe},{name:"Event Helper",icon:Me},{name:"Prep Cook",icon:ze}];c.useEffect(()=>{if(d.shifts_by_role&&Array.isArray(d.shifts_by_role)){const x=d.shifts_by_role.map(m=>{const F=m.shifts?m.shifts.length:m.total_shifts||1;return{skill_name:m.skill_name||m.role_name||"",needed_workers:F,pay_rate:m.pay_rate||15,description:"",uniform_id:void 0,cert_id:void 0}});E(x)}},[d]);const $=(x,m,F)=>{const k=[...n];k[x]={...k[x],[m]:F},E(k)},I=()=>{E([...n,{skill_name:"",needed_workers:1,pay_rate:15,description:"",uniform_id:void 0,cert_id:void 0}])},N=x=>{var m;if(n[x].needed_workers>0){const F=(m=d.shifts_by_role)==null?void 0:m[x];if(F&&(F.assigned_workers>0||F.filled_shifts>0)){r({isVisible:!0,message:"Cannot remove role with assigned workers. Please unassign workers first.",type:"error"});return}}E(n.filter((F,k)=>k!==x))},z=(x,m)=>{f.find(k=>k.name===m);const F=[...n];F[x]={...F[x],skill_name:m},E(F),C(null)},A=async()=>{var x,m,F;if(d.schedule&&new Date(d.schedule.start_time_utc)<=new Date){r({isVisible:!0,message:"Cannot edit event that has already started",type:"error"});return}U(!0);try{const k=await q.patch(`/events/${d.id}`,{event:{roles:n.map(a=>({skill_name:a.skill_name,needed:a.needed_workers,pay_rate:a.pay_rate,description:a.description,uniform_id:a.uniform_id,cert_id:a.cert_id}))}});k.data.status==="success"?(r({isVisible:!0,message:k.data.message||"Event updated successfully",type:"success"}),i(),w()):r({isVisible:!0,message:k.data.message||"Failed to update event",type:"error"})}catch(k){console.error("Failed to update event:",k);const a=(x=k==null?void 0:k.response)==null?void 0:x.data;if((a==null?void 0:a.status)==="validation_error"&&((F=(m=a==null?void 0:a.data)==null?void 0:m.conflicts)!=null&&F.length)){const t=a.data.conflicts.map(l=>{const v=new Date(l.conflicting_shift_start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),L=new Date(l.conflicting_shift_end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});return`${l.worker_name} conflicts with ${l.conflicting_event_title} (${v} â€“ ${L})`});r({isVisible:!0,message:`Can't save changes: ${t.length} worker${t.length!==1?"s":""} would be double-booked
â€¢ `+t.join(`
â€¢ `),type:"error"})}else r({isVisible:!0,message:(a==null?void 0:a.message)||"Failed to update event",type:"error"})}finally{U(!1)}},T=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:w,disabled:g,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:A,disabled:g,className:"btn-primary",children:g?"Saving...":"Save Changes"})]});return e.jsxs(e.Fragment,{children:[e.jsx(de,{isOpen:p,onClose:w,title:`Edit Event: ${d.title}`,size:"lg",footer:T,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Event Details"}),e.jsxs("button",{onClick:M,className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-white border border-gray-300 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all shadow-sm",children:[e.jsx(Se,{size:14}),"Edit"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Venue"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:d.venue.name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:new Date(d.schedule.start_time_utc).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"space-y-1 md:col-span-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Location"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900 leading-relaxed",children:d.venue.formatted_address})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Time"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[new Date(d.schedule.start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})," - ",new Date(d.schedule.end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})]})]}),e.jsx("div",{})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"Roles"}),e.jsxs("button",{onClick:I,className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white text-sm font-semibold rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(pe,{size:16}),"Add Role"]})]}),n.map((x,m)=>{var F,k;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[e.jsxs("div",{className:"flex-1 relative overflow-visible",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Role Name *"}),e.jsxs("div",{className:"relative",style:{zIndex:y===m?1e3:1},children:[e.jsxs("button",{type:"button",onClick:()=>C(y===m?null:m),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white text-left flex items-center justify-between",children:[x.skill_name?e.jsxs("div",{className:"flex items-center gap-2",children:[((F=f.find(a=>a.name===x.skill_name))==null?void 0:F.icon)&&e.jsx("img",{src:f.find(a=>a.name===x.skill_name).icon,alt:x.skill_name,className:"w-5 h-5"}),e.jsx("span",{className:"text-gray-900",children:x.skill_name})]}):e.jsx("span",{className:"text-gray-400",children:"Pick the Skills the Worker Has"}),e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M19 9l-7 7-7-7"})})]}),y===m&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border-2 border-gray-200 rounded-xl shadow-2xl z-[9999] max-h-[300px] overflow-y-auto w-full min-w-max",children:f.filter(a=>!n.some((t,l)=>l!==m&&t.skill_name===a.name)).map(a=>e.jsxs("div",{onClick:()=>z(m,a.name),className:"flex items-center gap-3 px-4 py-3 cursor-pointer hover:bg-teal-50 border-b border-gray-100 last:border-0",children:[e.jsx("img",{src:a.icon,width:"24",height:"24",alt:a.name,className:"flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.name})]},a.name))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Needed Workers *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>$(m,"needed_workers",Math.max(1,x.needed_workers-1)),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"-"}),e.jsx("input",{type:"number",value:x.needed_workers,onChange:a=>$(m,"needed_workers",parseInt(a.target.value)||1),min:"1",className:"w-16 px-2 py-2 border border-gray-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-teal-500 font-medium"}),e.jsx("button",{onClick:()=>$(m,"needed_workers",x.needed_workers+1),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"+"}),e.jsx("button",{onClick:()=>N(m),className:"ml-2 w-8 h-8 flex items-center justify-center text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove role",children:e.jsx(he,{size:18})})]})]})]}),((k=d.shifts_by_role)==null?void 0:k[m])&&(d.shifts_by_role[m].assigned_workers>0||d.shifts_by_role[m].filled_shifts>0)&&e.jsxs("div",{className:"text-sm text-amber-600 font-semibold bg-amber-50 px-3 py-2 rounded-lg",children:[d.shifts_by_role[m].assigned_workers||d.shifts_by_role[m].filled_shifts," worker(s) assigned"]})]},m)})]})]})}),e.jsx(_e,{isVisible:O.isVisible,message:O.message,type:O.type,onClose:()=>r({...O,isVisible:!1})})]})}function ds(){const d=ve(),[p,w]=$e(),i=(p.get("tab")==="completed"?"completed":p.get("tab"))||"active",W=p.get("filter")||"needs_workers",[b,h]=c.useState(i),[n,E]=c.useState(W),[g,U]=c.useState(""),[y,C]=c.useState("date"),[O,r]=c.useState(!0),[M,f]=c.useState([]),[$,I]=c.useState(new Set),[N,z]=c.useState({isOpen:!1}),[A,T]=c.useState({isVisible:!1,message:"",type:"success"}),[x,m]=c.useState({isOpen:!1,isLoading:!1}),[F,k]=c.useState({isOpen:!1,isLoading:!1}),[a,t]=c.useState({isOpen:!1,isLoading:!1}),[l,v]=c.useState({isOpen:!1,unfilledShiftIds:[]}),[L,D]=c.useState({isOpen:!1});c.useEffect(()=>{S()},[b,n,p]),c.useEffect(()=>{const s=(p.get("tab")==="completed"?"completed":p.get("tab"))||"active",o=p.get("filter")||"all";s!==b&&h(s),o!==n&&E(o)},[p,b,n]),c.useEffect(()=>{const s=p.get("event_id"),o=p.get("shift_id");if(s){const j=parseInt(s);isNaN(j)||(I(new Set([j])),o&&console.log(`Auto-expanding event ${j} with shift ${o}`))}},[p]);async function S(){r(!0);try{const s=b==="completed"?"completed":b,o=p.get("date");let j=`/events?tab=${s}`;n!=="all"&&(j+=`&filter=${n}`),o&&(j+=`&date=${o}`),console.log("Loading events with URL:",j,"filterStatus:",n,"date:",o);const R=await q.get(j);R.data.status==="success"&&(console.log("Received events:",R.data.data.length),f(R.data.data))}catch(s){console.error("Failed to load events:",s)}finally{r(!1)}}const _=s=>{h(s),w({tab:s}),E(s==="active"?"needs_workers":"all")},u=s=>{E(s);const o=new URLSearchParams;o.set("tab",b),s!=="all"&&o.set("filter",s),w(o)},P=s=>{const o=new Set($);o.has(s)?o.delete(s):o.add(s),I(o)};async function V(s){const o=M==null?void 0:M.find(j=>j.id===s);t({isOpen:!0,isLoading:!1,eventId:s,eventTitle:o==null?void 0:o.title})}async function B(){if(a.eventId){t(s=>({...s,isLoading:!0}));try{const s=await q.delete(`/events/${a.eventId}`);s.data.status==="success"?(t({isOpen:!1,isLoading:!1}),T({isVisible:!0,message:`"${s.data.event_title}" moved to trash`,type:"success",action:{label:"Undo",onClick:()=>Z(s.data.event_id),variant:"primary"}}),S()):T({isVisible:!0,message:s.data.message||"Unable to delete event",type:"error"})}catch(s){console.error("Failed to delete event:",s),T({isVisible:!0,message:"Unable to delete event",type:"error"})}finally{t(s=>({...s,isLoading:!1}))}}}async function Z(s){try{const o=await q.post(`/events/${s}/restore`);o.data.status==="success"?(T({isVisible:!0,message:"Event restored to draft",type:"success"}),S()):T({isVisible:!0,message:o.data.message||"Unable to restore event",type:"error"})}catch(o){console.error("Failed to restore event:",o),T({isVisible:!0,message:"Unable to restore event",type:"error"})}}function K(){t({isOpen:!1,isLoading:!1})}function ee(s){m({isOpen:!0,eventId:s,isLoading:!1})}async function ae(){if(x.eventId){m(s=>({...s,isLoading:!0}));try{const s=await q.post(`/events/${x.eventId}/publish`);s.data.status==="success"?(T({isVisible:!0,message:"Event published successfully",type:"success"}),m({isOpen:!1,isLoading:!1}),S()):(T({isVisible:!0,message:s.data.message||"Unable to publish event",type:"error"}),m({isOpen:!1,isLoading:!1}))}catch(s){console.error("Failed to publish event:",s),T({isVisible:!0,message:"Unable to publish event",type:"error"}),m({isOpen:!1,isLoading:!1})}}}function re(){m({isOpen:!1,isLoading:!1})}function ie(s,o){k({isOpen:!0,assignmentId:s,isLoading:!1,workerName:o})}async function se(){var s,o;if(F.assignmentId){k(j=>({...j,isLoading:!0}));try{const j=await q.delete(`/staffing/${F.assignmentId}`);((s=j.data)==null?void 0:s.status)==="success"?(T({isVisible:!0,message:"Worker unassigned successfully",type:"success"}),k({isOpen:!1,isLoading:!1}),S()):(T({isVisible:!0,message:((o=j.data)==null?void 0:o.message)||"Unable to unassign worker",type:"error"}),k({isOpen:!1,isLoading:!1}))}catch(j){console.error("Failed to unassign worker:",j),T({isVisible:!0,message:"Unable to unassign worker",type:"error"}),k({isOpen:!1,isLoading:!1})}}}const le=s=>{z({isOpen:!0,shiftId:s})},te=()=>{z({isOpen:!1})},ne=()=>{te(),T({isVisible:!0,message:"Worker assigned",type:"success"}),S()},H=M.filter(s=>{var o;if(g){const j=g.toLowerCase();if(!(s.title.toLowerCase().includes(j)||((o=s.venue)==null?void 0:o.name.toLowerCase().includes(j))))return!1}if(b==="active")switch(n){case"needs_workers":return s.unfilled_roles_count>0;case"partially_filled":return s.unfilled_roles_count>0&&s.assigned_workers_count>0;case"fully_staffed":return s.unfilled_roles_count===0&&s.assigned_workers_count>0;case"all":default:return!0}return!0}).sort((s,o)=>{var j,R;switch(y){case"name":return s.title.localeCompare(o.title);case"staffing":return s.staffing_percentage-o.staffing_percentage;case"date":default:const G=((j=s.schedule)==null?void 0:j.start_time_utc)||s.created_at,Q=((R=o.schedule)==null?void 0:R.start_time_utc)||o.created_at;return new Date(G).getTime()-new Date(Q).getTime()}});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Events"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage events and assign workers"})]}),e.jsxs("button",{onClick:()=>d("/events/create"),className:"flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(pe,{size:20}),"Create New Event"]})]}),p.get("date")&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-teal-50 border border-teal-200 rounded-lg",children:[e.jsx(me,{size:16,className:"text-teal-600"}),e.jsxs("span",{className:"text-sm font-medium text-teal-900",children:["Showing events for ",Y(X(p.get("date")),"EEEE, MMMM d, yyyy")]}),e.jsx("button",{onClick:()=>{const s=new URLSearchParams(p);s.delete("date"),w(s)},className:"ml-auto text-teal-600 hover:text-teal-700",title:"Clear date filter",children:e.jsx(oe,{size:16})})]})]}),e.jsxs("div",{className:"flex gap-6 border-b border-gray-200 mb-6",children:[e.jsx("button",{onClick:()=>_("draft"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${b==="draft"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Draft Events"}),e.jsx("button",{onClick:()=>_("active"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${b==="active"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Active Events"}),e.jsx("button",{onClick:()=>_("completed"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${b==="completed"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Completed Events"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 max-w-md relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search events or venues...",value:g,onChange:s=>U(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),e.jsxs("select",{value:y,onChange:s=>C(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"name",children:"Sort by Name"}),b!=="draft"&&e.jsx("option",{value:"staffing",children:"Sort by Staffing"})]}),b==="active"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u("all"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${n==="all"?"bg-gray-100 text-gray-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"All"}),e.jsx("button",{onClick:()=>u("needs_workers"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${n==="needs_workers"?"bg-red-100 text-red-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Needs Workers"}),e.jsx("button",{onClick:()=>u("fully_staffed"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${n==="fully_staffed"?"bg-green-100 text-green-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Ready"})]})]}),O?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600"})}):e.jsxs(e.Fragment,{children:[b==="draft"&&e.jsx(Ie,{events:H,onDelete:V,onPublish:ee,onNavigate:s=>d(s),searchQuery:g}),b==="active"&&e.jsx(Ve,{events:H,expandedEvents:$,onToggleEvent:P,onAssignWorker:le,onUnassign:ie,onQuickFill:(s,o,j,R)=>v({isOpen:!0,eventId:s,roleName:o,unfilledShiftIds:j,payRate:R}),onPublish:ee,onDelete:V,onEdit:s=>D({isOpen:!0,event:s}),searchQuery:g}),b==="completed"&&e.jsx(Qe,{events:H,expandedEvents:$,onToggleEvent:P,searchQuery:g})]})]}),N.isOpen&&N.shiftId&&e.jsx(Ae,{shiftId:N.shiftId,onClose:te,onSuccess:ne}),e.jsx(_e,{isVisible:A.isVisible,message:A.message,type:A.type,action:A.action,onClose:()=>T({...A,isVisible:!1})}),e.jsx(xe,{isOpen:x.isOpen,onClose:re,onConfirm:ae,title:"Publish Event",message:"Ready to publish? This will create shifts and make them available for worker assignment.",confirmText:x.isLoading?"Publishingâ€¦":"Publish",cancelText:"Cancel",isLoading:x.isLoading,isDestructive:!1}),e.jsx(xe,{isOpen:F.isOpen,onClose:()=>k({isOpen:!1,isLoading:!1}),onConfirm:se,title:"Unassign Worker",message:`Remove ${F.workerName||"this worker"} from this shift?`,confirmText:F.isLoading?"Removingâ€¦":"Unassign",cancelText:"Cancel",isLoading:F.isLoading,isDestructive:!0}),e.jsx(xe,{isOpen:a.isOpen,onClose:K,onConfirm:B,title:"Delete Event",message:`Delete "${a.eventTitle}"? This action cannot be undone.`,confirmText:a.isLoading?"Deletingâ€¦":"Delete",cancelText:"Cancel",isLoading:a.isLoading,isDestructive:!0}),e.jsx(Oe,{isOpen:l.isOpen,eventId:l.eventId||0,roleName:l.roleName||"",unfilledShiftIds:l.unfilledShiftIds,defaultPayRate:l.payRate,onClose:()=>v({isOpen:!1,unfilledShiftIds:[]}),onDone:({assigned:s,conflicts:o,details:j})=>{v({isOpen:!1,unfilledShiftIds:[]});let R=`Assigned ${s} workers â€¢ ${o} skipped`;o>0&&j&&(R+=`: ${j}`),T({isVisible:!0,message:R,type:o>0?"error":"success"}),S()}}),L.event&&e.jsx(We,{event:L.event,isOpen:L.isOpen,onClose:()=>D({isOpen:!1,event:void 0}),onSuccess:()=>{S(),D({isOpen:!1,event:void 0})}})]})}function Ie({events:d,onDelete:p,onPublish:w,onNavigate:i,searchQuery:W}){const b=n=>{if(!n)return"No date set";const E=X(n);return Y(E,"MMM d, yyyy")},h=n=>{if(!n)return"";const E=X(n);return Y(E,"h:mm a")};return d.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:W?"No draft events found":"No draft events yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:W?"Try adjusting your search query":"Create your first event to get started"}),!W&&e.jsxs("button",{onClick:()=>i("/events/create"),className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:[e.jsx(pe,{size:20}),"Create Event"]})]}):e.jsx("div",{className:"space-y-4",children:d.map(n=>e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[n.title,n.schedule&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-600",children:["â€¢ ",h(n.schedule.start_time_utc),"â€“",h(n.schedule.end_time_utc)]})]})}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Draft"})]}),n.venue&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[e.jsx(ce,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:n.venue.name})]}),n.schedule&&e.jsx("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{children:b(n.schedule.start_time_utc)})]})}),n.total_workers_needed>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ue,{size:16,className:"text-gray-400"}),e.jsxs("span",{children:[n.total_workers_needed," workers needed"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>i(`/events/${n.id}/edit`),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Edit",children:e.jsx(Se,{size:18})}),e.jsx("button",{onClick:()=>w(n.id),className:"px-4 py-2 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Publish"}),e.jsx("button",{onClick:()=>p(n.id),className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition",title:"Delete",children:e.jsx(he,{size:18})})]})]})})},n.id))})}function Ve({events:d,expandedEvents:p,onToggleEvent:w,onAssignWorker:i,onUnassign:W,onQuickFill:b,onPublish:h,onDelete:n,onEdit:E,searchQuery:g}){const U=r=>{const M=X(r);return Y(M,"EEE, MMM d, yyyy")},y=r=>{const M=X(r);return Y(M,"h:mm a")},C=r=>{if(!r.schedule)return!1;const f=(X(r.schedule.start_time_utc).getTime()-new Date().getTime())/(1e3*60*60);return f>0&&f<=48},O=r=>{switch(r){case"fully_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[e.jsx(ye,{size:14}),"Ready"]});case"partially_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full",children:[e.jsx(ge,{size:14}),"Partial"]});case"needs_workers":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[e.jsx(oe,{size:14}),"Needs Workers"]});default:return null}};return d.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:g?"No active events found":"No active events"}),e.jsx("p",{className:"text-gray-600",children:g?"Try adjusting your search query or filters":"Publish draft events to see them here"})]}):e.jsx("div",{className:"space-y-4",children:d.map(r=>{const M=p.has(r.id);return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{onClick:()=>w(r.id),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[r.title,r.schedule&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-600",children:["â€¢ ",y(r.schedule.start_time_utc),"â€“",y(r.schedule.end_time_utc)]})]})}),O(r.staffing_status)]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[r.venue&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ce,{size:14,className:"text-gray-400"}),r.venue.name]}),r.schedule&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(me,{size:14,className:"text-gray-400"}),e.jsx("span",{children:U(r.schedule.start_time_utc)}),C(r)&&e.jsx("span",{className:"bg-red-600 text-white text-xs font-semibold px-2 py-0.5 rounded-full ml-2","aria-label":"Urgent: starts within 48 hours",children:"Urgent"})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:[r.assigned_workers_count," of ",r.total_workers_needed," roles filled"]}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[r.staffing_percentage,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-full rounded-full transition-all ${r.staffing_percentage===100?"bg-green-500":r.staffing_percentage>0?"bg-yellow-500":"bg-red-500"}`,style:{width:`${r.staffing_percentage}%`}})})]}),r.unfilled_roles_count>0&&e.jsxs("p",{className:"text-sm text-red-600 font-medium",children:[r.unfilled_roles_count," role",r.unfilled_roles_count!==1?"s":""," still need workers"]}),r.shifts_by_role&&r.shifts_by_role.length>0&&e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Est. Cost: "}),e.jsxs("span",{className:"font-semibold text-green-600",children:["$",(()=>{let f=0;return r.shifts_by_role.forEach($=>{$.shifts.forEach(I=>{const N=(new Date(I.end_time_utc).getTime()-new Date(I.start_time_utc).getTime())/36e5;I.assignments.forEach(z=>{const A=Number(z.hourly_rate||I.pay_rate||0);f+=A*N})})}),f.toFixed(0)})()]})]})]}),e.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[(!r.shifts_by_role||r.shifts_by_role.length===0)&&n&&e.jsx("button",{onClick:f=>{f.stopPropagation(),n(r.id)},className:"px-3 py-1.5 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition-colors",children:"Delete Event"}),E&&r.status==="published"&&e.jsx("button",{onClick:f=>{f.stopPropagation(),E(r)},title:"Edit Event",className:"p-1.5 text-teal-600 hover:text-teal-700 hover:bg-teal-50 rounded transition-colors",children:e.jsx(Re,{size:14})}),n&&e.jsx("button",{onClick:f=>{f.stopPropagation(),n(r.id)},title:"Delete",className:"p-1.5 text-red-600 hover:text-red-700 hover:bg-red-50 rounded transition-colors",children:e.jsx(he,{size:14})}),e.jsx("div",{className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:M?e.jsx(Ne,{size:24,className:"text-gray-600 hover:text-gray-800"}):e.jsx(Ce,{size:24,className:"text-gray-600 hover:text-gray-800"})})]})]}),M&&e.jsx("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:r.shifts_by_role&&r.shifts_by_role.length>0?e.jsx("div",{className:"space-y-4",children:r.shifts_by_role.map(f=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:f.role_name}),e.jsxs("span",{className:"text-sm text-gray-600",children:[f.filled_shifts,"/",f.total_shifts," assigned"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[f.filled_shifts<f.total_shifts&&e.jsxs("span",{className:"px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[f.total_shifts-f.filled_shifts," needed"]}),f.filled_shifts<f.total_shifts&&e.jsx("button",{onClick:$=>{var z;$.stopPropagation();const I=f.shifts.filter(A=>A.staffing_progress.percentage<100).sort((A,T)=>new Date(A.start_time_utc).getTime()-new Date(T.start_time_utc).getTime()).map(A=>A.id),N=(z=f.shifts[0])==null?void 0:z.pay_rate;b(r.id,f.role_name,I,N)},className:"px-2.5 py-1 text-xs font-semibold bg-teal-600 text-white rounded hover:bg-teal-700",title:"Quick Fill by Skill",children:"Quick Fill by Skill"})]})]}),e.jsx("div",{className:"space-y-2",children:f.shifts.map(($,I)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 text-gray-700 rounded-md flex items-center justify-center text-xs font-medium",children:I+1}),e.jsxs("span",{className:"text-sm text-gray-700",children:[y($.start_time_utc)," - ",y($.end_time_utc)]}),$.assignments.length>0&&e.jsx("div",{className:"flex items-center gap-1 flex-wrap",children:$.assignments.map(N=>{const z=`${N.worker.first_name} ${N.worker.last_name}`,A=Number(N.hourly_rate||$.pay_rate||0);return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"bg-white text-black border border-gray-200 rounded-full px-2.5 py-1 text-sm font-medium shadow-sm max-w-[140px] truncate",title:`${z} â€¢ $${A.toFixed(0)}/hr`,children:z}),e.jsx("button",{onClick:T=>{T.stopPropagation(),W(N.id,z)},className:"w-5 h-5 flex items-center justify-center text-red-600 hover:text-red-700 hover:bg-red-50 rounded",title:"Unassign worker",children:e.jsx(oe,{size:12})})]},N.id)})})]}),$.staffing_progress.percentage===100?e.jsxs("span",{className:"flex items-center gap-1.5 text-sm font-medium text-green-600",children:[e.jsx(ye,{size:16}),"Assigned"]}):e.jsx("button",{onClick:N=>{N.stopPropagation(),i($.id)},className:"px-3 py-1.5 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Assign Worker"})]},$.id))})]},f.role_name))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:r.status==="draft"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"This event is still in draft status"}),e.jsx("p",{className:"text-sm",children:"Publish the event to generate shifts and assign workers"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"No shifts available"}),e.jsx("p",{className:"text-sm",children:"This event may not have any shifts generated yet"})]})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[r.status==="draft"&&e.jsx("button",{onClick:()=>h(r.id),className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors",children:"Publish Event"}),n&&e.jsx("button",{onClick:()=>n(r.id),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Delete Event"})]})]})})]},r.id)})})}function Qe({events:d,expandedEvents:p,onToggleEvent:w,searchQuery:i}){const W=h=>{const n=X(h);return Y(n,"MMM d, yyyy")},b=h=>{const n=X(h);return Y(n,"h:mm a")};return d.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“‹"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:i?"No past events found":"No past events yet"}),e.jsx("p",{className:"text-gray-600",children:i?"Try adjusting your search query":"Completed events will appear here"})]}):e.jsx("div",{className:"space-y-4",children:d.map(h=>{var g;const n=p.has(h.id);let E=0;return(g=h.shifts_by_role)==null||g.forEach(U=>{U.shifts.forEach(y=>{const C=(new Date(y.end_time_utc).getTime()-new Date(y.start_time_utc).getTime())/36e5;y.assignments.forEach(O=>{const r=O.hours_worked?parseFloat(O.hours_worked.toString()):void 0,M=typeof r=="number"&&!isNaN(r)?r:C;E+=M})})}),E=Number(E)||0,e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{onClick:()=>w(h.id),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:h.title}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Completed"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[h.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(me,{size:14,className:"text-gray-400"}),W(h.schedule.start_time_utc)]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(we,{size:14,className:"text-gray-400"}),b(h.schedule.start_time_utc)," - ",b(h.schedule.end_time_utc)]})]}),h.venue&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ce,{size:14,className:"text-gray-400"}),h.venue.name]})]})]}),e.jsx("div",{className:"ml-4 flex items-center",children:e.jsx("div",{className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:n?e.jsx(Ne,{size:24,className:"text-gray-600 hover:text-gray-800"}):e.jsx(Ce,{size:24,className:"text-gray-600 hover:text-gray-800"})})})]}),n&&h.shifts_by_role&&e.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:[e.jsx("div",{className:"mb-4 p-4 bg-white rounded-lg border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Workers"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:h.assigned_workers_count})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Hours"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:E.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Event Cost"}),e.jsxs("p",{className:"text-2xl font-semibold text-green-600",children:["$",(()=>{let U=0;return h.shifts_by_role.forEach(y=>{y.shifts.forEach(C=>{const O=(new Date(C.end_time_utc).getTime()-new Date(C.start_time_utc).getTime())/36e5;C.assignments.forEach(r=>{const M=Number(r.hourly_rate||C.pay_rate||0);U+=M*O})})}),U.toFixed(0)})()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Staffing"}),e.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[h.staffing_percentage,"%"]})]})]})}),e.jsx("div",{className:"space-y-3",children:h.shifts_by_role.map(U=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:U.role_name}),e.jsx("div",{className:"space-y-2",children:U.shifts.flatMap(y=>y.assignments.map(C=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 text-teal-700 flex items-center justify-center text-sm font-medium",children:[C.worker.first_name[0],C.worker.last_name[0]]}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[C.worker.first_name," ",C.worker.last_name]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[C.hours_worked&&e.jsxs("span",{className:"font-medium",children:[parseFloat(C.hours_worked.toString()).toFixed(2)," hrs"]}),e.jsxs("span",{className:"font-medium text-green-600",children:["$",Number(C.hourly_rate||y.pay_rate||0).toFixed(0),"/hr"]}),C.hours_worked&&e.jsxs("span",{className:"font-semibold text-blue-600",children:["$",(parseFloat(C.hours_worked.toString())*Number(C.hourly_rate||y.pay_rate||0)).toFixed(0)]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[b(y.start_time_utc)," - ",b(y.end_time_utc)]})]})]},C.id)))})]},U.role_name))})]})]},h.id)})})}export{ds as EventsPage};
