import{c as k,j as e,X as w,g as V,a as v,y as u,U as Y,d as Z,v as ee,f as T,p as B}from"./index-Coq_2c83.js";import{b as l}from"./vendor-7daYTdBd.js";import{L as se,E as te}from"./ErrorMessage-D2zEY_FT.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],f=k("check",ae);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],le=k("info",re);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],D=k("triangle-alert",ne),ce=({message:m,type:h="success",onClose:a,duration:x=3e3})=>{l.useEffect(()=>{const i=setTimeout(()=>{a()},x);return()=>clearTimeout(i)},[x,a]);const c={success:"bg-green-50 border-green-200 text-green-900",error:"bg-red-50 border-red-200 text-red-900",info:"bg-blue-50 border-blue-200 text-blue-900",warning:"bg-yellow-50 border-yellow-200 text-yellow-900"},j={success:e.jsx(f,{className:"h-5 w-5 text-green-600"}),error:e.jsx(w,{className:"h-5 w-5 text-red-600"}),info:e.jsx(le,{className:"h-5 w-5 text-blue-600"}),warning:e.jsx(V,{className:"h-5 w-5 text-yellow-600"})};return e.jsx("div",{className:"fixed top-4 right-4 z-50 animate-slide-in",children:e.jsxs("div",{className:`flex items-center gap-3 px-4 py-3 rounded-lg border shadow-lg ${c[h]} min-w-[300px] max-w-[500px]`,children:[j[h],e.jsx("p",{className:"flex-1",children:m}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700",children:e.jsx(w,{className:"h-4 w-4"})})]})})},me=({onClose:m,onSuccess:h})=>{const[a,x]=l.useState("select-worker"),[c,j]=l.useState(null),[i,S]=l.useState([]),[z,I]=l.useState([]),[U,q]=l.useState([]),[O,_]=l.useState(!0),[p,C]=l.useState(!1),[$,b]=l.useState(""),[d,P]=l.useState([]),[y,X]=l.useState(""),[g,G]=l.useState(""),[N,A]=l.useState(null);l.useEffect(()=>{L()},[]);const L=async()=>{try{_(!0),b("");const[s,t]=await Promise.all([v.getWorkers(),v.getShifts({status:"published"})]),n=s.data?.workers||[];I(n.filter(o=>o.active));const r=t.data?.shifts||[];q(r.filter(o=>(o.assignments?.length||0)<o.capacity&&o.status==="published"))}catch(s){const t=s?.response?.data?.error||"Failed to load data";b(t),console.error("Error loading data:",s)}finally{_(!1)}},H=s=>{j(s),x("select-shifts")},J=s=>{S(t=>t.find(r=>r.id===s.id)?t.filter(r=>r.id!==s.id):[...t,s])},K=async()=>{if(!c||i.length===0)return;C(!0),b("");const s=[];for(const t of i)try{await v.createAssignment({shift_id:t.id,worker_id:c.id}),s.push({shift:t,success:!0})}catch(n){const r=n.response?.data?.error||"Failed to assign";s.push({shift:t,success:!1,error:r})}P(s),C(!1),x("confirm")},Q=()=>{const s=d.filter(n=>n.success).length,t=d.length;s>0&&A({message:`Successfully assigned ${c?.first_name} to ${s} of ${t} shifts!`,type:"success"}),h(),m()},M=s=>{try{return T(B(s),"EEE, MMM d, yyyy")}catch{return s}},E=s=>{try{return T(B(s),"h:mm a")}catch{return s}},W=z.filter(s=>{if(!y.trim())return!0;const t=y.toLowerCase().trim(),n=(s.first_name||"").toLowerCase(),r=(s.last_name||"").toLowerCase(),o=(s.email||"").toLowerCase(),R=`${n} ${r}`;return n.includes(t)||r.includes(t)||R.includes(t)||o.includes(t)}),F=U.filter(s=>{if(!g.trim())return!0;const t=g.toLowerCase().trim(),n=(s.client_name||"").toLowerCase(),r=(s.role_needed||"").toLowerCase();return n.includes(t)||r.includes(t)});return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Bulk Assign Worker"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Assign one worker to multiple shifts at once"})]}),e.jsx("button",{onClick:m,className:"text-gray-400 hover:text-gray-600",children:e.jsx(w,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"px-6 py-4 border-b bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("div",{className:`flex items-center gap-2 ${a==="select-worker"?"text-blue-600":a==="select-shifts"||a==="confirm"?"text-green-600":"text-gray-400"}`,children:[e.jsx("div",{className:`h-8 w-8 rounded-full flex items-center justify-center ${a==="select-worker"?"bg-blue-600 text-white":a==="select-shifts"||a==="confirm"?"bg-green-600 text-white":"bg-gray-200"}`,children:a==="select-shifts"||a==="confirm"?e.jsx(f,{className:"h-5 w-5"}):"1"}),e.jsx("span",{className:"text-sm font-medium hidden sm:inline",children:"Select Worker"})]}),e.jsx(u,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{className:`flex items-center gap-2 ${a==="select-shifts"?"text-blue-600":a==="confirm"?"text-green-600":"text-gray-400"}`,children:[e.jsx("div",{className:`h-8 w-8 rounded-full flex items-center justify-center ${a==="select-shifts"?"bg-blue-600 text-white":a==="confirm"?"bg-green-600 text-white":"bg-gray-200"}`,children:a==="confirm"?e.jsx(f,{className:"h-5 w-5"}):"2"}),e.jsx("span",{className:"text-sm font-medium hidden sm:inline",children:"Select Shifts"})]}),e.jsx(u,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{className:`flex items-center gap-2 ${a==="confirm"?"text-blue-600":"text-gray-400"}`,children:[e.jsx("div",{className:`h-8 w-8 rounded-full flex items-center justify-center ${a==="confirm"?"bg-blue-600 text-white":"bg-gray-200"}`,children:"3"}),e.jsx("span",{className:"text-sm font-medium hidden sm:inline",children:"Confirm"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:O?e.jsx(se,{message:"Loading workers and shifts..."}):$?e.jsx(te,{message:$,onRetry:L}):a==="select-worker"?e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Select the worker you want to assign to multiple shifts:"}),e.jsx("input",{type:"text",placeholder:"Search workers...",value:y,onChange:s=>X(s.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:W.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No workers found"}):W.map(s=>e.jsx("button",{onClick:()=>H(s),className:"w-full p-4 border rounded-lg hover:border-blue-500 hover:bg-blue-50 text-left transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:e.jsxs("span",{className:"text-blue-600 font-medium",children:[s.first_name[0],s.last_name[0]]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[s.first_name," ",s.last_name]}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:s.email}),s.skills_json&&s.skills_json.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[s.skills_json.slice(0,3).map(t=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-100 text-gray-600 rounded",children:t},t)),s.skills_json.length>3&&e.jsxs("span",{className:"px-2 py-0.5 text-xs text-gray-500",children:["+",s.skills_json.length-3]})]})]}),e.jsx(u,{className:"h-5 w-5 text-gray-400"})]})},s.id))})]}):a==="select-shifts"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Select shifts to assign ",e.jsxs("strong",{children:[c?.first_name," ",c?.last_name]}),":"]}),e.jsxs("div",{className:"text-sm font-medium text-blue-600",children:[i.length," selected"]})]}),e.jsx("input",{type:"text",placeholder:"Search shifts...",value:g,onChange:s=>G(s.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),F.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Y,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:g?"No shifts match your search":"No shifts available for assignment"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:F.map(s=>{const t=i.some(r=>r.id===s.id),n=s.assignments?.length||0;return e.jsx("label",{className:`block p-4 border rounded-lg cursor-pointer transition-colors ${t?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:()=>J(s),className:"mt-1"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.client_name}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:s.role_needed}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-gray-500 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-3 w-3"}),M(s.start_time_utc)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"h-3 w-3"}),E(s.start_time_utc)," - ",E(s.end_time_utc)]}),e.jsxs("span",{className:"text-xs px-2 py-0.5 bg-gray-100 rounded",children:[n,"/",s.capacity," assigned"]})]})]})]})},s.id)})})]}):e.jsx("div",{className:"space-y-4",children:p?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Assigning worker to shifts..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"This may take a moment"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-1",children:"Assignment Results"}),e.jsxs("p",{className:"text-sm text-blue-700",children:[c?.first_name," ",c?.last_name," was assigned to ",d.filter(s=>s.success).length," of ",d.length," shifts"]})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:d.map((s,t)=>e.jsx("div",{className:`p-4 border rounded-lg ${s.success?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[s.success?e.jsx(f,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}):e.jsx(D,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.shift.client_name}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[s.shift.role_needed," • ",M(s.shift.start_time_utc)]}),s.error&&e.jsxs("div",{className:"text-sm text-red-700 mt-2 flex items-start gap-1",children:[e.jsx(D,{className:"h-4 w-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:s.error})]})]})]})},t))}),e.jsx("div",{className:"pt-4 border-t mt-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:d.filter(s=>s.success).length}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Successful"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:d.filter(s=>!s.success).length}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Failed"})]})]})})]})})}),e.jsx("div",{className:"flex items-center justify-between p-6 border-t bg-gray-50",children:a==="select-worker"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Step 1 of 3"}),e.jsx("button",{onClick:m,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-white",children:"Cancel"})]}):a==="select-shifts"?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{x("select-worker"),S([])},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-white",children:"← Back"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:m,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-white",children:"Cancel"}),e.jsx("button",{onClick:K,disabled:i.length===0||p,className:"btn-green disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Assigning..."]}):e.jsxs(e.Fragment,{children:["Assign to ",i.length," ",i.length===1?"Shift":"Shifts",e.jsx(u,{className:"h-4 w-4"})]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Assignment complete"}),e.jsx("button",{onClick:Q,className:"btn-green",children:"Done"})]})})]}),N&&e.jsx(ce,{message:N.message,type:N.type,onClose:()=>A(null)})]})};export{me as B,f as C,ce as T};
