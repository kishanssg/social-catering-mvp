import{z as X,A as Y,f as x,a as ee,j as e,D as se,d as S,v as L,F as te,y as ae,g as p,G as re,p as C}from"./index-By8ML5kS.js";import{e as ie,b as o,L as u}from"./vendor-7daYTdBd.js";import{u as ne,A as le}from"./AssignmentStatusBadge-fGFLxp7s.js";import{L as P,E as F}from"./ErrorMessage-B4s_tp88.js";import{M as R}from"./map-pin-Bm2MzF6z.js";import{a as ce,F as de}from"./addDays-_CtwHqAs.js";function O(l,r,g){return ce(l,r*7,g)}function oe(l,r,g){return O(l,-1,g)}const pe=()=>{const{id:l}=ie(),[r,g]=o.useState(null),[I,$]=o.useState(!0),[D,U]=o.useState(""),[h,N]=o.useState(new Date),[v,H]=o.useState(""),y=o.useMemo(()=>X(h,{weekStartsOn:0}),[h]),b=o.useMemo(()=>Y(h,{weekStartsOn:0}),[h]),G=o.useMemo(()=>({worker_id:l?parseInt(l):void 0,start_date:x(y,"yyyy-MM-dd"),end_date:x(b,"yyyy-MM-dd"),status:v||void 0}),[l,y,b,v]),{assignments:c,loading:z,error:E}=ne(G);o.useEffect(()=>{l&&w(parseInt(l))},[l]);const w=async s=>{try{$(!0);const t=await ee.getWorker(s);g(t.data.worker)}catch(t){U("Failed to load worker"),console.error("Error loading worker:",t)}finally{$(!1)}},B=s=>{try{return x(C(s),"EEE, MMM d")}catch{return s}},m=s=>{try{return x(C(s),"h:mm a")}catch{return s}},W=()=>c.reduce((s,t)=>{if(t.status==="cancelled")return s;const i=new Date(t.shift.start_time_utc),a=(new Date(t.shift.end_time_utc).getTime()-i.getTime())/(1e3*60*60);return s+a},0),_=()=>c.reduce((s,t)=>{if(t.status==="cancelled"||!t.shift.pay_rate)return s;const i=new Date(t.shift.start_time_utc),a=(new Date(t.shift.end_time_utc).getTime()-i.getTime())/(1e3*60*60);return s+a*t.shift.pay_rate},0),V=()=>{const s=new Date;return c.filter(t=>new Date(t.shift.start_time_utc)>s&&t.status==="assigned")},Z=()=>c.filter(s=>s.status==="completed"),k=(()=>{const s=[],t=c.filter(i=>i.status==="assigned");for(let i=0;i<t.length;i++)for(let n=i+1;n<t.length;n++){const a=t[i],d=t[n],A=new Date(a.shift.start_time_utc),f=new Date(a.shift.end_time_utc),j=new Date(d.shift.start_time_utc),Q=new Date(d.shift.end_time_utc);A<Q&&j<f&&s.push({type:"time_overlap",assignments:[a,d],message:`Time conflict: ${a.shift.client_name} (${m(a.shift.start_time_utc)}-${m(a.shift.end_time_utc)}) overlaps with ${d.shift.client_name} (${m(d.shift.start_time_utc)}-${m(d.shift.end_time_utc)})`})}return s})(),q=()=>{N(oe(h))},J=()=>{N(O(h,1))},M=()=>{N(new Date)},T=()=>`${x(y,"MMM d")} - ${x(b,"MMM d, yyyy")}`,K=()=>{if(!r)return;const s=[["Date","Start Time","End Time","Client","Role","Location","Status","Pay Rate","Hours","Estimated Pay"].join(","),...c.map(a=>{const d=new Date(a.shift.start_time_utc),f=(new Date(a.shift.end_time_utc).getTime()-d.getTime())/(1e3*60*60),j=a.shift.pay_rate?(f*a.shift.pay_rate).toFixed(2):"N/A";return[x(C(a.shift.start_time_utc),"yyyy-MM-dd"),m(a.shift.start_time_utc),m(a.shift.end_time_utc),`"${a.shift.client_name}"`,`"${a.shift.role_needed}"`,`"${a.shift.location||"N/A"}"`,a.status,a.shift.pay_rate?`$${a.shift.pay_rate}`:"N/A",f.toFixed(1),j?`$${j}`:"N/A"].join(",")}),["","","","","","","TOTAL","",W().toFixed(1),`$${_().toFixed(2)}`].join(",")].join(`
`),t=new Blob([s],{type:"text/csv;charset=utf-8;"}),i=window.URL.createObjectURL(t),n=document.createElement("a");n.href=i,n.download=`${r.first_name}_${r.last_name}_schedule_${T().replace(/[^a-zA-Z0-9]/g,"_")}.csv`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(i)};return I?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(P,{message:"Loading worker schedule..."})}):D||!r?e.jsx("div",{className:"py-8",children:e.jsx(F,{message:D||"Worker not found",onRetry:()=>l&&w(parseInt(l))})}):r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-4",children:[e.jsx(u,{to:"/dashboard",className:"hover:text-gray-900",children:"Home"}),e.jsx("span",{children:"/"}),e.jsx(u,{to:"/workers",className:"hover:text-gray-900",children:"Workers"}),e.jsx("span",{children:"/"}),e.jsxs(u,{to:`/workers/${r.id}`,className:"hover:text-gray-900",children:[r.first_name," ",r.last_name]}),e.jsx("span",{children:"/"}),e.jsx("span",{className:"text-gray-900 font-medium",children:"Schedule"})]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:[r.first_name," ",r.last_name,"'s Schedule"]}),e.jsx("p",{className:"text-gray-500 mt-1",children:r.email})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:K,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),"Export"]}),e.jsx(u,{to:`/workers/${r.id}`,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"View Profile"})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(S,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Email"}),e.jsx("div",{className:"font-medium text-gray-900",children:r.email})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(L,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Phone"}),e.jsx("div",{className:"font-medium text-gray-900",children:r.phone||"No phone number"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(R,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Status"}),e.jsx("div",{className:"font-medium text-gray-900",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${r.active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:r.active?"Active":"Inactive"})})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:q,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Previous Week"]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:T()}),e.jsx("button",{onClick:M,className:"text-sm text-blue-600 hover:text-blue-700 mt-1",children:"Go to Current Week"})]}),e.jsxs("button",{onClick:J,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2",children:["Next Week",e.jsx(ae,{className:"h-4 w-4"})]})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx(de,{className:"h-4 w-4 text-gray-400"}),e.jsxs("select",{value:v,onChange:s=>H(s.target.value),className:"px-3 py-1 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"no_show",children:"No Show"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-3 space-y-4",children:E?e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(p,{className:"h-16 w-16 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error Loading Schedule"}),e.jsx("p",{className:"text-gray-500 mb-6",children:E}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Retry"})]}):z?e.jsx("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:e.jsx(P,{message:"Loading assignments..."})}):c.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(S,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No shifts this week"}),e.jsxs("p",{className:"text-gray-500 mb-6",children:[r.first_name," doesn't have any scheduled shifts for this week. Try selecting a different week or create a new shift assignment."]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:M,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Go to Current Week"}),e.jsx(u,{to:"/shifts",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"View All Shifts"})]})]}):e.jsxs("div",{className:"space-y-4",children:[k.length>0&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(p,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-red-900 mb-2",children:"Schedule Conflicts Detected"}),e.jsx("div",{className:"space-y-2",children:k.map((s,t)=>e.jsx("div",{className:"text-sm text-red-700",children:s.message},t))}),e.jsx("p",{className:"text-sm text-red-600 mt-2",children:"Please resolve these conflicts by adjusting shift times or reassigning workers."})]})]})}),c.map(s=>{const t=k.some(i=>i.assignments.some(n=>n.id===s.id));return e.jsx("div",{className:`rounded-lg shadow p-6 hover:shadow-md transition-shadow ${t?"bg-red-50 border border-red-200":"bg-white"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[t&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 mb-2",children:[e.jsx(p,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Schedule Conflict"})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-900",children:[e.jsx(S,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"font-semibold",children:B(s.shift.start_time_utc)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm",children:[m(s.shift.start_time_utc)," - ",m(s.shift.end_time_utc)]})]})]}),e.jsx(u,{to:`/shifts/${s.shift.id}`,className:"text-lg font-semibold text-blue-600 hover:text-blue-700 mb-2 block",children:s.shift.client_name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:s.shift.role_needed}),s.shift.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"h-4 w-4"}),s.shift.location]}),s.shift.pay_rate&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"h-4 w-4"}),"$",s.shift.pay_rate,"/hr"]})]})]}),e.jsx("div",{className:"ml-6",children:e.jsx(le,{status:s.status})})]})},s.id)})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Week Summary"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Total Shifts"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:c.length})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Upcoming"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:V().length})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Completed"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:Z().length})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Total Hours"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:W().toFixed(1)})]}),_()>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Est. Earnings"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["$",_().toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Worker Info"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Phone"}),e.jsx("div",{className:"text-gray-900",children:r.phone||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Email"}),e.jsx("div",{className:"text-gray-900 text-sm break-words",children:r.email})]}),r.skills_json&&r.skills_json.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-2",children:"Skills"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:r.skills_json.map(s=>e.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded-full",children:s},s))})]})]})]}),c.some(s=>{const t=new Date(s.shift.start_time_utc),i=new Date(s.shift.end_time_utc);return c.some(n=>{if(n.id===s.id)return!1;const a=new Date(n.shift.start_time_utc),d=new Date(n.shift.end_time_utc);return t<d&&i>a})})&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(p,{className:"h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-yellow-900",children:"Scheduling Conflicts"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"This worker has overlapping shift assignments this week."})]})]})})]})]})]}):e.jsx("div",{className:"py-8",children:e.jsx(F,{message:"Worker not found",onRetry:()=>l&&w(parseInt(l))})})};export{pe as default};
