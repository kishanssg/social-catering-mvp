import{a as N,j as e,C as U}from"./index-DT4fCdgf.js";import{i as F,b as R,r as x}from"./vendor-79DyBOV9.js";import{L as D}from"./LoadingSpinner-CLe2BCcs.js";import{A as L,P as _}from"./phone-D7kKx0G7.js";import{C as P}from"./calendar-D7T5JDE7.js";import{M as T}from"./map-pin-_CSeSjMG.js";import{U as M}from"./user-CNU3rjzy.js";import{U as W}from"./users-C34N6mm2.js";import{F as B}from"./file-text-D5B7bITI.js";import{C as I}from"./chevron-down-CA8_4yR8.js";function q(){const{id:u}=F(),c=R(),[s,h]=x.useState(null),[w,f]=x.useState(!0),[v,k]=x.useState(new Set),[i,j]=x.useState(null);x.useEffect(()=>{S()},[u]);async function S(){var t;f(!0);try{const a=await N.get(`/events/${u}`);if(a.data.status==="success"){h(a.data.data);try{const l=await N.get(`/events/${u}/approvals`);if(((t=l.data)==null?void 0:t.status)==="success"){const n=l.data.data.assignments||[],d=n.length,o=n.filter(m=>m.approved).length;j({approved:o,total:d})}}catch{j(null)}}}catch(a){console.error("Failed to load event:",a),h(null)}finally{f(!1)}}const C=t=>{const a=new Set(v);a.has(t)?a.delete(t):a.add(t),k(a)};if(w)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(D,{message:"Loading event details..."})});if(!s)return e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"❌"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Event Not Found"}),e.jsx("button",{onClick:()=>c("/events"),className:"mt-4 px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition",children:"Back to Events"})]})});const A=t=>new Date(t).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),g=t=>new Date(t).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),E=s.shifts.reduce((t,a)=>(t[a.role_needed]||(t[a.role_needed]=[]),t[a.role_needed].push(a),t),{});return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-5xl mx-auto p-8",children:[e.jsxs("button",{onClick:()=>c("/events"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-6 transition-colors",children:[e.jsx(L,{size:20}),"Back to Events"]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 mb-2",children:s.title}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-green-100 text-green-700 text-sm font-medium rounded-full",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"}),s.status.charAt(0).toUpperCase()+s.status.slice(1)]}),i&&(i.total>0?i.approved===i.total?e.jsx("span",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-emerald-100 text-emerald-700 text-sm font-medium rounded-full",children:"✓ All Hours Approved"}):e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-amber-100 text-amber-700 text-sm font-medium rounded-full",children:["Approvals ",i.approved,"/",i.total]}):null)]})]}),e.jsx("div",{className:"flex items-center gap-2",children:s.unfilled_roles_count>0&&e.jsx("button",{onClick:()=>c(`/events?tab=active&event_id=${s.id}`),className:"px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Assign Workers"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6",children:[s.schedule&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mb-2",children:[e.jsx(P,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"Date & Time"})]}),e.jsx("p",{className:"text-gray-900 font-medium",children:A(s.schedule.start_time_utc)}),e.jsxs("p",{className:"text-gray-600",children:[g(s.schedule.start_time_utc)," - ",g(s.schedule.end_time_utc)]}),s.schedule.break_minutes>0&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[s.schedule.break_minutes," min break"]})]}),s.venue&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mb-2",children:[e.jsx(T,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"Venue"})]}),e.jsx("p",{className:"text-gray-900 font-medium",children:s.venue.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:s.venue.formatted_address}),s.venue.phone&&e.jsxs("p",{className:"text-gray-600 text-sm mt-1",children:[e.jsx(_,{size:14,className:"inline mr-1"}),s.venue.phone]})]}),s.supervisor_name&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mb-2",children:[e.jsx(M,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"Event Supervisor"})]}),e.jsx("p",{className:"text-gray-900 font-medium",children:s.supervisor_name}),s.supervisor_phone&&e.jsxs("p",{className:"text-gray-600 text-sm",children:[e.jsx(_,{size:14,className:"inline mr-1"}),s.supervisor_phone]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mb-2",children:[e.jsx(W,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"Staffing Status"})]}),e.jsxs("p",{className:"text-gray-900 font-medium mb-2",children:[s.assigned_workers_count||0," of ",s.total_workers_needed||0," workers hired"]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${s.staffing_percentage===100?"bg-green-500":s.staffing_percentage>0?"bg-yellow-500":"bg-red-500"}`,style:{width:`${s.staffing_percentage}%`}})}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[s.staffing_percentage,"% complete"]})]})]}),s.check_in_instructions&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mb-2",children:[e.jsx(B,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"Check-in Instructions"})]}),e.jsx("p",{className:"text-gray-700 text-sm leading-relaxed",children:s.check_in_instructions})]}),s.venue&&(s.venue.arrival_instructions||s.venue.parking_info)&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[s.venue.arrival_instructions&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Arrival Instructions:"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.venue.arrival_instructions})]}),s.venue.parking_info&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Parking:"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.venue.parking_info})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Roles & Shifts"}),e.jsx("div",{className:"space-y-3",children:Object.entries(E).map(([t,a])=>{const l=v.has(t),n=s.skill_requirements.find(r=>r.skill_name===t),d=(n==null?void 0:n.needed_workers)??a.length,o=a.slice(0,d),m=Math.max(a.length-o.length,0);m>0&&console.warn(`Role ${t} has ${m} orphaned shift(s) beyond needed count.`,{roleName:t,needed:d,totalShifts:a.length});const b=o.filter(r=>r.staffing_progress.percentage===100).length,y=d,p=Math.max(y-b,0);return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("button",{onClick:()=>C(t),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:t}),e.jsxs("p",{className:"text-sm text-gray-600",children:[b," of ",y," shifts filled",(n==null?void 0:n.pay_rate)&&e.jsxs("span",{className:"ml-2 text-gray-500",children:["• $",n.pay_rate,"/hr"]})]})]}),p===0?e.jsx("span",{className:"px-2.5 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:"All Filled"}):e.jsxs("span",{className:"px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[p," Need Workers"]}),l?e.jsx(U,{size:20,className:"text-gray-400"}):e.jsx(I,{size:20,className:"text-gray-400"})]})}),l&&e.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 px-4 py-3",children:[n&&e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-200",children:[n.description&&e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:n.description}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.uniform_name&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-white border border-gray-200 text-xs text-gray-600 rounded",children:["Uniform: ",n.uniform_name]}),n.certification_name&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-white border border-gray-200 text-xs text-gray-600 rounded",children:["Cert: ",n.certification_name]})]})]}),m>0&&e.jsxs("div",{className:"text-sm text-amber-600 font-medium mb-2",children:["Showing first ",d," of ",a.length," shifts (unassigned extras hidden)"]}),e.jsx("div",{className:"space-y-2",children:o.map((r,$)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-white rounded border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Shift ",$+1]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[g(r.start_time_utc)," - ",g(r.end_time_utc)]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[r.staffing_progress.percentage===100?e.jsx("span",{className:"text-sm font-medium text-green-600",children:"✓ Assigned"}):e.jsx("span",{className:"text-sm font-medium text-red-600",children:"Needs Worker"}),r.staffing_progress.percentage<100&&e.jsx("button",{onClick:z=>{z.stopPropagation(),c(`/events?tab=active&shift_id=${r.id}`)},className:"px-3 py-1 bg-teal-600 text-white text-xs font-medium rounded hover:bg-teal-700 transition-colors",children:"Assign"})]})]},r.id))}),p>0&&e.jsxs("button",{onClick:()=>c(`/events?tab=active&event_id=${s.id}&role=${encodeURIComponent(t)}`),className:"mt-3 w-full px-4 py-2 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:["Assign All ",t," Shifts (",p,")"]})]})]},t)})})]})]})})}export{q as EventDetailPage};
