import{c as me,a as A,j as e,C as ee}from"./index-ZW86mhzJ.js";import{r as d,b as ge,f as fe}from"./vendor-D4VeuP1H.js";import{X as U,P as se}from"./x-DqVda97J.js";import{C as V,f as O}from"./index-BsWJbyzK.js";import{M as q}from"./map-pin-DiBJimv2.js";import{U as Q}from"./users-BuMEfdaO.js";import{A as B}from"./alert-circle-BaUK_2qv.js";import{S as X,A as he,T as ue,C as G,a as pe}from"./ConfirmationModal-BMxvOHXo.js";import{p as D}from"./index-BkGjr18E.js";import{C as ye,P as be}from"./x-circle-B2yQryUy.js";import{C as J}from"./calendar-DmhZgaQ1.js";import{C as te}from"./chevron-down-CK5Jy4vU.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=me("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);function je({shiftId:b,onClose:F,onSuccess:L}){var T,E;const[r,_]=d.useState(null),[x,l]=d.useState([]),[i,y]=d.useState([]),[h,k]=d.useState(""),[s,j]=d.useState(null),[u,N]=d.useState(!0),[P,p]=d.useState(!1),[g,$]=d.useState(null);d.useEffect(()=>{W()},[b]),d.useEffect(()=>{r&&n()},[r]),d.useEffect(()=>{if(!h)y(x);else{const t=h.toLowerCase();y(x.filter(m=>{var w;return m.first_name.toLowerCase().includes(t)||m.last_name.toLowerCase().includes(t)||m.email.toLowerCase().includes(t)||((w=m.skills_json)==null?void 0:w.some(M=>M.toLowerCase().includes(t)))}))}},[h,x]);async function W(){try{const t=await A.get(`/shifts/${b}`);t.data.status==="success"?_(t.data.data):$("Failed to load shift details")}catch(t){console.error("Failed to load shift details:",t),$("Failed to load shift details")}}async function n(){try{const t=await A.get("/workers?active=true");if(t.data.status==="success"){const m=t.data.data.workers||t.data.data;if(r!=null&&r.role_needed){const w=m.filter(M=>{var S;return(S=M.skills_json)==null?void 0:S.includes(r.role_needed)});l(w)}else l(m)}else $("Failed to load workers")}catch(t){console.error("Failed to load workers:",t),$("Failed to load workers")}finally{N(!1)}}async function c(){var t,m,w,M;if(!(!s||!r)){p(!0),$(null);try{const z=(await A.post("/staffing",{assignment:{shift_id:r.id,worker_id:s.id,status:"assigned",assigned_at_utc:new Date().toISOString()}})).data;if(z.status==="success")L();else{const I=z.errors?z.errors.join(". "):z.message||"Failed to assign worker";$(I)}}catch(S){console.error("Failed to assign worker:",S);let z="Failed to assign worker";(m=(t=S.response)==null?void 0:t.data)!=null&&m.errors?z=S.response.data.errors.join(". "):(M=(w=S.response)==null?void 0:w.data)!=null&&M.message?z=S.response.data.message:S.message&&(z=S.message),$(z)}finally{p(!1)}}}const f=t=>{try{return O(D(t),"MMM d, yyyy h:mm a")}catch{return t}},C=t=>{try{return O(D(t),"h:mm a")}catch{return t}};return u?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-600"})})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Assign Worker"}),r&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[r.client_name," â€¢ ",r.role_needed]})]}),e.jsx("button",{onClick:F,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition",children:e.jsx(U,{size:20})})]}),e.jsxs("div",{className:"flex h-[600px]",children:[e.jsx("div",{className:"w-1/3 border-r border-gray-200 p-6 bg-gray-50",children:r?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Shift Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(V,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:f(r.start_time_utc)}),e.jsxs("div",{className:"text-sm text-gray-600",children:[C(r.start_time_utc)," - ",C(r.end_time_utc)]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(q,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"text-sm text-gray-900",children:r.location||((E=(T=r.event)==null?void 0:T.venue)==null?void 0:E.formatted_address)||"Location not specified"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Q,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900",children:r.role_needed}),r.required_skill&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Requires: ",r.required_skill]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Pay Rate:"})," $",r.pay_rate,"/hour"]}),r.uniform_name&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",r.uniform_name]})]}),r.notes&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Notes:"}),e.jsx("div",{className:"mt-1 whitespace-pre-line",children:r.notes.split("Uniform:").map((t,m)=>m===0?t.trim():e.jsxs("div",{children:[e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",t.trim()]},m))})]})})]})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(B,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Failed to load shift details"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search workers by name, email, or skills...",value:h,onChange:t=>k(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:g?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(B,{size:32,className:"text-red-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-red-600",children:g})]}):i.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:h?"No workers found matching your search":r!=null&&r.role_needed?`No workers found with "${r.role_needed}" skill`:"No available workers"}),(r==null?void 0:r.role_needed)&&!h&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:['Try adding "',r.role_needed,'" skill to workers or select a different shift.']})]}):e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:e.jsx("ul",{children:i.map(t=>{var w;const m=(s==null?void 0:s.id)===t.id;return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${m?"bg-teal-50":"bg-white"} cursor-pointer`,onClick:()=>j(t),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[t.first_name[0],t.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[t.first_name," ",t.last_name]}),e.jsx("div",{className:"text-xs text-gray-600",children:(w=t.skills_json)==null?void 0:w.slice(0,3).join(", ")})]})]}),m&&e.jsx("div",{className:"w-6 h-6 rounded-full bg-teal-600 flex items-center justify-center text-white",children:e.jsx(H,{size:14})})]},t.id)})})})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:[g&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-600",children:g})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:F,className:"flex-1 px-4 py-2 bg-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-400 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:c,disabled:!s||P,className:"flex-1 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:P?"Assigning...":"Assign Worker"})]})]})]})]})]})})}function Ne({isOpen:b,eventId:F,roleName:L,unfilledShiftIds:r,onClose:_,onDone:x}){const[l,i]=d.useState([]),[y,h]=d.useState([]),[k,s]=d.useState(""),[j,u]=d.useState(!1),[N,P]=d.useState(!1);d.useEffect(()=>{b&&(async()=>{var n,c,f;u(!0);try{const C=await A.get("/workers?active=true"),E=(((c=(n=C.data)==null?void 0:n.data)==null?void 0:c.workers)||((f=C.data)==null?void 0:f.data)||[]).filter(t=>(t.skills_json||[]).includes(L));i(E)}finally{u(!1)}})()},[b,L]);const p=d.useMemo(()=>{const n=k.trim().toLowerCase(),c=l;return n?c.filter(f=>`${f.first_name} ${f.last_name}`.toLowerCase().includes(n)||(f.email||"").toLowerCase().includes(n)):c},[l,k]),g=r.length,$=n=>{h(c=>c.includes(n)?c.filter(f=>f!==n):c.length>=g?c:[...c,n])},W=async()=>{var f;if(y.length===0||g===0)return;P(!0);let n=0,c=0;try{const C=y.map(t=>l.find(m=>m.id===t)).filter(Boolean),T=[...r];let E=0;for(;T.length>0&&C.length>0;){const t=C[E%C.length],m=T.shift();try{((f=(await A.post("/staffing",{assignment:{shift_id:m,worker_id:t.id,status:"assigned",assigned_at_utc:new Date().toISOString()}})).data)==null?void 0:f.status)==="success"?n+=1:c+=1}catch{c+=1}E+=1}x({assigned:n,conflicts:c})}finally{P(!1)}};return b?e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[10000] flex items-center justify-center p-4",onClick:n=>{n.target===n.currentTarget&&_()},children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-3xl w-full overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-5 border-b border-gray-100",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["Quick Fill â€” ",L]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Unfilled shifts: ",g]})]}),e.jsx("button",{onClick:_,className:"w-8 h-8 rounded-lg hover:bg-gray-100 flex items-center justify-center text-gray-500",children:e.jsx(U,{size:18})})]}),e.jsxs("div",{className:"px-6 py-5 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(X,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{value:k,onChange:n=>s(n.target.value),placeholder:"Search eligible workersâ€¦",className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsx("div",{className:"max-h-[340px] overflow-y-auto border border-gray-200 rounded-lg",children:j?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loadingâ€¦"}):p.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"No eligible workers"}):e.jsx("ul",{children:p.map(n=>{const c=y.includes(n.id);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${c?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[n.first_name[0],n.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[n.first_name," ",n.last_name]}),e.jsx("div",{className:"text-xs text-gray-600",children:(n.skills_json||[]).slice(0,3).join(", ")})]})]}),e.jsx("button",{onClick:()=>$(n.id),disabled:!c&&y.length>=g,className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${c?"bg-teal-600 text-white border-teal-600":y.length>=g?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:c?"Selected":"Select"})]},n.id)})})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(ye,{size:16,className:"text-teal-600"}),e.jsxs("span",{children:["Will assign ",e.jsx("strong",{children:Math.min(y.length,g)})," worker",Math.min(y.length,g)!==1?"s":""," to ",g," shift",g!==1?"s":"","."]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(he,{size:14,className:"text-yellow-600"}),"Conflicts and already-filled shifts will be skipped automatically."]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 px-6 py-5 bg-gray-50",children:[e.jsx("button",{onClick:_,className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100",children:"Cancel"}),e.jsx("button",{onClick:W,disabled:N||y.length===0||g===0,className:"px-5 py-2 rounded-lg bg-teal-600 text-white font-semibold hover:bg-teal-700 disabled:opacity-50",children:N?"Assigningâ€¦":`Assign to ${g} shifts`})]})]})}):null}function Oe(){const b=ge(),[F,L]=fe(),r=(F.get("tab")==="completed"?"completed":F.get("tab"))||"active",_=F.get("filter")||"all",[x,l]=d.useState(r),[i,y]=d.useState(_),[h,k]=d.useState(""),[s,j]=d.useState("date"),[u,N]=d.useState(!0),[P,p]=d.useState([]),[g,$]=d.useState(new Set),[W,n]=d.useState({isOpen:!1}),[c,f]=d.useState({isVisible:!1,message:"",type:"success"}),[C,T]=d.useState({isOpen:!1,isLoading:!1}),[E,t]=d.useState({isOpen:!1,isLoading:!1}),[m,w]=d.useState({isOpen:!1,unfilledShiftIds:[]});d.useEffect(()=>{M()},[x,i]);async function M(){N(!0);try{const o=`/events?tab=${x==="completed"?"completed":x}${i!=="all"?`&filter=${i}`:""}`,v=await A.get(o);v.data.status==="success"&&p(v.data.data)}catch(a){console.error("Failed to load events:",a)}finally{N(!1)}}const S=a=>{l(a),L({tab:a}),y("all")},z=a=>{y(a)},I=a=>{const o=new Set(g);o.has(a)?o.delete(a):o.add(a),$(o)};async function K(a){if(confirm("Are you sure you want to delete this event?"))try{(await A.delete(`/events/${a}`)).data.status==="success"&&M()}catch(o){console.error("Failed to delete event:",o)}}function ae(a){T({isOpen:!0,eventId:a,isLoading:!1})}async function re(){if(C.eventId){T(a=>({...a,isLoading:!0}));try{const a=await A.post(`/events/${C.eventId}/publish`);a.data.status==="success"?(f({isVisible:!0,message:a.data.message||"Event published",type:"success"}),T({isOpen:!1,isLoading:!1}),M()):(f({isVisible:!0,message:a.data.message||"Failed to publish event",type:"error"}),T({isOpen:!1,isLoading:!1}))}catch(a){console.error("Failed to publish event:",a),f({isVisible:!0,message:"Failed to publish event",type:"error"}),T({isOpen:!1,isLoading:!1})}}}function ie(){T({isOpen:!1,isLoading:!1})}function le(a,o){t({isOpen:!0,assignmentId:a,isLoading:!1,workerName:o})}async function ne(){var a,o;if(E.assignmentId){t(v=>({...v,isLoading:!0}));try{const v=await A.delete(`/staffing/${E.assignmentId}`);((a=v.data)==null?void 0:a.status)==="success"?(f({isVisible:!0,message:"Worker unassigned",type:"success"}),t({isOpen:!1,isLoading:!1}),M()):(f({isVisible:!0,message:((o=v.data)==null?void 0:o.message)||"Failed to unassign worker",type:"error"}),t({isOpen:!1,isLoading:!1}))}catch(v){console.error("Failed to unassign worker:",v),f({isVisible:!0,message:"Failed to unassign worker",type:"error"}),t({isOpen:!1,isLoading:!1})}}}const de=a=>{n({isOpen:!0,shiftId:a})},Y=()=>{n({isOpen:!1})},ce=()=>{Y(),f({isVisible:!0,message:"Worker assigned successfully",type:"success"}),M()},R=P.filter(a=>{var v;if(!h)return!0;const o=h.toLowerCase();return a.title.toLowerCase().includes(o)||((v=a.venue)==null?void 0:v.name.toLowerCase().includes(o))}).sort((a,o)=>{var v,Z;switch(s){case"name":return a.title.localeCompare(o.title);case"staffing":return a.staffing_percentage-o.staffing_percentage;case"date":default:const oe=((v=a.schedule)==null?void 0:v.start_time_utc)||a.created_at,xe=((Z=o.schedule)==null?void 0:Z.start_time_utc)||o.created_at;return new Date(oe).getTime()-new Date(xe).getTime()}});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Events"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage events and assign workers"})]}),e.jsxs("button",{onClick:()=>b("/events/create"),className:"flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(se,{size:20}),"Create New Event"]})]}),e.jsxs("div",{className:"flex gap-6 border-b border-gray-200 mb-6",children:[e.jsx("button",{onClick:()=>S("draft"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${x==="draft"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Draft Events"}),e.jsx("button",{onClick:()=>S("active"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${x==="active"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Active Events"}),e.jsx("button",{onClick:()=>S("completed"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${x==="completed"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Completed Events"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 max-w-md relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search events or venues...",value:h,onChange:a=>k(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),e.jsxs("select",{value:s,onChange:a=>j(a.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"name",children:"Sort by Name"}),x!=="draft"&&e.jsx("option",{value:"staffing",children:"Sort by Staffing"})]}),x==="active"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>z("all"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${i==="all"?"bg-teal-100 text-teal-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"All"}),e.jsx("button",{onClick:()=>z("needs_workers"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${i==="needs_workers"?"bg-red-100 text-red-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Needs Workers"}),e.jsx("button",{onClick:()=>z("partially_filled"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${i==="partially_filled"?"bg-yellow-100 text-yellow-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Partial"}),e.jsx("button",{onClick:()=>z("fully_staffed"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${i==="fully_staffed"?"bg-green-100 text-green-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Ready"})]})]}),u?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600"})}):e.jsxs(e.Fragment,{children:[x==="draft"&&e.jsx(ve,{events:R,onDelete:K,onPublish:ae,onNavigate:a=>b(a),searchQuery:h}),x==="active"&&e.jsx(we,{events:R,expandedEvents:g,onToggleEvent:I,onAssignWorker:de,onUnassign:le,onQuickFill:(a,o,v)=>w({isOpen:!0,eventId:a,roleName:o,unfilledShiftIds:v}),onDelete:K,searchQuery:h}),x==="completed"&&e.jsx(_e,{events:R,expandedEvents:g,onToggleEvent:I,searchQuery:h})]})]}),W.isOpen&&W.shiftId&&e.jsx(je,{shiftId:W.shiftId,onClose:Y,onSuccess:ce}),e.jsx(ue,{isVisible:c.isVisible,message:c.message,type:c.type,onClose:()=>f({...c,isVisible:!1})}),e.jsx(G,{isOpen:C.isOpen,onClose:ie,onConfirm:re,title:"Publish Event",message:"Publish this event? This will create shifts and make them available for staffing.",confirmText:C.isLoading?"Publishingâ€¦":"Publish",cancelText:"Cancel",isLoading:C.isLoading,isDestructive:!1}),e.jsx(G,{isOpen:E.isOpen,onClose:()=>t({isOpen:!1,isLoading:!1}),onConfirm:ne,title:"Unassign Worker",message:`Remove ${E.workerName||"this worker"} from this shift?`,confirmText:E.isLoading?"Removingâ€¦":"Unassign",cancelText:"Cancel",isLoading:E.isLoading,isDestructive:!0}),e.jsx(Ne,{isOpen:m.isOpen,eventId:m.eventId||0,roleName:m.roleName||"",unfilledShiftIds:m.unfilledShiftIds,onClose:()=>w({isOpen:!1,unfilledShiftIds:[]}),onDone:({assigned:a,conflicts:o})=>{w({isOpen:!1,unfilledShiftIds:[]}),f({isVisible:!0,message:`Assigned ${a} workers â€¢ ${o} skipped`,type:o>0?"error":"success"}),M()}})]})}function ve({events:b,onDelete:F,onPublish:L,onNavigate:r,searchQuery:_}){const x=i=>i?O(D(i),"MMM d, yyyy"):"No date set",l=i=>i?O(D(i),"h:mm a"):"";return b.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:_?"No draft events found":"No draft events yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:_?"Try adjusting your search query":"Create your first event to get started"}),!_&&e.jsxs("button",{onClick:()=>r("/events/create"),className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:[e.jsx(se,{size:20}),"Create Event"]})]}):e.jsx("div",{className:"space-y-4",children:b.map(i=>e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 flex-1",children:i.title}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Draft"})]}),i.venue&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[e.jsx(q,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:i.venue.name})]}),i.schedule&&e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{children:x(i.schedule.start_time_utc)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsxs("span",{children:[l(i.schedule.start_time_utc)," - ",l(i.schedule.end_time_utc)]})]})]}),i.total_workers_needed>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Q,{size:16,className:"text-gray-400"}),e.jsxs("span",{children:[i.total_workers_needed," workers needed"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>r(`/events/${i.id}/edit`),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Edit",children:e.jsx(be,{size:18})}),e.jsx("button",{onClick:()=>L(i.id),className:"px-4 py-2 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Publish"}),e.jsx("button",{onClick:()=>F(i.id),className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition",title:"Delete",children:e.jsx(pe,{size:18})})]})]})})},i.id))})}function we({events:b,expandedEvents:F,onToggleEvent:L,onAssignWorker:r,onUnassign:_,onQuickFill:x,onDelete:l,searchQuery:i}){const y=s=>O(D(s),"EEE, MMM d, yyyy"),h=s=>O(D(s),"h:mm a"),k=s=>{switch(s){case"fully_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[e.jsx(H,{size:14}),"Ready"]});case"partially_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full",children:[e.jsx(B,{size:14}),"Partial"]});case"needs_workers":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[e.jsx(U,{size:14}),"Needs Workers"]});default:return null}};return b.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:i?"No active events found":"No active events"}),e.jsx("p",{className:"text-gray-600",children:i?"Try adjusting your search query or filters":"Publish draft events to see them here"})]}):e.jsx("div",{className:"space-y-4",children:b.map(s=>{const j=F.has(s.id);return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("button",{onClick:()=>L(s.id),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.title}),k(s.staffing_status)]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[s.venue&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(q,{size:14,className:"text-gray-400"}),s.venue.name]}),s.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(J,{size:14,className:"text-gray-400"}),y(s.schedule.start_time_utc)]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(V,{size:14,className:"text-gray-400"}),h(s.schedule.start_time_utc)]})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:[s.assigned_workers_count," of ",s.total_workers_needed," roles filled"]}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[s.staffing_percentage,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-full rounded-full transition-all ${s.staffing_percentage===100?"bg-green-500":s.staffing_percentage>0?"bg-yellow-500":"bg-red-500"}`,style:{width:`${s.staffing_percentage}%`}})})]}),s.unfilled_roles_count>0&&e.jsxs("p",{className:"text-sm text-red-600 font-medium",children:[s.unfilled_roles_count," role",s.unfilled_roles_count!==1?"s":""," still need workers"]})]}),e.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[(!s.shifts_by_role||s.shifts_by_role.length===0)&&l&&e.jsx("button",{onClick:u=>{u.stopPropagation(),l(s.id)},className:"px-3 py-1.5 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition-colors",children:"Delete Event"}),e.jsx("div",{className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:j?e.jsx(ee,{size:24,className:"text-gray-600 hover:text-gray-800"}):e.jsx(te,{size:24,className:"text-gray-600 hover:text-gray-800"})})]})]}),j&&e.jsx("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:s.shifts_by_role&&s.shifts_by_role.length>0?e.jsx("div",{className:"space-y-4",children:s.shifts_by_role.map(u=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:u.role_name}),e.jsxs("span",{className:"text-sm text-gray-600",children:[u.filled_shifts,"/",u.total_shifts," assigned"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[u.filled_shifts<u.total_shifts&&e.jsxs("span",{className:"px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[u.total_shifts-u.filled_shifts," needed"]}),u.filled_shifts<u.total_shifts&&e.jsx("button",{onClick:N=>{N.stopPropagation();const P=u.shifts.filter(p=>p.staffing_progress.percentage<100).sort((p,g)=>new Date(p.start_time_utc).getTime()-new Date(g.start_time_utc).getTime()).map(p=>p.id);x(s.id,u.role_name,P)},className:"px-2.5 py-1 text-xs font-semibold bg-teal-600 text-white rounded hover:bg-teal-700",title:"Quick Fill by Skill",children:"Quick Fill by Skill"})]})]}),e.jsx("div",{className:"space-y-2",children:u.shifts.map((N,P)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 text-gray-700 rounded-md flex items-center justify-center text-xs font-medium",children:P+1}),e.jsxs("span",{className:"text-sm text-gray-700",children:[h(N.start_time_utc)," - ",h(N.end_time_utc)]}),N.assignments.length>0&&e.jsx("div",{className:"flex items-center gap-1",children:N.assignments.map(p=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"px-2 py-0.5 bg-teal-100 text-teal-700 text-xs rounded",children:[p.worker.first_name," ",p.worker.last_name[0],"."]}),e.jsx("button",{onClick:g=>{g.stopPropagation(),_(p.id,`${p.worker.first_name} ${p.worker.last_name}`)},className:"w-5 h-5 flex items-center justify-center text-red-600 hover:text-red-700 hover:bg-red-50 rounded",title:"Unassign worker",children:e.jsx(U,{size:12})})]},p.id))})]}),N.staffing_progress.percentage===100?e.jsxs("span",{className:"flex items-center gap-1.5 text-sm font-medium text-green-600",children:[e.jsx(H,{size:16}),"Assigned"]}):e.jsx("button",{onClick:p=>{p.stopPropagation(),r(N.id)},className:"px-3 py-1.5 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Assign Worker"})]},N.id))})]},u.role_name))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:s.status==="draft"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"This event is still in draft status"}),e.jsx("p",{className:"text-sm",children:"Publish the event to generate shifts and assign workers"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"No shifts available"}),e.jsx("p",{className:"text-sm",children:"This event may not have any shifts generated yet"})]})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[s.status==="draft"&&e.jsx("button",{onClick:()=>{console.log("Publish event:",s.id)},className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors",children:"Publish Event"}),l&&e.jsx("button",{onClick:()=>l(s.id),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Delete Event"})]})]})})]},s.id)})})}function _e({events:b,expandedEvents:F,onToggleEvent:L,searchQuery:r}){const _=l=>O(D(l),"MMM d, yyyy"),x=l=>O(D(l),"h:mm a");return b.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“‹"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:r?"No past events found":"No past events yet"}),e.jsx("p",{className:"text-gray-600",children:r?"Try adjusting your search query":"Completed events will appear here"})]}):e.jsx("div",{className:"space-y-4",children:b.map(l=>{var h;const i=F.has(l.id);let y=0;return(h=l.shifts_by_role)==null||h.forEach(k=>{k.shifts.forEach(s=>{s.assignments.forEach(j=>{y+=j.hours_worked||0})})}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("button",{onClick:()=>L(l.id),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l.title}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Completed"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[l.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(J,{size:14,className:"text-gray-400"}),_(l.schedule.start_time_utc)]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(V,{size:14,className:"text-gray-400"}),x(l.schedule.start_time_utc)," - ",x(l.schedule.end_time_utc)]})]}),l.venue&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(q,{size:14,className:"text-gray-400"}),l.venue.name]})]})]}),e.jsx("div",{className:"ml-4 flex items-center",children:e.jsx("div",{className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:i?e.jsx(ee,{size:24,className:"text-gray-600 hover:text-gray-800"}):e.jsx(te,{size:24,className:"text-gray-600 hover:text-gray-800"})})})]}),i&&l.shifts_by_role&&e.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:[e.jsx("div",{className:"mb-4 p-4 bg-white rounded-lg border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Workers"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:l.assigned_workers_count})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Hours"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:y.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Staffing"}),e.jsxs("p",{className:"text-2xl font-semibold text-green-600",children:[l.staffing_percentage,"%"]})]})]})}),e.jsx("div",{className:"space-y-3",children:l.shifts_by_role.map(k=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:k.role_name}),e.jsx("div",{className:"space-y-2",children:k.shifts.flatMap(s=>s.assignments.map(j=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 text-teal-700 flex items-center justify-center text-sm font-medium",children:[j.worker.first_name[0],j.worker.last_name[0]]}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[j.worker.first_name," ",j.worker.last_name]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[j.hours_worked&&e.jsxs("span",{className:"font-medium",children:[j.hours_worked.toFixed(2)," hrs"]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[x(s.start_time_utc)," - ",x(s.end_time_utc)]})]})]},j.id)))})]},k.role_name))})]})]},l.id)})})}export{Oe as EventsPage};
