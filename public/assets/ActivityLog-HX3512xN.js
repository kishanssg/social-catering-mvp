import{b as H,r as u}from"./vendor-79DyBOV9.js";import{c as f,j as e,X as Y,R as Z,a as J}from"./index-ByejfKGi.js";import{F as T}from"./file-text-J-4V-N4m.js";import{S as M,T as K,L as Q}from"./trash-2-1j5mpWcp.js";import{C as j}from"./calendar-DdwflBiH.js";import{c as N}from"./utils-DuMXYCiK.js";import{X as ee,C as E}from"./x-circle-BTyB4BpK.js";import{c as S,d as te}from"./dateUtils-dPQjf4aX.js";import{U as w}from"./user-PBCl4t94.js";import{r as k,C as re,f as _}from"./index-BjKf21R6.js";import{D as F}from"./dollar-sign-BSniogYn.js";import{C as I}from"./chevron-down-B435TTmc.js";import{C as P}from"./chevron-right-C5mjPkFW.js";import{p as U}from"./index-DdfPJynm.js";import{i as se,b as ae,a as le}from"./index-Im5epGPm.js";import{s as oe}from"./index-CVMX9KAv.js";import{s as A}from"./index-BT8jzIOE.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=f("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=f("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=f("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=f("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=f("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=f("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=f("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=f("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=f("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=f("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);function me(t,s,a){k(2,arguments);var r=A(t,a),o=A(s,a);return r.getTime()===o.getTime()}function ge(t){return k(1,arguments),se(Date.now(),t)}function pe(t,s){return k(1,arguments),me(t,Date.now(),s)}function he(t){return k(1,arguments),ae(t,oe(Date.now(),1))}function ue({searchQuery:t,onSearchChange:s,totalLogs:a,showingLogs:r}){return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(T,{className:"h-6 w-6 text-teal-600"}),"Activity Log"]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Track all actions and changes in the system"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-blue-50 text-blue-700 rounded-lg",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsxs("span",{className:"font-medium",children:["Total Logs: ",a.toLocaleString()]})]}),t&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-teal-50 text-teal-700 rounded-lg",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsxs("span",{className:"font-medium",children:["Showing: ",r," of ",a]})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(M,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",value:t,onChange:o=>s(o.target.value),placeholder:"Search by worker name, event name, or action...",className:"block w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 text-sm"}),t&&e.jsx("button",{onClick:()=>s(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx(Y,{className:"h-5 w-5 text-gray-400 hover:text-gray-600"})})]}),t&&e.jsx("div",{className:"mt-2 text-xs text-gray-500",children:'ðŸ’¡ Tip: Search for "Charlie Williams" to see all activities for that worker, or "Wedding Reception" for all event activities'})]})}function fe({filters:t,onFiltersChange:s,onRefresh:a}){return e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 font-medium",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Filters:"})]}),e.jsxs("select",{value:t.entityType,onChange:r=>s({...t,entityType:r.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500",children:[e.jsx("option",{value:"all",children:"All Entity Types"}),e.jsx("option",{value:"Worker",children:"Workers"}),e.jsx("option",{value:"Event",children:"Events"}),e.jsx("option",{value:"Assignment",children:"Assignments"}),e.jsx("option",{value:"Shift",children:"Shifts"})]}),e.jsxs("select",{value:t.action,onChange:r=>s({...t,action:r.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500",children:[e.jsx("option",{value:"all",children:"All Actions"}),e.jsx("option",{value:"created",children:"Created"}),e.jsx("option",{value:"updated",children:"Updated"}),e.jsx("option",{value:"deleted",children:"Deleted"}),e.jsx("option",{value:"assigned_worker",children:"Assigned"}),e.jsx("option",{value:"marked_no_show",children:"No Show"}),e.jsx("option",{value:"hours_re_edited",children:"Hours Edited"}),e.jsx("option",{value:"event_hours_approved_selected",children:"Hours Approved"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-4 text-gray-500"}),e.jsx("input",{type:"date",value:t.dateFrom||"",onChange:r=>s({...t,dateFrom:r.target.value||null}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500"}),e.jsx("span",{className:"text-gray-500 text-sm",children:"to"}),e.jsx("input",{type:"date",value:t.dateTo||"",onChange:r=>s({...t,dateTo:r.target.value||null}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500"})]}),e.jsxs("button",{onClick:a,className:"ml-auto px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),"Refresh"]})]})})}function be({viewMode:t,onViewModeChange:s}){return e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"View:"}),e.jsxs("div",{className:"flex gap-1 bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>s("chronological"),className:N("px-4 py-1.5 rounded-md text-sm font-medium transition-colors flex items-center gap-2",t==="chronological"?"bg-white text-teal-700 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[e.jsx(ie,{className:"h-4 w-4"}),"Chronological"]}),e.jsxs("button",{onClick:()=>s("grouped"),className:N("px-4 py-1.5 rounded-md text-sm font-medium transition-colors flex items-center gap-2",t==="grouped"?"bg-white text-teal-700 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[e.jsx(de,{className:"h-4 w-4"}),"Grouped by Entity"]})]})]})})}function ye(t){return{event_hours_approved_selected:{icon:E,bgColor:"bg-green-50",textColor:"text-green-600",borderColor:"border-green-500",label:"Hours Approved"},event_hours_approved:{icon:E,bgColor:"bg-green-50",textColor:"text-green-600",borderColor:"border-green-500",label:"All Hours Approved"},approved:{icon:E,bgColor:"bg-green-50",textColor:"text-green-600",borderColor:"border-green-500",label:"Approved"},hours_re_edited:{icon:L,bgColor:"bg-blue-50",textColor:"text-blue-600",borderColor:"border-blue-500",label:"Hours Edited"},hours_updated:{icon:L,bgColor:"bg-blue-50",textColor:"text-blue-600",borderColor:"border-blue-500",label:"Hours Updated"},updated:{icon:L,bgColor:"bg-blue-50",textColor:"text-blue-600",borderColor:"border-blue-500",label:"Updated"},assigned_worker:{icon:W,bgColor:"bg-purple-50",textColor:"text-purple-600",borderColor:"border-purple-500",label:"Worker Assigned"},created:{icon:W,bgColor:"bg-purple-50",textColor:"text-purple-600",borderColor:"border-purple-500",label:"Created"},unassigned_worker:{icon:D,bgColor:"bg-amber-50",textColor:"text-amber-600",borderColor:"border-amber-500",label:"Worker Removed"},removed_from_job:{icon:D,bgColor:"bg-amber-50",textColor:"text-amber-600",borderColor:"border-amber-500",label:"Removed from Job"},marked_no_show:{icon:ee,bgColor:"bg-red-50",textColor:"text-red-600",borderColor:"border-red-500",label:"No Show"},deleted:{icon:K,bgColor:"bg-red-50",textColor:"text-red-600",borderColor:"border-red-500",label:"Deleted"},restored_from_cancelled:{icon:ce,bgColor:"bg-teal-50",textColor:"text-teal-600",borderColor:"border-teal-500",label:"Restored"},hours_reopened_for_editing:{icon:xe,bgColor:"bg-teal-50",textColor:"text-teal-600",borderColor:"border-teal-500",label:"Reopened for Editing"},totals_recalculated:{icon:ne,bgColor:"bg-gray-50",textColor:"text-gray-600",borderColor:"border-gray-500",label:"Totals Recalculated"}}[t]||{icon:T,bgColor:"bg-gray-50",textColor:"text-gray-600",borderColor:"border-gray-500",label:t.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}}function je({activity:t}){var a,r,o,i,c,h,x,b,l;const s=H();return e.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 px-4 py-3",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wider mb-3",children:"Full Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Action by"}),e.jsx("div",{className:"font-medium text-gray-900",children:t.actor_name})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(j,{className:"h-4 w-4 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Timestamp"}),e.jsx("div",{className:"font-medium text-gray-900",children:S(t.created_at)})]})]}),((a=t.details)==null?void 0:a.worker_name)&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-teal-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Worker"}),t.details.worker_id?e.jsxs("button",{onClick:()=>{var m;return s(`/workers/${(m=t.details)==null?void 0:m.worker_id}`)},className:"font-medium text-teal-600 hover:underline flex items-center gap-1",children:[t.details.worker_name,e.jsx(R,{className:"h-3 w-3"})]}):e.jsx("div",{className:"font-medium text-gray-900",children:t.details.worker_name})]})]}),((r=t.details)==null?void 0:r.event_name)&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(j,{className:"h-4 w-4 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Event"}),t.details.event_id?e.jsxs("button",{onClick:()=>{var m;return s(`/events/${(m=t.details)==null?void 0:m.event_id}`)},className:"font-medium text-blue-600 hover:underline flex items-center gap-1",children:[t.details.event_name,e.jsx(R,{className:"h-3 w-3"})]}):e.jsx("div",{className:"font-medium text-gray-900",children:t.details.event_name})]})]}),((o=t.details)==null?void 0:o.before_hours)!==void 0&&((i=t.details)==null?void 0:i.after_hours)!==void 0&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(re,{className:"h-4 w-4 text-purple-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Hours"}),e.jsxs("div",{className:"font-medium text-gray-900",children:[Number(t.details.before_hours||0).toFixed(1),"h â†’ ",Number(t.details.after_hours||0).toFixed(1),"h",e.jsx("span",{className:"text-xs text-gray-500 ml-1",children:(()=>{const m=Number(t.details.before_hours||0),g=Number(t.details.after_hours||0)-m;return g>0?`+${g.toFixed(1)}h`:`${g.toFixed(1)}h`})()})]})]})]}),((c=t.details)==null?void 0:c.before_pay)!==void 0&&((h=t.details)==null?void 0:h.after_pay)!==void 0&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(F,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Pay"}),e.jsxs("div",{className:"font-medium text-gray-900",children:["$",Number(t.details.before_pay||0).toFixed(2)," â†’ $",Number(t.details.after_pay||0).toFixed(2),e.jsx("span",{className:"text-xs text-gray-500 ml-1",children:(()=>{const m=Number(t.details.before_pay||0),g=Number(t.details.after_pay||0)-m;return g>0?`+$${g.toFixed(2)}`:`$${g.toFixed(2)}`})()})]})]})]}),((x=t.details)==null?void 0:x.before_rate)!==void 0&&((b=t.details)==null?void 0:b.after_rate)!==void 0&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(F,{className:"h-4 w-4 text-amber-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Hourly Rate"}),e.jsxs("div",{className:"font-medium text-gray-900",children:["$",Number(t.details.before_rate||0).toFixed(2),"/h â†’ $",Number(t.details.after_rate||0).toFixed(2),"/h"]})]})]}),((l=t.details)==null?void 0:l.role)&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-purple-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Role"}),e.jsx("div",{className:"font-medium text-gray-900",children:t.details.role})]})]})]}),!1]})}function O({activity:t}){const[s,a]=u.useState(!1),r=H(),{icon:o,bgColor:i,textColor:c,borderColor:h}=ye(t.action),x=()=>{const b=t.summary,l=t.details;let m=b;if(l!=null&&l.worker_name){const n=new RegExp(l.worker_name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g");m=m.replace(n,`<span class="font-semibold text-teal-600 hover:underline cursor-pointer" data-worker-id="${l.worker_id||""}">${l.worker_name}</span>`)}if(l!=null&&l.event_name){const n=new RegExp(l.event_name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g");m=m.replace(n,`<span class="font-semibold text-blue-600 hover:underline cursor-pointer" data-event-id="${l.event_id||""}">${l.event_name}</span>`)}return e.jsx("div",{dangerouslySetInnerHTML:{__html:m},onClick:n=>{const g=n.target;g.dataset.workerId?r(`/workers/${g.dataset.workerId}`):g.dataset.eventId&&r(`/events/${g.dataset.eventId}`)}})};return e.jsxs("div",{className:N("bg-white rounded-lg shadow-sm border-l-4 hover:shadow-md transition-all duration-200",h),children:[e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:N("flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center",i),children:e.jsx(o,{className:N("h-5 w-5",c)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm text-gray-900 mb-2",children:x()}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[e.jsx("span",{className:"flex items-center gap-1 px-2 py-0.5 bg-gray-100 rounded",children:t.entity_type}),e.jsx("span",{title:S(t.created_at),children:te(t.created_at)}),e.jsx("span",{className:"hidden sm:inline",children:S(t.created_at)})]}),t.details&&Object.keys(t.details).length>0&&e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[t.details.worker_name&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-teal-50 text-teal-700 rounded text-xs",children:[e.jsx("span",{className:"font-medium",children:"Worker:"}),e.jsx("span",{children:t.details.worker_name})]}),t.details.event_name&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs",children:[e.jsx("span",{className:"font-medium",children:"Event:"}),e.jsx("span",{children:t.details.event_name})]}),t.details.role&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-purple-50 text-purple-700 rounded text-xs",children:[e.jsx("span",{className:"font-medium",children:"Role:"}),e.jsx("span",{children:t.details.role})]}),t.details.before_pay!==void 0&&t.details.after_pay!==void 0&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-green-50 text-green-700 rounded text-xs",children:[e.jsx("span",{className:"font-medium",children:"Pay:"}),e.jsxs("span",{children:["$",t.details.before_pay.toFixed(2)," â†’ $",t.details.after_pay.toFixed(2)]})]})]})]}),e.jsx("button",{onClick:()=>a(!s),className:"flex-shrink-0 p-1 hover:bg-gray-100 rounded transition-colors",children:s?e.jsx(I,{className:"h-5 w-5 text-gray-400"}):e.jsx(P,{className:"h-5 w-5 text-gray-400"})})]})}),s&&e.jsx(je,{activity:t})]})}function Ne(t){const s={};t.forEach(r=>{const o=_(U(r.created_at),"yyyy-MM-dd");s[o]||(s[o]=[]),s[o].push(r)});const a={};return Object.keys(s).sort((r,o)=>o.localeCompare(r)).forEach(r=>{a[r]=s[r]}),a}function ve(t){const s={};t.forEach(r=>{var h,x;let o,i,c;(h=r.details)!=null&&h.event_name?(o=`event-${r.details.event_id||r.entity_id}`,i=r.details.event_name,c="Event"):(x=r.details)!=null&&x.worker_name?(o=`worker-${r.details.worker_id||r.entity_id}`,i=r.details.worker_name,c="Worker"):(o=`${r.entity_type.toLowerCase()}-${r.entity_id}`,i=`${r.entity_type} #${r.entity_id}`,c=r.entity_type),s[o]||(s[o]={type:c,name:i,activities:[]}),s[o].activities.push(r)});const a={};return Object.keys(s).sort((r,o)=>{var h,x;const i=((h=s[r].activities[0])==null?void 0:h.created_at)||"";return(((x=s[o].activities[0])==null?void 0:x.created_at)||"").localeCompare(i)}).forEach(r=>{a[r]=s[r]}),a}function we(t){try{const s=U(t);return le(s)?"Today":he(s)?"Yesterday":pe(s)?_(s,"EEEE"):ge(s)?_(s,"MMMM d"):_(s,"MMMM d, yyyy")}catch(s){return console.error("Error formatting date:",s),t}}function _e(t,s){if(!s.trim())return t;const a=s.toLowerCase();return t.filter(r=>{var o,i,c;return!!(r.summary.toLowerCase().includes(a)||r.details&&((o=r.details.worker_name)!=null&&o.toLowerCase().includes(a)||(i=r.details.event_name)!=null&&i.toLowerCase().includes(a)||(c=r.details.role)!=null&&c.toLowerCase().includes(a))||r.actor_name.toLowerCase().includes(a))})}function ke({date:t,activities:s}){return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(j,{className:"h-4 w-4 text-gray-400"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wider",children:we(t)}),e.jsx("div",{className:"flex-1 h-px bg-gray-200"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[s.length," ",s.length===1?"activity":"activities"]})]}),e.jsx("div",{className:"space-y-3 ml-6",children:s.map(a=>e.jsx(O,{activity:a},a.id))})]})}function Ce({entityType:t,entityName:s,activities:a}){const[r,o]=u.useState(!1),i=()=>{switch(t){case"Event":return j;case"Worker":return w;default:return j}},c=()=>{switch(t){case"Event":return"text-blue-600 bg-blue-50";case"Worker":return"text-teal-600 bg-teal-50";default:return"text-gray-600 bg-gray-50"}},h=i(),x=c();return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("button",{onClick:()=>o(!r),className:"w-full px-4 py-3 flex items-center gap-3 hover:bg-gray-50 transition-colors",children:[r?e.jsx(I,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}):e.jsx(P,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),e.jsx("div",{className:N("w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0",x),children:e.jsx(h,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:s}),e.jsxs("div",{className:"text-xs text-gray-500",children:[a.length," ",a.length===1?"activity":"activities"]})]}),e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs font-medium rounded",children:t})]}),r&&e.jsx("div",{className:"border-t border-gray-200 p-4 bg-gray-50 space-y-3",children:a.map(b=>e.jsx(O,{activity:b},b.id))})]})}function Ee({searchQuery:t,hasFilters:s}){return t?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border border-gray-200",children:[e.jsx(M,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:['No results found for "',t,'"']}),e.jsx("p",{className:"text-sm text-gray-500",children:"Try searching for a different worker name or event name"})]}):s?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border border-gray-200",children:[e.jsx(q,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No activities match your filters"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Try adjusting your filters to see more results"})]}):e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border border-gray-200",children:[e.jsx(j,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No activities yet"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Activity logs will appear here as users make changes"})]})}function Ve(){const[t,s]=u.useState([]),[a,r]=u.useState([]),[o,i]=u.useState(!0),[c,h]=u.useState("chronological"),[x,b]=u.useState(""),[l,m]=u.useState({entityType:"all",action:"all",dateFrom:null,dateTo:null,actor:"all"}),[n,g]=u.useState({page:1,perPage:50,total:0});u.useEffect(()=>{$()},[l,n.page]),u.useEffect(()=>{if(x.trim()){const d=_e(t,x);r(d)}else r(t)},[x,t]);const $=async()=>{i(!0);try{const d={page:n.page,per_page:n.perPage};l.entityType!=="all"&&(d.entity_type=l.entityType),l.action!=="all"&&(d.log_action=l.action),l.dateFrom&&(d.date_from=l.dateFrom),l.dateTo&&(d.date_to=l.dateTo),l.actor!=="all"&&(d.actor_user_id=l.actor);const y=(await J.get("/activity_logs",{params:d})).data.data||{},X=y.activity_logs||[],B=y.pagination||{},C=X.map(p=>({id:p.id,actor_name:p.actor||p.actor_name||"System",entity_type:p.entity_type,entity_id:p.entity_id,action:p.action,summary:p.summary||"",details:p.details||p.details_json||null,created_at:p.when||p.created_at||p.created_at_utc,before_json:p.before_json||{},after_json:p.after_json||{}}));s(C),r(C),g(p=>({...p,total:B.total_count||C.length}))}catch(d){console.error("Error loading activities:",d)}finally{i(!1)}},G=()=>{const d=Ne(a);return e.jsx("div",{className:"space-y-6",children:Object.entries(d).map(([v,y])=>e.jsx(ke,{date:v,activities:y},v))})},V=()=>{const d=ve(a);return e.jsx("div",{className:"space-y-4",children:Object.entries(d).map(([v,y])=>e.jsx(Ce,{entityType:y.type,entityName:y.name,activities:y.activities},v))})},z=l.entityType!=="all"||l.action!=="all"||l.dateFrom||l.dateTo;return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(ue,{searchQuery:x,onSearchChange:b,totalLogs:n.total,showingLogs:a.length}),e.jsx(fe,{filters:l,onFiltersChange:m,onRefresh:$}),e.jsx(be,{viewMode:c,onViewModeChange:h}),e.jsx("div",{className:"mt-6",children:o?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Q,{className:"h-8 w-8 animate-spin text-teal-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading activities..."})]}):a.length===0?e.jsx(Ee,{searchQuery:x,hasFilters:z}):e.jsxs(e.Fragment,{children:[c==="chronological"&&G(),c==="grouped"&&V()]})}),!o&&a.length>0&&e.jsxs("div",{className:"mt-8 flex items-center justify-between border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",(n.page-1)*n.perPage+1," to"," ",Math.min(n.page*n.perPage,n.total)," of"," ",n.total," activities"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>g(d=>({...d,page:d.page-1})),disabled:n.page===1,className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>g(d=>({...d,page:d.page+1})),disabled:n.page*n.perPage>=n.total,className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})})}export{Ve as ActivityLog};
