import{j as e,u as xe,a as B,X as le,b as re}from"./index-BKbWwlKC.js";import{R as fe,b as he,u as ge,r as x}from"./vendor-79DyBOV9.js";import{L as te}from"./LoadingSpinner-DeGzpscU.js";import{S as ce,T as pe,C as ye}from"./ConfirmationModal-DkDIrsUq.js";import{T as je}from"./Toast-Dv8_5C8P.js";import{P as oe}from"./plus-UJkxdlca.js";import{U as be}from"./user-X9JfAn6S.js";import{C as ve,X as Ne}from"./x-circle-BNVfJWen.js";import{C as de}from"./calendar-DkH1OpPv.js";import{P as _e}from"./pen-square-Bs2Lsu6v.js";import{f as J}from"./index-C_slYh2M.js";import{p as K}from"./index-BK_MyBzW.js";import{B as Se}from"./briefcase-Bv9kVkmC.js";import{C as we}from"./clock-Bl8ROGnO.js";import{M as Ce}from"./map-pin-C7Eu3Ydz.js";import{D as ke}from"./dollar-sign-BKoliV8Z.js";function $e({name:r,src:w,size:_=40}){const[h,U]=fe.useState(!1),f=(r||"User").split(" ").filter(Boolean).slice(0,2).map(D=>{var j;return(j=D[0])==null?void 0:j.toUpperCase()}).join("")||"UW",k={width:_,height:_,minWidth:_};return e.jsx("div",{className:"rounded-full overflow-hidden bg-gray-200 flex items-center justify-center ring-1 ring-gray-300",style:k,"aria-label":r,children:w&&!h?e.jsx("img",{src:w,alt:r,className:"w-full h-full object-cover",onError:()=>U(!0),crossOrigin:"anonymous",referrerPolicy:"no-referrer"}):e.jsx("span",{className:"text-gray-600 text-sm font-medium select-none",children:f})})}function Qe(){const r=he(),w=ge(),{isAuthenticated:_,isLoading:h}=xe(),[U,f]=x.useState([]),[k,D]=x.useState(!0),[j,F]=x.useState(""),[O,R]=x.useState("name"),[p,C]=x.useState("all"),[T,$]=x.useState({isOpen:!1}),[ae,I]=x.useState([]),[ne,A]=x.useState(null),[S,E]=x.useState({isOpen:!1}),[Y,W]=x.useState(!1),[M,P]=x.useState({isVisible:!1,message:"",type:"success"});x.useEffect(()=>{_&&!h&&L()},[_,h]),x.useEffect(()=>{_&&!h&&w.pathname==="/workers"&&L()},[w.pathname,_,h]);async function L(){D(!0);try{const t=await B.get("/workers");if(t.data.status==="success"){const u=t.data.data||[];f(u)}else f([])}catch(t){console.error("Failed to load workers:",t),f([])}finally{D(!1)}}const V=t=>{E({isOpen:!0,worker:t})},Z=async()=>{var t,u,b,s,l,a;if(S.worker){W(!0);try{(await B.delete(`/workers/${(t=S.worker)==null?void 0:t.id}`)).data.status==="success"&&(P({isVisible:!0,message:`${S.worker.first_name||"Unknown"} ${S.worker.last_name||"Worker"} has been deleted successfully`,type:"success"}),L(),E({isOpen:!1}))}catch(n){console.error("Failed to delete worker:",n),console.error("Error response data:",(u=n.response)==null?void 0:u.data);let d="Failed to delete worker. Please try again.";(s=(b=n.response)==null?void 0:b.data)!=null&&s.error?d=n.response.data.error:(a=(l=n.response)==null?void 0:l.data)!=null&&a.errors?d=Array.isArray(n.response.data.errors)?n.response.data.errors.join(", "):n.response.data.errors.toString():n.message&&(d=n.message),console.error("Final error message shown to user:",d),P({isVisible:!0,message:d,type:"error"})}finally{W(!1)}}},G=()=>{E({isOpen:!1})},ee=t=>{$({isOpen:!0,worker:t}),I([]),A(null)},q=()=>{$({isOpen:!1})},Q=t=>{console.log("handleBulkAssignSuccess called with message:",t),console.log("Closing modal and showing toast..."),q(),P({isVisible:!0,message:t||"Worker scheduled successfully",type:"success"}),L(),console.log("Modal should now be closed")},X=U.filter(t=>{if(p==="active"&&!t.active||p==="inactive"&&t.active)return!1;if(j){const u=j.toLowerCase();return(t.first_name||"").toLowerCase().includes(u)||(t.last_name||"").toLowerCase().includes(u)||(t.email||"").toLowerCase().includes(u)||(t.phone||"").includes(u)||(t.skills_json||[]).some(b=>(b||"").toLowerCase().includes(u))||(t.certifications||[]).some(b=>((b==null?void 0:b.name)||"").toLowerCase().includes(u))}return!0}).sort((t,u)=>{switch(O){case"name":return`${t.first_name||""} ${t.last_name||""}`.localeCompare(`${u.first_name||""} ${u.last_name||""}`);case"email":return(t.email||"").localeCompare(u.email||"");case"status":return(u.active?1:0)-(t.active?1:0);default:return 0}});return h?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(te,{})}):_?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Workers"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your workforce"})]}),e.jsxs("button",{onClick:()=>r("/workers/create"),className:"flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(oe,{size:20}),"Add New Worker"]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 max-w-md relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search workers by name, email, phone, skills, or certifications",value:j,onChange:t=>F(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),e.jsxs("select",{value:O,onChange:t=>R(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"name",children:"Sort by Name"}),e.jsx("option",{value:"email",children:"Sort by Email"}),e.jsx("option",{value:"status",children:"Sort by Status"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>C("all"),className:`px-3 py-2 text-sm font-medium rounded-lg transition-colors ${p==="all"?"bg-teal-100 text-teal-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"All"}),e.jsx("button",{onClick:()=>C("active"),className:`px-3 py-2 text-sm font-medium rounded-lg transition-colors ${p==="active"?"bg-green-100 text-green-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Active"}),e.jsx("button",{onClick:()=>C("inactive"),className:`px-3 py-2 text-sm font-medium rounded-lg transition-colors ${p==="inactive"?"bg-gray-200 text-gray-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Inactive"})]})]}),k?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(te,{})}):X.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(be,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:j?"No workers found":"No workers yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:j?"Try adjusting your search or filters":"Add your first worker to get started"}),!j&&e.jsxs("button",{onClick:()=>r("/workers/create"),className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:[e.jsx(oe,{size:20}),"Add Worker"]})]}):e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Name"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Phone"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Email"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:X.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>r(`/workers/${t.id}`),children:[e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($e,{name:`${t.first_name||"Unknown"} ${t.last_name||"Worker"}`,src:t.profile_photo_url,size:40}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[t.first_name||"Unknown"," ",t.last_name||"Worker"]}),t.skills_json&&t.skills_json.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.skills_json.map((u,b)=>{const s=j&&u.toLowerCase().includes(j.toLowerCase());return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${s?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:u},b)})})]})]})}),e.jsx("td",{className:"py-4 px-6 text-sm text-gray-600",children:t.phone||"—"}),e.jsx("td",{className:"py-4 px-6 text-sm text-gray-600",children:t.email}),e.jsx("td",{className:"py-4 px-6",children:t.active?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[e.jsx(ve,{size:14}),"Active"]}):e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-gray-100 text-gray-600 text-xs font-medium rounded-full",children:[e.jsx(Ne,{size:14}),"Inactive"]})}),e.jsx("td",{className:"py-4 px-6 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.active&&e.jsxs("button",{onClick:u=>{u.stopPropagation(),ee(t)},className:"px-3 py-1.5 bg-purple-600 text-white text-sm font-medium rounded-lg hover:bg-purple-700 transition-colors",title:"Schedule Worker",children:[e.jsx(de,{size:14,className:"inline mr-1"}),"Schedule"]}),e.jsx("button",{onClick:u=>{u.stopPropagation(),r(`/workers/${t.id}/edit`)},className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Edit",children:e.jsx(_e,{size:16})}),e.jsx("button",{onClick:u=>{u.preventDefault(),u.stopPropagation(),V(t)},className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition",title:"Delete",children:e.jsx(pe,{size:16})})]})})]},t.id))})]})})]}),T.isOpen&&T.worker&&e.jsx(Ae,{worker:T.worker,onClose:q,onSuccess:Q}),e.jsx(ye,{isOpen:S.isOpen,onClose:G,onConfirm:Z,title:"Delete Worker",message:"Are you sure you want to delete this worker?",confirmText:"Delete Worker",cancelText:"Cancel",isLoading:Y,isDestructive:!0,workerName:S.worker?`${S.worker.first_name||"Unknown"} ${S.worker.last_name||"Worker"}`:void 0}),e.jsx(je,{isVisible:M.isVisible,message:M.message,type:M.type,onClose:()=>P({...M,isVisible:!1})})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Authentication Required"}),e.jsx("p",{className:"text-gray-600",children:"Please log in to view workers."})]})})}function Ae({worker:r,onClose:w,onSuccess:_}){var b;const[h,U]=x.useState([]),[f,k]=x.useState(new Set),[D,j]=x.useState(!0),[F,O]=x.useState(!1),[R,p]=x.useState(null),[C,T]=x.useState(""),[$,ae]=x.useState("all"),[I,ne]=x.useState([]),[A,S]=x.useState({}),[E,Y]=x.useState(new Set),[W,M]=x.useState({});x.useEffect(()=>{r&&r.id&&P()},[r==null?void 0:r.id]),x.useEffect(()=>{r&&r.id&&h.length>0&&L()},[r==null?void 0:r.id,h]);async function P(){if(!(!r||!r.id)){j(!0);try{const s=await B.get("/events",{params:{tab:"active",filter:"needs_workers"}});if(s.data.status==="success"){const l=s.data.data,a=[];l.forEach(n=>{if(n&&n.shifts_by_role){const d={id:n.id,title:n.title||"Untitled Event"};n.shifts_by_role.forEach(c=>{var o;if(c&&r.skills_json&&r.skills_json.includes(c.role_name)&&c.filled_shifts<c.total_shifts){const i=(c.shifts||[]).filter(g=>{const N=g.filled_positions||0;return g.capacity>N});if(i.length===0)return;const m=i[0];if(m){const g=i.map(y=>y.id),N={id:m.id,event:d,role_needed:c.role_name,start_time_utc:m.start_time_utc,end_time_utc:m.end_time_utc,location:((o=n.venue)==null?void 0:o.formatted_address)||"Location TBD",current_status:m.status,pay_rate:m.pay_rate,total_positions:c.total_shifts,filled_positions:c.filled_shifts,available_positions:i.reduce((y,v)=>y+(v.capacity-(v.filled_positions||0)),0),all_shift_ids:g};a.push(N)}}})}}),U(a)}}catch(s){console.error("Failed to load available shifts:",s),p("Failed to load available shifts")}finally{j(!1)}}}async function L(){if(!(!r||!r.id))try{const s=[];if(h.forEach(a=>{a.all_shift_ids&&s.push(...a.all_shift_ids)}),s.length===0)return;const l=await B.post("/staffing/validate_bulk",{worker_id:r.id,shift_ids:s});if(l.data.status==="success"){const{invalid_shifts:a}=l.data.data,n=new Set,d={};a.forEach(c=>{const o=h.find(i=>{var m;return(m=i.all_shift_ids)==null?void 0:m.includes(c.shift_id)});o&&(n.add(o.id),d[o.id]=c.errors.map(i=>i.message))}),Y(n),M(d)}}catch(s){console.error("Failed to validate shifts:",s)}}const V=s=>{const l=new Set(f),a=h.find(n=>n.id===s);if(a){if(l.has(s))l.delete(s);else{if(E.has(s)){const d=W[s]||["Not available"];p(`Cannot select this shift: ${d.join(", ")}`);return}if(Array.from(l).forEach(d=>{var o,i,m;const c=h.find(g=>g.id===d);if(c&&((o=c.event)==null?void 0:o.id)===((i=a.event)==null?void 0:i.id)&&c.start_time_utc===a.start_time_utc&&c.end_time_utc===a.end_time_utc&&c.role_needed!==a.role_needed){l.delete(d),p(`Selected ${a.role_needed} for ${(m=a.event)==null?void 0:m.title}. Previous role (${c.role_needed}) was unselected.`);return}}),Array.from(l).some(d=>{var y,v;const c=h.find(z=>z.id===d);if(!c||((y=c.event)==null?void 0:y.id)===((v=a.event)==null?void 0:v.id))return!1;const o=new Date(a.start_time_utc).getTime(),i=new Date(a.end_time_utc).getTime(),m=new Date(c.start_time_utc).getTime(),g=new Date(c.end_time_utc).getTime(),N=o<g&&i>m;return console.log("Checking overlap:",{shiftA:`${new Date(o).toISOString()} - ${new Date(i).toISOString()}`,shiftB:`${new Date(m).toISOString()} - ${new Date(g).toISOString()}`,overlaps:N}),N})){p("Cannot select this shift: It overlaps with another selected shift. Please deselect the conflicting shift first.");return}l.add(s)}k(l),p(null)}},Z=(s,l)=>{S(a=>({...a,[s]:l}))},G=()=>{f.size===t.length?k(new Set):k(new Set(t.map(s=>s.id)))};async function ee(){var s,l;if(f.size===0){p("Please select at least one shift");return}O(!0),p(null);try{const a=[];h.filter(i=>f.has(i.id)).forEach(i=>{a.push(i.id)});const c=[...new Set(a)].map(i=>{const m=h.find(N=>{var y;return(y=N.all_shift_ids)==null?void 0:y.includes(i)}),g=A[i]||Number(m==null?void 0:m.pay_rate)||0;return{shift_id:i,worker_id:r.id,hourly_rate:g}}),o=await B.post("/staffing/bulk_create",{assignments:c});if(console.log("Bulk create response:",o.data),p(null),ne([]),o.data.status==="success"||o.data.status==="partial_success"){let i=o.data.message;if(o.data.status==="partial_success"&&o.data.data){const{successful:m,failed:g,total_requested:N}=o.data.data,y=m.length,v=g.length,z=N||y+v;if(i=`Successfully scheduled ${y} of ${z} shift${z!==1?"s":""}`,v>0&&y>0){const H=g.map(se=>{var ie;const me=se.event||"Unknown Event",ue=((ie=se.reasons)==null?void 0:ie[0])||se.reason||"Unknown reason";return`${me} (${ue})`}).join(", ");i+=`. ${v} ${v===1?"shift":"shifts"} could not be scheduled: ${H}`}}console.log("Success - calling onSuccess with message:",i),_(i)}else if(o.data.status==="error"){let i=o.data.message||"Failed to schedule worker for shifts";if(o.data.details&&o.data.details.length>0&&(i+=`

Details:
• `+o.data.details.join(`
• `)),(s=o.data.data)!=null&&s.failed){const m=o.data.data.failed.map(g=>{var v,z,H;const N=g.event||((z=(v=g.shift)==null?void 0:v.event)==null?void 0:z.title)||"Unknown Event",y=((H=g.reasons)==null?void 0:H[0])||g.reason||"Unknown reason";return`${N} (${y})`}).join(", ");i+=`

Failed shifts: ${m}`}p(i)}else console.error("Unknown response status:",o.data.status),p("Unexpected response from server")}catch(a){console.error("Failed to bulk assign:",a);let n="Failed to schedule worker for shifts";(l=a.response)!=null&&l.data&&(a.response.data.message&&(n=a.response.data.message),a.response.data.details&&a.response.data.details.length>0&&(n+=`

Details:
• `+a.response.data.details.join(`
• `))),p(n)}finally{O(!1)}}const q=s=>J(K(s),"EEE, MMM d, yyyy"),Q=s=>J(K(s),"h:mm a"),X=r.skills_json||[],t=h.filter(s=>{var l;if($!=="all"&&s.role_needed!==$)return!1;if(C){const a=C.toLowerCase();return(((l=s.event)==null?void 0:l.title)||"").toLowerCase().includes(a)||(s.location||"").toLowerCase().includes(a)}return!0}),u=s=>Array.from(f).some(a=>{var d,c;const n=h.find(o=>o.id===a);return n?((d=n.event)==null?void 0:d.id)===((c=s.event)==null?void 0:c.id)&&n.start_time_utc===s.start_time_utc&&n.end_time_utc===s.end_time_utc&&n.role_needed!==s.role_needed:!1});return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Schedule ",r.first_name," ",r.last_name," for Shifts"]}),e.jsx("button",{onClick:w,className:"p-1 text-gray-400 hover:text-gray-600 rounded transition",children:e.jsx(le,{size:24})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:(b=r.skills_json)==null?void 0:b.map(s=>e.jsx("span",{className:"px-2.5 py-1 bg-teal-100 text-teal-700 text-xs font-medium rounded",children:s},s))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:D?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(te,{})}):e.jsxs(e.Fragment,{children:[R&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2",children:[e.jsx(le,{size:18,className:"text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-red-700",children:R.split(`
`).map((s,l)=>e.jsx("p",{className:s.startsWith("•")?"ml-2":"",children:s},l))})]}),I.length>0&&e.jsxs("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"Scheduling Conflicts"}),e.jsx("div",{className:"space-y-2",children:I.map((s,l)=>{var a;return e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"text-yellow-800",children:[e.jsx("strong",{children:((a=s.new_shift)==null?void 0:a.event)||"Unknown Event"})," conflicts with:"]}),e.jsx("ul",{className:"ml-4 mt-1 space-y-1",children:(s.conflicting_with||[]).map((n,d)=>e.jsxs("li",{className:"text-yellow-700",children:[n.event||"Unknown Event"," (",J(K(n.start_time),"MMM d, h:mm a")," - ",J(K(n.end_time),"h:mm a"),")"]},d))})]},l)})})]}),e.jsxs("div",{className:"mb-4 flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search events or locations...",value:C,onChange:s=>T(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsxs("select",{value:$,onChange:s=>ae(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"all",children:"All Roles"}),X.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),t.length>0&&e.jsxs("div",{className:"mb-4 flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f.size===t.length&&t.length>0,onChange:G,className:"w-4 h-4 text-teal-600 rounded focus:ring-teal-500"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Select All (",t.length," shifts)"]})]}),f.size>0&&e.jsxs("span",{className:"text-sm font-medium text-teal-600",children:[f.size," selected"]})]}),t.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Se,{size:48,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"font-medium",children:"No available shifts found"}),e.jsx("p",{className:"text-sm mt-1",children:C||$!=="all"?"Try adjusting your filters":`No shifts matching ${r.first_name}'s skills need workers`})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:t.map(s=>{var o;const l=f.has(s.id),a=u(s),n=E.has(s.id),d=(a||n)&&!l,c=W[s.id]||[];return e.jsxs("button",{onClick:()=>V(s.id),className:`w-full p-4 rounded-lg border-2 transition-all text-left ${l?"border-teal-600 bg-teal-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:l,disabled:d,onChange:()=>V(s.id),className:`mt-1 w-4 h-4 rounded focus:ring-teal-500 ${d?"text-gray-400 cursor-not-allowed":"text-teal-600"}`,onClick:i=>i.stopPropagation()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{children:[e.jsx("h4",{className:`font-medium ${d?"text-gray-500":"text-gray-900"}`,children:((o=s.event)==null?void 0:o.title)||"Untitled Event"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`inline-block px-2 py-0.5 text-xs font-medium rounded ${d?"bg-gray-200 text-gray-500":"bg-purple-100 text-purple-700"}`,children:s.role_needed}),s.total_positions&&s.total_positions>1&&e.jsxs("span",{className:`text-xs ${d?"text-gray-400":"text-gray-500"}`,children:[s.available_positions," of ",s.total_positions," positions available"]}),a&&!l&&e.jsx("span",{className:"text-xs text-red-600 font-medium",children:"(Conflicts with selected role)"}),n&&!l&&e.jsxs("span",{className:"text-xs text-red-600 font-medium flex items-center gap-1",children:[e.jsx(re,{size:12}),"(Not available)"]})]})]})}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{size:14,className:"text-gray-400"}),e.jsx("span",{children:q(s.start_time_utc)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{size:14,className:"text-gray-400"}),e.jsxs("span",{children:[Q(s.start_time_utc)," - ",Q(s.end_time_utc)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"truncate",children:s.location})]})]})]}),e.jsx("div",{className:"flex flex-col items-end gap-1",onClick:i=>i.stopPropagation(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[A[s.id]&&A[s.id]!==(Number(s.pay_rate)||0)&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"(custom)"}),e.jsx(ke,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"text-gray-500 text-sm",children:"Pay:"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:(Number(s.pay_rate)||0).toString(),value:A[s.id]!==void 0?A[s.id]:Number(s.pay_rate)||0,onChange:i=>{const m=i.target.value;(m===""||/^\d*\.?\d*$/.test(m))&&Z(s.id,parseFloat(m)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:i=>i.stopPropagation(),onFocus:i=>i.stopPropagation()}),e.jsx("span",{className:"text-gray-500 text-sm",children:"/hr"})]})})]}),n&&c.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-red-200",children:e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx(re,{size:14,className:"text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-red-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"Cannot assign to this shift:"}),e.jsx("ul",{className:"list-disc list-inside space-y-0.5",children:c.map((i,m)=>e.jsx("li",{children:i},m))})]})]})})]},s.id)})})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:f.size>0?e.jsxs("span",{className:"font-medium",children:[f.size," shift",f.size!==1?"s":""," selected"]}):e.jsxs("span",{children:["Select shifts to assign ",r.first_name," to"]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:w,disabled:F,className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:ee,disabled:f.size===0||F,className:"px-6 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:F?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Scheduling..."]}):e.jsxs(e.Fragment,{children:["Schedule for ",f.size," Shift",f.size!==1?"s":""]})})]})]})]})})}export{Qe as WorkersPage};
