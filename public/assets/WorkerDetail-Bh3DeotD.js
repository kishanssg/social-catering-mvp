import{c as E,a as x,j as e,L as re,E as z,d as ie,T as le,f as R,p as B,P as O,X as U,C as ne}from"./index--sp_F6OS.js";import{f as ce,c as oe,b as r,L as de}from"./vendor-B6rXSep8.js";import{r as me,a as xe}from"./workersApi-Noo0iGbp.js";import{U as fe}from"./user-CCrJeMAa.js";import{M as ge,P as ue}from"./phone-BMWhhVC2.js";import{B as he}from"./briefcase-EDHbILUE.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],be=E("arrow-left",pe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],ye=E("award",je);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Ne=E("pen",ve),Ee=()=>{const{id:h}=ce(),W=oe(),[s,p]=r.useState(null),[H,F]=r.useState(!0),[I,c]=r.useState(""),[V,b]=r.useState(!1),[X,M]=r.useState(!1),[o,j]=r.useState(!1),[y,D]=r.useState(!1),[v,q]=r.useState([]),[G,N]=r.useState(!1),[f,k]=r.useState(null),[P,w]=r.useState(""),[C,L]=r.useState(!1),[$,d]=r.useState(""),[J,_]=r.useState(!1),[g,S]=r.useState(""),[A,T]=r.useState(!1),[i,n]=r.useState({first_name:"",last_name:"",email:"",phone:"",active:!0});r.useEffect(()=>{h&&(u(parseInt(h)),K())},[h]);const u=async t=>{try{F(!0),c("");const a=await x.getWorker(t);p(a.data.worker),n({first_name:a.data.worker.first_name,last_name:a.data.worker.last_name,email:a.data.worker.email,phone:a.data.worker.phone||"",active:a.data.worker.active})}catch(a){c("Failed to load worker details"),console.error("Error loading worker:",a)}finally{F(!1)}},K=async()=>{try{const t=await x.getCertifications();q(t.data.certifications||[])}catch(t){console.error("Error loading certifications:",t)}},Q=async()=>{if(!(!s||!f)){L(!0),d("");try{const t={certification_id:f,expires_at_utc:P||void 0},a=await xe(s.id,t);if(a.data?.worker_certification){const l=a.data.worker_certification.certification,m={...s,certifications:[...s.certifications||[],l],worker_certifications:[...s.worker_certifications||[],{certification_id:l.id,expires_at_utc:a.data.worker_certification.expires_at_utc}]};p(m)}else console.error("No worker_certification in response:",a);k(null),w(""),N(!1)}catch(t){const a=t.response?.data?.error||t.message||"Failed to add certification";a.includes("already has this certification")?d("This worker already has this certification. Please select a different one."):a.includes("not found")||a.includes("Not Found")?d("Certification API endpoint not found. Please refresh the page and try again."):d(a),console.error("Error adding certification:",t)}finally{L(!1)}}},Y=async t=>{if(s)try{await me(s.id,t);const a={...s,certifications:s.certifications?.filter(l=>l.id!==t)||[],worker_certifications:s.worker_certifications?.filter(l=>l.certification_id!==t)||[]};p(a)}catch(a){d(a.response?.data?.error||"Failed to remove certification"),console.error("Error removing certification:",a)}},Z=async()=>{if(!(!s||!g.trim())){T(!0);try{const a=[...s.skills_json||[],g.trim()];await x.updateWorker(s.id,{skills_json:a}),await u(s.id),S(""),_(!1)}catch(t){c(t.response?.data?.error||"Failed to add skill"),console.error("Error adding skill:",t)}finally{T(!1)}}},ee=async t=>{if(s)try{const l=(s.skills_json||[]).filter(m=>m!==t);await x.updateWorker(s.id,{skills_json:l}),await u(s.id)}catch(a){c(a.response?.data?.error||"Failed to remove skill"),console.error("Error removing skill:",a)}},se=async()=>{if(s)try{D(!0),c(""),await x.updateWorker(s.id,i),await u(s.id),j(!1)}catch(t){c(t.response?.data?.error||"Failed to update worker"),console.error("Error updating worker:",t)}finally{D(!1)}},te=()=>{s&&n({first_name:s.first_name,last_name:s.last_name,email:s.email,phone:s.phone||"",active:s.active}),j(!1)},ae=async()=>{if(s){M(!0);try{console.log("Delete worker:",s.id),W("/workers")}catch(t){console.error("Error deleting worker:",t)}finally{M(!1),b(!1)}}};return H?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(re,{size:"lg"})}):I||!s?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx(z,{message:I||"Worker not found"})}):s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>W("/workers"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(be,{className:"h-5 w-5"}),"Back to Workers"]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:[s.first_name," ",s.last_name]}),e.jsx("p",{className:"text-gray-500 mt-1",children:s.email})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[o?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:se,disabled:y,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2 disabled:opacity-50",children:y?"Saving...":"Save"}),e.jsx("button",{onClick:te,disabled:y,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2",children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>j(!0),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),"Edit"]}),e.jsxs(de,{to:`/workers/${s.id}/schedule`,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"View Schedule"]})]}),e.jsxs("button",{onClick:()=>b(!0),className:"px-4 py-2 border border-red-300 text-red-600 rounded-lg hover:bg-red-50 flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5"}),"Profile"]}),e.jsxs("dl",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"First Name"}),e.jsx("dd",{className:"mt-1",children:o?e.jsx("input",{type:"text",value:i.first_name,onChange:t=>n({...i,first_name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}):e.jsx("span",{className:"text-sm text-gray-900",children:s.first_name})})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Last Name"}),e.jsx("dd",{className:"mt-1",children:o?e.jsx("input",{type:"text",value:i.last_name,onChange:t=>n({...i,last_name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}):e.jsx("span",{className:"text-sm text-gray-900",children:s.last_name})})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Status"}),e.jsx("dd",{className:"mt-1",children:o?e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:i.active,onChange:t=>n({...i,active:t.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:i.active?"Active":"Inactive"})]}):e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${s.active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.active?"Active":"Inactive"})})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Email"}),e.jsx("dd",{className:"mt-1",children:o?e.jsx("input",{type:"email",value:i.email,onChange:t=>n({...i,email:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}):e.jsxs("span",{className:"text-sm text-gray-900 flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4 text-gray-400"}),e.jsx("a",{href:`mailto:${s.email}`,className:"hover:text-blue-600",children:s.email})]})})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Phone"}),e.jsx("dd",{className:"mt-1",children:o?e.jsx("input",{type:"tel",value:i.phone,onChange:t=>n({...i,phone:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}):e.jsxs("span",{className:"text-sm text-gray-900 flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4 text-gray-400"}),s.phone?e.jsx("a",{href:`tel:${s.phone}`,className:"hover:text-blue-600",children:s.phone}):e.jsx("span",{className:"text-gray-400",children:"No phone number"})]})})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Added"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:s.created_at?R(B(s.created_at),"MMM d, yyyy"):"Unknown"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5"}),"Skills"]}),e.jsxs("button",{onClick:()=>_(!0),className:"px-3 py-1 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 flex items-center gap-1",children:[e.jsx(O,{className:"h-4 w-4"}),"Add Skill"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.skills_json&&s.skills_json.length>0?s.skills_json.map((t,a)=>e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800",children:[t,e.jsx("button",{onClick:()=>ee(t),className:"ml-2 p-0.5 text-blue-600 hover:text-blue-800 hover:bg-blue-200 rounded-full",title:"Remove skill",children:e.jsx(U,{className:"h-3 w-3"})})]},a)):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No skills added"})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5"}),"Certifications"]}),e.jsxs("button",{onClick:()=>N(!0),className:"px-3 py-1 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 flex items-center gap-1",children:[e.jsx(O,{className:"h-4 w-4"}),"Add Certification"]})]}),s.certifications&&s.certifications.length>0?e.jsx("div",{className:"space-y-3",children:s.certifications.map((t,a)=>{const l=s.worker_certifications?.find(m=>m.certification_id===t.id);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.name}),l?.expires_at_utc&&e.jsxs("span",{className:"text-sm text-gray-500",children:["Expires: ",R(B(l.expires_at_utc),"MMM d, yyyy")]})]}),e.jsx("button",{onClick:()=>Y(t.id),className:"p-1 text-red-600 hover:text-red-800 hover:bg-red-50 rounded",title:"Remove certification",children:e.jsx(U,{className:"h-4 w-4"})})]},t.id||a)})}):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No certifications"})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Worker Stats"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Status"}),e.jsx("div",{className:`text-lg font-semibold ${s.active?"text-green-600":"text-gray-600"}`,children:s.active?"Active":"Inactive"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Skills Count"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:s.skills_json?.length||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Certifications"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:s.certifications?.length||0})]})]})]})})]}),e.jsx(ne,{isOpen:V,onClose:()=>b(!1),onConfirm:ae,title:"Delete Worker",message:`Are you sure you want to delete ${s.first_name} ${s.last_name}? This action cannot be undone.`,confirmText:"Delete",isLoading:X}),G&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Add Certification"}),e.jsxs("div",{className:"space-y-4",children:[$&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-red-600 text-sm font-medium",children:"Error:"}),e.jsx("div",{className:"text-red-700 text-sm",children:$})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Certification"}),v.filter(t=>!s.certifications?.some(a=>a.id===t.id)).length>0?e.jsxs("select",{value:f||"",onChange:t=>k(parseInt(t.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select a certification"}),v.filter(t=>!s.certifications?.some(a=>a.id===t.id)).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}):e.jsx("div",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500",children:"This worker already has all available certifications."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Expiration Date (Optional)"}),e.jsx("input",{type:"date",value:P,onChange:t=>w(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{N(!1),k(null),w("")},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",disabled:C,children:"Cancel"}),e.jsx("button",{onClick:Q,disabled:!f||C||v.filter(t=>!s.certifications?.some(a=>a.id===t.id)).length===0,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:C?"Adding...":"Add Certification"})]})]})}),J&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Add Skill"}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Skill Name"}),e.jsx("input",{type:"text",value:g,onChange:t=>S(t.target.value),placeholder:"e.g., Bartender, Server, Chef",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{_(!1),S("")},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",disabled:A,children:"Cancel"}),e.jsx("button",{onClick:Z,disabled:!g.trim()||A,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:A?"Adding...":"Add Skill"})]})]})})]}):e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx(z,{message:"Worker not found"})})};export{Ee as default};
