import{c as de,a as A,j as e,X as me}from"./index-Cxcb2WYz.js";import{i as pe,b as fe,r as m}from"./vendor-79DyBOV9.js";import{L as xe}from"./LoadingSpinner-CL2lCBPi.js";import{T as he}from"./Toast-fAhL8wc5.js";import{c as ue}from"./check-Bp3f4Z94.js";import{b as L,a as O,c as T,e as U,p as q}from"./Prep Cook-li-JR_eG.js";import{C as ge}from"./chevron-right-dwxSB-eT.js";import{U as be}from"./user-DCU-zkHh.js";import{P as _e}from"./plus-DCC5ZB7c.js";import"./x-circle-D3-r1t8h.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=de("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function Le(){const{id:g}=pe(),k=fe(),u=!!g,I=m.useRef(null),[f,W]=m.useState("details"),[E,v]=m.useState(!1),[G,B]=m.useState(!1),[R,D]=m.useState(!1),[M,b]=m.useState(!1),[w,J]=m.useState([]),[s,o]=m.useState({first_name:"",last_name:"",email:"",phone:"",address_line1:"",address_line2:"",profile_photo_url:"",skills:[],worker_certifications_attributes:[]}),[$,V]=m.useState(null),[_,N]=m.useState(null),[c,X]=m.useState({}),[y,C]=m.useState({isVisible:!1,message:"",type:"success"}),S=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),P=t=>{const r=t.replace(/\D/g,"");return r.length>=10&&r.length<=15},K=t=>{const r=t.replace(/\D/g,"");o({...s,phone:r})},z=[{name:"Bartender",icon:L},{name:"Banquet Server/Runner",icon:O},{name:"Captain",icon:T},{name:"Event Helper",icon:U},{name:"Prep Cook",icon:q}],Q=t=>({Bartender:L,"Banquet Server/Runner":O,Captain:T,"Event Helper":U,"Prep Cook":q})[t]||L;m.useEffect(()=>{(async()=>{var t,r,a;try{const i=await A.get("/certifications"),n=((r=(t=i.data)==null?void 0:t.data)==null?void 0:r.certifications)||((a=i.data)==null?void 0:a.certifications)||[];J(Array.isArray(n)?n:[])}catch(i){console.error("Failed to load certifications catalog",i)}})(),u&&Y()},[g]);async function Y(){B(!0);try{const t=await A.get(`/workers/${g}`);if(t.data.status==="success"){const r=t.data.data.worker,a=Array.isArray(r==null?void 0:r.worker_certifications)?r.worker_certifications:Array.isArray(r==null?void 0:r.certifications)?r.certifications:[],i=Array.isArray(a)?a:[];o({first_name:r.first_name||"",last_name:r.last_name||"",email:r.email||"",phone:r.phone?r.phone.replace(/\D/g,""):"",address_line1:r.address_line1||"",address_line2:r.address_line2||"",profile_photo_url:r.profile_photo_url||"",skills:r.skills_json||[],worker_certifications_attributes:i.map(n=>{var l,p;return{id:n.id,certification_id:((l=n.certification)==null?void 0:l.id)??n.certification_id??n.id,name:((p=n.certification)==null?void 0:p.name)??n.name,expires_at_utc:n.expires_at_utc?String(n.expires_at_utc).split("T")[0]:"",_destroy:!1}})}),r.profile_photo_url&&N(r.profile_photo_url)}}catch(t){console.error("Failed to load worker:",t)}finally{B(!1)}}function Z(){var t;(t=I.current)==null||t.click()}function ee(t){var i;const r=(i=t.target.files)==null?void 0:i[0];if(!r||!r.type.startsWith("image/")||r.size>5*1024*1024)return;V(r);const a=new FileReader;a.onloadend=()=>N(a.result),a.readAsDataURL(r)}async function te(){var t,r,a,i,n;v(!0);try{x("first_name",s.first_name),x("last_name",s.last_name),x("email",s.email),x("phone",s.phone);const l=s.first_name.trim().length>=2,p=s.last_name.trim().length>=2,ne=!!s.email.trim()&&S(s.email),le=!!s.phone.trim()&&P(s.phone);if(!l||!p||!ne||!le){v(!1);return}const oe=u?"PATCH":"POST",ce=u?`/workers/${g}`:"/workers",d=new FormData;d.append("worker[first_name]",s.first_name),d.append("worker[last_name]",s.last_name),d.append("worker[email]",s.email),d.append("worker[phone]",s.phone),d.append("worker[address_line1]",s.address_line1),d.append("worker[address_line2]",s.address_line2),s.skills.forEach(h=>d.append("worker[skills_json][]",h)),s.worker_certifications_attributes.forEach((h,j)=>{h.id!=null&&d.append(`worker[worker_certifications_attributes][${j}][id]`,String(h.id)),d.append(`worker[worker_certifications_attributes][${j}][certification_id]`,String(h.certification_id)),h.expires_at_utc&&d.append(`worker[worker_certifications_attributes][${j}][expires_at_utc]`,h.expires_at_utc),h._destroy&&d.append(`worker[worker_certifications_attributes][${j}][_destroy]`,"true")}),$&&d.append("profile_photo",$);const H=await A.request({method:oe,url:ce,data:d});H.data.status==="success"?k("/workers"):C({isVisible:!0,message:((t=H.data.errors)==null?void 0:t.join(", "))||"Failed to save worker",type:"error"})}catch(l){console.error("Failed to save worker:",l);let p="Failed to save worker";(a=(r=l.response)==null?void 0:r.data)!=null&&a.errors?p=l.response.data.errors.join(", "):(n=(i=l.response)==null?void 0:i.data)!=null&&n.message?p=l.response.data.message:l.message&&(p=l.message),C({isVisible:!0,message:p,type:"error"})}finally{v(!1)}}const se=(w||[]).filter(t=>!(Array.isArray(s.worker_certifications_attributes)?s.worker_certifications_attributes:[]).some(a=>a.certification_id===t.id&&!a._destroy)),F=[{id:1,title:"Add New Worker",description:"Invite a new user to join as a Worker.",completed:f==="skills",active:f==="details"},{id:2,title:"Add Skills",description:"Specify Worker's Skills.",completed:!1,active:f==="skills"}],x=(t,r)=>{const a={...c};switch(t){case"first_name":r.length<2?a.first_name="First name must be at least 2 characters":delete a.first_name;break;case"last_name":r.length<2?a.last_name="Last name must be at least 2 characters":delete a.last_name;break;case"email":r.trim()?S(r)?delete a.email:a.email="Please enter a valid email address":a.email="Email is required";break;case"phone":r.length>0&&!P(r)?a.phone="Please enter a valid phone number (10-15 digits only, no hyphens or spaces)":delete a.phone;break}X(a)},re=()=>{if(f==="details"){const t=s.first_name.trim().length>=2,r=s.last_name.trim().length>=2,a=!!s.email.trim()&&S(s.email),i=!!s.phone.trim()&&P(s.phone);return t&&r&&a&&i}return!0},ae=()=>{f==="details"?W("skills"):te()},ie=()=>{f==="skills"&&W("details")};return G?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(xe,{})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-8 py-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("button",{onClick:()=>k("/workers"),className:"hover:text-gray-900 transition",children:"Workers"}),e.jsx(ge,{size:16}),e.jsx("span",{className:"text-gray-900",children:u?"Edit Worker":"Add New Worker"})]})})}),e.jsxs("div",{className:"flex flex-1 justify-center gap-12 px-8 min-h-0",style:{paddingTop:"80px",paddingBottom:"40px"},children:[e.jsx("div",{className:"w-[280px] flex-shrink-0 self-start",children:F.map((t,r)=>e.jsxs("div",{className:"flex gap-4",style:{minHeight:r<F.length-1?"100px":"auto"},children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full flex-shrink-0",style:{backgroundColor:t.completed?"#FFFFFF":t.active?"#000000":"transparent",border:t.completed||t.active?"2px solid #000000":"0.8px solid #292826",boxShadow:t.active||t.completed?"0 2px 8px 0 rgba(0,0,0,0.04)":"none"},children:t.completed?e.jsx("img",{src:ue,width:"18",height:"18",alt:"Completed",className:"flex-shrink-0"}):t.active?e.jsx("div",{className:"rounded-full bg-white",style:{width:"12px",height:"12px"}}):null}),r<F.length-1&&e.jsx("div",{className:"flex-1",style:{width:"2px",backgroundColor:"rgba(0,0,0,0.5)"}})]}),e.jsxs("div",{className:"flex flex-col gap-1 pt-1",children:[e.jsx("span",{className:"text-sm font-bold font-manrope leading-[140%] text-font-primary",children:t.title}),e.jsx("span",{className:"text-sm font-normal font-manrope leading-[140%] text-font-secondary",children:t.description})]})]},t.id))}),e.jsxs("div",{className:"flex flex-col p-8 rounded-lg border border-primary-color/10 bg-white self-start overflow-visible",style:{boxShadow:"0 2px 8px 0 rgba(0,0,0,0.04)",maxWidth:"850px",width:"100%",minHeight:"600px"},children:[e.jsx("div",{className:"flex flex-col gap-6 flex-1 overflow-visible pr-2",style:{fontFamily:"Manrope, sans-serif"},children:f==="details"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx("h2",{className:"text-xl font-bold text-font-primary",children:"Worker Details"})}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Phone number"}),e.jsx("input",{type:"tel",value:s.phone,onChange:t=>K(t.target.value),onBlur:()=>x("phone",s.phone),className:`px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent ${c.phone?"border-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"1234567890"}),c.phone&&e.jsx("p",{className:"text-sm text-red-600",children:c.phone})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"First name"}),e.jsx("input",{type:"text",value:s.first_name,onChange:t=>o({...s,first_name:t.target.value}),onBlur:()=>x("first_name",s.first_name),className:`px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent ${c.first_name?"border-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"First name"}),c.first_name&&e.jsx("p",{className:"text-sm text-red-600",children:c.first_name})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Last name"}),e.jsx("input",{type:"text",value:s.last_name,onChange:t=>o({...s,last_name:t.target.value}),onBlur:()=>x("last_name",s.last_name),className:`px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent ${c.last_name?"border-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"Last name"}),c.last_name&&e.jsx("p",{className:"text-sm text-red-600",children:c.last_name})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Email address"}),e.jsx("input",{type:"email",value:s.email,onChange:t=>o({...s,email:t.target.value}),onBlur:()=>x("email",s.email),className:`px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent ${c.email?"border-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"Email address"}),c.email&&e.jsx("p",{className:"text-sm text-red-600",children:c.email})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Home address"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx("input",{type:"text",value:s.address_line1,onChange:t=>o({...s,address_line1:t.target.value}),className:"px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"Address line 1"}),e.jsx("input",{type:"text",value:s.address_line2,onChange:t=>o({...s,address_line2:t.target.value}),className:"px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"Address line 2"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Profile Photo"}),e.jsxs("div",{className:"flex items-center gap-4 p-4 border border-gray-300 rounded-lg",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden",children:_?e.jsx("img",{src:_,alt:"Preview",className:"w-16 h-16 object-cover"}):e.jsx(be,{size:24,className:"text-gray-500"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{ref:I,type:"file",accept:"image/*",className:"hidden",onChange:ee}),e.jsxs("button",{type:"button",onClick:Z,className:"text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center gap-2",children:[e.jsx(ye,{size:16}),_?"Change Photo":"Upload Photo"]}),_&&e.jsx("button",{type:"button",onClick:()=>{V(null),N(null)},className:"text-red-600 hover:text-red-700 text-sm",children:"Remove"}),e.jsx("span",{className:"text-xs text-gray-500",children:"JPG, PNG up to 5MB"})]})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx("h2",{className:"text-xl font-bold text-font-primary",children:"Worker Skills"})}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("label",{className:"text-sm font-semibold font-manrope leading-[140%] text-font-primary",children:"Skills"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between h-11 px-4 rounded-lg border border-primary-color/10 bg-white cursor-pointer hover:border-primary-color/30 transition-colors",onClick:()=>D(!R),children:[e.jsx("span",{className:"text-sm font-normal font-manrope leading-[140%] text-primary-color",children:s.skills.length>0?s.skills.join(", "):"Pick the Skills the Worker Has"}),e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M4 6L8 10L12 6",stroke:"#292826",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]}),R&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border border-primary-color/10 rounded-lg shadow-lg z-50 max-h-[200px] overflow-y-auto",children:[z.filter(t=>!s.skills.includes(t.name)).map(t=>e.jsxs("div",{className:"flex items-center gap-3 px-3 py-2.5 cursor-pointer hover:bg-gray-50",onClick:()=>{o({...s,skills:[...s.skills,t.name]}),D(!1)},children:[e.jsx("img",{src:t.icon,width:"20",height:"20",alt:t.name,className:"flex-shrink-0",style:{imageRendering:"crisp-edges"}}),e.jsx("span",{className:"text-sm font-normal font-manrope leading-[140%] text-font-primary",children:t.name})]},t.name)),s.skills.length===z.length&&e.jsx("div",{className:"px-3 py-2.5 text-sm text-gray-500 text-center",children:"All skills selected"})]})]}),s.skills.length>0&&e.jsx("div",{className:"flex flex-col gap-3",children:s.skills.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-primary-color/10 bg-white",style:{boxShadow:"0 1px 2px rgba(0,0,0,0.06)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:Q(t),width:"24",height:"24",alt:t,className:"flex-shrink-0",style:{imageRendering:"crisp-edges"}}),e.jsx("span",{className:"text-sm font-semibold font-manrope leading-[140%] text-font-primary",children:t})]}),e.jsx("button",{onClick:()=>o({...s,skills:s.skills.filter(r=>r!==t)}),className:"flex items-center justify-center w-6 h-6 text-red-500 hover:bg-red-50 rounded",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 4L4 12M4 4L12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]},t))})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Certifications"}),e.jsx("div",{className:"space-y-3",children:(Array.isArray(s.worker_certifications_attributes)?s.worker_certifications_attributes:[]).map((t,r)=>e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("select",{value:t.certification_id||"",onChange:a=>{const i=parseInt(a.target.value||"0",10),n=w.find(p=>p.id===i),l=[...s.worker_certifications_attributes];l[r].certification_id=i,l[r].name=(n==null?void 0:n.name)||"",o({...s,worker_certifications_attributes:l})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"",children:"Select certificationâ€¦"}),w.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"date",value:t.expires_at_utc,onChange:a=>{const i=[...s.worker_certifications_attributes];i[r].expires_at_utc=a.target.value,o({...s,worker_certifications_attributes:i})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})}),e.jsx("button",{type:"button",onClick:()=>{const a=[...s.worker_certifications_attributes];a[r].id?a[r]._destroy=!0:a.splice(r,1),o({...s,worker_certifications_attributes:a})},className:"text-red-600 hover:text-red-800",children:e.jsx(me,{size:16})})]},r))}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>b(!M),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:[e.jsx(_e,{size:16}),e.jsx("span",{children:"Add Certification"})]}),M&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-10",children:se.map(t=>e.jsx("button",{type:"button",onClick:()=>{if(s.worker_certifications_attributes.findIndex(i=>i.certification_id===t.id&&!i._destroy)!==-1){b(!1);return}const a=s.worker_certifications_attributes.findIndex(i=>i.certification_id===t.id&&i._destroy);if(a!==-1){const i=[...s.worker_certifications_attributes];i[a]._destroy=!1,o({...s,worker_certifications_attributes:i}),b(!1);return}o({...s,worker_certifications_attributes:[...s.worker_certifications_attributes,{id:null,certification_id:t.id,name:t.name,expires_at_utc:"",_destroy:!1}]}),b(!1)},className:"w-full text-left px-4 py-2 hover:bg-gray-50 first:rounded-t-lg last:rounded-b-lg",children:t.name},t.id))})]})]})]})]})}),e.jsxs("div",{className:"flex justify-between items-center gap-4 pt-6 border-t border-gray-200",children:[e.jsx("div",{children:f==="skills"&&e.jsxs("button",{onClick:ie,className:"flex items-center gap-2 px-6 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M10 12L6 8L10 4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Back"]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>k("/workers"),className:"px-6 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{onClick:ae,disabled:!re()||E,className:"px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transition",children:E?"Saving...":f==="details"?"Continue":u?"Update Worker":"Create Worker"})]})]})]})]}),e.jsx(he,{isVisible:y.isVisible,message:y.message,type:y.type,onClose:()=>C({...y,isVisible:!1})})]})}export{Le as WorkerCreatePage};
