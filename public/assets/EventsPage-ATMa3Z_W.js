import{c as Ne,j as e,a as q,C as ve}from"./index-D9AVL-2E.js";import{r as c,b as _e,f as Ee}from"./vendor-79DyBOV9.js";import{f as $e,a as ye}from"./dateUtils-CHmZs4Ub.js";import{X as oe,T as we}from"./Toast-DV0rDIw3.js";import{C as ce}from"./clock-hCYGkKbU.js";import{M as me}from"./map-pin-yBFfypGQ.js";import{U as ge}from"./users-DdnaKi6b.js";import{A as fe}from"./alert-circle-RCM2JQiw.js";import{S as he,A as Fe,T as pe,C as ue}from"./ConfirmationModal-DxV7v1Rk.js";import{D as ke}from"./dollar-sign-mGPq8Lc1.js";import{C as Le}from"./x-circle--ZXhmoXj.js";import{b as De,a as Pe,c as Me,e as Te,p as ze}from"./Prep Cook-CE8OFMb5.js";import{P as Ce}from"./pen-square-Bh4K6wOc.js";import{P as be}from"./plus-B1-kKfQS.js";import{C as xe}from"./calendar-DwUI4oPE.js";import{f as K}from"./index-C_slYh2M.js";import{p as Y}from"./index-BK_MyBzW.js";import{C as Se}from"./chevron-down-CucS6-wQ.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=Ne("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=Ne("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),Ae={sm:"max-w-md",md:"max-w-2xl",lg:"max-w-4xl",xl:"max-w-6xl"},de=({isOpen:d,onClose:p,title:v,subtitle:a,children:W,footer:b,size:h="md",closeOnOverlayClick:l=!0})=>{if(c.useEffect(()=>(d?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[d]),c.useEffect(()=>{const g=R=>{R.key==="Escape"&&d&&p()};return document.addEventListener("keydown",g),()=>document.removeEventListener("keydown",g)},[d,p]),!d)return null;const D=g=>{g.target===g.currentTarget&&l&&p()};return e.jsx("div",{className:"modal-overlay",onClick:D,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:e.jsxs("div",{className:`modal-container ${Ae[h]}`,children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{id:"modal-title",className:"text-xl font-semibold text-gray-900 font-manrope",children:v}),a&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a})]}),e.jsx("button",{onClick:p,className:"p-1.5 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors","aria-label":"Close modal",children:e.jsx(oe,{size:20,className:"text-gray-600"})})]}),e.jsx("div",{className:"modal-body",children:W}),b&&e.jsx("div",{className:"modal-footer",children:b})]})})};function Oe({shiftId:d,onClose:p,onSuccess:v}){var S,o;const[a,W]=c.useState(null),[b,h]=c.useState([]),[l,D]=c.useState([]),[g,R]=c.useState(""),[_,w]=c.useState(null),[r,I]=c.useState({}),[f,M]=c.useState(!0),[F,T]=c.useState(!1),[$,A]=c.useState(null),Q=(t,i)=>{I(k=>({...k,[t]:i}))};c.useEffect(()=>{O()},[d]),c.useEffect(()=>{a&&x()},[a]),c.useEffect(()=>{if(!g)D(b);else{const t=g.toLowerCase();D(b.filter(i=>{var k;return i.first_name.toLowerCase().includes(t)||i.last_name.toLowerCase().includes(t)||i.email.toLowerCase().includes(t)||((k=i.skills_json)==null?void 0:k.some(L=>L.toLowerCase().includes(t)))}))}},[g,b]);async function O(){try{const t=await q.get(`/shifts/${d}`);t.data.status==="success"?W(t.data.data):A("Failed to load shift details")}catch(t){console.error("Failed to load shift details:",t),A("Failed to load shift details")}}async function x(){var t;try{const i=new Set;if(a!=null&&a.event_id)try{const E=((t=(await q.get(`/events/${a.event_id}`)).data)==null?void 0:t.data)||{};if(E.shifts_by_role){const C=E.shifts_by_role.find(N=>N.skill_name===a.role_needed||N.role_name===a.role_needed);C!=null&&C.shifts&&C.shifts.forEach(N=>{N.assignments&&N.assignments.forEach(u=>{var B;const P=u.worker_id||((B=u.worker)==null?void 0:B.id),U=u.status;P&&U!=="cancelled"&&U!=="no_show"&&i.add(P)})})}}catch(L){console.log("Could not fetch event to filter assigned workers:",L)}console.log(`AssignmentModal: Found ${i.size} already assigned workers for "${a==null?void 0:a.role_needed}"`);const k=await q.get("/workers?active=true");if(k.data.status==="success"){const L=k.data.data.workers||k.data.data;if(a!=null&&a.role_needed){const E=L.filter(C=>{var N;return((N=C.skills_json)==null?void 0:N.includes(a.role_needed))&&!i.has(C.id)});console.log(`AssignmentModal: Showing ${E.length} eligible workers`),h(E)}else{const E=L.filter(C=>!i.has(C.id));h(E)}}else A("Failed to load workers")}catch(i){console.error("Failed to load workers:",i),A("Failed to load workers")}finally{M(!1)}}async function m(){var t,i,k,L,E,C;if(!(!_||!a)){T(!0),A(null);try{const u=(await q.post("/staffing",{assignment:{shift_id:a.id,worker_id:_.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:r[_.id]||Number(a.pay_rate)||0}})).data;if(u.status==="success")v();else{let P=u.message||"Failed to assign worker";u.details&&u.details.length>0?P+=`

Details:
â€¢ `+u.details.join(`
â€¢ `):u.errors&&(P+=`

Details:
â€¢ `+u.errors.join(`
â€¢ `)),A(P)}}catch(N){console.error("Failed to assign worker:",N);let u="Failed to assign worker";if((i=(t=N.response)==null?void 0:t.data)!=null&&i.details&&N.response.data.details.length>0){const P=N.response.data.details.map(U=>(U.includes("conflicting shift"),U));u+=`

`+P.join(`
`)}else(L=(k=N.response)==null?void 0:k.data)!=null&&L.errors?u+=`

`+N.response.data.errors.join(`
`):(C=(E=N.response)==null?void 0:E.data)!=null&&C.message?u=N.response.data.message:N.message&&(u=N.message);A(u)}finally{T(!1)}}}if(f)return e.jsx(de,{isOpen:!0,onClose:p,title:"Assign Worker",size:"lg",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-600"})})});const j=e.jsxs(e.Fragment,{children:[$&&e.jsxs("div",{className:"mb-4 p-3 bg-gradient-to-r from-red-50 to-amber-50 border-l-4 border-red-500 rounded-r-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsx("h4",{className:"text-sm font-semibold text-red-900",children:"âš ï¸ Scheduling Conflict Detected"})]}),e.jsx("p",{className:"text-xs text-gray-600 ml-8",children:"Please resolve the conflict before attempting to assign this worker"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:p,disabled:F,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:m,disabled:!_||F||!!$,className:`btn-primary ${$?"opacity-50 cursor-not-allowed":""}`,title:$?"Cannot assign due to scheduling conflict":"",children:F?"Assigning Worker...":"Assign Worker"})]})]});return e.jsx(de,{isOpen:!0,onClose:p,title:a?`${a.client_name} â€¢ ${a.role_needed}`:"Assign Worker",size:"xl",footer:j,children:e.jsxs("div",{className:"flex h-[600px]",children:[e.jsx("div",{className:"w-1/3 border-r border-gray-200 p-6 bg-gray-50",children:a?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Shift Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ce,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:$e(a.start_time_utc)}),e.jsxs("div",{className:"text-sm text-gray-600",children:[ye(a.start_time_utc)," - ",ye(a.end_time_utc)]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(me,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"text-sm text-gray-900",children:a.location||((o=(S=a.event)==null?void 0:S.venue)==null?void 0:o.formatted_address)||"Location not specified"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ge,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900",children:a.role_needed}),a.required_skill&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Requires: ",a.required_skill]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Pay Rate:"})," $",(Number(a.pay_rate)||0).toFixed(2),"/hour"]}),a.uniform_name&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",a.uniform_name]})]}),a.notes&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Notes:"}),e.jsx("div",{className:"mt-1 whitespace-pre-line",children:a.notes.split("Uniform:").map((t,i)=>i===0?t.trim():e.jsxs("div",{children:[e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",t.trim()]},i))})]})})]})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fe,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Failed to load shift details"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search workers...",value:g,onChange:t=>R(t.target.value),className:"w-full pl-9 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-teal-500 focus:border-teal-500"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:$?e.jsx("div",{className:"p-6 flex items-center justify-center h-full",children:e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 rounded-lg p-5 shadow-sm w-full max-w-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(fe,{size:20,className:"text-red-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg font-semibold text-red-900 mb-1",children:"âš ï¸ Scheduling Conflict"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"This worker cannot be assigned due to a scheduling conflict"}),e.jsx("div",{className:"bg-white border border-red-200 rounded p-3 mt-3",children:e.jsx("div",{className:"text-sm text-red-800 font-mono",children:$.split(`
`).map((t,i)=>t.trim()===""?null:t.startsWith("â€¢")?e.jsxs("div",{className:"mt-1 flex items-start gap-2",children:[e.jsx("span",{className:"text-red-500",children:"â—"}),e.jsx("span",{className:"flex-1",children:t.replace("â€¢","").trim()})]},i):t.startsWith("Details:")?null:t.includes("conflicting shift")?e.jsx("div",{className:"mt-1 text-red-700 font-medium",children:t},i):e.jsx("div",{className:"text-gray-700",children:t},i))})})]})]})})}):l.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ge,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:g?"No workers found matching your search":a!=null&&a.role_needed?`No workers found with "${a.role_needed}" skill`:"No available workers"}),(a==null?void 0:a.role_needed)&&!g&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:['Try adding "',a.role_needed,'" skill to workers or select a different shift.']})]}):e.jsx("ul",{children:l.map(t=>{const i=(_==null?void 0:_.id)===t.id,k=r[t.id]||Number(a.pay_rate)||0,L=r[t.id]&&r[t.id]!==(Number(a.pay_rate)||0);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${i?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[t.first_name[0],t.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[t.first_name," ",t.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(t.skills_json||[]).map((E,C)=>{const N=E===(a==null?void 0:a.role_needed);return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${N?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:E},C)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[L&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ke,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:(Number(a.pay_rate)||0).toString(),value:k||"",onChange:E=>{const C=E.target.value;(C===""||/^\d*\.?\d*$/.test(C))&&Q(t.id,parseFloat(C)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:E=>E.stopPropagation(),onFocus:E=>E.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>w(t),className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${i?"bg-teal-600 text-white border-teal-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:i?"Selected":"Select"})]})]},t.id)})})})]})]})})}function We({isOpen:d,eventId:p,roleName:v,unfilledShiftIds:a,defaultPayRate:W,onClose:b,onDone:h}){const[l,D]=c.useState([]),[g,R]=c.useState([]),[_,w]=c.useState(""),[r,I]=c.useState(!1),[f,M]=c.useState(!1),[F,T]=c.useState({}),[$,A]=c.useState(0),Q=(o,t)=>{T(i=>({...i,[o]:t}))};c.useEffect(()=>{d&&(D([]),R([]),w(""),T({}),I(!0),(async()=>{var o,t;try{const k=((o=(await q.get(`/events/${p}`)).data)==null?void 0:o.data)||{};console.log("QuickFill: Full event data:",JSON.stringify(k,null,2)),console.log("QuickFill: Looking for role:",v),console.log("QuickFill: shifts_by_role:",k.shifts_by_role);const L=new Set;if(k.shifts_by_role){const u=k.shifts_by_role.find(P=>(console.log("QuickFill: Checking role:",P.skill_name,P.role_name,"vs",v),P.skill_name===v||P.role_name===v));u?(console.log("QuickFill: Found role shifts:",u),u.shifts&&u.shifts.forEach(P=>{P.assignments&&(console.log("QuickFill: Shift has assignments:",P.assignments),P.assignments.forEach(U=>{var Z;const B=U.worker_id||((Z=U.worker)==null?void 0:Z.id),X=U.status;B&&X!=="cancelled"&&(L.add(B),console.log("QuickFill: Adding worker_id to exclude:",B,"status:",X))}))})):console.log("QuickFill: No role shifts found for:",v)}console.log(`QuickFill: Found ${L.size} already assigned worker IDs:`,Array.from(L));const E=await q.get("/workers?active=true"),N=(((t=E.data)==null?void 0:t.data)||E.data||[]).filter(u=>{const P=(u.skills_json||[]).includes(v),U=L.has(u.id);return U&&console.log(`QuickFill: Excluding ${u.first_name} ${u.last_name} (ID: ${u.id}) - already assigned`),P&&!U});if(console.log(`QuickFill: Found ${N.length} eligible workers for "${v}"`),console.log("QuickFill: Eligible workers:",N.map(u=>`${u.first_name} ${u.last_name}`)),D(N),W){const u=Number(W)||0;A(u),console.log(`QuickFill: Default pay rate for ${v}: $${u}/hr`)}else console.log(`QuickFill: No default pay rate provided for ${v}`)}catch(i){console.error("Error loading workers:",i)}finally{I(!1)}})())},[d,p,v,W]);const O=c.useMemo(()=>{const o=_.trim().toLowerCase(),t=l;return o?t.filter(i=>`${i.first_name} ${i.last_name}`.toLowerCase().includes(o)||(i.email||"").toLowerCase().includes(o)):t},[l,_]),x=a.length,m=o=>{R(t=>t.includes(o)?t.filter(i=>i!==o):t.length>=x?t:[...t,o])},j=async()=>{var k,L,E,C,N,u,P,U,B,X,Z,ee,ae,re,ie;if(g.length===0||x===0)return;M(!0);let o=0,t=0;const i=[];try{const se=g.map(H=>l.find(s=>s.id===H)).filter(Boolean),le=[...a];let te=0;for(;le.length>0&&se.length>0;){const H=se[te%se.length],s=le.shift();try{const n=F[H.id]||Number($)||0||0,y=await q.post("/staffing",{assignment:{shift_id:s,worker_id:H.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:n}});if(((k=y.data)==null?void 0:k.status)==="success")o+=1;else{t+=1;const z=`${H.first_name} ${H.last_name}`,G=((L=y.data)==null?void 0:L.message)||((C=(E=y.data)==null?void 0:E.error)==null?void 0:C.message)||((u=(N=y.data)==null?void 0:N.errors)==null?void 0:u.join(", "))||"Unknown error";let V="Unable to assign";const J=String(G).toLowerCase();J.includes("overlapping")||J.includes("conflict")?V="Has overlapping shift":J.includes("capacity")||J.includes("full")?V="Shift is full":J.includes("skill")||J.includes("certification")||J.includes("requirement")?V="Missing required skill":J.includes("status")?V="Cannot be assigned":V="Unable to assign",i.push(`${z}: ${V}`)}}catch(n){t+=1;const y=`${H.first_name} ${H.last_name}`;let z="Unable to assign";const G=((U=(P=n.response)==null?void 0:P.data)==null?void 0:U.message)||((Z=(X=(B=n.response)==null?void 0:B.data)==null?void 0:X.error)==null?void 0:Z.message)||((re=(ae=(ee=n.response)==null?void 0:ee.data)==null?void 0:ae.errors)==null?void 0:re.join(", "))||null;if(G){const V=String(G).toLowerCase();V.includes("overlapping")||V.includes("conflict")?z="Has overlapping shift":V.includes("capacity")||V.includes("full")?z="Shift is full":V.includes("skill")||V.includes("certification")||V.includes("requirement")?z="Missing required skill":V.includes("status")?z="Cannot be assigned":z="Unable to assign"}else((ie=n.response)==null?void 0:ie.status)===422?z="Unable to assign":n.message&&!n.message.includes("status code")&&(z=n.message);i.push(`${y}: ${z}`)}te+=1}let ne="";t>0&&i.length>0&&(ne=i.join(", ")),h({assigned:o,conflicts:t,details:ne})}finally{M(!1)}};if(!d)return null;const S=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,disabled:f,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:j,disabled:f||g.length===0||x===0,className:"btn-primary",children:f?"Filling Shifts...":g.length===1?`Assign worker to ${x} shift${x!==1?"s":""}`:`Assign ${g.length} workers to ${x} shifts`})]});return e.jsxs(de,{isOpen:d,onClose:b,title:`Quick Fill â€” ${v}`,subtitle:`Unfilled shifts: ${x}`,size:"lg",footer:S,children:[e.jsxs("div",{className:"relative",children:[e.jsx(he,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{value:_,onChange:o=>w(o.target.value),placeholder:"Search eligible workersâ€¦",className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsx("div",{className:"max-h-[340px] overflow-y-auto border border-gray-200 rounded-lg",children:r?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loadingâ€¦"}):O.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"No eligible workers"}):e.jsx("ul",{children:O.map(o=>{const t=g.includes(o.id);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${t?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[o.first_name[0],o.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[o.first_name," ",o.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(o.skills_json||[]).map((i,k)=>{const L=i===v;return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${L?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:i},k)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[F[o.id]&&F[o.id]!==(Number($)||0)&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ke,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:Number($)?(Number($)||0).toString():"Rate",value:F[o.id]||Number($)||0||"",onChange:i=>{const k=i.target.value;(k===""||/^\d*\.?\d*$/.test(k))&&Q(o.id,parseFloat(k)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:i=>i.stopPropagation(),onFocus:i=>i.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>m(o.id),disabled:!t&&g.length>=x,className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${t?"bg-teal-600 text-white border-teal-600":g.length>=x?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:t?"Selected":"Select"})]})]},o.id)})})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(Le,{size:16,className:"text-teal-600"}),e.jsxs("span",{children:["Will assign ",e.jsx("strong",{children:g.length})," worker",g.length!==1?"s":""," to ",e.jsx("strong",{children:x})," shift",x!==1?"s":"","."]})]}),(Number($)||0)>0&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Default rate for ",v,":"]}),e.jsxs("span",{className:"font-medium",children:["$",(Number($)||0).toFixed(2),"/hr"]})]}),Object.keys(F).length>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["ðŸ’¡ Empty fields will use default rate ($",(Number($)||0).toFixed(2),"/hr)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(Fe,{size:14,className:"text-yellow-600"}),"Conflicts and already-filled shifts will be skipped automatically."]})]})}function Ie({event:d,isOpen:p,onClose:v,onSuccess:a}){const W=_e(),[b,h]=c.useState(!1),[l,D]=c.useState([]),[g,R]=c.useState(!1),[_,w]=c.useState(null),[r,I]=c.useState({isVisible:!1,message:"",type:"error"}),f=()=>{v(),W(`/events/${d.id}/edit`)},M=[{name:"Bartender",icon:De},{name:"Banquet Server/Runner",icon:Pe},{name:"Captain",icon:Me},{name:"Event Helper",icon:Te},{name:"Prep Cook",icon:ze}];c.useEffect(()=>{if(d.shifts_by_role&&Array.isArray(d.shifts_by_role)){const x=d.shifts_by_role.map(m=>{const j=m.shifts?m.shifts.length:m.total_shifts||1;return{skill_name:m.skill_name||m.role_name||"",needed_workers:j,pay_rate:m.pay_rate||15,description:"",uniform_id:void 0,cert_id:void 0}});D(x)}},[d]);const F=(x,m,j)=>{const S=[...l];S[x]={...S[x],[m]:j},D(S)},T=()=>{D([...l,{skill_name:"",needed_workers:1,pay_rate:15,description:"",uniform_id:void 0,cert_id:void 0}])},$=x=>{var m;if(l[x].needed_workers>0){const j=(m=d.shifts_by_role)==null?void 0:m[x];if(j&&(j.assigned_workers>0||j.filled_shifts>0)){I({isVisible:!0,message:"Cannot remove role with assigned workers. Please unassign workers first.",type:"error"});return}}D(l.filter((j,S)=>S!==x))},A=(x,m)=>{M.find(S=>S.name===m);const j=[...l];j[x]={...j[x],skill_name:m},D(j),w(null)},Q=async()=>{var x,m;if(d.schedule&&new Date(d.schedule.start_time_utc)<=new Date){I({isVisible:!0,message:"Cannot edit event that has already started",type:"error"});return}R(!0);try{const j=await q.patch(`/events/${d.id}`,{event:{roles:l.map(S=>({skill_name:S.skill_name,needed:S.needed_workers,pay_rate:S.pay_rate,description:S.description,uniform_id:S.uniform_id,cert_id:S.cert_id}))}});j.data.status==="success"?(I({isVisible:!0,message:j.data.message||"Event updated successfully",type:"success"}),a(),v()):I({isVisible:!0,message:j.data.message||"Failed to update event",type:"error"})}catch(j){console.error("Failed to update event:",j),I({isVisible:!0,message:((m=(x=j.response)==null?void 0:x.data)==null?void 0:m.message)||"Failed to update event",type:"error"})}finally{R(!1)}},O=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:v,disabled:g,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:Q,disabled:g,className:"btn-primary",children:g?"Saving...":"Save Changes"})]});return e.jsxs(e.Fragment,{children:[e.jsx(de,{isOpen:p,onClose:v,title:`Edit Event: ${d.title}`,size:"lg",footer:O,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Event Details"}),e.jsxs("button",{onClick:f,className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-white border border-gray-300 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all shadow-sm",children:[e.jsx(Ce,{size:14}),"Edit"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Venue"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:d.venue.name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:new Date(d.schedule.start_time_utc).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"space-y-1 md:col-span-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Location"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900 leading-relaxed",children:d.venue.formatted_address})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Time"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[new Date(d.schedule.start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})," - ",new Date(d.schedule.end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})]})]}),e.jsx("div",{})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"Roles"}),e.jsxs("button",{onClick:T,className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white text-sm font-semibold rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(be,{size:16}),"Add Role"]})]}),l.map((x,m)=>{var j,S;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[e.jsxs("div",{className:"flex-1 relative overflow-visible",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Role Name *"}),e.jsxs("div",{className:"relative",style:{zIndex:_===m?1e3:1},children:[e.jsxs("button",{type:"button",onClick:()=>w(_===m?null:m),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white text-left flex items-center justify-between",children:[x.skill_name?e.jsxs("div",{className:"flex items-center gap-2",children:[((j=M.find(o=>o.name===x.skill_name))==null?void 0:j.icon)&&e.jsx("img",{src:M.find(o=>o.name===x.skill_name).icon,alt:x.skill_name,className:"w-5 h-5"}),e.jsx("span",{className:"text-gray-900",children:x.skill_name})]}):e.jsx("span",{className:"text-gray-400",children:"Pick the Skills the Worker Has"}),e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M19 9l-7 7-7-7"})})]}),_===m&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border-2 border-gray-200 rounded-xl shadow-2xl z-[9999] max-h-[300px] overflow-y-auto w-full min-w-max",children:M.filter(o=>!l.some((t,i)=>i!==m&&t.skill_name===o.name)).map(o=>e.jsxs("div",{onClick:()=>A(m,o.name),className:"flex items-center gap-3 px-4 py-3 cursor-pointer hover:bg-teal-50 border-b border-gray-100 last:border-0",children:[e.jsx("img",{src:o.icon,width:"24",height:"24",alt:o.name,className:"flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:o.name})]},o.name))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Needed Workers *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>F(m,"needed_workers",Math.max(1,x.needed_workers-1)),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"-"}),e.jsx("input",{type:"number",value:x.needed_workers,onChange:o=>F(m,"needed_workers",parseInt(o.target.value)||1),min:"1",className:"w-16 px-2 py-2 border border-gray-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-teal-500 font-medium"}),e.jsx("button",{onClick:()=>F(m,"needed_workers",x.needed_workers+1),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"+"}),e.jsx("button",{onClick:()=>$(m),className:"ml-2 w-8 h-8 flex items-center justify-center text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove role",children:e.jsx(pe,{size:18})})]})]})]}),((S=d.shifts_by_role)==null?void 0:S[m])&&(d.shifts_by_role[m].assigned_workers>0||d.shifts_by_role[m].filled_shifts>0)&&e.jsxs("div",{className:"text-sm text-amber-600 font-semibold bg-amber-50 px-3 py-2 rounded-lg",children:[d.shifts_by_role[m].assigned_workers||d.shifts_by_role[m].filled_shifts," worker(s) assigned"]})]},m)})]})]})}),e.jsx(we,{isVisible:r.isVisible,message:r.message,type:r.type,onClose:()=>I({...r,isVisible:!1})})]})}function ds(){const d=_e(),[p,v]=Ee(),a=(p.get("tab")==="completed"?"completed":p.get("tab"))||"active",W=p.get("filter")||"all",[b,h]=c.useState(a),[l,D]=c.useState(W),[g,R]=c.useState(""),[_,w]=c.useState("date"),[r,I]=c.useState(!0),[f,M]=c.useState([]),[F,T]=c.useState(new Set),[$,A]=c.useState({isOpen:!1}),[Q,O]=c.useState({isVisible:!1,message:"",type:"success"}),[x,m]=c.useState({isOpen:!1,isLoading:!1}),[j,S]=c.useState({isOpen:!1,isLoading:!1}),[o,t]=c.useState({isOpen:!1,isLoading:!1}),[i,k]=c.useState({isOpen:!1,unfilledShiftIds:[]}),[L,E]=c.useState({isOpen:!1});c.useEffect(()=>{C()},[b,l,p]),c.useEffect(()=>{const s=(p.get("tab")==="completed"?"completed":p.get("tab"))||"active",n=p.get("filter")||"all";s!==b&&h(s),n!==l&&D(n)},[p,b,l]),c.useEffect(()=>{const s=p.get("event_id"),n=p.get("shift_id");if(s){const y=parseInt(s);isNaN(y)||(T(new Set([y])),n&&console.log(`Auto-expanding event ${y} with shift ${n}`))}},[p]);async function C(){I(!0);try{const s=b==="completed"?"completed":b,n=p.get("date");let y=`/events?tab=${s}`;l!=="all"&&(y+=`&filter=${l}`),n&&(y+=`&date=${n}`),console.log("Loading events with URL:",y,"filterStatus:",l,"date:",n);const z=await q.get(y);z.data.status==="success"&&(console.log("Received events:",z.data.data.length),M(z.data.data))}catch(s){console.error("Failed to load events:",s)}finally{I(!1)}}const N=s=>{h(s),v({tab:s}),D("all")},u=s=>{D(s);const n=new URLSearchParams;n.set("tab",b),s!=="all"&&n.set("filter",s),v(n)},P=s=>{const n=new Set(F);n.has(s)?n.delete(s):n.add(s),T(n)};async function U(s){const n=f==null?void 0:f.find(y=>y.id===s);t({isOpen:!0,isLoading:!1,eventId:s,eventTitle:n==null?void 0:n.title})}async function B(){if(o.eventId){t(s=>({...s,isLoading:!0}));try{const s=await q.delete(`/events/${o.eventId}`);s.data.status==="success"?(t({isOpen:!1,isLoading:!1}),O({isVisible:!0,message:`"${s.data.event_title}" moved to trash`,type:"success",action:{label:"Undo",onClick:()=>X(s.data.event_id),variant:"primary"}}),C()):O({isVisible:!0,message:s.data.message||"Failed to delete event",type:"error"})}catch(s){console.error("Failed to delete event:",s),O({isVisible:!0,message:"Failed to delete event",type:"error"})}finally{t(s=>({...s,isLoading:!1}))}}}async function X(s){try{const n=await q.post(`/events/${s}/restore`);n.data.status==="success"?(O({isVisible:!0,message:"Event restored to draft",type:"success"}),C()):O({isVisible:!0,message:n.data.message||"Failed to restore event",type:"error"})}catch(n){console.error("Failed to restore event:",n),O({isVisible:!0,message:"Failed to restore event",type:"error"})}}function Z(){t({isOpen:!1,isLoading:!1})}function ee(s){m({isOpen:!0,eventId:s,isLoading:!1})}async function ae(){if(x.eventId){m(s=>({...s,isLoading:!0}));try{const s=await q.post(`/events/${x.eventId}/publish`);s.data.status==="success"?(O({isVisible:!0,message:s.data.message||"Event published",type:"success"}),m({isOpen:!1,isLoading:!1}),C()):(O({isVisible:!0,message:s.data.message||"Failed to publish event",type:"error"}),m({isOpen:!1,isLoading:!1}))}catch(s){console.error("Failed to publish event:",s),O({isVisible:!0,message:"Failed to publish event",type:"error"}),m({isOpen:!1,isLoading:!1})}}}function re(){m({isOpen:!1,isLoading:!1})}function ie(s,n){S({isOpen:!0,assignmentId:s,isLoading:!1,workerName:n})}async function se(){var s,n;if(j.assignmentId){S(y=>({...y,isLoading:!0}));try{const y=await q.delete(`/staffing/${j.assignmentId}`);((s=y.data)==null?void 0:s.status)==="success"?(O({isVisible:!0,message:"Worker unassigned",type:"success"}),S({isOpen:!1,isLoading:!1}),C()):(O({isVisible:!0,message:((n=y.data)==null?void 0:n.message)||"Failed to unassign worker",type:"error"}),S({isOpen:!1,isLoading:!1}))}catch(y){console.error("Failed to unassign worker:",y),O({isVisible:!0,message:"Failed to unassign worker",type:"error"}),S({isOpen:!1,isLoading:!1})}}}const le=s=>{A({isOpen:!0,shiftId:s})},te=()=>{A({isOpen:!1})},ne=()=>{te(),O({isVisible:!0,message:"Worker assigned successfully",type:"success"}),C()},H=f.filter(s=>{var n;if(g){const y=g.toLowerCase();if(!(s.title.toLowerCase().includes(y)||((n=s.venue)==null?void 0:n.name.toLowerCase().includes(y))))return!1}if(b==="active")switch(l){case"needs_workers":return s.unfilled_roles_count>0;case"partially_filled":return s.unfilled_roles_count>0&&s.assigned_workers_count>0;case"fully_staffed":return s.unfilled_roles_count===0&&s.assigned_workers_count>0;case"all":default:return!0}return!0}).sort((s,n)=>{var y,z;switch(_){case"name":return s.title.localeCompare(n.title);case"staffing":return s.staffing_percentage-n.staffing_percentage;case"date":default:const G=((y=s.schedule)==null?void 0:y.start_time_utc)||s.created_at,V=((z=n.schedule)==null?void 0:z.start_time_utc)||n.created_at;return new Date(G).getTime()-new Date(V).getTime()}});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Events"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage events and assign workers"})]}),e.jsxs("button",{onClick:()=>d("/events/create"),className:"flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(be,{size:20}),"Create New Event"]})]}),p.get("date")&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-teal-50 border border-teal-200 rounded-lg",children:[e.jsx(xe,{size:16,className:"text-teal-600"}),e.jsxs("span",{className:"text-sm font-medium text-teal-900",children:["Showing events for ",K(Y(p.get("date")),"EEEE, MMMM d, yyyy")]}),e.jsx("button",{onClick:()=>{const s=new URLSearchParams(p);s.delete("date"),v(s)},className:"ml-auto text-teal-600 hover:text-teal-700",title:"Clear date filter",children:e.jsx(oe,{size:16})})]})]}),e.jsxs("div",{className:"flex gap-6 border-b border-gray-200 mb-6",children:[e.jsx("button",{onClick:()=>N("draft"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${b==="draft"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Draft Events"}),e.jsx("button",{onClick:()=>N("active"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${b==="active"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Active Events"}),e.jsx("button",{onClick:()=>N("completed"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${b==="completed"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Completed Events"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 max-w-md relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search events or venues...",value:g,onChange:s=>R(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),e.jsxs("select",{value:_,onChange:s=>w(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"name",children:"Sort by Name"}),b!=="draft"&&e.jsx("option",{value:"staffing",children:"Sort by Staffing"})]}),b==="active"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u("all"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${l==="all"?"bg-teal-100 text-teal-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"All"}),e.jsx("button",{onClick:()=>u("needs_workers"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${l==="needs_workers"?"bg-red-100 text-red-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Needs Workers"}),e.jsx("button",{onClick:()=>u("partially_filled"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${l==="partially_filled"?"bg-yellow-100 text-yellow-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Partial"}),e.jsx("button",{onClick:()=>u("fully_staffed"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${l==="fully_staffed"?"bg-green-100 text-green-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Ready"})]})]}),r?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600"})}):e.jsxs(e.Fragment,{children:[b==="draft"&&e.jsx(Ue,{events:H,onDelete:U,onPublish:ee,onNavigate:s=>d(s),searchQuery:g}),b==="active"&&e.jsx(Ve,{events:H,expandedEvents:F,onToggleEvent:P,onAssignWorker:le,onUnassign:ie,onQuickFill:(s,n,y,z)=>k({isOpen:!0,eventId:s,roleName:n,unfilledShiftIds:y,payRate:z}),onPublish:ee,onDelete:U,onEdit:s=>E({isOpen:!0,event:s}),searchQuery:g}),b==="completed"&&e.jsx(Qe,{events:H,expandedEvents:F,onToggleEvent:P,searchQuery:g})]})]}),$.isOpen&&$.shiftId&&e.jsx(Oe,{shiftId:$.shiftId,onClose:te,onSuccess:ne}),e.jsx(we,{isVisible:Q.isVisible,message:Q.message,type:Q.type,action:Q.action,onClose:()=>O({...Q,isVisible:!1})}),e.jsx(ue,{isOpen:x.isOpen,onClose:re,onConfirm:ae,title:"Publish Event",message:"Publish this event? This will create shifts and make them available for staffing.",confirmText:x.isLoading?"Publishingâ€¦":"Publish",cancelText:"Cancel",isLoading:x.isLoading,isDestructive:!1}),e.jsx(ue,{isOpen:j.isOpen,onClose:()=>S({isOpen:!1,isLoading:!1}),onConfirm:se,title:"Unassign Worker",message:`Remove ${j.workerName||"this worker"} from this shift?`,confirmText:j.isLoading?"Removingâ€¦":"Unassign",cancelText:"Cancel",isLoading:j.isLoading,isDestructive:!0}),e.jsx(ue,{isOpen:o.isOpen,onClose:Z,onConfirm:B,title:"Delete Event",message:`Are you sure you want to delete "${o.eventTitle}"? This action cannot be undone.`,confirmText:o.isLoading?"Deletingâ€¦":"Delete",cancelText:"Cancel",isLoading:o.isLoading,isDestructive:!0}),e.jsx(We,{isOpen:i.isOpen,eventId:i.eventId||0,roleName:i.roleName||"",unfilledShiftIds:i.unfilledShiftIds,defaultPayRate:i.payRate,onClose:()=>k({isOpen:!1,unfilledShiftIds:[]}),onDone:({assigned:s,conflicts:n,details:y})=>{k({isOpen:!1,unfilledShiftIds:[]});let z=`Assigned ${s} workers â€¢ ${n} skipped`;n>0&&y&&(z+=`: ${y}`),O({isVisible:!0,message:z,type:n>0?"error":"success"}),C()}}),L.event&&e.jsx(Ie,{event:L.event,isOpen:L.isOpen,onClose:()=>E({isOpen:!1,event:void 0}),onSuccess:()=>{C(),E({isOpen:!1,event:void 0})}})]})}function Ue({events:d,onDelete:p,onPublish:v,onNavigate:a,searchQuery:W}){const b=l=>l?K(Y(l),"MMM d, yyyy"):"No date set",h=l=>l?K(Y(l),"h:mm a"):"";return d.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:W?"No draft events found":"No draft events yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:W?"Try adjusting your search query":"Create your first event to get started"}),!W&&e.jsxs("button",{onClick:()=>a("/events/create"),className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:[e.jsx(be,{size:20}),"Create Event"]})]}):e.jsx("div",{className:"space-y-4",children:d.map(l=>e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 flex-1",children:l.title}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Draft"})]}),l.venue&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[e.jsx(me,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:l.venue.name})]}),l.schedule&&e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{children:b(l.schedule.start_time_utc)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsxs("span",{children:[h(l.schedule.start_time_utc)," - ",h(l.schedule.end_time_utc)]})]})]}),l.total_workers_needed>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ge,{size:16,className:"text-gray-400"}),e.jsxs("span",{children:[l.total_workers_needed," workers needed"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>a(`/events/${l.id}/edit`),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Edit",children:e.jsx(Ce,{size:18})}),e.jsx("button",{onClick:()=>v(l.id),className:"px-4 py-2 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Publish"}),e.jsx("button",{onClick:()=>p(l.id),className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition",title:"Delete",children:e.jsx(pe,{size:18})})]})]})})},l.id))})}function Ve({events:d,expandedEvents:p,onToggleEvent:v,onAssignWorker:a,onUnassign:W,onQuickFill:b,onPublish:h,onDelete:l,onEdit:D,searchQuery:g}){const R=r=>K(Y(r),"EEE, MMM d, yyyy"),_=r=>K(Y(r),"h:mm a"),w=r=>{switch(r){case"fully_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[e.jsx(je,{size:14}),"Ready"]});case"partially_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full",children:[e.jsx(fe,{size:14}),"Partial"]});case"needs_workers":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[e.jsx(oe,{size:14}),"Needs Workers"]});default:return null}};return d.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:g?"No active events found":"No active events"}),e.jsx("p",{className:"text-gray-600",children:g?"Try adjusting your search query or filters":"Publish draft events to see them here"})]}):e.jsx("div",{className:"space-y-4",children:d.map(r=>{const I=p.has(r.id);return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{onClick:()=>v(r.id),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:r.title}),w(r.staffing_status)]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[r.venue&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(me,{size:14,className:"text-gray-400"}),r.venue.name]}),r.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(xe,{size:14,className:"text-gray-400"}),R(r.schedule.start_time_utc)]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ce,{size:14,className:"text-gray-400"}),_(r.schedule.start_time_utc)]})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:[r.assigned_workers_count," of ",r.total_workers_needed," roles filled"]}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[r.staffing_percentage,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-full rounded-full transition-all ${r.staffing_percentage===100?"bg-green-500":r.staffing_percentage>0?"bg-yellow-500":"bg-red-500"}`,style:{width:`${r.staffing_percentage}%`}})})]}),r.unfilled_roles_count>0&&e.jsxs("p",{className:"text-sm text-red-600 font-medium",children:[r.unfilled_roles_count," role",r.unfilled_roles_count!==1?"s":""," still need workers"]}),r.shifts_by_role&&r.shifts_by_role.length>0&&e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Est. Cost: "}),e.jsxs("span",{className:"font-semibold text-green-600",children:["$",(()=>{let f=0;return r.shifts_by_role.forEach(M=>{M.shifts.forEach(F=>{const T=(new Date(F.end_time_utc).getTime()-new Date(F.start_time_utc).getTime())/36e5;F.assignments.forEach($=>{const A=Number($.hourly_rate||F.pay_rate||0);f+=A*T})})}),f.toFixed(0)})()]})]})]}),e.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[(!r.shifts_by_role||r.shifts_by_role.length===0)&&l&&e.jsx("button",{onClick:f=>{f.stopPropagation(),l(r.id)},className:"px-3 py-1.5 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition-colors",children:"Delete Event"}),D&&r.status==="published"&&e.jsx("button",{onClick:f=>{f.stopPropagation(),D(r)},title:"Edit Event",className:"p-1.5 text-teal-600 hover:text-teal-700 hover:bg-teal-50 rounded transition-colors",children:e.jsx(Re,{size:14})}),l&&e.jsx("button",{onClick:f=>{f.stopPropagation(),l(r.id)},title:"Delete",className:"p-1.5 text-red-600 hover:text-red-700 hover:bg-red-50 rounded transition-colors",children:e.jsx(pe,{size:14})}),e.jsx("div",{className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:I?e.jsx(ve,{size:24,className:"text-gray-600 hover:text-gray-800"}):e.jsx(Se,{size:24,className:"text-gray-600 hover:text-gray-800"})})]})]}),I&&e.jsx("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:r.shifts_by_role&&r.shifts_by_role.length>0?e.jsx("div",{className:"space-y-4",children:r.shifts_by_role.map(f=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:f.role_name}),e.jsxs("span",{className:"text-sm text-gray-600",children:[f.filled_shifts,"/",f.total_shifts," assigned"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[f.filled_shifts<f.total_shifts&&e.jsxs("span",{className:"px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[f.total_shifts-f.filled_shifts," needed"]}),f.filled_shifts<f.total_shifts&&e.jsx("button",{onClick:M=>{var $;M.stopPropagation();const F=f.shifts.filter(A=>A.staffing_progress.percentage<100).sort((A,Q)=>new Date(A.start_time_utc).getTime()-new Date(Q.start_time_utc).getTime()).map(A=>A.id),T=($=f.shifts[0])==null?void 0:$.pay_rate;b(r.id,f.role_name,F,T)},className:"px-2.5 py-1 text-xs font-semibold bg-teal-600 text-white rounded hover:bg-teal-700",title:"Quick Fill by Skill",children:"Quick Fill by Skill"})]})]}),e.jsx("div",{className:"space-y-2",children:f.shifts.map((M,F)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 text-gray-700 rounded-md flex items-center justify-center text-xs font-medium",children:F+1}),e.jsxs("span",{className:"text-sm text-gray-700",children:[_(M.start_time_utc)," - ",_(M.end_time_utc)]}),M.assignments.length>0&&e.jsx("div",{className:"flex items-center gap-1",children:M.assignments.map(T=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"px-2 py-0.5 bg-teal-100 text-teal-700 text-xs rounded",children:[T.worker.first_name," ",T.worker.last_name[0],".",e.jsxs("span",{className:"ml-1 text-teal-600 font-medium",children:["$",Number(T.hourly_rate||M.pay_rate||0).toFixed(0),"/hr"]})]}),e.jsx("button",{onClick:$=>{$.stopPropagation(),W(T.id,`${T.worker.first_name} ${T.worker.last_name}`)},className:"w-5 h-5 flex items-center justify-center text-red-600 hover:text-red-700 hover:bg-red-50 rounded",title:"Unassign worker",children:e.jsx(oe,{size:12})})]},T.id))})]}),M.staffing_progress.percentage===100?e.jsxs("span",{className:"flex items-center gap-1.5 text-sm font-medium text-green-600",children:[e.jsx(je,{size:16}),"Assigned"]}):e.jsx("button",{onClick:T=>{T.stopPropagation(),a(M.id)},className:"px-3 py-1.5 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Assign Worker"})]},M.id))})]},f.role_name))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:r.status==="draft"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"This event is still in draft status"}),e.jsx("p",{className:"text-sm",children:"Publish the event to generate shifts and assign workers"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"No shifts available"}),e.jsx("p",{className:"text-sm",children:"This event may not have any shifts generated yet"})]})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[r.status==="draft"&&e.jsx("button",{onClick:()=>h(r.id),className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors",children:"Publish Event"}),l&&e.jsx("button",{onClick:()=>l(r.id),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Delete Event"})]})]})})]},r.id)})})}function Qe({events:d,expandedEvents:p,onToggleEvent:v,searchQuery:a}){const W=h=>K(Y(h),"MMM d, yyyy"),b=h=>K(Y(h),"h:mm a");return d.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“‹"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:a?"No past events found":"No past events yet"}),e.jsx("p",{className:"text-gray-600",children:a?"Try adjusting your search query":"Completed events will appear here"})]}):e.jsx("div",{className:"space-y-4",children:d.map(h=>{var g;const l=p.has(h.id);let D=0;return(g=h.shifts_by_role)==null||g.forEach(R=>{R.shifts.forEach(_=>{_.assignments.forEach(w=>{const r=w.hours_worked?parseFloat(w.hours_worked.toString()):0;D+=r})})}),D=Number(D)||0,e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{onClick:()=>v(h.id),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:h.title}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Completed"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[h.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(xe,{size:14,className:"text-gray-400"}),W(h.schedule.start_time_utc)]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ce,{size:14,className:"text-gray-400"}),b(h.schedule.start_time_utc)," - ",b(h.schedule.end_time_utc)]})]}),h.venue&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(me,{size:14,className:"text-gray-400"}),h.venue.name]})]})]}),e.jsx("div",{className:"ml-4 flex items-center",children:e.jsx("div",{className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:l?e.jsx(ve,{size:24,className:"text-gray-600 hover:text-gray-800"}):e.jsx(Se,{size:24,className:"text-gray-600 hover:text-gray-800"})})})]}),l&&h.shifts_by_role&&e.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:[e.jsx("div",{className:"mb-4 p-4 bg-white rounded-lg border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Workers"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:h.assigned_workers_count})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Hours"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:D.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Event Cost"}),e.jsxs("p",{className:"text-2xl font-semibold text-green-600",children:["$",(()=>{let R=0;return h.shifts_by_role.forEach(_=>{_.shifts.forEach(w=>{const r=(new Date(w.end_time_utc).getTime()-new Date(w.start_time_utc).getTime())/36e5;w.assignments.forEach(I=>{const f=Number(I.hourly_rate||w.pay_rate||0);R+=f*r})})}),R.toFixed(0)})()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Staffing"}),e.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[h.staffing_percentage,"%"]})]})]})}),e.jsx("div",{className:"space-y-3",children:h.shifts_by_role.map(R=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:R.role_name}),e.jsx("div",{className:"space-y-2",children:R.shifts.flatMap(_=>_.assignments.map(w=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 text-teal-700 flex items-center justify-center text-sm font-medium",children:[w.worker.first_name[0],w.worker.last_name[0]]}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[w.worker.first_name," ",w.worker.last_name]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[w.hours_worked&&e.jsxs("span",{className:"font-medium",children:[parseFloat(w.hours_worked.toString()).toFixed(2)," hrs"]}),e.jsxs("span",{className:"font-medium text-green-600",children:["$",Number(w.hourly_rate||_.pay_rate||0).toFixed(0),"/hr"]}),w.hours_worked&&e.jsxs("span",{className:"font-semibold text-blue-600",children:["$",(parseFloat(w.hours_worked.toString())*Number(w.hourly_rate||_.pay_rate||0)).toFixed(0)]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[b(_.start_time_utc)," - ",b(_.end_time_utc)]})]})]},w.id)))})]},R.role_name))})]})]},h.id)})})}export{ds as EventsPage};
