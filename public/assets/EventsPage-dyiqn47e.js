import{c as je,j as e,a as V,C as ve}from"./index-KgUPzAav.js";import{r as u,b as Ne,f as Ee}from"./vendor-79DyBOV9.js";import{f as $e,a as be}from"./dateUtils-CHmZs4Ub.js";import{X as oe,T as _e}from"./Toast-BLvtjrVc.js";import{C as we}from"./clock-BCcUYsge.js";import{M as ce}from"./map-pin-DZbDW2NO.js";import{U as ue}from"./users-CpgZdJMH.js";import{A as ge}from"./alert-circle-BsEqcKnU.js";import{S as fe,A as Fe,T as he,C as xe}from"./ConfirmationModal-0XY11zyQ.js";import{D as ke}from"./dollar-sign-B2cCca9w.js";import{C as De}from"./x-circle-D5fsJ_x-.js";import{b as Le,a as Te,c as Pe,e as Me,p as ze}from"./Prep Cook-CE8OFMb5.js";import{P as Se}from"./pen-square-CFGlgyD-.js";import{P as pe}from"./plus-DW-cYiRA.js";import{C as me}from"./calendar-D41oUcnf.js";import{f as Y}from"./index-C_slYh2M.js";import{p as K}from"./index-BK_MyBzW.js";import{C as Ce}from"./chevron-down-BMCdPxMI.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=je("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=je("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),Ae={sm:"max-w-md",md:"max-w-2xl",lg:"max-w-4xl",xl:"max-w-6xl"},de=({isOpen:p,onClose:b,title:S,subtitle:r,children:U,footer:v,size:y="md",closeOnOverlayClick:n=!0})=>{if(u.useEffect(()=>(p?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[p]),u.useEffect(()=>{const h=A=>{A.key==="Escape"&&p&&b()};return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[p,b]),!p)return null;const $=h=>{h.target===h.currentTarget&&n&&b()};return e.jsx("div",{className:"modal-overlay",onClick:$,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:e.jsxs("div",{className:`modal-container ${Ae[y]}`,children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{id:"modal-title",className:"text-xl font-semibold text-gray-900 font-manrope",children:S}),r&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:r})]}),e.jsx("button",{onClick:b,className:"p-1.5 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors","aria-label":"Close modal",children:e.jsx(oe,{size:20,className:"text-gray-600"})})]}),e.jsx("div",{className:"modal-body",children:U}),v&&e.jsx("div",{className:"modal-footer",children:v})]})})};function Ue({shiftId:p,onClose:b,onSuccess:S}){var Q,f;const[r,U]=u.useState(null),[v,y]=u.useState([]),[n,$]=u.useState([]),[h,A]=u.useState(""),[C,F]=u.useState(null),[O,l]=u.useState({}),[L,j]=u.useState(!0),[E,T]=u.useState(!1),[k,M]=u.useState(null),P=(t,o)=>{l(w=>({...w,[t]:o}))};u.useEffect(()=>{_()},[p]),u.useEffect(()=>{r&&z()},[r]),u.useEffect(()=>{if(!h)$(v);else{const t=h.toLowerCase();$(v.filter(o=>{var w;return o.first_name.toLowerCase().includes(t)||o.last_name.toLowerCase().includes(t)||o.email.toLowerCase().includes(t)||((w=o.skills_json)==null?void 0:w.some(d=>d.toLowerCase().includes(t)))}))}},[h,v]);async function _(){try{const t=await V.get(`/shifts/${p}`);t.data.status==="success"?U(t.data.data):M("Failed to load shift details")}catch(t){console.error("Failed to load shift details:",t),M("Failed to load shift details")}}async function z(){var t;try{const o=new Set;if(r!=null&&r.event_id)try{const a=((t=(await V.get(`/events/${r.event_id}`)).data)==null?void 0:t.data)||{};if(a.shifts_by_role){const c=a.shifts_by_role.find(x=>x.skill_name===r.role_needed||x.role_name===r.role_needed);c!=null&&c.shifts&&c.shifts.forEach(x=>{x.assignments&&x.assignments.forEach(i=>{var I;const g=i.worker_id||((I=i.worker)==null?void 0:I.id),D=i.status;g&&D!=="cancelled"&&D!=="no_show"&&o.add(g)})})}}catch(d){console.log("Could not fetch event to filter assigned workers:",d)}console.log(`AssignmentModal: Found ${o.size} already assigned workers for "${r==null?void 0:r.role_needed}"`);const w=await V.get("/workers?active=true");if(w.data.status==="success"){const d=w.data.data.workers||w.data.data;if(r!=null&&r.role_needed){const a=d.filter(c=>{var x;return((x=c.skills_json)==null?void 0:x.includes(r.role_needed))&&!o.has(c.id)});console.log(`AssignmentModal: Showing ${a.length} eligible workers`),y(a)}else{const a=d.filter(c=>!o.has(c.id));y(a)}}else M("Failed to load workers")}catch(o){console.error("Failed to load workers:",o),M("Failed to load workers")}finally{j(!1)}}async function q(){var t,o,w,d,a,c;if(!(!C||!r)){T(!0),M(null);try{const i=(await V.post("/staffing",{assignment:{shift_id:r.id,worker_id:C.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:O[C.id]||Number(r.pay_rate)||0}})).data;if(i.status==="success")S();else{let g=i.message||"Failed to assign worker";i.details&&i.details.length>0?g+=`

Details:
â€¢ `+i.details.join(`
â€¢ `):i.errors&&(g+=`

Details:
â€¢ `+i.errors.join(`
â€¢ `)),M(g)}}catch(x){console.error("Failed to assign worker:",x);let i="Failed to assign worker";if((o=(t=x.response)==null?void 0:t.data)!=null&&o.details&&x.response.data.details.length>0){const g=x.response.data.details.map(D=>(D.includes("conflicting shift"),D));i+=`

`+g.join(`
`)}else(d=(w=x.response)==null?void 0:w.data)!=null&&d.errors?i+=`

`+x.response.data.errors.join(`
`):(c=(a=x.response)==null?void 0:a.data)!=null&&c.message?i=x.response.data.message:x.message&&(i=x.message);M(i)}finally{T(!1)}}}if(L)return e.jsx(de,{isOpen:!0,onClose:b,title:"Assign Worker",size:"lg",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-600"})})});const H=e.jsxs(e.Fragment,{children:[k&&e.jsxs("div",{className:"mb-4 p-3 bg-gradient-to-r from-red-50 to-amber-50 border-l-4 border-red-500 rounded-r-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsx("h4",{className:"text-sm font-semibold text-red-900",children:"âš ï¸ Scheduling Conflict Detected"})]}),e.jsx("p",{className:"text-xs text-gray-600 ml-8",children:"Please resolve the conflict before attempting to assign this worker"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,disabled:E,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:q,disabled:!C||E||!!k,className:`btn-primary ${k?"opacity-50 cursor-not-allowed":""}`,title:k?"Cannot assign due to scheduling conflict":"",children:E?"Assigning Worker...":"Assign Worker"})]})]});return e.jsx(de,{isOpen:!0,onClose:b,title:r?`${r.client_name} â€¢ ${r.role_needed}`:"Assign Worker",size:"xl",footer:H,children:e.jsxs("div",{className:"flex h-[600px]",children:[e.jsx("div",{className:"w-1/3 border-r border-gray-200 p-6 bg-gray-50",children:r?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Shift Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(we,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:$e(r.start_time_utc)}),e.jsxs("div",{className:"text-sm text-gray-600",children:[be(r.start_time_utc)," - ",be(r.end_time_utc)]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ce,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"text-sm text-gray-900",children:r.location||((f=(Q=r.event)==null?void 0:Q.venue)==null?void 0:f.formatted_address)||"Location not specified"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ue,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900",children:r.role_needed}),r.required_skill&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Requires: ",r.required_skill]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Pay Rate:"})," $",(Number(r.pay_rate)||0).toFixed(2),"/hour"]}),r.uniform_name&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",r.uniform_name]})]}),r.notes&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Notes:"}),e.jsx("div",{className:"mt-1 whitespace-pre-line",children:r.notes.split("Uniform:").map((t,o)=>o===0?t.trim():e.jsxs("div",{children:[e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",t.trim()]},o))})]})})]})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ge,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Failed to load shift details"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search workers...",value:h,onChange:t=>A(t.target.value),className:"w-full pl-9 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-teal-500 focus:border-teal-500"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:k?e.jsx("div",{className:"p-6 flex items-center justify-center h-full",children:e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 rounded-lg p-5 shadow-sm w-full max-w-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(ge,{size:20,className:"text-red-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg font-semibold text-red-900 mb-1",children:"âš ï¸ Scheduling Conflict"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"This worker cannot be assigned due to a scheduling conflict"}),e.jsx("div",{className:"bg-white border border-red-200 rounded p-3 mt-3",children:e.jsx("div",{className:"text-sm text-red-800 font-mono",children:k.split(`
`).map((t,o)=>t.trim()===""?null:t.startsWith("â€¢")?e.jsxs("div",{className:"mt-1 flex items-start gap-2",children:[e.jsx("span",{className:"text-red-500",children:"â—"}),e.jsx("span",{className:"flex-1",children:t.replace("â€¢","").trim()})]},o):t.startsWith("Details:")?null:t.includes("conflicting shift")?e.jsx("div",{className:"mt-1 text-red-700 font-medium",children:t},o):e.jsx("div",{className:"text-gray-700",children:t},o))})})]})]})})}):n.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ue,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:h?"No workers found matching your search":r!=null&&r.role_needed?`No workers found with "${r.role_needed}" skill`:"No available workers"}),(r==null?void 0:r.role_needed)&&!h&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:['Try adding "',r.role_needed,'" skill to workers or select a different shift.']})]}):e.jsx("ul",{children:n.map(t=>{const o=(C==null?void 0:C.id)===t.id,w=O[t.id]||Number(r.pay_rate)||0,d=O[t.id]&&O[t.id]!==(Number(r.pay_rate)||0);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${o?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[t.first_name[0],t.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[t.first_name," ",t.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(t.skills_json||[]).map((a,c)=>{const x=a===(r==null?void 0:r.role_needed);return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${x?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:a},c)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[d&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ke,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:(Number(r.pay_rate)||0).toString(),value:w||"",onChange:a=>{const c=a.target.value;(c===""||/^\d*\.?\d*$/.test(c))&&P(t.id,parseFloat(c)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:a=>a.stopPropagation(),onFocus:a=>a.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>F(t),className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${o?"bg-teal-600 text-white border-teal-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:o?"Selected":"Select"})]})]},t.id)})})})]})]})})}function Oe({isOpen:p,eventId:b,roleName:S,unfilledShiftIds:r,defaultPayRate:U,onClose:v,onDone:y}){const[n,$]=u.useState([]),[h,A]=u.useState([]),[C,F]=u.useState(""),[O,l]=u.useState(!1),[L,j]=u.useState(!1),[E,T]=u.useState({}),[k,M]=u.useState(0),P=(f,t)=>{T(o=>({...o,[f]:t}))};u.useEffect(()=>{p&&($([]),A([]),F(""),T({}),l(!0),(async()=>{var f,t;try{const w=((f=(await V.get(`/events/${b}`)).data)==null?void 0:f.data)||{};console.log("QuickFill: Full event data:",JSON.stringify(w,null,2)),console.log("QuickFill: Looking for role:",S),console.log("QuickFill: shifts_by_role:",w.shifts_by_role);const d=new Set;if(w.shifts_by_role){const i=w.shifts_by_role.find(g=>(console.log("QuickFill: Checking role:",g.skill_name,g.role_name,"vs",S),g.skill_name===S||g.role_name===S));i?(console.log("QuickFill: Found role shifts:",i),i.shifts&&i.shifts.forEach(g=>{g.assignments&&(console.log("QuickFill: Shift has assignments:",g.assignments),g.assignments.forEach(D=>{var X;const I=D.worker_id||((X=D.worker)==null?void 0:X.id),J=D.status;I&&J!=="cancelled"&&(d.add(I),console.log("QuickFill: Adding worker_id to exclude:",I,"status:",J))}))})):console.log("QuickFill: No role shifts found for:",S)}console.log(`QuickFill: Found ${d.size} already assigned worker IDs:`,Array.from(d));const a=await V.get("/workers?active=true"),x=(((t=a.data)==null?void 0:t.data)||a.data||[]).filter(i=>{const g=(i.skills_json||[]).includes(S),D=d.has(i.id);return D&&console.log(`QuickFill: Excluding ${i.first_name} ${i.last_name} (ID: ${i.id}) - already assigned`),g&&!D});if(console.log(`QuickFill: Found ${x.length} eligible workers for "${S}"`),console.log("QuickFill: Eligible workers:",x.map(i=>`${i.first_name} ${i.last_name}`)),$(x),U){const i=Number(U)||0;M(i),console.log(`QuickFill: Default pay rate for ${S}: $${i}/hr`)}else console.log(`QuickFill: No default pay rate provided for ${S}`)}catch(o){console.error("Error loading workers:",o)}finally{l(!1)}})())},[p,b,S,U]);const _=u.useMemo(()=>{const f=C.trim().toLowerCase(),t=n;return f?t.filter(o=>`${o.first_name} ${o.last_name}`.toLowerCase().includes(f)||(o.email||"").toLowerCase().includes(f)):t},[n,C]),z=r.length,q=f=>{A(t=>t.includes(f)?t.filter(o=>o!==f):t.length>=z?t:[...t,f])},H=async()=>{var w,d,a,c,x,i,g,D,I,J,X,ee,ae,re,ie;if(h.length===0||z===0)return;j(!0);let f=0,t=0;const o=[];try{const se=h.map(B=>n.find(s=>s.id===B)).filter(Boolean),le=[...r];let te=0;for(;le.length>0&&se.length>0;){const B=se[te%se.length],s=le.shift();try{const m=E[B.id]||Number(k)||0||0,N=await V.post("/staffing",{assignment:{shift_id:s,worker_id:B.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:m}});if(((w=N.data)==null?void 0:w.status)==="success")f+=1;else{t+=1;const R=`${B.first_name} ${B.last_name}`,G=((d=N.data)==null?void 0:d.message)||((c=(a=N.data)==null?void 0:a.error)==null?void 0:c.message)||((i=(x=N.data)==null?void 0:x.errors)==null?void 0:i.join(", "))||"Unknown error";let W="Unable to assign";const Z=String(G).toLowerCase();Z.includes("overlapping")||Z.includes("conflict")?W="Has overlapping shift":Z.includes("capacity")||Z.includes("full")?W="Shift is full":Z.includes("skill")||Z.includes("certification")||Z.includes("requirement")?W="Missing required skill":Z.includes("status")?W="Cannot be assigned":W="Unable to assign",o.push(`${R}: ${W}`)}}catch(m){t+=1;const N=`${B.first_name} ${B.last_name}`;let R="Unable to assign";const G=((D=(g=m.response)==null?void 0:g.data)==null?void 0:D.message)||((X=(J=(I=m.response)==null?void 0:I.data)==null?void 0:J.error)==null?void 0:X.message)||((re=(ae=(ee=m.response)==null?void 0:ee.data)==null?void 0:ae.errors)==null?void 0:re.join(", "))||null;if(G){const W=String(G).toLowerCase();W.includes("overlapping")||W.includes("conflict")?R="Has overlapping shift":W.includes("capacity")||W.includes("full")?R="Shift is full":W.includes("skill")||W.includes("certification")||W.includes("requirement")?R="Missing required skill":W.includes("status")?R="Cannot be assigned":R="Unable to assign"}else((ie=m.response)==null?void 0:ie.status)===422?R="Unable to assign":m.message&&!m.message.includes("status code")&&(R=m.message);o.push(`${N}: ${R}`)}te+=1}let ne="";t>0&&o.length>0&&(ne=o.join(", ")),y({assigned:f,conflicts:t,details:ne})}finally{j(!1)}};if(!p)return null;const Q=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:v,disabled:L,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:H,disabled:L||h.length===0||z===0,className:"btn-primary",children:L?"Filling Shifts...":h.length===1?`Assign worker to ${z} shift${z!==1?"s":""}`:`Assign ${h.length} workers to ${z} shifts`})]});return e.jsxs(de,{isOpen:p,onClose:v,title:`Quick Fill â€” ${S}`,subtitle:`Unfilled shifts: ${z}`,size:"lg",footer:Q,children:[e.jsxs("div",{className:"relative",children:[e.jsx(fe,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{value:C,onChange:f=>F(f.target.value),placeholder:"Search eligible workersâ€¦",className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsx("div",{className:"max-h-[340px] overflow-y-auto border border-gray-200 rounded-lg",children:O?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loadingâ€¦"}):_.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"No eligible workers"}):e.jsx("ul",{children:_.map(f=>{const t=h.includes(f.id);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${t?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[f.first_name[0],f.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[f.first_name," ",f.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(f.skills_json||[]).map((o,w)=>{const d=o===S;return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${d?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:o},w)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[E[f.id]&&E[f.id]!==(Number(k)||0)&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ke,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:Number(k)?(Number(k)||0).toString():"Rate",value:E[f.id]||Number(k)||0||"",onChange:o=>{const w=o.target.value;(w===""||/^\d*\.?\d*$/.test(w))&&P(f.id,parseFloat(w)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:o=>o.stopPropagation(),onFocus:o=>o.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>q(f.id),disabled:!t&&h.length>=z,className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${t?"bg-teal-600 text-white border-teal-600":h.length>=z?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:t?"Selected":"Select"})]})]},f.id)})})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(De,{size:16,className:"text-teal-600"}),e.jsxs("span",{children:["Will assign ",e.jsx("strong",{children:h.length})," worker",h.length!==1?"s":""," to ",e.jsx("strong",{children:z})," shift",z!==1?"s":"","."]})]}),(Number(k)||0)>0&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Default rate for ",S,":"]}),e.jsxs("span",{className:"font-medium",children:["$",(Number(k)||0).toFixed(2),"/hr"]})]}),Object.keys(E).length>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["ðŸ’¡ Empty fields will use default rate ($",(Number(k)||0).toFixed(2),"/hr)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(Fe,{size:14,className:"text-yellow-600"}),"Conflicts and already-filled shifts will be skipped automatically."]})]})}function We({event:p,isOpen:b,onClose:S,onSuccess:r}){var o,w;const U=Ne(),[v,y]=u.useState(!1),[n,$]=u.useState([]),[h,A]=u.useState(!1),[C,F]=u.useState(!1),[O,l]=u.useState(null),[L,j]=u.useState(null),[E,T]=u.useState({isVisible:!1,message:"",type:"error"});u.useEffect(()=>{b&&p.id&&k()},[b,p.id]);const k=async()=>{F(!0);try{const d=await V.get(`/events/${p.id}`);d.data.status==="success"&&l(d.data.data)}catch(d){console.error("Failed to load full event details:",d),l(p)}finally{F(!1)}},M=()=>{S(),U(`/events/${p.id}/edit`)},P=[{name:"Bartender",icon:Le},{name:"Banquet Server/Runner",icon:Te},{name:"Captain",icon:Pe},{name:"Event Helper",icon:Me},{name:"Prep Cook",icon:ze}],_=O||p;u.useEffect(()=>{if(_){if(_.skill_requirements&&Array.isArray(_.skill_requirements)){const d=_.skill_requirements.map(a=>{var i,g;const c=(i=_.shifts_by_role)==null?void 0:i.find(D=>(D.skill_name||D.role_name)===a.skill_name),x=((g=c==null?void 0:c.shifts)==null?void 0:g.length)||(c==null?void 0:c.total_shifts)||a.needed_workers||1;return{skill_name:a.skill_name,needed_workers:x,pay_rate:a.pay_rate||15,description:a.description||"",uniform_id:void 0,cert_id:void 0}});$(d)}else if(_.shifts_by_role&&Array.isArray(_.shifts_by_role)){const d=_.shifts_by_role.map(a=>{const c=a.shifts?a.shifts.length:a.total_shifts||1;return{skill_name:a.skill_name||a.role_name||"",needed_workers:c,pay_rate:a.pay_rate||15,description:"",uniform_id:void 0,cert_id:void 0}});$(d)}}},[_]);const z=(d,a,c)=>{const x=[...n];x[d]={...x[d],[a]:c},$(x)},q=()=>{$([...n,{skill_name:"",needed_workers:1,pay_rate:15,description:"",uniform_id:void 0,cert_id:void 0}])},H=d=>{var a;if(n[d].needed_workers>0){const c=(a=displayEvent==null?void 0:displayEvent.shifts_by_role)==null?void 0:a[d];if(c&&(c.assigned_workers>0||c.filled_shifts>0)){T({isVisible:!0,message:"Cannot remove role with assigned workers. Please unassign workers first.",type:"error"});return}}$(n.filter((c,x)=>x!==d))},Q=(d,a)=>{P.find(x=>x.name===a);const c=[...n];c[d]={...c[d],skill_name:a},$(c),j(null)},f=async()=>{var a,c,x;const d=O||p;if(d.schedule&&new Date(d.schedule.start_time_utc)<=new Date){T({isVisible:!0,message:"Cannot edit event that has already started",type:"error"});return}A(!0);try{const i=await V.patch(`/events/${displayEvent.id}`,{event:{roles:n.map(g=>({skill_name:g.skill_name,needed:g.needed_workers,pay_rate:g.pay_rate,description:g.description,uniform_id:g.uniform_id,cert_id:g.cert_id}))}});i.data.status==="success"?(T({isVisible:!0,message:i.data.message||"Event updated successfully",type:"success"}),r(),S()):T({isVisible:!0,message:i.data.message||"Failed to update event",type:"error"})}catch(i){console.error("Failed to update event:",i);const g=(a=i==null?void 0:i.response)==null?void 0:a.data;if((g==null?void 0:g.status)==="validation_error"&&((x=(c=g==null?void 0:g.data)==null?void 0:c.conflicts)!=null&&x.length)){const D=g.data.conflicts.map(I=>{const J=new Date(I.conflicting_shift_start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),X=new Date(I.conflicting_shift_end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});return`${I.worker_name} conflicts with ${I.conflicting_event_title} (${J} â€“ ${X})`});T({isVisible:!0,message:`Can't save changes: ${D.length} worker${D.length!==1?"s":""} would be double-booked
â€¢ `+D.join(`
â€¢ `),type:"error"})}else T({isVisible:!0,message:(g==null?void 0:g.message)||"Failed to update event",type:"error"})}finally{A(!1)}},t=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:S,disabled:h,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:f,disabled:h,className:"btn-primary",children:h?"Saving...":"Save Changes"})]});return e.jsxs(e.Fragment,{children:[e.jsx(de,{isOpen:b,onClose:S,title:`Edit Event: ${displayEvent.title}`,size:"lg",footer:t,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Event Details"}),e.jsxs("button",{onClick:M,className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-white border border-gray-300 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all shadow-sm",children:[e.jsx(Se,{size:14}),"Edit"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Venue"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:(o=displayEvent.venue)==null?void 0:o.name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:displayEvent.schedule&&new Date(displayEvent.schedule.start_time_utc).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"space-y-1 md:col-span-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Location"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900 leading-relaxed",children:(w=displayEvent.venue)==null?void 0:w.formatted_address})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Time"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:displayEvent.schedule&&e.jsxs(e.Fragment,{children:[new Date(displayEvent.schedule.start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})," - ",new Date(displayEvent.schedule.end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})]})})]}),e.jsx("div",{})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"Roles"}),e.jsxs("button",{onClick:q,className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white text-sm font-semibold rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(pe,{size:16}),"Add Role"]})]}),n.map((d,a)=>{var c,x;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[e.jsxs("div",{className:"flex-1 relative overflow-visible",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Role Name *"}),e.jsxs("div",{className:"relative",style:{zIndex:L===a?1e3:1},children:[e.jsxs("button",{type:"button",onClick:()=>j(L===a?null:a),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white text-left flex items-center justify-between",children:[d.skill_name?e.jsxs("div",{className:"flex items-center gap-2",children:[((c=P.find(i=>i.name===d.skill_name))==null?void 0:c.icon)&&e.jsx("img",{src:P.find(i=>i.name===d.skill_name).icon,alt:d.skill_name,className:"w-5 h-5"}),e.jsx("span",{className:"text-gray-900",children:d.skill_name})]}):e.jsx("span",{className:"text-gray-400",children:"Pick the Skills the Worker Has"}),e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M19 9l-7 7-7-7"})})]}),L===a&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border-2 border-gray-200 rounded-xl shadow-2xl z-[9999] max-h-[300px] overflow-y-auto w-full min-w-max",children:P.filter(i=>!n.some((g,D)=>D!==a&&g.skill_name===i.name)).map(i=>e.jsxs("div",{onClick:()=>Q(a,i.name),className:"flex items-center gap-3 px-4 py-3 cursor-pointer hover:bg-teal-50 border-b border-gray-100 last:border-0",children:[e.jsx("img",{src:i.icon,width:"24",height:"24",alt:i.name,className:"flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:i.name})]},i.name))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Needed Workers *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>z(a,"needed_workers",Math.max(1,d.needed_workers-1)),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"-"}),e.jsx("input",{type:"number",value:d.needed_workers,onChange:i=>z(a,"needed_workers",parseInt(i.target.value)||1),min:"1",className:"w-16 px-2 py-2 border border-gray-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-teal-500 font-medium"}),e.jsx("button",{onClick:()=>z(a,"needed_workers",d.needed_workers+1),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"+"}),e.jsx("button",{onClick:()=>H(a),className:"ml-2 w-8 h-8 flex items-center justify-center text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove role",children:e.jsx(he,{size:18})})]})]})]}),((x=displayEvent.shifts_by_role)==null?void 0:x[a])&&(p.shifts_by_role[a].assigned_workers>0||p.shifts_by_role[a].filled_shifts>0)&&e.jsxs("div",{className:"text-sm text-amber-600 font-semibold bg-amber-50 px-3 py-2 rounded-lg",children:[p.shifts_by_role[a].assigned_workers||p.shifts_by_role[a].filled_shifts," worker(s) assigned"]})]},a)})]})]})}),e.jsx(_e,{isVisible:E.isVisible,message:E.message,type:E.type,onClose:()=>T({...E,isVisible:!1})})]})}function ds(){const p=Ne(),[b,S]=Ee(),r=(b.get("tab")==="completed"?"completed":b.get("tab"))||"active",U=b.get("filter")||"needs_workers",[v,y]=u.useState(r),[n,$]=u.useState(U),[h,A]=u.useState(""),[C,F]=u.useState("date"),[O,l]=u.useState(!0),[L,j]=u.useState([]),[E,T]=u.useState(new Set),[k,M]=u.useState({isOpen:!1}),[P,_]=u.useState({isVisible:!1,message:"",type:"success"}),[z,q]=u.useState({isOpen:!1,isLoading:!1}),[H,Q]=u.useState({isOpen:!1,isLoading:!1}),[f,t]=u.useState({isOpen:!1,isLoading:!1}),[o,w]=u.useState({isOpen:!1,unfilledShiftIds:[]}),[d,a]=u.useState({isOpen:!1});u.useEffect(()=>{c()},[v,n,b]),u.useEffect(()=>{const s=(b.get("tab")==="completed"?"completed":b.get("tab"))||"active",m=b.get("filter")||"all";s!==v&&y(s),m!==n&&$(m)},[b,v,n]),u.useEffect(()=>{const s=b.get("event_id"),m=b.get("shift_id");if(s){const N=parseInt(s);isNaN(N)||(T(new Set([N])),m&&console.log(`Auto-expanding event ${N} with shift ${m}`))}},[b]);async function c(){l(!0);try{const s=v==="completed"?"completed":v,m=b.get("date");let N=`/events?tab=${s}`;n!=="all"&&(N+=`&filter=${n}`),m&&(N+=`&date=${m}`),console.log("Loading events with URL:",N,"filterStatus:",n,"date:",m);const R=await V.get(N);R.data.status==="success"&&(console.log("Received events:",R.data.data.length),j(R.data.data))}catch(s){console.error("Failed to load events:",s)}finally{l(!1)}}const x=s=>{y(s),S({tab:s}),$(s==="active"?"needs_workers":"all")},i=s=>{$(s);const m=new URLSearchParams;m.set("tab",v),s!=="all"&&m.set("filter",s),S(m)},g=s=>{const m=new Set(E);m.has(s)?m.delete(s):m.add(s),T(m)};async function D(s){const m=L==null?void 0:L.find(N=>N.id===s);t({isOpen:!0,isLoading:!1,eventId:s,eventTitle:m==null?void 0:m.title})}async function I(){if(f.eventId){t(s=>({...s,isLoading:!0}));try{const s=await V.delete(`/events/${f.eventId}`);s.data.status==="success"?(t({isOpen:!1,isLoading:!1}),_({isVisible:!0,message:`"${s.data.event_title}" moved to trash`,type:"success",action:{label:"Undo",onClick:()=>J(s.data.event_id),variant:"primary"}}),c()):_({isVisible:!0,message:s.data.message||"Unable to delete event",type:"error"})}catch(s){console.error("Failed to delete event:",s),_({isVisible:!0,message:"Unable to delete event",type:"error"})}finally{t(s=>({...s,isLoading:!1}))}}}async function J(s){try{const m=await V.post(`/events/${s}/restore`);m.data.status==="success"?(_({isVisible:!0,message:"Event restored to draft",type:"success"}),c()):_({isVisible:!0,message:m.data.message||"Unable to restore event",type:"error"})}catch(m){console.error("Failed to restore event:",m),_({isVisible:!0,message:"Unable to restore event",type:"error"})}}function X(){t({isOpen:!1,isLoading:!1})}function ee(s){q({isOpen:!0,eventId:s,isLoading:!1})}async function ae(){if(z.eventId){q(s=>({...s,isLoading:!0}));try{const s=await V.post(`/events/${z.eventId}/publish`);s.data.status==="success"?(_({isVisible:!0,message:"Event published successfully",type:"success"}),q({isOpen:!1,isLoading:!1}),c()):(_({isVisible:!0,message:s.data.message||"Unable to publish event",type:"error"}),q({isOpen:!1,isLoading:!1}))}catch(s){console.error("Failed to publish event:",s),_({isVisible:!0,message:"Unable to publish event",type:"error"}),q({isOpen:!1,isLoading:!1})}}}function re(){q({isOpen:!1,isLoading:!1})}function ie(s,m){Q({isOpen:!0,assignmentId:s,isLoading:!1,workerName:m})}async function se(){var s,m;if(H.assignmentId){Q(N=>({...N,isLoading:!0}));try{const N=await V.delete(`/staffing/${H.assignmentId}`);((s=N.data)==null?void 0:s.status)==="success"?(_({isVisible:!0,message:"Worker unassigned successfully",type:"success"}),Q({isOpen:!1,isLoading:!1}),c()):(_({isVisible:!0,message:((m=N.data)==null?void 0:m.message)||"Unable to unassign worker",type:"error"}),Q({isOpen:!1,isLoading:!1}))}catch(N){console.error("Failed to unassign worker:",N),_({isVisible:!0,message:"Unable to unassign worker",type:"error"}),Q({isOpen:!1,isLoading:!1})}}}const le=s=>{M({isOpen:!0,shiftId:s})},te=()=>{M({isOpen:!1})},ne=()=>{te(),_({isVisible:!0,message:"Worker assigned",type:"success"}),c()},B=L.filter(s=>{var m;if(h){const N=h.toLowerCase();if(!(s.title.toLowerCase().includes(N)||((m=s.venue)==null?void 0:m.name.toLowerCase().includes(N))))return!1}if(v==="active")switch(n){case"needs_workers":return s.unfilled_roles_count>0;case"partially_filled":return s.unfilled_roles_count>0&&s.assigned_workers_count>0;case"fully_staffed":return s.unfilled_roles_count===0&&s.assigned_workers_count>0;case"all":default:return!0}return!0}).sort((s,m)=>{var N,R;switch(C){case"name":return s.title.localeCompare(m.title);case"staffing":return s.staffing_percentage-m.staffing_percentage;case"date":default:const G=((N=s.schedule)==null?void 0:N.start_time_utc)||s.created_at,W=((R=m.schedule)==null?void 0:R.start_time_utc)||m.created_at;return new Date(G).getTime()-new Date(W).getTime()}});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Events"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage events and assign workers"})]}),e.jsxs("button",{onClick:()=>p("/events/create"),className:"flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(pe,{size:20}),"Create New Event"]})]}),b.get("date")&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-teal-50 border border-teal-200 rounded-lg",children:[e.jsx(me,{size:16,className:"text-teal-600"}),e.jsxs("span",{className:"text-sm font-medium text-teal-900",children:["Showing events for ",Y(K(b.get("date")),"EEEE, MMMM d, yyyy")]}),e.jsx("button",{onClick:()=>{const s=new URLSearchParams(b);s.delete("date"),S(s)},className:"ml-auto text-teal-600 hover:text-teal-700",title:"Clear date filter",children:e.jsx(oe,{size:16})})]})]}),e.jsxs("div",{className:"flex gap-6 border-b border-gray-200 mb-6",children:[e.jsx("button",{onClick:()=>x("draft"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${v==="draft"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Draft Events"}),e.jsx("button",{onClick:()=>x("active"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${v==="active"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Active Events"}),e.jsx("button",{onClick:()=>x("completed"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${v==="completed"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Completed Events"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 max-w-md relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search events or venues...",value:h,onChange:s=>A(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),e.jsxs("select",{value:C,onChange:s=>F(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"name",children:"Sort by Name"}),v!=="draft"&&e.jsx("option",{value:"staffing",children:"Sort by Staffing"})]}),v==="active"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>i("all"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${n==="all"?"bg-gray-100 text-gray-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"All"}),e.jsx("button",{onClick:()=>i("needs_workers"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${n==="needs_workers"?"bg-red-100 text-red-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Needs Workers"}),e.jsx("button",{onClick:()=>i("fully_staffed"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${n==="fully_staffed"?"bg-green-100 text-green-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Ready"})]})]}),O?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600"})}):e.jsxs(e.Fragment,{children:[v==="draft"&&e.jsx(Ie,{events:B,onDelete:D,onPublish:ee,onNavigate:s=>p(s),searchQuery:h}),v==="active"&&e.jsx(Ve,{events:B,expandedEvents:E,onToggleEvent:g,onAssignWorker:le,onUnassign:ie,onQuickFill:(s,m,N,R)=>w({isOpen:!0,eventId:s,roleName:m,unfilledShiftIds:N,payRate:R}),onPublish:ee,onDelete:D,onEdit:s=>a({isOpen:!0,event:s}),searchQuery:h}),v==="completed"&&e.jsx(Qe,{events:B,expandedEvents:E,onToggleEvent:g,searchQuery:h})]})]}),k.isOpen&&k.shiftId&&e.jsx(Ue,{shiftId:k.shiftId,onClose:te,onSuccess:ne}),e.jsx(_e,{isVisible:P.isVisible,message:P.message,type:P.type,action:P.action,onClose:()=>_({...P,isVisible:!1})}),e.jsx(xe,{isOpen:z.isOpen,onClose:re,onConfirm:ae,title:"Publish Event",message:"Ready to publish? This will create shifts and make them available for worker assignment.",confirmText:z.isLoading?"Publishingâ€¦":"Publish",cancelText:"Cancel",isLoading:z.isLoading,isDestructive:!1}),e.jsx(xe,{isOpen:H.isOpen,onClose:()=>Q({isOpen:!1,isLoading:!1}),onConfirm:se,title:"Unassign Worker",message:`Remove ${H.workerName||"this worker"} from this shift?`,confirmText:H.isLoading?"Removingâ€¦":"Unassign",cancelText:"Cancel",isLoading:H.isLoading,isDestructive:!0}),e.jsx(xe,{isOpen:f.isOpen,onClose:X,onConfirm:I,title:"Delete Event",message:`Delete "${f.eventTitle}"? This action cannot be undone.`,confirmText:f.isLoading?"Deletingâ€¦":"Delete",cancelText:"Cancel",isLoading:f.isLoading,isDestructive:!0}),e.jsx(Oe,{isOpen:o.isOpen,eventId:o.eventId||0,roleName:o.roleName||"",unfilledShiftIds:o.unfilledShiftIds,defaultPayRate:o.payRate,onClose:()=>w({isOpen:!1,unfilledShiftIds:[]}),onDone:({assigned:s,conflicts:m,details:N})=>{w({isOpen:!1,unfilledShiftIds:[]});let R=`Assigned ${s} workers â€¢ ${m} skipped`;m>0&&N&&(R+=`: ${N}`),_({isVisible:!0,message:R,type:m>0?"error":"success"}),c()}}),d.event&&e.jsx(We,{event:d.event,isOpen:d.isOpen,onClose:()=>a({isOpen:!1,event:void 0}),onSuccess:()=>{c(),a({isOpen:!1,event:void 0})}})]})}function Ie({events:p,onDelete:b,onPublish:S,onNavigate:r,searchQuery:U}){const v=n=>{if(!n)return"No date set";const $=K(n);return Y($,"MMM d, yyyy")},y=n=>{if(!n)return"";const $=K(n);return Y($,"h:mm a")};return p.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:U?"No draft events found":"No draft events yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:U?"Try adjusting your search query":"Create your first event to get started"}),!U&&e.jsxs("button",{onClick:()=>r("/events/create"),className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:[e.jsx(pe,{size:20}),"Create Event"]})]}):e.jsx("div",{className:"space-y-4",children:p.map(n=>e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[n.title,n.schedule&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-600",children:["â€¢ ",y(n.schedule.start_time_utc),"â€“",y(n.schedule.end_time_utc)]})]})}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Draft"})]}),n.venue&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[e.jsx(ce,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:n.venue.name})]}),n.schedule&&e.jsx("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{children:v(n.schedule.start_time_utc)})]})}),n.total_workers_needed>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ue,{size:16,className:"text-gray-400"}),e.jsxs("span",{children:[n.total_workers_needed," workers needed"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>r(`/events/${n.id}/edit`),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Edit",children:e.jsx(Se,{size:18})}),e.jsx("button",{onClick:()=>S(n.id),className:"px-4 py-2 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Publish"}),e.jsx("button",{onClick:()=>b(n.id),className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition",title:"Delete",children:e.jsx(he,{size:18})})]})]})})},n.id))})}function Ve({events:p,expandedEvents:b,onToggleEvent:S,onAssignWorker:r,onUnassign:U,onQuickFill:v,onPublish:y,onDelete:n,onEdit:$,searchQuery:h}){const A=l=>{const L=K(l);return Y(L,"EEE, MMM d, yyyy")},C=l=>{const L=K(l);return Y(L,"h:mm a")},F=l=>{if(!l.schedule)return!1;const j=(K(l.schedule.start_time_utc).getTime()-new Date().getTime())/(1e3*60*60);return j>0&&j<=48},O=l=>{switch(l){case"fully_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[e.jsx(ye,{size:14}),"Ready"]});case"partially_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full",children:[e.jsx(ge,{size:14}),"Partial"]});case"needs_workers":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[e.jsx(oe,{size:14}),"Needs Workers"]});default:return null}};return p.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:h?"No active events found":"No active events"}),e.jsx("p",{className:"text-gray-600",children:h?"Try adjusting your search query or filters":"Publish draft events to see them here"})]}):e.jsx("div",{className:"space-y-4",children:p.map(l=>{const L=b.has(l.id);return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{onClick:()=>S(l.id),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[l.title,l.schedule&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-600",children:["â€¢ ",C(l.schedule.start_time_utc),"â€“",C(l.schedule.end_time_utc)]})]})}),O(l.staffing_status)]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[l.venue&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ce,{size:14,className:"text-gray-400"}),l.venue.name]}),l.schedule&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(me,{size:14,className:"text-gray-400"}),e.jsx("span",{children:A(l.schedule.start_time_utc)}),F(l)&&e.jsx("span",{className:"bg-red-600 text-white text-xs font-semibold px-2 py-0.5 rounded-full ml-2","aria-label":"Urgent: starts within 48 hours",children:"Urgent"})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:[l.assigned_workers_count," of ",l.total_workers_needed," roles filled"]}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[l.staffing_percentage,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-full rounded-full transition-all ${l.staffing_percentage===100?"bg-green-500":l.staffing_percentage>0?"bg-yellow-500":"bg-red-500"}`,style:{width:`${l.staffing_percentage}%`}})})]}),l.unfilled_roles_count>0&&e.jsxs("p",{className:"text-sm text-red-600 font-medium",children:[l.unfilled_roles_count," role",l.unfilled_roles_count!==1?"s":""," still need workers"]}),l.shifts_by_role&&l.shifts_by_role.length>0&&e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Est. Cost: "}),e.jsxs("span",{className:"font-semibold text-green-600",children:["$",(()=>{let j=0;return l.shifts_by_role.forEach(E=>{E.shifts.forEach(T=>{const k=(new Date(T.end_time_utc).getTime()-new Date(T.start_time_utc).getTime())/36e5;T.assignments.forEach(M=>{const P=Number(M.hourly_rate||T.pay_rate||0);j+=P*k})})}),j.toFixed(0)})()]})]})]}),e.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[(!l.shifts_by_role||l.shifts_by_role.length===0)&&n&&e.jsx("button",{onClick:j=>{j.stopPropagation(),n(l.id)},className:"px-3 py-1.5 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition-colors",children:"Delete Event"}),$&&l.status==="published"&&e.jsx("button",{onClick:j=>{j.stopPropagation(),$(l)},title:"Edit Event",className:"p-1.5 text-teal-600 hover:text-teal-700 hover:bg-teal-50 rounded transition-colors",children:e.jsx(Re,{size:14})}),n&&e.jsx("button",{onClick:j=>{j.stopPropagation(),n(l.id)},title:"Delete",className:"p-1.5 text-red-600 hover:text-red-700 hover:bg-red-50 rounded transition-colors",children:e.jsx(he,{size:14})}),e.jsx("div",{className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:L?e.jsx(ve,{size:24,className:"text-gray-600 hover:text-gray-800"}):e.jsx(Ce,{size:24,className:"text-gray-600 hover:text-gray-800"})})]})]}),L&&e.jsx("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:l.shifts_by_role&&l.shifts_by_role.length>0?e.jsx("div",{className:"space-y-4",children:l.shifts_by_role.map(j=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:j.role_name}),e.jsxs("span",{className:"text-sm text-gray-600",children:[j.filled_shifts,"/",j.total_shifts," assigned"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[j.filled_shifts<j.total_shifts&&e.jsxs("span",{className:"px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[j.total_shifts-j.filled_shifts," needed"]}),j.filled_shifts<j.total_shifts&&e.jsx("button",{onClick:E=>{var M;E.stopPropagation();const T=j.shifts.filter(P=>P.staffing_progress.percentage<100).sort((P,_)=>new Date(P.start_time_utc).getTime()-new Date(_.start_time_utc).getTime()).map(P=>P.id),k=(M=j.shifts[0])==null?void 0:M.pay_rate;v(l.id,j.role_name,T,k)},className:"px-2.5 py-1 text-xs font-semibold bg-teal-600 text-white rounded hover:bg-teal-700",title:"Quick Fill by Skill",children:"Quick Fill by Skill"})]})]}),e.jsx("div",{className:"space-y-2",children:j.shifts.map((E,T)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 text-gray-700 rounded-md flex items-center justify-center text-xs font-medium",children:T+1}),e.jsxs("span",{className:"text-sm text-gray-700",children:[C(E.start_time_utc)," - ",C(E.end_time_utc)]}),E.assignments.length>0&&e.jsx("div",{className:"flex items-center gap-1 flex-wrap",children:E.assignments.map(k=>{const M=`${k.worker.first_name} ${k.worker.last_name}`,P=Number(k.hourly_rate||E.pay_rate||0);return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"bg-white text-black border border-gray-200 rounded-full px-2.5 py-1 text-sm font-medium shadow-sm max-w-[140px] truncate",title:`${M} â€¢ $${P.toFixed(0)}/hr`,children:M}),e.jsx("button",{onClick:_=>{_.stopPropagation(),U(k.id,M)},className:"w-5 h-5 flex items-center justify-center text-red-600 hover:text-red-700 hover:bg-red-50 rounded",title:"Unassign worker",children:e.jsx(oe,{size:12})})]},k.id)})})]}),E.staffing_progress.percentage===100?e.jsxs("span",{className:"flex items-center gap-1.5 text-sm font-medium text-green-600",children:[e.jsx(ye,{size:16}),"Assigned"]}):e.jsx("button",{onClick:k=>{k.stopPropagation(),r(E.id)},className:"px-3 py-1.5 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Assign Worker"})]},E.id))})]},j.role_name))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:l.status==="draft"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"This event is still in draft status"}),e.jsx("p",{className:"text-sm",children:"Publish the event to generate shifts and assign workers"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"No shifts available"}),e.jsx("p",{className:"text-sm",children:"This event may not have any shifts generated yet"})]})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[l.status==="draft"&&e.jsx("button",{onClick:()=>y(l.id),className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors",children:"Publish Event"}),n&&e.jsx("button",{onClick:()=>n(l.id),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Delete Event"})]})]})})]},l.id)})})}function Qe({events:p,expandedEvents:b,onToggleEvent:S,searchQuery:r}){const U=y=>{const n=K(y);return Y(n,"MMM d, yyyy")},v=y=>{const n=K(y);return Y(n,"h:mm a")};return p.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“‹"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:r?"No past events found":"No past events yet"}),e.jsx("p",{className:"text-gray-600",children:r?"Try adjusting your search query":"Completed events will appear here"})]}):e.jsx("div",{className:"space-y-4",children:p.map(y=>{var h;const n=b.has(y.id);let $=0;return(h=y.shifts_by_role)==null||h.forEach(A=>{A.shifts.forEach(C=>{const F=(new Date(C.end_time_utc).getTime()-new Date(C.start_time_utc).getTime())/36e5;C.assignments.forEach(O=>{const l=O.hours_worked?parseFloat(O.hours_worked.toString()):void 0,L=typeof l=="number"&&!isNaN(l)?l:F;$+=L})})}),$=Number($)||0,e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{onClick:()=>S(y.id),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:y.title}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Completed"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[y.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(me,{size:14,className:"text-gray-400"}),U(y.schedule.start_time_utc)]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(we,{size:14,className:"text-gray-400"}),v(y.schedule.start_time_utc)," - ",v(y.schedule.end_time_utc)]})]}),y.venue&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ce,{size:14,className:"text-gray-400"}),y.venue.name]})]})]}),e.jsx("div",{className:"ml-4 flex items-center",children:e.jsx("div",{className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:n?e.jsx(ve,{size:24,className:"text-gray-600 hover:text-gray-800"}):e.jsx(Ce,{size:24,className:"text-gray-600 hover:text-gray-800"})})})]}),n&&y.shifts_by_role&&e.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:[e.jsx("div",{className:"mb-4 p-4 bg-white rounded-lg border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Workers"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:y.assigned_workers_count})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Hours"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:$.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Event Cost"}),e.jsxs("p",{className:"text-2xl font-semibold text-green-600",children:["$",(()=>{let A=0;return y.shifts_by_role.forEach(C=>{C.shifts.forEach(F=>{const O=(new Date(F.end_time_utc).getTime()-new Date(F.start_time_utc).getTime())/36e5;F.assignments.forEach(l=>{const L=Number(l.hourly_rate||F.pay_rate||0);A+=L*O})})}),A.toFixed(0)})()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Staffing"}),e.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[y.staffing_percentage,"%"]})]})]})}),e.jsx("div",{className:"space-y-3",children:y.shifts_by_role.map(A=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:A.role_name}),e.jsx("div",{className:"space-y-2",children:A.shifts.flatMap(C=>C.assignments.map(F=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 text-teal-700 flex items-center justify-center text-sm font-medium",children:[F.worker.first_name[0],F.worker.last_name[0]]}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[F.worker.first_name," ",F.worker.last_name]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[F.hours_worked&&e.jsxs("span",{className:"font-medium",children:[parseFloat(F.hours_worked.toString()).toFixed(2)," hrs"]}),e.jsxs("span",{className:"font-medium text-green-600",children:["$",Number(F.hourly_rate||C.pay_rate||0).toFixed(0),"/hr"]}),F.hours_worked&&e.jsxs("span",{className:"font-semibold text-blue-600",children:["$",(parseFloat(F.hours_worked.toString())*Number(F.hourly_rate||C.pay_rate||0)).toFixed(0)]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[v(C.start_time_utc)," - ",v(C.end_time_utc)]})]})]},F.id)))})]},A.role_name))})]})]},y.id)})})}export{ds as EventsPage};
