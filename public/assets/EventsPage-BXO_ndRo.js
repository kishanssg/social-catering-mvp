import{c as we,j as e,X as he,a as B,A as ge,b as He,C as Re}from"./index-Be0uSSOX.js";import{r as m,b as ze,f as qe}from"./vendor-79DyBOV9.js";import{f as Qe,a as Te}from"./dateUtils-CHmZs4Ub.js";import{C as Fe}from"./clock-DZaI8Opw.js";import{M as ke}from"./map-pin-CmX5aCmX.js";import{U as ve}from"./users-YIOsBJL1.js";import{S as Ae,T as Le,C as Ce}from"./ConfirmationModal-JsKCLAHP.js";import{D as Oe}from"./dollar-sign-BKAjr5go.js";import{T as De}from"./Toast-Byq0GjkY.js";import{C as Be}from"./x-circle-5MjSy5ZK.js";import{b as Je,a as Ze,c as Xe,e as Ke,p as Ye}from"./Prep Cook-CE8OFMb5.js";import{P as Ue}from"./pen-square-CsqI6gKA.js";import{P as Me}from"./plus-JOcKRjTT.js";import{f as de}from"./index-C_slYh2M.js";import{p as ne}from"./index-BK_MyBzW.js";import{U as Ge}from"./user-YoU5LFdf.js";import{C as Se}from"./calendar-Hxf5o7Q2.js";import{C as Ie}from"./chevron-down-D-luC4lz.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=we("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=we("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=we("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=we("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);function xe(r,p=0){const b=typeof r=="string"?Number(r):r;return Number.isFinite(b)?b:p}function P(r,p=2,b="0"){const o=xe(r,NaN);if(!Number.isFinite(o))return b;try{return o.toFixed(p)}catch{return b}}const ts={sm:"max-w-md",md:"max-w-2xl",lg:"max-w-4xl",xl:"max-w-6xl"},Ee=({isOpen:r,onClose:p,title:b,subtitle:o,children:R,footer:$,size:V="md",closeOnOverlayClick:t=!0})=>{if(m.useEffect(()=>(r?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[r]),m.useEffect(()=>{const v=J=>{J.key==="Escape"&&r&&p()};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[r,p]),!r)return null;const _=v=>{v.target===v.currentTarget&&t&&p()};return e.jsx("div",{className:"modal-overlay",onClick:_,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:e.jsxs("div",{className:`modal-container ${ts[V]}`,children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{id:"modal-title",className:"text-xl font-semibold text-gray-900 font-manrope",children:b}),o&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:o})]}),e.jsx("button",{onClick:p,className:"p-1.5 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors","aria-label":"Close modal",children:e.jsx(he,{size:20,className:"text-gray-600"})})]}),e.jsx("div",{className:"modal-body",children:R}),$&&e.jsx("div",{className:"modal-footer",children:$})]})})};function as({shiftId:r,onClose:p,onSuccess:b}){var Q,x;const[o,R]=m.useState(null),[$,V]=m.useState([]),[t,_]=m.useState([]),[v,J]=m.useState(""),[T,z]=m.useState(null),[w,i]=m.useState({}),[D,A]=m.useState(!0),[g,y]=m.useState(!1),[u,k]=m.useState(null),W=(n,c)=>{i(S=>({...S,[n]:c}))};m.useEffect(()=>{q()},[r]),m.useEffect(()=>{o&&U()},[o]),m.useEffect(()=>{if(!v)_($);else{const n=v.toLowerCase();_($.filter(c=>{var S;return c.first_name.toLowerCase().includes(n)||c.last_name.toLowerCase().includes(n)||c.email.toLowerCase().includes(n)||((S=c.skills_json)==null?void 0:S.some(L=>L.toLowerCase().includes(n)))}))}},[v,$]);async function q(){try{const n=await B.get(`/shifts/${r}`);n.data.status==="success"?R(n.data.data):k("Failed to load shift details")}catch(n){console.error("Failed to load shift details:",n),k("Failed to load shift details")}}async function U(){var n;try{const c=new Set;if(o!=null&&o.event_id)try{const E=((n=(await B.get(`/events/${o.event_id}`)).data)==null?void 0:n.data)||{};if(E.shifts_by_role){const M=E.shifts_by_role.find(C=>C.skill_name===o.role_needed||C.role_name===o.role_needed);M!=null&&M.shifts&&M.shifts.forEach(C=>{C.assignments&&C.assignments.forEach(N=>{var f;const s=N.worker_id||((f=N.worker)==null?void 0:f.id),l=N.status;s&&l!=="cancelled"&&l!=="no_show"&&c.add(s)})})}}catch(L){console.log("Could not fetch event to filter assigned workers:",L)}console.log(`AssignmentModal: Found ${c.size} already assigned workers for "${o==null?void 0:o.role_needed}"`);const S=await B.get("/workers?active=true");if(S.data.status==="success"){const L=S.data.data.workers||S.data.data;if(o!=null&&o.role_needed){const E=L.filter(M=>{var C;return((C=M.skills_json)==null?void 0:C.includes(o.role_needed))&&!c.has(M.id)});console.log(`AssignmentModal: Showing ${E.length} eligible workers`),V(E)}else{const E=L.filter(M=>!c.has(M.id));V(E)}}else k("Failed to load workers")}catch(c){console.error("Failed to load workers:",c),k("Failed to load workers")}finally{A(!1)}}async function ee(){var n,c,S,L,E,M;if(!(!T||!o)){y(!0),k(null);try{const N=(await B.post("/staffing",{assignment:{shift_id:o.id,worker_id:T.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:w[T.id]||Number(o.pay_rate)||0}})).data;if(N.status==="success")b();else{let s=N.message||"Failed to assign worker";N.details&&N.details.length>0?s+=`

Details:
â€¢ `+N.details.join(`
â€¢ `):N.errors&&(s+=`

Details:
â€¢ `+N.errors.join(`
â€¢ `)),k(s)}}catch(C){console.error("Failed to assign worker:",C);let N="Failed to assign worker";if((c=(n=C.response)==null?void 0:n.data)!=null&&c.details&&C.response.data.details.length>0){const s=C.response.data.details.map(l=>(l.includes("conflicting shift"),l));N+=`

`+s.join(`
`)}else(L=(S=C.response)==null?void 0:S.data)!=null&&L.errors?N+=`

`+C.response.data.errors.join(`
`):(M=(E=C.response)==null?void 0:E.data)!=null&&M.message?N=C.response.data.message:C.message&&(N=C.message);k(N)}finally{y(!1)}}}if(D)return e.jsx(Ee,{isOpen:!0,onClose:p,title:"Assign Worker",size:"lg",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-600"})})});const I=e.jsxs(e.Fragment,{children:[u&&e.jsxs("div",{className:"mb-4 p-3 bg-gradient-to-r from-red-50 to-amber-50 border-l-4 border-red-500 rounded-r-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsx("h4",{className:"text-sm font-semibold text-red-900",children:"âš ï¸ Scheduling Conflict Detected"})]}),e.jsx("p",{className:"text-xs text-gray-600 ml-8",children:"Please resolve the conflict before attempting to assign this worker"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:p,disabled:g,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:ee,disabled:!T||g||!!u,className:`btn-primary ${u?"opacity-50 cursor-not-allowed":""}`,title:u?"Cannot assign due to scheduling conflict":"",children:g?"Assigning Worker...":"Assign Worker"})]})]});return e.jsx(Ee,{isOpen:!0,onClose:p,title:o?`${o.client_name} â€¢ ${o.role_needed}`:"Assign Worker",size:"xl",footer:I,children:e.jsxs("div",{className:"flex h-[600px]",children:[e.jsx("div",{className:"w-1/3 border-r border-gray-200 p-6 bg-gray-50",children:o?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Shift Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Fe,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:Qe(o.start_time_utc)}),e.jsxs("div",{className:"text-sm text-gray-600",children:[Te(o.start_time_utc)," - ",Te(o.end_time_utc)]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ke,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"text-sm text-gray-900",children:o.location||((x=(Q=o.event)==null?void 0:Q.venue)==null?void 0:x.formatted_address)||"Location not specified"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ve,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900",children:o.role_needed}),o.required_skill&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Requires: ",o.required_skill]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Pay Rate:"})," $",(Number(o.pay_rate)||0).toFixed(2),"/hour"]}),o.uniform_name&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",o.uniform_name]})]}),o.notes&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Notes:"}),e.jsx("div",{className:"mt-1 whitespace-pre-line",children:o.notes.split("Uniform:").map((n,c)=>c===0?n.trim():e.jsxs("div",{children:[e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",n.trim()]},c))})]})})]})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ge,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Failed to load shift details"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search workers...",value:v,onChange:n=>J(n.target.value),className:"w-full pl-9 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-teal-500 focus:border-teal-500"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:u?e.jsx("div",{className:"p-6 flex items-center justify-center h-full",children:e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 rounded-lg p-5 shadow-sm w-full max-w-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(ge,{size:20,className:"text-red-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg font-semibold text-red-900 mb-1",children:"âš ï¸ Scheduling Conflict"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"This worker cannot be assigned due to a scheduling conflict"}),e.jsx("div",{className:"bg-white border border-red-200 rounded p-3 mt-3",children:e.jsx("div",{className:"text-sm text-red-800 font-mono",children:u.split(`
`).map((n,c)=>n.trim()===""?null:n.startsWith("â€¢")?e.jsxs("div",{className:"mt-1 flex items-start gap-2",children:[e.jsx("span",{className:"text-red-500",children:"â—"}),e.jsx("span",{className:"flex-1",children:n.replace("â€¢","").trim()})]},c):n.startsWith("Details:")?null:n.includes("conflicting shift")?e.jsx("div",{className:"mt-1 text-red-700 font-medium",children:n},c):e.jsx("div",{className:"text-gray-700",children:n},c))})})]})]})})}):t.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ve,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:v?"No workers found matching your search":o!=null&&o.role_needed?`No workers found with "${o.role_needed}" skill`:"No available workers"}),(o==null?void 0:o.role_needed)&&!v&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:['Try adding "',o.role_needed,'" skill to workers or select a different shift.']})]}):e.jsx("ul",{children:t.map(n=>{const c=(T==null?void 0:T.id)===n.id,S=w[n.id]||Number(o.pay_rate)||0,L=w[n.id]&&w[n.id]!==(Number(o.pay_rate)||0);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${c?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[n.first_name[0],n.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[n.first_name," ",n.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(n.skills_json||[]).map((E,M)=>{const C=E===(o==null?void 0:o.role_needed);return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${C?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:E},M)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[L&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Oe,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:(Number(o.pay_rate)||0).toString(),value:S||"",onChange:E=>{const M=E.target.value;(M===""||/^\d*\.?\d*$/.test(M))&&W(n.id,parseFloat(M)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:E=>E.stopPropagation(),onFocus:E=>E.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>z(n),className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${c?"bg-teal-600 text-white border-teal-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:c?"Selected":"Select"})]})]},n.id)})})})]})]})})}function rs({isOpen:r,eventId:p,roleName:b,unfilledShiftIds:o,defaultPayRate:R,onClose:$,onDone:V}){const[t,_]=m.useState([]),[v,J]=m.useState([]),[T,z]=m.useState(""),[w,i]=m.useState(!1),[D,A]=m.useState(!1),[g,y]=m.useState({}),[u,k]=m.useState(0),W=(x,n)=>{y(c=>({...c,[x]:n}))};m.useEffect(()=>{r&&(_([]),J([]),z(""),y({}),i(!0),(async()=>{var x,n;try{const S=((x=(await B.get(`/events/${p}`)).data)==null?void 0:x.data)||{};console.log("QuickFill: Full event data:",JSON.stringify(S,null,2)),console.log("QuickFill: Looking for role:",b),console.log("QuickFill: shifts_by_role:",S.shifts_by_role);const L=new Set;if(S.shifts_by_role){const N=S.shifts_by_role.find(s=>(console.log("QuickFill: Checking role:",s.skill_name,s.role_name,"vs",b),s.skill_name===b||s.role_name===b));N?(console.log("QuickFill: Found role shifts:",N),N.shifts&&N.shifts.forEach(s=>{s.assignments&&(console.log("QuickFill: Shift has assignments:",s.assignments),s.assignments.forEach(l=>{var F;const f=l.worker_id||((F=l.worker)==null?void 0:F.id),h=l.status;f&&h!=="cancelled"&&(L.add(f),console.log("QuickFill: Adding worker_id to exclude:",f,"status:",h))}))})):console.log("QuickFill: No role shifts found for:",b)}console.log(`QuickFill: Found ${L.size} already assigned worker IDs:`,Array.from(L));const E=await B.get("/workers?active=true"),C=(((n=E.data)==null?void 0:n.data)||E.data||[]).filter(N=>{const s=(N.skills_json||[]).includes(b),l=L.has(N.id);return l&&console.log(`QuickFill: Excluding ${N.first_name} ${N.last_name} (ID: ${N.id}) - already assigned`),s&&!l});if(console.log(`QuickFill: Found ${C.length} eligible workers for "${b}"`),console.log("QuickFill: Eligible workers:",C.map(N=>`${N.first_name} ${N.last_name}`)),_(C),R){const N=Number(R)||0;k(N),console.log(`QuickFill: Default pay rate for ${b}: $${N}/hr`)}else console.log(`QuickFill: No default pay rate provided for ${b}`)}catch(c){console.error("Error loading workers:",c)}finally{i(!1)}})())},[r,p,b,R]);const q=m.useMemo(()=>{const x=T.trim().toLowerCase(),n=t;return x?n.filter(c=>`${c.first_name} ${c.last_name}`.toLowerCase().includes(x)||(c.email||"").toLowerCase().includes(x)):n},[t,T]),U=o.length,ee=x=>{J(n=>n.includes(x)?n.filter(c=>c!==x):n.length>=U?n:[...n,x])},I=async()=>{var S,L,E,M,C,N,s,l,f,h,F,O,X,oe,fe;if(v.length===0||U===0)return;A(!0);let x=0,n=0;const c=[];try{const ce=v.map(le=>t.find(ye=>ye.id===le)).filter(Boolean),je=[...o];let Ne=0;for(;je.length>0&&ce.length>0;){const le=ce[Ne%ce.length],ye=je.shift();try{const ae=g[le.id]||Number(u)||0||0,me=await B.post("/staffing",{assignment:{shift_id:ye,worker_id:le.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:ae}});if(((S=me.data)==null?void 0:S.status)==="success")x+=1;else{n+=1;const G=`${le.first_name} ${le.last_name}`,a=((L=me.data)==null?void 0:L.message)||((M=(E=me.data)==null?void 0:E.error)==null?void 0:M.message)||((N=(C=me.data)==null?void 0:C.errors)==null?void 0:N.join(", "))||"Unknown error";let d="Unable to assign";const j=String(a).toLowerCase();j.includes("overlapping")||j.includes("conflict")?d="Has overlapping shift":j.includes("capacity")||j.includes("full")?d="Shift is full":j.includes("skill")||j.includes("certification")||j.includes("requirement")?d="Missing required skill":j.includes("status")?d="Cannot be assigned":d="Unable to assign",c.push(`${G}: ${d}`)}}catch(ae){n+=1;const me=`${le.first_name} ${le.last_name}`;let G="Unable to assign";const a=((l=(s=ae.response)==null?void 0:s.data)==null?void 0:l.message)||((F=(h=(f=ae.response)==null?void 0:f.data)==null?void 0:h.error)==null?void 0:F.message)||((oe=(X=(O=ae.response)==null?void 0:O.data)==null?void 0:X.errors)==null?void 0:oe.join(", "))||null;if(a){const d=String(a).toLowerCase();d.includes("overlapping")||d.includes("conflict")?G="Has overlapping shift":d.includes("capacity")||d.includes("full")?G="Shift is full":d.includes("skill")||d.includes("certification")||d.includes("requirement")?G="Missing required skill":d.includes("status")?G="Cannot be assigned":G="Unable to assign"}else((fe=ae.response)==null?void 0:fe.status)===422?G="Unable to assign":ae.message&&!ae.message.includes("status code")&&(G=ae.message);c.push(`${me}: ${G}`)}Ne+=1}let _e="";n>0&&c.length>0&&(_e=c.join(", ")),V({assigned:x,conflicts:n,details:_e})}finally{A(!1)}};if(!r)return null;const Q=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:$,disabled:D,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:I,disabled:D||v.length===0||U===0,className:"btn-primary",children:D?"Filling Shifts...":v.length===1?`Assign worker to ${U} shift${U!==1?"s":""}`:`Assign ${v.length} workers to ${U} shifts`})]});return e.jsxs(Ee,{isOpen:r,onClose:$,title:`Quick Fill â€” ${b}`,subtitle:`Unfilled shifts: ${U}`,size:"lg",footer:Q,children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{value:T,onChange:x=>z(x.target.value),placeholder:"Search eligible workersâ€¦",className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsx("div",{className:"max-h-[340px] overflow-y-auto border border-gray-200 rounded-lg",children:w?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loadingâ€¦"}):q.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"No eligible workers"}):e.jsx("ul",{children:q.map(x=>{const n=v.includes(x.id);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${n?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[x.first_name[0],x.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[x.first_name," ",x.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(x.skills_json||[]).map((c,S)=>{const L=c===b;return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${L?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:c},S)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[g[x.id]&&g[x.id]!==(Number(u)||0)&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Oe,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:Number(u)?(Number(u)||0).toString():"Rate",value:g[x.id]||Number(u)||0||"",onChange:c=>{const S=c.target.value;(S===""||/^\d*\.?\d*$/.test(S))&&W(x.id,parseFloat(S)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:c=>c.stopPropagation(),onFocus:c=>c.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>ee(x.id),disabled:!n&&v.length>=U,className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${n?"bg-teal-600 text-white border-teal-600":v.length>=U?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:n?"Selected":"Select"})]})]},x.id)})})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(Be,{size:16,className:"text-teal-600"}),e.jsxs("span",{children:["Will assign ",e.jsx("strong",{children:v.length})," worker",v.length!==1?"s":""," to ",e.jsx("strong",{children:U})," shift",U!==1?"s":"","."]})]}),(Number(u)||0)>0&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Default rate for ",b,":"]}),e.jsxs("span",{className:"font-medium",children:["$",(Number(u)||0).toFixed(2),"/hr"]})]}),Object.keys(g).length>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["ðŸ’¡ Empty fields will use default rate ($",(Number(u)||0).toFixed(2),"/hr)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(He,{size:14,className:"text-yellow-600"}),"Conflicts and already-filled shifts will be skipped automatically."]})]})}function ls({event:r,isOpen:p,onClose:b,onSuccess:o}){var C,N;const R=ze(),[$,V]=m.useState(!1),[t,_]=m.useState([]),[v,J]=m.useState(!1),[T,z]=m.useState(!1),[w,i]=m.useState(null),[D,A]=m.useState(null),[g,y]=m.useState({isVisible:!1,message:"",type:"error"}),[u,k]=m.useState(null),[W,q]=m.useState(!1);m.useEffect(()=>{p&&r.id&&U()},[p,r.id]);const U=async()=>{z(!0);try{const s=await B.get(`/events/${r.id}`);s.data.status==="success"&&i(s.data.data)}catch(s){console.error("Failed to load full event details:",s),i(r)}finally{z(!1)}},ee=()=>{b(),R(`/events/${r.id}/edit`)},I=[{name:"Bartender",icon:Je},{name:"Banquet Server/Runner",icon:Ze},{name:"Captain",icon:Xe},{name:"Event Helper",icon:Ke},{name:"Prep Cook",icon:Ye}],Q=w||r,x=w||r;m.useEffect(()=>{if(Q){if(Q.skill_requirements&&Array.isArray(Q.skill_requirements)){const s=Q.skill_requirements.map(l=>{var F,O;const f=(F=Q.shifts_by_role)==null?void 0:F.find(X=>(X.skill_name||X.role_name)===l.skill_name),h=((O=f==null?void 0:f.shifts)==null?void 0:O.length)||(f==null?void 0:f.total_shifts)||l.needed_workers||1;return{skill_name:l.skill_name,needed_workers:h,pay_rate:l.pay_rate||15,description:l.description||"",uniform_id:void 0,cert_id:void 0}});_(s)}else if(Q.shifts_by_role&&Array.isArray(Q.shifts_by_role)){const s=Q.shifts_by_role.map(l=>{const f=l.shifts?l.shifts.length:l.total_shifts||1;return{skill_name:l.skill_name||l.role_name||"",needed_workers:f,pay_rate:l.pay_rate||15,description:"",uniform_id:void 0,cert_id:void 0}});_(s)}}},[Q]),m.useEffect(()=>{const s=w||r;s!=null&&s.schedule&&k({start_time_utc:s.schedule.start_time_utc,end_time_utc:s.schedule.end_time_utc,break_minutes:s.schedule.break_minutes||0})},[w,r]);const n=(s,l,f)=>{if(s<0||s>=t.length)return;const h=[...t];h[s]={...h[s],[l]:f},_(h)},c=()=>{_([...t,{skill_name:"",needed_workers:1,pay_rate:15,description:"",uniform_id:void 0,cert_id:void 0}])},S=s=>{var f;if(s<0||s>=t.length)return;const l=t[s];if((l==null?void 0:l.needed_workers)>0){const h=(f=x==null?void 0:x.shifts_by_role)==null?void 0:f[s];if(((h==null?void 0:h.assigned_workers)||(h==null?void 0:h.filled_shifts)||0)>0){y({isVisible:!0,message:"Cannot remove role with assigned workers. Please unassign workers first.",type:"error"});return}}_(t.filter((h,F)=>F!==s))},L=(s,l)=>{if(s<0||s>=t.length)return;I.find(h=>h.name===l);const f=[...t];f[s]={...f[s],skill_name:l},_(f),A(null)},E=async()=>{var l,f,h;const s=w||r;if(s.schedule&&new Date(s.schedule.start_time_utc)<=new Date){y({isVisible:!0,message:"Cannot edit event that has already started",type:"error"});return}J(!0);try{const F=w||r,O=await B.patch(`/events/${F.id}`,{event:{roles:t.map(X=>({skill_name:X.skill_name,needed:X.needed_workers,pay_rate:X.pay_rate,description:X.description,uniform_id:X.uniform_id,cert_id:X.cert_id})),schedule:u?{start_time_utc:u.start_time_utc,end_time_utc:u.end_time_utc,break_minutes:u.break_minutes}:F.schedule?{start_time_utc:F.schedule.start_time_utc,end_time_utc:F.schedule.end_time_utc,break_minutes:F.schedule.break_minutes||0}:void 0}});O.data.status==="success"?(y({isVisible:!0,message:O.data.message||"Event updated successfully",type:"success"}),o(),b()):y({isVisible:!0,message:O.data.message||"Failed to update event",type:"error"})}catch(F){console.error("Failed to update event:",F);const O=(l=F==null?void 0:F.response)==null?void 0:l.data;if((O==null?void 0:O.status)==="validation_error"&&((h=(f=O==null?void 0:O.data)==null?void 0:f.conflicts)!=null&&h.length)){const X=O.data.conflicts.map(oe=>{const fe=new Date(oe.conflicting_shift_start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),ce=new Date(oe.conflicting_shift_end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});return`${oe.worker_name} conflicts with ${oe.conflicting_event_title} (${fe} â€“ ${ce})`});y({isVisible:!0,message:`Can't save changes: ${X.length} worker${X.length!==1?"s":""} would be double-booked
â€¢ `+X.join(`
â€¢ `),type:"error"})}else y({isVisible:!0,message:(O==null?void 0:O.message)||"Failed to update event",type:"error"})}finally{J(!1)}},M=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,disabled:v,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:E,disabled:v,className:"btn-primary",children:v?"Saving...":"Save Changes"})]});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-0 sm:p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white w-full h-full sm:h-auto sm:max-w-4xl sm:rounded-lg shadow-xl overflow-hidden flex flex-col sm:max-h-[90vh]",children:[e.jsxs("div",{className:"sticky top-0 bg-white px-4 sm:px-6 py-4 border-b border-gray-200 flex items-center justify-between z-10",children:[e.jsxs("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-gray-900 truncate",children:["Edit Event: ",x.title]}),e.jsx("button",{onClick:b,className:"p-2 text-gray-400 hover:text-gray-600 min-h-touch min-w-touch","aria-label":"Close",children:e.jsx(he,{className:"h-5 w-5 sm:h-6 sm:w-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 sm:px-6 py-4 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Event Details"}),e.jsxs("button",{onClick:ee,className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-white border border-gray-300 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all shadow-sm",children:[e.jsx(Ue,{size:14}),"Edit"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Venue"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:(C=x.venue)==null?void 0:C.name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:x.schedule&&new Date(x.schedule.start_time_utc).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"space-y-1 md:col-span-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Location"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900 leading-relaxed",children:(N=x.venue)==null?void 0:N.formatted_address})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Time"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:x.schedule&&e.jsxs(e.Fragment,{children:[new Date(x.schedule.start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})," - ",new Date(x.schedule.end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})]})})]}),e.jsx("div",{})]})]}),e.jsxs("div",{className:"col-span-2 bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 uppercase tracking-wide",children:"Event Schedule"}),e.jsx("button",{type:"button",onClick:()=>q(!W),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:W?"Cancel":"Edit Schedule"})]}),W?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Start Time"}),e.jsx("input",{type:"datetime-local",value:u!=null&&u.start_time_utc?new Date(u.start_time_utc).toISOString().slice(0,16):"",onChange:s=>k(l=>l?{...l,start_time_utc:new Date(s.target.value).toISOString()}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"End Time"}),e.jsx("input",{type:"datetime-local",value:u!=null&&u.end_time_utc?new Date(u.end_time_utc).toISOString().slice(0,16):"",onChange:s=>k(l=>l?{...l,end_time_utc:new Date(s.target.value).toISOString()}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Break Minutes"}),e.jsx("input",{type:"number",min:"0",value:(u==null?void 0:u.break_minutes)||0,onChange:s=>k(l=>l?{...l,break_minutes:parseInt(s.target.value)||0}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3",children:e.jsx("p",{className:"text-xs text-blue-800",children:"âš ï¸ Changing schedule times will update ALL shifts and worker schedules for this event."})})]}):e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:x.schedule&&new Date(x.schedule.start_time_utc).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Time"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:u&&e.jsxs(e.Fragment,{children:[new Date(u.start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})," -",new Date(u.end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})]})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Break"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[(u==null?void 0:u.break_minutes)||0," minutes"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"Roles"}),e.jsxs("button",{onClick:c,className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white text-sm font-semibold rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(Me,{size:16}),"Add Role"]})]}),t.map((s,l)=>{var f;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[e.jsxs("div",{className:"flex-1 relative overflow-visible",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Role Name *"}),e.jsxs("div",{className:"relative",style:{zIndex:D===l?1e3:1},children:[e.jsxs("button",{type:"button",onClick:()=>A(D===l?null:l),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white text-left flex items-center justify-between",children:[s.skill_name?e.jsxs("div",{className:"flex items-center gap-2",children:[((f=I.find(h=>h.name===s.skill_name))==null?void 0:f.icon)&&e.jsx("img",{src:I.find(h=>h.name===s.skill_name).icon,alt:s.skill_name,className:"w-5 h-5"}),e.jsx("span",{className:"text-gray-900",children:s.skill_name})]}):e.jsx("span",{className:"text-gray-400",children:"Pick the Skills the Worker Has"}),e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M19 9l-7 7-7-7"})})]}),D===l&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border-2 border-gray-200 rounded-xl shadow-2xl z-[9999] max-h-[300px] overflow-y-auto w-full min-w-max",children:I.filter(h=>!t.some((F,O)=>O!==l&&F.skill_name===h.name)).map(h=>e.jsxs("div",{onClick:()=>L(l,h.name),className:"flex items-center gap-3 px-4 py-3 cursor-pointer hover:bg-teal-50 border-b border-gray-100 last:border-0",children:[e.jsx("img",{src:h.icon,width:"24",height:"24",alt:h.name,className:"flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:h.name})]},h.name))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Needed Workers *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(l,"needed_workers",Math.max(1,s.needed_workers-1)),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"-"}),e.jsx("input",{type:"number",value:s.needed_workers,onChange:h=>n(l,"needed_workers",parseInt(h.target.value)||1),min:"1",className:"w-16 px-2 py-2 border border-gray-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-teal-500 font-medium"}),e.jsx("button",{onClick:()=>n(l,"needed_workers",s.needed_workers+1),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"+"}),e.jsx("button",{onClick:()=>S(l),className:"ml-2 w-8 h-8 flex items-center justify-center text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove role",children:e.jsx(Le,{size:18})})]})]})]}),(()=>{var O;const h=(O=x==null?void 0:x.shifts_by_role)==null?void 0:O[l],F=(h==null?void 0:h.assigned_workers)||(h==null?void 0:h.filled_shifts)||0;return F>0?e.jsxs("div",{className:"text-sm text-amber-600 font-semibold bg-amber-50 px-3 py-2 rounded-lg",children:[F," worker(s) assigned"]}):null})()]},l)})]})]}),e.jsx("div",{className:"sticky bottom-0 bg-white px-4 sm:px-6 py-4 border-t border-gray-200 flex flex-col sm:flex-row gap-3 sm:justify-end z-10",children:M})]})}),e.jsx(De,{isVisible:g.isVisible,message:g.message,type:g.type,onClose:()=>y({...g,isVisible:!1})})]})}function is({assignment:r,isEditing:p,editData:b,onEdit:o,onSave:R,onCancel:$,onEditDataChange:V,onNoShow:t,onRemove:_,onReEdit:v}){const[J,T]=m.useState(!1),z=w=>{if(!w)return"";try{const i=ne(w);return de(i,"MMM d, yyyy h:mm a")}catch{return new Date(w).toLocaleString()}};return p?e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:6,className:"py-4 px-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Edit Hours Worked"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Hours Worked"}),e.jsx("input",{type:"number",step:"0.25",min:"0",value:b.hours_worked||"",onChange:w=>V({...b,hours_worked:parseFloat(w.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Actual Start Time"}),e.jsx("input",{type:"datetime-local",value:b.actual_start_time_utc?new Date(b.actual_start_time_utc).toISOString().slice(0,16):"",onChange:w=>V({...b,actual_start_time_utc:new Date(w.target.value).toISOString()}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Actual End Time"}),e.jsx("input",{type:"datetime-local",value:b.actual_end_time_utc?new Date(b.actual_end_time_utc).toISOString().slice(0,16):"",onChange:w=>V({...b,actual_end_time_utc:new Date(w.target.value).toISOString()}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>R(r.id),className:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 transition-colors",children:"Save Changes"}),e.jsx("button",{onClick:$,className:"px-4 py-2 bg-gray-200 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})})}):e.jsxs("tr",{className:`group transition-colors ${r.approved?"bg-green-50/30":r.status==="no_show"?"bg-red-50/30":r.status==="cancelled"?"bg-gray-50/30":"hover:bg-gray-50"}`,onMouseEnter:()=>T(!0),onMouseLeave:()=>T(!1),children:[e.jsxs("td",{className:"py-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-gray-100 flex items-center justify-center flex-shrink-0",children:e.jsx(Ge,{className:"h-4 w-4 text-gray-600"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:r.worker_name}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Scheduled: ",P(r.scheduled_hours,2,"0.00"),"h"]})]})]}),r.approved&&r.approved_by_name&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500 ml-11",children:["Approved by ",r.approved_by_name," on ",z(r.approved_at)]})]}),e.jsx("td",{className:"py-4 text-sm text-gray-700",children:r.shift_role||"N/A"}),e.jsx("td",{className:"py-4 text-right",children:e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[P(r.effective_hours,2,"0.00"),"h",r.edited_at&&e.jsx("span",{className:"ml-1 text-xs text-orange-600",title:"Edited",children:e.jsx(Pe,{className:"h-3 w-3 inline"})})]})}),e.jsxs("td",{className:"py-4 text-right text-sm text-gray-700",children:["$",P(r.effective_hourly_rate,2,"0.00"),"/h"]}),e.jsx("td",{className:"py-4 text-right",children:e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:["$",P(r.effective_pay,2,"0.00")]})}),e.jsx("td",{className:"py-4 text-right",children:e.jsx("div",{className:"flex items-center justify-end gap-2",children:r.status==="no_show"?e.jsx(e.Fragment,{children:e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-red-700",children:[e.jsx(es,{className:"h-3.5 w-3.5"}),"No-Show"]})}):r.status==="cancelled"?e.jsx(e.Fragment,{children:e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-gray-700",children:[e.jsx(he,{className:"h-3.5 w-3.5"}),"Cancelled"]})}):r.approved?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-green-700",children:[e.jsx(ue,{className:"h-3.5 w-3.5"}),"Approved"]}),r.can_edit_hours&&e.jsx("button",{onClick:()=>v(r),className:`text-xs text-gray-600 hover:text-gray-900 transition-all ${J?"opacity-100":"opacity-0"}`,title:"Re-edit approved hours",children:"Re-edit"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-amber-700 bg-amber-50 rounded",children:[e.jsx(Fe,{className:"h-3.5 w-3.5"}),"Pending"]}),r.can_edit_hours&&e.jsxs("div",{className:`flex items-center gap-1 transition-all ${J?"opacity-100":"opacity-0"}`,children:[e.jsx("button",{onClick:()=>o(r),className:"p-1.5 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Edit hours",children:e.jsx(Pe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>t(r),className:"p-1.5 text-gray-600 hover:text-orange-600 hover:bg-orange-50 rounded transition-colors",title:"Mark no-show",children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>_(r),className:"p-1.5 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"Remove worker",children:e.jsx(Le,{className:"h-4 w-4"})})]})]})})})]})}function ns({event:r,isOpen:p,onClose:b,onSuccess:o}){const[R,$]=m.useState([]),[V,t]=m.useState(null),[_,v]=m.useState(!1),[J,T]=m.useState(null),[z,w]=m.useState({}),[i,D]=m.useState(!1),[A,g]=m.useState({isVisible:!1,message:"",type:"success"}),[y,u]=m.useState({open:!1,title:"",variant:"default"});m.useEffect(()=>{p&&r&&k()},[p,r]);const k=async()=>{var s,l;if(r!=null&&r.id){v(!0);try{const f=await B.get(`/events/${r.id}/approvals`);$(f.data.data.assignments||[]),t(f.data.data.cost_summary||null)}catch(f){console.error("Error loading assignments:",f),g({isVisible:!0,type:"error",message:((l=(s=f.response)==null?void 0:s.data)==null?void 0:l.error)||f.message||"Unable to load assignments for approval"}),$([]),t(null)}finally{v(!1)}}},W=s=>{T(s.id),w({hours_worked:s.hours_worked||s.scheduled_hours,actual_start_time_utc:s.actual_start||s.scheduled_start,actual_end_time_utc:s.actual_end||s.scheduled_end,hourly_rate:s.hourly_rate})},q=s=>{u({open:!0,title:"Re-Edit Approved Hours",message:"Re-editing will un-approve this assignment. The assignment will need to be re-approved after you make changes. Continue?",variant:"warning",onConfirm:async()=>{u({open:!1,title:""}),W(s)}})},U=async s=>{var l,f,h;try{const F=await B.patch(`/approvals/${s}/update_hours`,z);await k(),T(null),w({}),(l=F.data)!=null&&l.message?g({isVisible:!0,type:"success",message:F.data.message}):g({isVisible:!0,type:"success",message:"Hours updated successfully"})}catch(F){console.error("Error updating hours:",F),g({isVisible:!0,type:"error",message:((h=(f=F.response)==null?void 0:f.data)==null?void 0:h.message)||"Failed to update hours"})}},ee=async s=>{u({open:!0,title:"Mark No-Show",message:`Mark ${s.worker_name} as no-show? This will set hours to 0.`,requireNote:!0,note:"",variant:"warning",onConfirm:async()=>{var l,f;try{await B.post(`/approvals/${s.id}/mark_no_show`,{notes:y.note}),await k(),g({isVisible:!0,type:"success",message:"Marked as no-show"})}catch(h){console.error("Error marking no-show:",h),g({isVisible:!0,type:"error",message:((f=(l=h.response)==null?void 0:l.data)==null?void 0:f.message)||"Failed to mark no-show"})}finally{u({open:!1,title:""})}}})},I=async s=>{u({open:!0,title:"Remove from Job",message:`Remove ${s.worker_name} from this job? This cannot be undone.`,requireNote:!0,note:"",variant:"danger",onConfirm:async()=>{var l,f;try{await B.delete(`/approvals/${s.id}/remove`,{data:{notes:y.note}}),await k(),g({isVisible:!0,type:"success",message:"Assignment removed"})}catch(h){console.error("Error removing assignment:",h),g({isVisible:!0,type:"error",message:((f=(l=h.response)==null?void 0:l.data)==null?void 0:f.message)||"Failed to remove assignment"})}finally{u({open:!1,title:""})}}})},Q=async()=>{const s=R.filter(l=>!l.approved&&l.can_approve&&l.status!=="no_show").length;u({open:!0,title:"Approve All Hours",message:`Approve hours for all ${s} eligible workers?`,onConfirm:async()=>{var l,f;D(!0);try{await B.post(`/events/${r.id}/approve_all`),await k(),o(),g({isVisible:!0,type:"success",message:`Approved ${s} assignments`})}catch(h){console.error("Error approving all:",h),g({isVisible:!0,type:"error",message:((f=(l=h.response)==null?void 0:l.data)==null?void 0:f.message)||"Failed to approve all hours"})}finally{D(!1),u({open:!1,title:""})}}})};if(!p)return null;const x=R.filter(s=>s.status!=="no_show"&&s.status!=="cancelled"),n=x.filter(s=>!s.approved).length,c=x.filter(s=>s.approved).length,S=x.length,L=x.filter(s=>!s.approved).reduce((s,l)=>s+Number(l.effective_pay||0),0),E=x.filter(s=>s.approved).reduce((s,l)=>s+Number(l.effective_pay||0),0),M=L+E,C=x.reduce((s,l)=>s+Number(l.effective_hours||0),0),N=s=>{if(!s)return"";try{return de(ne(s),"MMM d, yyyy")}catch{return new Date(s).toLocaleDateString()}};return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-0 sm:p-4 overflow-y-auto",children:[e.jsx(De,{isVisible:A.isVisible,message:A.message,type:A.type,onClose:()=>g({...A,isVisible:!1})}),e.jsxs("div",{className:"bg-white w-full h-full sm:h-auto sm:max-w-6xl sm:rounded-lg shadow-xl overflow-hidden flex flex-col sm:max-h-[90vh] my-0 sm:my-4",children:[e.jsx("header",{className:"border-b px-6 py-4 bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Approve Hours"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-0.5",children:[r==null?void 0:r.title," Â· ",r!=null&&r.event_date?N(r.event_date):""]})]}),e.jsx("button",{onClick:b,className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close modal",children:e.jsx(he,{className:"h-5 w-5"})})]})}),n>0&&e.jsx("div",{className:"bg-amber-50 border-l-4 border-amber-400 px-6 py-3 flex-shrink-0",children:e.jsxs("p",{className:"text-sm text-amber-800 flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("strong",{children:n})," ",n===1?"assignment":"assignments"," pending approval"]})}),e.jsx("div",{className:"flex-1 overflow-auto px-6 py-4",children:_?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading assignments..."})]}):R.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ge,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No assignments found for this event."})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b border-gray-200",children:e.jsxs("tr",{className:"text-left",children:[e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Worker"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right",children:"Hours"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right",children:"Rate"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right",children:"Total"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:R.map(s=>e.jsx(is,{assignment:s,isEditing:J===s.id,editData:z,onEdit:W,onSave:U,onCancel:()=>{T(null),w({})},onEditDataChange:w,onNoShow:ee,onRemove:I,onReEdit:q},s.id))})]})}),e.jsxs("footer",{className:"border-t bg-gray-50 px-6 py-4 flex-shrink-0",children:[n>0&&c>0?e.jsxs("div",{className:"mb-4 space-y-1.5 text-sm",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Pending approval:"}),e.jsxs("span",{className:"font-medium",children:["$",P(L,2,"0.00")," (",n," ",n===1?"worker":"workers",")"]})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Approved:"}),e.jsxs("span",{className:"font-medium",children:["$",P(E,2,"0.00")," (",c," ",c===1?"worker":"workers",")"]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200 flex justify-between text-gray-900",children:[e.jsx("span",{className:"font-semibold",children:"Total:"}),e.jsxs("span",{className:"font-semibold",children:["$",P(M,2,"0.00")," (",S," workers, ",P(C,2,"0.00"),"h)"]})]})]}):n===0&&c>0?e.jsxs("div",{className:"mb-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Final approved cost:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["$",P(E,2,"0.00")]})]}):e.jsxs("div",{className:"mb-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Total cost:"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["$",P(M,2,"0.00")," (",S," workers, ",P(C,2,"0.00"),"h)"]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:b,className:"px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 transition-colors",children:"Close"}),n>0&&e.jsxs("button",{onClick:Q,disabled:i,className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white text-sm font-medium rounded-lg shadow-sm flex items-center gap-2 transition-colors",children:[e.jsx(ue,{className:"h-4 w-4"}),"Approve All (",n,")"]})]})]})]}),y.open&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>u({open:!1,title:""})}),e.jsxs("div",{className:"relative bg-white w-full max-w-md rounded-lg shadow-xl p-5",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:y.title}),y.message&&e.jsx("p",{className:"mt-2 text-sm text-gray-700",children:y.message}),y.requireNote&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes (optional)"}),e.jsx("textarea",{value:y.note||"",onChange:s=>u(l=>({...l,note:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]}),e.jsxs("div",{className:"mt-5 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>u({open:!1,title:""}),className:"px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-200",children:"Cancel"}),e.jsx("button",{onClick:async()=>{var s;await((s=y.onConfirm)==null?void 0:s.call(y))},className:"px-4 py-2 text-white text-sm font-medium rounded-md "+(y.variant==="danger"?"bg-red-600 hover:bg-red-700":y.variant==="warning"?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:"Confirm"})]})]})]})]})}function te({className:r="",count:p=1}){return e.jsx(e.Fragment,{children:Array.from({length:p}).map((b,o)=>e.jsx("div",{className:`animate-pulse bg-gray-200 rounded-lg ${r}`},o))})}function $e(){return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(te,{className:"h-6 w-48 mb-2"}),e.jsx(te,{className:"h-4 w-32"})]}),e.jsx(te,{className:"h-8 w-8 rounded-full"})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 rounded"}),e.jsx(te,{className:"h-4 w-40"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 rounded"}),e.jsx(te,{className:"h-4 w-36"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 rounded"}),e.jsx(te,{className:"h-4 w-32"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(te,{className:"h-2 w-full rounded-full mb-2"}),e.jsx(te,{className:"h-3 w-24"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(te,{className:"h-9 w-24 rounded-md"}),e.jsx(te,{className:"h-9 w-24 rounded-md"})]})]})})}function os(r,p=500){const[b,o]=m.useState(r);return m.useEffect(()=>{const R=setTimeout(()=>{o(r)},p);return()=>{clearTimeout(R)}},[r,p]),b}function Fs(){const r=ze(),[p,b]=qe(),o=(p.get("tab")==="completed"?"completed":p.get("tab"))||"active",R=p.get("filter")||"needs_workers",[$,V]=m.useState(o),[t,_]=m.useState(R),[v,J]=m.useState(""),T=os(v,500),[z,w]=m.useState("date"),[i,D]=m.useState(!0),[A,g]=m.useState([]),[y,u]=m.useState(new Set),[k,W]=m.useState({isOpen:!1}),[q,U]=m.useState({isOpen:!1}),[ee,I]=m.useState({isVisible:!1,message:"",type:"success"}),[Q,x]=m.useState({isOpen:!1,isLoading:!1}),[n,c]=m.useState({isOpen:!1,isLoading:!1}),[S,L]=m.useState({isOpen:!1,isLoading:!1}),[E,M]=m.useState({isOpen:!1,unfilledShiftIds:[]}),[C,N]=m.useState({isOpen:!1});m.useEffect(()=>{s()},[$,t,p]),m.useEffect(()=>{const a=(p.get("tab")==="completed"?"completed":p.get("tab"))||"active",d=p.get("filter")||"all";a!==$&&V(a),d!==t&&_(d)},[p,$,t]),m.useEffect(()=>{const a=p.get("event_id"),d=p.get("shift_id");if(a){const j=parseInt(a);isNaN(j)||(u(new Set([j])),d&&console.log(`Auto-expanding event ${j} with shift ${d}`))}},[p]),m.useEffect(()=>{const a=p.get("event_id");if(!a)return;const d=parseInt(a);if(isNaN(d))return;const j=A.find(H=>H.id===d);j&&(!j.shifts_by_role||j.shifts_by_role.length===0)&&(h(d),u(new Set([d])))},[p,A]);async function s(){D(!0);try{const a=$==="completed"?"completed":$,d=p.get("date");let j=`/events?tab=${a}`;t!=="all"&&(j+=`&filter=${t}`),d&&(j+=`&date=${d}`),console.log("Loading events with URL:",j,"filterStatus:",t,"date:",d);const H=await B.get(j);if(H.data.status==="success"){console.log("Received events:",H.data.data.length);const ie=H.data.data;if($==="completed"){const Y=await Promise.all(ie.map(async K=>{var re;try{const Z=await B.get(`/events/${K.id}/approvals`);if(((re=Z.data)==null?void 0:re.status)==="success"){const se=Z.data.data.assignments||[],pe=se.length,be=se.filter(We=>We.approved).length,Ve=Z.data.data.cost_summary||null;return{...K,approval_status:{total:pe,approved:be,pending:pe-be},cost_summary:Ve}}}catch(Z){console.warn(`Failed to load approval status for event ${K.id}:`,Z)}return K}));g(Y)}else{const Y=Array.from(y);g(K=>{const re=new Map(K.map(Z=>[Z.id,Z]));return ie.map(Z=>{const se=re.get(Z.id);return Y.includes(Z.id)&&(se!=null&&se.shifts_by_role)&&se.shifts_by_role.length>0?{...Z,shifts_by_role:se.shifts_by_role,full_details:se.full_details||se}:Z})}),Y.length>0&&Promise.all(Y.map(K=>h(K))).catch(K=>{console.error("Failed to refresh expanded event details:",K)})}}}catch(a){console.error("Failed to load events:",a)}finally{D(!1)}}const l=a=>{V(a),b({tab:a}),_(a==="active"?"needs_workers":"all")},f=a=>{_(a);const d=new URLSearchParams;d.set("tab",$),a!=="all"&&d.set("filter",a),b(d)},h=async a=>{var d,j;try{const[H,ie]=await Promise.all([B.get(`/events/${a}`),B.get(`/events/${a}/approvals`).catch(()=>null)]);if(((d=H.data)==null?void 0:d.status)==="success"){const Y=H.data.data;if(((j=ie==null?void 0:ie.data)==null?void 0:j.status)==="success"){const K=ie.data.data.assignments||[],re=new Map(K.map(Z=>[Z.id,Z]));Y.shifts_by_role&&(Y.shifts_by_role=Y.shifts_by_role.map(Z=>({...Z,shifts:Z.shifts.map(se=>({...se,assignments:se.assignments.map(pe=>{const be=re.get(pe.id);return be&&typeof be=="object"?{...pe,...be}:pe})}))})))}g(K=>K.map(re=>re.id===a?{...re,...Y}:re))}}catch(H){console.error("Failed to load event details",H)}},F=a=>{var j;const d=new Set(y);if(d.has(a))d.delete(a);else{d.add(a);const H=A.find(Y=>Y.id===a);!!((j=H==null?void 0:H.shifts_by_role)!=null&&j.some(Y=>{var K;return(K=Y.shifts)==null?void 0:K.some(re=>(re.assignments||[]).length>0)}))||h(a)}u(d)};async function O(a){const d=A==null?void 0:A.find(j=>j.id===a);L({isOpen:!0,isLoading:!1,eventId:a,eventTitle:d==null?void 0:d.title})}async function X(){if(S.eventId){L(a=>({...a,isLoading:!0}));try{const a=await B.delete(`/events/${S.eventId}`);a.data.status==="success"?(L({isOpen:!1,isLoading:!1}),I({isVisible:!0,message:`"${a.data.event_title}" moved to trash`,type:"success",action:{label:"Undo",onClick:()=>oe(a.data.event_id),variant:"primary"}}),s()):I({isVisible:!0,message:a.data.message||"Unable to delete event",type:"error"})}catch(a){console.error("Failed to delete event:",a),I({isVisible:!0,message:"Unable to delete event",type:"error"})}finally{L(a=>({...a,isLoading:!1}))}}}async function oe(a){try{const d=await B.post(`/events/${a}/restore`);d.data.status==="success"?(I({isVisible:!0,message:"Event restored to draft",type:"success"}),s()):I({isVisible:!0,message:d.data.message||"Unable to restore event",type:"error"})}catch(d){console.error("Failed to restore event:",d),I({isVisible:!0,message:"Unable to restore event",type:"error"})}}function fe(){L({isOpen:!1,isLoading:!1})}function ce(a){x({isOpen:!0,eventId:a,isLoading:!1})}async function je(){if(Q.eventId){x(a=>({...a,isLoading:!0}));try{const a=await B.post(`/events/${Q.eventId}/publish`);a.data.status==="success"?(I({isVisible:!0,message:"Event published successfully",type:"success"}),x({isOpen:!1,isLoading:!1}),s()):(I({isVisible:!0,message:a.data.message||"Unable to publish event",type:"error"}),x({isOpen:!1,isLoading:!1}))}catch(a){console.error("Failed to publish event:",a),I({isVisible:!0,message:"Unable to publish event",type:"error"}),x({isOpen:!1,isLoading:!1})}}}function Ne(){x({isOpen:!1,isLoading:!1})}function _e(a,d){c({isOpen:!0,assignmentId:a,isLoading:!1,workerName:d})}async function le(){var a,d;if(n.assignmentId){c(j=>({...j,isLoading:!0}));try{const j=await B.delete(`/staffing/${n.assignmentId}`);((a=j.data)==null?void 0:a.status)==="success"?(I({isVisible:!0,message:"Worker unassigned successfully",type:"success"}),c({isOpen:!1,isLoading:!1}),s()):(I({isVisible:!0,message:((d=j.data)==null?void 0:d.message)||"Unable to unassign worker",type:"error"}),c({isOpen:!1,isLoading:!1}))}catch(j){console.error("Failed to unassign worker:",j),I({isVisible:!0,message:"Unable to unassign worker",type:"error"}),c({isOpen:!1,isLoading:!1})}}}const ye=a=>{U({isOpen:!0,shiftId:a})},ae=()=>{U({isOpen:!1})},me=()=>{ae(),I({isVisible:!0,message:"Worker assigned",type:"success"}),s()},G=A.filter(a=>{var d;if(T){const j=T.toLowerCase();if(!(a.title.toLowerCase().includes(j)||((d=a.venue)==null?void 0:d.name.toLowerCase().includes(j))))return!1}if($==="active")switch(t){case"needs_workers":return a.unfilled_roles_count>0;case"partially_filled":return a.unfilled_roles_count>0&&a.assigned_workers_count>0;case"fully_staffed":return a.unfilled_roles_count===0&&a.assigned_workers_count>0;case"all":default:return!0}return!0}).sort((a,d)=>{var j,H;switch(z){case"name":return a.title.localeCompare(d.title);case"staffing":return a.staffing_percentage-d.staffing_percentage;case"date":default:const ie=((j=a.schedule)==null?void 0:j.start_time_utc)||a.created_at,Y=((H=d.schedule)==null?void 0:H.start_time_utc)||d.created_at;return new Date(ie).getTime()-new Date(Y).getTime()}});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold text-gray-900",children:"Events"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage events and assign workers"})]}),e.jsxs("button",{onClick:()=>r("/events/create"),className:"w-full sm:w-auto inline-flex items-center justify-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors shadow-sm min-h-touch",children:[e.jsx(Me,{size:20}),"Create New Event"]})]}),p.get("date")&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-teal-50 border border-teal-200 rounded-lg",children:[e.jsx(Se,{size:16,className:"text-teal-600"}),e.jsxs("span",{className:"text-sm font-medium text-teal-900",children:["Showing events for ",de(ne(p.get("date")),"EEEE, MMMM d, yyyy")]}),e.jsx("button",{onClick:()=>{const a=new URLSearchParams(p);a.delete("date"),b(a)},className:"ml-auto text-teal-600 hover:text-teal-700",title:"Clear date filter",children:e.jsx(he,{size:16})})]})]}),e.jsxs("div",{className:"flex gap-6 border-b border-gray-200 mb-6",children:[e.jsx("button",{onClick:()=>l("draft"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${$==="draft"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Draft Events"}),e.jsx("button",{onClick:()=>l("active"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${$==="active"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Active Events"}),e.jsx("button",{onClick:()=>l("completed"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${$==="completed"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Completed Events"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-3 sm:gap-4 mb-6",children:[e.jsxs("div",{className:"w-full md:flex-1 md:max-w-md relative",children:[e.jsx(Ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search events or venues...",value:v,onChange:a=>J(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),e.jsxs("select",{value:z,onChange:a=>w(a.target.value),className:"w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"name",children:"Sort by Name"}),$!=="draft"&&e.jsx("option",{value:"staffing",children:"Sort by Staffing"})]}),$==="active"&&e.jsxs("div",{className:"w-full sm:w-auto flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>f("all"),className:`w-full sm:w-auto px-3 py-2 text-sm font-medium rounded-lg transition ${t==="all"?"bg-gray-100 text-gray-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"All"}),e.jsx("button",{onClick:()=>f("needs_workers"),className:`w-full sm:w-auto px-3 py-2 text-sm font-medium rounded-lg transition ${t==="needs_workers"?"bg-red-100 text-red-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Needs Workers"}),e.jsx("button",{onClick:()=>f("fully_staffed"),className:`w-full sm:w-auto px-3 py-2 text-sm font-medium rounded-lg transition ${t==="fully_staffed"?"bg-green-100 text-green-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Ready"})]})]}),i?e.jsxs("div",{className:"space-y-4",children:[e.jsx($e,{}),e.jsx($e,{}),e.jsx($e,{})]}):e.jsxs(e.Fragment,{children:[$==="draft"&&e.jsx(ds,{events:G,onDelete:O,onPublish:ce,onNavigate:a=>r(a),searchQuery:v}),$==="active"&&e.jsx(cs,{events:G,expandedEvents:y,onToggleEvent:F,onAssignWorker:ye,onUnassign:_e,onQuickFill:(a,d,j,H)=>M({isOpen:!0,eventId:a,roleName:d,unfilledShiftIds:j,payRate:H}),onPublish:ce,onDelete:O,onEdit:a=>N({isOpen:!0,event:a}),searchQuery:v}),$==="completed"&&e.jsx(ms,{events:G,expandedEvents:y,onToggleEvent:F,searchQuery:v,onApproveHours:a=>W({isOpen:!0,event:a})})]})]}),q.isOpen&&q.shiftId&&e.jsx(as,{shiftId:q.shiftId,onClose:ae,onSuccess:me}),e.jsx(De,{isVisible:ee.isVisible,message:ee.message,type:ee.type,action:ee.action,onClose:()=>I({...ee,isVisible:!1})}),e.jsx(Ce,{isOpen:Q.isOpen,onClose:Ne,onConfirm:je,title:"Publish Event",message:"Ready to publish? This will create shifts and make them available for worker assignment.",confirmText:Q.isLoading?"Publishingâ€¦":"Publish",cancelText:"Cancel",isLoading:Q.isLoading,isDestructive:!1}),e.jsx(Ce,{isOpen:n.isOpen,onClose:()=>c({isOpen:!1,isLoading:!1}),onConfirm:le,title:"Unassign Worker",message:`Remove ${n.workerName||"this worker"} from this shift?`,confirmText:n.isLoading?"Removingâ€¦":"Unassign",cancelText:"Cancel",isLoading:n.isLoading,isDestructive:!0}),e.jsx(Ce,{isOpen:S.isOpen,onClose:fe,onConfirm:X,title:"Delete Event",message:`Delete "${S.eventTitle}"? This action cannot be undone.`,confirmText:S.isLoading?"Deletingâ€¦":"Delete",cancelText:"Cancel",isLoading:S.isLoading,isDestructive:!0}),e.jsx(rs,{isOpen:E.isOpen,eventId:E.eventId||0,roleName:E.roleName||"",unfilledShiftIds:E.unfilledShiftIds,defaultPayRate:E.payRate,onClose:()=>M({isOpen:!1,unfilledShiftIds:[]}),onDone:({assigned:a,conflicts:d,details:j})=>{M({isOpen:!1,unfilledShiftIds:[]});let H=`Assigned ${a} workers â€¢ ${d} skipped`;d>0&&j&&(H+=`: ${j}`),I({isVisible:!0,message:H,type:d>0?"error":"success"}),s()}}),C.event&&e.jsx(ls,{event:C.event,isOpen:C.isOpen,onClose:()=>N({isOpen:!1,event:void 0}),onSuccess:()=>{s(),N({isOpen:!1,event:void 0})}}),k.isOpen&&k.event&&e.jsx(ns,{event:k.event,isOpen:k.isOpen,onClose:()=>{W({isOpen:!1}),s()},onSuccess:()=>{s(),W({isOpen:!1})}})]})}function ds({events:r,onDelete:p,onPublish:b,onNavigate:o,searchQuery:R}){const $=t=>{if(!t)return"No date set";const _=ne(t);return de(_,"MMM d, yyyy")},V=t=>{if(!t)return"";const _=ne(t);return de(_,"h:mm a")};return r.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:R?"No draft events found":"No draft events yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:R?"Try adjusting your search query":"Create your first event to get started"}),!R&&e.jsxs("button",{onClick:()=>o("/events/create"),className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:[e.jsx(Me,{size:20}),"Create Event"]})]}):e.jsxs("div",{className:"space-y-4",children:[r.length>0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ve,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-blue-900",children:[r.length," Event",r.length!==1?"s":""," Today"]}),e.jsxs("p",{className:"text-xs text-blue-700",children:[r.reduce((t,_)=>t+(_.assigned_workers_count||0),0),"/",r.reduce((t,_)=>t+(_.total_workers_needed||0),0)," workers hired"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:r.reduce((t,_)=>t+(_.assigned_workers_count||0),0)}),e.jsx("p",{className:"text-xs text-blue-700",children:"hired"})]})]})}),r.map(t=>{var _;return e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[t.title,t.schedule&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-600",children:["â€¢ ",V(t.schedule.start_time_utc),"â€“",V(t.schedule.end_time_utc)]})]})}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Draft"})]}),t.venue&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[e.jsx(ke,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:((_=t.venue)==null?void 0:_.name)||"No venue"})]}),t.schedule&&e.jsx("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{children:$(t.schedule.start_time_utc)})]})}),t.total_workers_needed>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ve,{size:16,className:"text-gray-400"}),e.jsxs("span",{children:[t.total_workers_needed," workers needed"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>o(`/events/${t.id}/edit`),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Edit",children:e.jsx(Ue,{size:18})})})]})})},t.id)})]})}function cs({events:r,expandedEvents:p,onToggleEvent:b,onAssignWorker:o,onUnassign:R,onQuickFill:$,onPublish:V,onDelete:t,onEdit:_,searchQuery:v}){const J=i=>{const D=ne(i);return de(D,"EEE, MMM d, yyyy")},T=i=>{const D=ne(i);return de(D,"h:mm a")},z=i=>{if(!i.schedule)return!1;const A=(ne(i.schedule.start_time_utc).getTime()-new Date().getTime())/(1e3*60*60);return A>0&&A<=48},w=i=>{switch(i){case"fully_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[e.jsx(ue,{size:14}),"Ready"]});case"partially_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full",children:[e.jsx(ge,{size:14}),"Partial"]});case"needs_workers":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[e.jsx(he,{size:14}),"Needs Workers"]});default:return null}};return r.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:v?"No active events found":"No active events"}),e.jsx("p",{className:"text-gray-600",children:v?"Try adjusting your search query or filters":"Publish draft events to see them here"})]}):e.jsx("div",{className:"space-y-4",children:r.map(i=>{var A;const D=p.has(i.id);return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{onClick:()=>b(i.id),className:"w-full px-4 sm:px-6 py-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[i.title,i.schedule&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-600",children:["â€¢ ",T(i.schedule.start_time_utc),"â€“",T(i.schedule.end_time_utc)]})]})}),w(i.staffing_status)]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[i.venue&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ke,{size:14,className:"text-gray-400"}),((A=i.venue)==null?void 0:A.name)||"No venue"]}),i.schedule&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Se,{size:14,className:"text-gray-400"}),e.jsx("span",{children:J(i.schedule.start_time_utc)}),z(i)&&e.jsx("span",{className:"bg-red-600 text-white text-xs font-semibold px-2 py-0.5 rounded-full ml-2","aria-label":"Urgent: starts within 48 hours",children:"Urgent"})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:[i.assigned_workers_count,"/",i.total_workers_needed," hired"]}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[i.staffing_percentage,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-full rounded-full transition-all ${i.staffing_percentage===100?"bg-green-500":i.staffing_percentage>0?"bg-yellow-500":"bg-red-500"}`,style:{width:`${i.staffing_percentage}%`}})})]}),i.unfilled_roles_count>0&&e.jsxs("p",{className:"text-sm text-red-600 font-medium",children:[i.unfilled_roles_count," still needed"]}),(i.total_pay_amount!==void 0||i.shifts_by_role&&i.shifts_by_role.length>0)&&e.jsxs("div",{className:"mt-3 inline-flex items-center gap-2 px-3 py-1.5 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Estimated Cost:"}),e.jsxs("span",{className:"text-base font-bold text-green-700",children:["$",(()=>{if(i.total_pay_amount!==void 0&&i.total_pay_amount>0)return P(i.total_pay_amount,2,"0.00");let g=0;return i.shifts_by_role&&i.shifts_by_role.length>0&&i.shifts_by_role.forEach(y=>{var u;(u=y.shifts)==null||u.forEach(k=>{var W;(W=k.assignments)==null||W.forEach(q=>{const U=xe(q.effective_pay);g+=U})})}),P(g,2,"0.00")})()]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",i.assigned_workers_count," worker",i.assigned_workers_count!==1?"s":"",")"]})]})]}),e.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[_&&i.status==="published"&&e.jsx("button",{onClick:g=>{g.stopPropagation(),_(i)},title:"Edit Event",className:"p-1.5 text-teal-600 hover:text-teal-700 hover:bg-teal-50 rounded transition-colors",children:e.jsx(ss,{size:14})}),t&&e.jsx("button",{onClick:g=>{g.stopPropagation(),t(i.id)},title:"Delete",className:"p-1.5 text-red-600 hover:text-red-700 hover:bg-red-50 rounded transition-colors",children:e.jsx(Le,{size:14})}),e.jsx("div",{className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:D?e.jsx(Re,{size:24,className:"text-gray-600 hover:text-gray-800"}):e.jsx(Ie,{size:24,className:"text-gray-600 hover:text-gray-800"})})]})]}),D&&e.jsx("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:i.shifts_by_role&&i.shifts_by_role.length>0?e.jsx("div",{className:"space-y-4",children:i.shifts_by_role.map(g=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:g.role_name}),e.jsxs("span",{className:"text-sm text-gray-600",children:[g.filled_shifts,"/",g.total_shifts," hired"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[g.filled_shifts<g.total_shifts&&e.jsxs("span",{className:"px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[g.total_shifts-g.filled_shifts," needed"]}),g.filled_shifts<g.total_shifts&&e.jsx("button",{onClick:y=>{var W;y.stopPropagation();const u=g.shifts.filter(q=>q.staffing_progress.percentage<100).sort((q,U)=>new Date(q.start_time_utc).getTime()-new Date(U.start_time_utc).getTime()).map(q=>q.id),k=(W=g.shifts[0])==null?void 0:W.pay_rate;$(i.id,g.role_name,u,k)},className:"px-2.5 py-1 text-xs font-semibold bg-teal-600 text-white rounded hover:bg-teal-700",title:"Quick Fill by Skill",children:"Quick Fill by Skill"})]})]}),e.jsx("div",{className:"space-y-2",children:g.shifts.map((y,u)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 text-gray-700 rounded-md flex items-center justify-center text-xs font-medium",children:u+1}),e.jsxs("span",{className:"text-sm text-gray-700",children:[T(y.start_time_utc)," - ",T(y.end_time_utc)]}),y.assignments.length>0&&e.jsx("div",{className:"flex items-center gap-1 flex-wrap",children:y.assignments.map(k=>{const W=`${k.worker.first_name} ${k.worker.last_name}`,q=Number(k.hourly_rate||y.pay_rate||0);return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"bg-white text-black border border-gray-200 rounded-full px-2.5 py-1 text-sm font-medium shadow-sm max-w-[140px] truncate",title:`${W} â€¢ $${P(q,0,"0")}/hr`,children:W}),e.jsx("button",{onClick:U=>{U.stopPropagation(),R(k.id,W)},className:"w-5 h-5 flex items-center justify-center text-red-600 hover:text-red-700 hover:bg-red-50 rounded",title:"Unassign worker",children:e.jsx(he,{size:12})})]},k.id)})})]}),y.staffing_progress.percentage===100?e.jsxs("span",{className:"flex items-center gap-1.5 text-sm font-medium text-green-600",children:[e.jsx(ue,{size:16}),"Assigned"]}):e.jsx("button",{onClick:k=>{k.stopPropagation(),o(y.id)},className:"px-3 py-1.5 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Assign Worker"})]},y.id))})]},g.role_name))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:i.status==="draft"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"This event is still in draft status"}),e.jsx("p",{className:"text-sm",children:"Publish the event to generate shifts and assign workers"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"No shifts available"}),e.jsx("p",{className:"text-sm",children:"This event may not have any shifts generated yet"})]})}),e.jsx("div",{className:"flex items-center justify-center gap-3",children:i.status==="draft"&&e.jsx("button",{onClick:()=>V(i.id),className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors",children:"Publish Event"})})]})})]},i.id)})})}function ms({events:r,expandedEvents:p,onToggleEvent:b,searchQuery:o,onApproveHours:R}){const $=t=>{const _=ne(t);return de(_,"MMM d, yyyy")},V=t=>{const _=ne(t);return de(_,"h:mm a")};return r.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“‹"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:o?"No past events found":"No past events yet"}),e.jsx("p",{className:"text-gray-600",children:o?"Try adjusting your search query":"Completed events will appear here"})]}):e.jsx("div",{className:"space-y-4",children:r.map(t=>{var T;const _=p.has(t.id);let v=xe(t.total_hours_worked),J=xe(t.total_pay_amount);return v===0&&J===0&&t.shifts_by_role&&t.shifts_by_role.length>0&&t.shifts_by_role.forEach(z=>{var w;(w=z.shifts)==null||w.forEach(i=>{var D;(D=i.assignments)==null||D.forEach(A=>{const g=xe(A.effective_hours);v+=g;const y=xe(A.effective_pay);J+=y})})}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{onClick:()=>b(t.id),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2 flex-wrap",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.title}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Completed"}),t.approval_status&&t.approval_status.total>0&&(t.approval_status.approved===t.approval_status.total?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-emerald-100 text-emerald-700 text-xs font-medium rounded-full",children:[e.jsx(ue,{size:12}),"All Hours Approved"]}):e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-amber-100 text-amber-700 text-xs font-medium rounded-full",children:[e.jsx(ge,{size:12}),t.approval_status.pending," Pending Approval"]}))]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[t.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Se,{size:14,className:"text-gray-400"}),$(t.schedule.start_time_utc)]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Fe,{size:14,className:"text-gray-400"}),V(t.schedule.start_time_utc)," - ",V(t.schedule.end_time_utc)]})]}),t.venue&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ke,{size:14,className:"text-gray-400"}),((T=t.venue)==null?void 0:T.name)||"No venue"]})]}),t.cost_summary&&e.jsx("div",{className:"mt-2 text-sm",children:t.cost_summary.all_approved?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-600",children:"Final Cost:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["$",P(t.cost_summary.approved_cost,2,"0.00")]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",t.cost_summary.approved_count," workers)"]})]}):e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-600",children:"Cost:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["$",P(t.cost_summary.total_estimated_cost,2,"0.00")]})]}),t.cost_summary.approved_count>0&&e.jsxs("span",{className:"text-xs text-green-600",children:["âœ… $",P(t.cost_summary.approved_cost,2,"0.00")," approved"]}),t.cost_summary.pending_count>0&&e.jsxs("span",{className:"text-xs text-amber-600",children:["âš ï¸ $",P(t.cost_summary.pending_cost,2,"0.00")," pending"]})]})})]}),e.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[R&&(t.approval_status&&t.approval_status.approved===t.approval_status.total?e.jsxs("span",{className:"px-3 py-1.5 text-sm bg-emerald-100 text-emerald-700 rounded-md flex items-center gap-1 font-medium",children:[e.jsx(ue,{size:14}),"Approved"]}):e.jsx("button",{onClick:z=>{z.stopPropagation(),R(t)},className:`px-3 py-1.5 text-sm rounded-md flex items-center gap-1 ${t.approval_status&&t.approval_status.pending>0?"bg-amber-600 text-white hover:bg-amber-700":"bg-green-600 text-white hover:bg-green-700"}`,title:"Approve Hours",children:t.approval_status&&t.approval_status.pending>0?`Approve Hours (${t.approval_status.pending})`:"Approve Hours"})),e.jsx("div",{className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:_?e.jsx(Re,{size:24,className:"text-gray-600 hover:text-gray-800"}):e.jsx(Ie,{size:24,className:"text-gray-600 hover:text-gray-800"})})]})]}),_&&t.shifts_by_role&&e.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:[e.jsx("div",{className:"mb-4 p-4 bg-white rounded-lg border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Workers"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:t.assigned_workers_count})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Hours"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:P(v,2,"0.00")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Event Cost"}),t.cost_summary?t.cost_summary.all_approved?e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-semibold text-green-600",children:["$",P(t.cost_summary.approved_cost,2,"0.00")]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Final Approved Cost"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"âœ… Approved:"}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["$",P(t.cost_summary.approved_cost,2,"0.00")]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"âš ï¸ Pending:"}),e.jsxs("span",{className:"text-sm font-semibold text-amber-600",children:["$",P(t.cost_summary.pending_cost,2,"0.00")]})]}),e.jsxs("div",{className:"border-t border-gray-300 pt-1 mt-1 flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Total:"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["$",P(t.cost_summary.total_estimated_cost,2,"0.00")]})]})]}):e.jsxs("p",{className:"text-2xl font-semibold text-green-600",children:["$",(()=>{if(t.total_pay_amount!==void 0&&t.total_pay_amount>0)return P(t.total_pay_amount,0,"0");let z=0;return t.shifts_by_role&&t.shifts_by_role.length>0&&t.shifts_by_role.forEach(w=>{var i;(i=w.shifts)==null||i.forEach(D=>{var A;(A=D.assignments)==null||A.forEach(g=>{const y=xe(g.effective_pay);z+=y})})}),P(z,0,"0")})()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Staffing"}),e.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[t.staffing_percentage,"%"]})]})]})}),e.jsx("div",{className:"space-y-3",children:t.shifts_by_role.map(z=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:z.role_name}),e.jsx("div",{className:"space-y-2",children:z.shifts.flatMap(w=>w.assignments.map(i=>{var D,A,g,y,u,k;return e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 text-teal-700 flex items-center justify-center text-sm font-medium",children:[((A=(D=i.worker)==null?void 0:D.first_name)==null?void 0:A[0])||"",((y=(g=i.worker)==null?void 0:g.last_name)==null?void 0:y[0])||""]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[((u=i.worker)==null?void 0:u.first_name)||"Unknown"," ",((k=i.worker)==null?void 0:k.last_name)||"Worker"]}),i.approved?e.jsxs("span",{className:"text-xs text-emerald-600 font-medium flex items-center gap-1",children:[e.jsx(ue,{size:10}),"Approved",i.approved_by_name?` by ${i.approved_by_name.split("@")[0]}`:""]}):e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Pending Approval"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[i.scheduled_hours!==void 0&&e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["Scheduled: ",P(i.scheduled_hours,2,"0.00"),"h"]}),e.jsxs("span",{className:"font-medium",children:[P(i.effective_hours||i.hours_worked||0,2,"0.00")," hrs"]})]}),!i.scheduled_hours&&i.hours_worked&&e.jsxs("span",{className:"font-medium",children:[P(i.hours_worked,2,"0.00")," hrs"]}),e.jsxs("span",{className:"font-medium text-green-600",children:["$",P(Number(i.hourly_rate??w.pay_rate??0),0,"0"),"/hr"]}),e.jsxs("span",{className:"font-semibold text-blue-600",children:["$",P(i.effective_pay||Number(i.hours_worked||0)*Number(i.hourly_rate??w.pay_rate??0),0,"0")]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[V(w.start_time_utc)," - ",V(w.end_time_utc)]})]})]},i.id)}))})]},z.role_name))})]})]},t.id)})})}export{Fs as EventsPage};
