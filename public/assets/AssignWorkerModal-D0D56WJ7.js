import{j as e,k as M}from"./index-yz7Odp8O.js";import{b as r}from"./vendor-7daYTdBd.js";import{g as R}from"./workersApi-cxXEBSCQ.js";import{d as F}from"./MapPinIcon-sNr2BJFd.js";function q({title:t,titleId:a,...c},l){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":a},c),t?r.createElement("title",{id:a},t):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"}))}const h=r.forwardRef(q);function $({title:t,titleId:a,...c},l){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":a},c),t?r.createElement("title",{id:a},t):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))}const Z=r.forwardRef($);function B({title:t,titleId:a,...c},l){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":a},c),t?r.createElement("title",{id:a},t):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"}))}const O=r.forwardRef(B);function T({title:t,titleId:a,...c},l){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":a},c),t?r.createElement("title",{id:a},t):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}const D=r.forwardRef(T);function U({shift:t,onClose:a,onSuccess:c}){const[l,N]=r.useState([]),[p,u]=r.useState([]),[m,k]=r.useState(""),[d,_]=r.useState(null),[E,W]=r.useState(!0),[j,b]=r.useState(!1),[w,g]=r.useState("");r.useEffect(()=>{L()},[]),r.useEffect(()=>{C()},[m,l]);const L=async()=>{try{const s=await R(),i=t.assignments?.map(o=>o.worker_id)||[],n=s.data.workers.filter(o=>o.active&&!i.includes(o.id));N(n),u(n)}catch(s){g("Failed to load workers"),console.error("Error loading workers:",s)}finally{W(!1)}},C=()=>{if(!m){u(l);return}const s=m.toLowerCase(),i=l.filter(n=>n.first_name.toLowerCase().includes(s)||n.last_name.toLowerCase().includes(s)||n.email.toLowerCase().includes(s)||n.skills_json?.some(o=>o.toLowerCase().includes(s)));u(i)},y=s=>s.skills_json?.includes(t.role_needed)||!1,v=s=>t.required_cert_id?(s.worker_certifications||s.certifications||[]).some(n=>{const o=n.certification_id??n.id,x=n.expires_at_utc;return o===t.required_cert_id&&x&&new Date(x)>new Date(t.end_time_utc)})||!1:!0,S=s=>y(s)&&v(s),A=async()=>{if(d){b(!0),g("");try{await M(t.id,d.id),c()}catch(s){const i=s?.response?.data?.error||"Failed to assign worker";g(i),console.error("Error assigning worker:",s)}finally{b(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Assign Worker"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[t.client_name," - ",t.role_needed]})]}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",children:e.jsx(D,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by name, email, or skill...",value:m,onChange:s=>k(s.target.value),className:"pl-10 pr-4 py-2 w-full border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0})]})}),w&&e.jsxs("div",{className:"mx-6 mt-4 bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(h,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-red-800 font-medium",children:"Assignment Failed"}),e.jsx("p",{className:"text-red-700 text-sm mt-1",children:w})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:E?e.jsx("div",{className:"text-center py-12 text-gray-500",children:"Loading workers..."}):p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(O,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:m?"No workers match your search":"No available workers"})]}):e.jsx("div",{className:"space-y-2",children:p.map(s=>{const i=S(s),n=y(s),o=v(s),x=d?.id===s.id;return e.jsx("div",{onClick:()=>i&&_(s),className:`p-4 border rounded-lg cursor-pointer transition-all ${x?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"} ${i?"":"opacity-60 cursor-not-allowed"}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0",children:e.jsxs("span",{className:"text-gray-600 font-medium",children:[s.first_name[0],s.last_name[0]]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h3",{className:"font-medium text-gray-900",children:[s.first_name," ",s.last_name]}),x&&e.jsx(F,{className:"h-5 w-5 text-blue-600"})]}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),s.skills_json&&s.skills_json.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:s.skills_json.map(f=>e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${f===t.role_needed?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"}`,children:f},f))}),!i&&e.jsxs("div",{className:"mt-2 space-y-1",children:[!n&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-yellow-600",children:[e.jsx(h,{className:"h-3 w-3"})," Missing required skill: ",t.role_needed]}),!o&&t.required_certification&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-yellow-600",children:[e.jsx(h,{className:"h-3 w-3"})," Missing or expired certification: ",t.required_certification.name]})]})]})]})})},s.id)})})}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t bg-gray-50",children:[e.jsx("div",{className:"text-sm text-gray-500",children:d?e.jsxs("span",{children:["Selected: ",e.jsxs("strong",{children:[d.first_name," ",d.last_name]})]}):e.jsx("span",{children:"Select a worker to assign"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-white",children:"Cancel"}),e.jsx("button",{onClick:A,disabled:!d||j,className:"btn-green disabled:opacity-50 disabled:cursor-not-allowed",children:j?"Assigning...":"Assign Worker"})]})]})]})})}export{U as A,Z as F};
