import{c as Ze,j as e,X as Se,a as Y,A as De,b as as,C as rs}from"./index-C-n8NY-S.js";import{r as d,b as Ke,R as ls,f as ns}from"./vendor-79DyBOV9.js";import{f as is,a as Je,g as os}from"./dateUtils-DugSZKu1.js";import{s as ge,a as ke}from"./number-BA3fu1JD.js";import{c as Ee,C as Fe}from"./utils-D8k4yFQS.js";import{C as Me}from"./clock-Bhza7SrA.js";import{M as Te}from"./map-pin-CxnbLfr8.js";import{U as Ve}from"./users-DMrK-o4o.js";import{S as We,A as ds,L as cs,C as Re}from"./Avatar-CpY2YBP1.js";import{D as Ye}from"./dollar-sign-CzSWXWVd.js";import{T as He}from"./Toast-C784aQSR.js";import{C as Le}from"./x-circle-_HOnMIIy.js";import{b as ms,a as us,c as xs,e as hs,p as gs}from"./Prep Cook-li-JR_eG.js";import{P as Ge}from"./pen-square-XBkZf-Bb.js";import{P as qe}from"./plus-C-Lrg5lo.js";import{T as es}from"./trash-2-lxGVXoQf.js";import{f as be}from"./index-C_slYh2M.js";import{p as fe}from"./index-BK_MyBzW.js";import{C as ss}from"./chevron-down-DTXVCBI0.js";import{C as Ie}from"./chevron-right-Cab8k3vC.js";import{C as Pe}from"./calendar-Ds1WS-he.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=Ze("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=Ze("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),bs={sm:"max-w-md",md:"max-w-2xl",lg:"max-w-4xl",xl:"max-w-6xl"},ze=({isOpen:a,onClose:x,title:j,subtitle:P,children:l,footer:o,size:y="md",closeOnOverlayClick:m=!0})=>{if(d.useEffect(()=>(a?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[a]),d.useEffect(()=>{const A=X=>{X.key==="Escape"&&a&&x()};return document.addEventListener("keydown",A),()=>document.removeEventListener("keydown",A)},[a,x]),!a)return null;const T=A=>{A.target===A.currentTarget&&m&&x()};return e.jsx("div",{className:"modal-overlay",onClick:T,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:e.jsxs("div",{className:`modal-container ${bs[y]}`,children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{id:"modal-title",className:"text-xl font-semibold text-gray-900 font-manrope",children:j}),P&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:P})]}),e.jsx("button",{onClick:x,className:"p-1.5 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors","aria-label":"Close modal",children:e.jsx(Se,{size:20,className:"text-gray-600"})})]}),e.jsx("div",{className:"modal-body",children:l}),o&&e.jsx("div",{className:"modal-footer",children:o})]})})};function ys({shiftId:a,suggestedPayRate:x,onClose:j,onSuccess:P}){var i,E;const[l,o]=d.useState(null),[y,m]=d.useState([]),[T,A]=d.useState([]),[X,oe]=d.useState(""),[Z,le]=d.useState(null),[ne,g]=d.useState({}),[q,w]=d.useState(!0),[$,v]=d.useState(!1),[S,R]=d.useState(null),U=(n,N)=>{g(F=>({...F,[n]:N}))};d.useEffect(()=>{D()},[a]),d.useEffect(()=>{l&&G()},[l]),d.useEffect(()=>{if(!X)A(y);else{const n=X.toLowerCase();A(y.filter(N=>{var F;return N.first_name.toLowerCase().includes(n)||N.last_name.toLowerCase().includes(n)||N.email.toLowerCase().includes(n)||((F=N.skills_json)==null?void 0:F.some(O=>O.toLowerCase().includes(n)))}))}},[X,y]);async function D(){try{const n=await Y.get(`/shifts/${a}`);n.data.status==="success"?o(n.data.data):R("Failed to load shift details")}catch(n){console.error("Failed to load shift details:",n),R("Failed to load shift details")}}async function G(){var n;try{const N=new Set;if(l!=null&&l.event_id)try{const B=((n=(await Y.get(`/events/${l.event_id}`)).data)==null?void 0:n.data)||{};if(B.shifts_by_role){const M=B.shifts_by_role.find(f=>f.skill_name===l.role_needed||f.role_name===l.role_needed);M!=null&&M.shifts&&M.shifts.forEach(f=>{f.assignments&&f.assignments.forEach(r=>{var h;const c=r.worker_id||((h=r.worker)==null?void 0:h.id),_=r.status;c&&_!=="cancelled"&&_!=="no_show"&&N.add(c)})})}}catch(O){console.log("Could not fetch event to filter assigned workers:",O)}console.log(`AssignmentModal: Found ${N.size} already assigned workers for "${l==null?void 0:l.role_needed}"`);const F=await Y.get("/workers?active=true");if(F.data.status==="success"){const O=F.data.data.workers||F.data.data;if(l!=null&&l.role_needed){const B=O.filter(M=>{var f;return((f=M.skills_json)==null?void 0:f.includes(l.role_needed))&&!N.has(M.id)});console.log(`AssignmentModal: Showing ${B.length} eligible workers`),m(B)}else{const B=O.filter(M=>!N.has(M.id));m(B)}}else R("Failed to load workers")}catch(N){console.error("Failed to load workers:",N),R("Failed to load workers")}finally{w(!1)}}async function z(){var n,N,F,O,B,M;if(!(!Z||!l)){v(!0),R(null);try{const r=(await Y.post("/staffing",{assignment:{shift_id:l.id,worker_id:Z.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:ne[Z.id]||x||Number(l.pay_rate)||0}})).data;if(r.status==="success")P();else{let c=r.message||"Failed to assign worker";r.details&&r.details.length>0?c+=`

Details:
â€¢ `+r.details.join(`
â€¢ `):r.errors&&(c+=`

Details:
â€¢ `+r.errors.join(`
â€¢ `)),R(c)}}catch(f){console.error("Failed to assign worker:",f);let r="Failed to assign worker";if((N=(n=f.response)==null?void 0:n.data)!=null&&N.details&&f.response.data.details.length>0){const c=f.response.data.details.map(_=>(_.includes("conflicting shift"),_));r+=`

`+c.join(`
`)}else(O=(F=f.response)==null?void 0:F.data)!=null&&O.errors?r+=`

`+f.response.data.errors.join(`
`):(M=(B=f.response)==null?void 0:B.data)!=null&&M.message?r=f.response.data.message:f.message&&(r=f.message);R(r)}finally{v(!1)}}}if(q)return e.jsx(ze,{isOpen:!0,onClose:j,title:"Assign Worker",size:"lg",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-600"})})});const V=e.jsxs(e.Fragment,{children:[S&&e.jsxs("div",{className:"mb-4 p-3 bg-gradient-to-r from-red-50 to-amber-50 border-l-4 border-red-500 rounded-r-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsx("h4",{className:"text-sm font-semibold text-red-900",children:"âš ï¸ Scheduling Conflict Detected"})]}),e.jsx("p",{className:"text-xs text-gray-600 ml-8",children:"Please resolve the conflict before attempting to assign this worker"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:j,disabled:$,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:z,disabled:!Z||$||!!S,className:`btn-primary ${S?"opacity-50 cursor-not-allowed":""}`,title:S?"Cannot assign due to scheduling conflict":"",children:$?"Assigning Worker...":"Assign Worker"})]})]});return e.jsx(ze,{isOpen:!0,onClose:j,title:l?`${l.client_name} â€¢ ${l.role_needed}`:"Assign Worker",size:"xl",footer:V,children:e.jsxs("div",{className:"flex h-[600px]",children:[e.jsx("div",{className:"w-1/3 border-r border-gray-200 p-6 bg-gray-50",children:l?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Shift Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Me,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:is(l.start_time_utc)}),e.jsxs("div",{className:"text-sm text-gray-600",children:[Je(l.start_time_utc)," - ",Je(l.end_time_utc)]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Te,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"text-sm text-gray-900",children:l.location||((E=(i=l.event)==null?void 0:i.venue)==null?void 0:E.formatted_address)||"Location not specified"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ve,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900",children:l.role_needed}),l.required_skill&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Requires: ",l.required_skill]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Pay Rate:"})," $",(x||Number(l.pay_rate)||0).toFixed(2),"/hour"]}),l.uniform_name&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",l.uniform_name]})]}),l.notes&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Notes:"}),e.jsx("div",{className:"mt-1 whitespace-pre-line",children:l.notes.split("Uniform:").map((n,N)=>N===0?n.trim():e.jsxs("div",{children:[e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",n.trim()]},N))})]})})]})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(De,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Failed to load shift details"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(We,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search workers...",value:X,onChange:n=>oe(n.target.value),className:"w-full pl-9 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-teal-500 focus:border-teal-500"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:S?e.jsx("div",{className:"p-6 flex items-center justify-center h-full",children:e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 rounded-lg p-5 shadow-sm w-full max-w-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(De,{size:20,className:"text-red-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg font-semibold text-red-900 mb-1",children:"âš ï¸ Scheduling Conflict"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"This worker cannot be assigned due to a scheduling conflict"}),e.jsx("div",{className:"bg-white border border-red-200 rounded p-3 mt-3",children:e.jsx("div",{className:"text-sm text-red-800 font-mono",children:S.split(`
`).map((n,N)=>n.trim()===""?null:n.startsWith("â€¢")?e.jsxs("div",{className:"mt-1 flex items-start gap-2",children:[e.jsx("span",{className:"text-red-500",children:"â—"}),e.jsx("span",{className:"flex-1",children:n.replace("â€¢","").trim()})]},N):n.startsWith("Details:")?null:n.includes("conflicting shift")?e.jsx("div",{className:"mt-1 text-red-700 font-medium",children:n},N):e.jsx("div",{className:"text-gray-700",children:n},N))})})]})]})})}):T.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ve,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:X?"No workers found matching your search":l!=null&&l.role_needed?`No workers found with "${l.role_needed}" skill`:"No available workers"}),(l==null?void 0:l.role_needed)&&!X&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:['Try adding "',l.role_needed,'" skill to workers or select a different shift.']})]}):e.jsx("ul",{children:T.map(n=>{const N=(Z==null?void 0:Z.id)===n.id,F=x||Number(l.pay_rate)||0,O=ne[n.id]||F,B=ne[n.id]&&ne[n.id]!==F;return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${N?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[n.first_name[0],n.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[n.first_name," ",n.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(n.skills_json||[]).map((M,f)=>{const r=M===(l==null?void 0:l.role_needed);return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${r?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:M},f)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[B&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ye,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:(x||Number(l.pay_rate)||0).toString(),value:O||"",onChange:M=>{const f=M.target.value;(f===""||/^\d*\.?\d*$/.test(f))&&U(n.id,parseFloat(f)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:M=>M.stopPropagation(),onFocus:M=>M.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>le(n),className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${N?"bg-teal-600 text-white border-teal-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:N?"Selected":"Select"})]})]},n.id)})})})]})]})})}function js({isOpen:a,eventId:x,roleName:j,unfilledShiftIds:P,defaultPayRate:l,onClose:o,onDone:y}){const[m,T]=d.useState([]),[A,X]=d.useState([]),[oe,Z]=d.useState(""),[le,ne]=d.useState(!1),[g,q]=d.useState(!1),[w,$]=d.useState({}),[v,S]=d.useState(0),R=(i,E)=>{$(n=>({...n,[i]:E}))};d.useEffect(()=>{a&&(T([]),X([]),Z(""),$({}),ne(!0),(async()=>{var i,E;try{const N=((i=(await Y.get(`/events/${x}`)).data)==null?void 0:i.data)||{};console.log("QuickFill: Full event data:",JSON.stringify(N,null,2)),console.log("QuickFill: Looking for role:",j),console.log("QuickFill: shifts_by_role:",N.shifts_by_role);const F=new Set;if(N.shifts_by_role){const f=N.shifts_by_role.find(r=>(console.log("QuickFill: Checking role:",r.skill_name,r.role_name,"vs",j),r.skill_name===j||r.role_name===j));f?(console.log("QuickFill: Found role shifts:",f),f.shifts&&f.shifts.forEach(r=>{r.assignments&&(console.log("QuickFill: Shift has assignments:",r.assignments),r.assignments.forEach(c=>{var k;const _=c.worker_id||((k=c.worker)==null?void 0:k.id),h=c.status;_&&h!=="cancelled"&&(F.add(_),console.log("QuickFill: Adding worker_id to exclude:",_,"status:",h))}))})):console.log("QuickFill: No role shifts found for:",j)}console.log(`QuickFill: Found ${F.size} already assigned worker IDs:`,Array.from(F));const O=await Y.get("/workers?active=true"),M=(((E=O.data)==null?void 0:E.data)||O.data||[]).filter(f=>{const r=(f.skills_json||[]).includes(j),c=F.has(f.id);return c&&console.log(`QuickFill: Excluding ${f.first_name} ${f.last_name} (ID: ${f.id}) - already assigned`),r&&!c});if(console.log(`QuickFill: Found ${M.length} eligible workers for "${j}"`),console.log("QuickFill: Eligible workers:",M.map(f=>`${f.first_name} ${f.last_name}`)),T(M),l){const f=Number(l)||0;S(f),console.log(`QuickFill: Default pay rate for ${j}: $${f}/hr`)}else console.log(`QuickFill: No default pay rate provided for ${j}`)}catch(n){console.error("Error loading workers:",n)}finally{ne(!1)}})())},[a,x,j,l]);const U=d.useMemo(()=>{const i=oe.trim().toLowerCase(),E=m;return i?E.filter(n=>`${n.first_name} ${n.last_name}`.toLowerCase().includes(i)||(n.email||"").toLowerCase().includes(i)):E},[m,oe]),D=P.length,G=i=>{X(E=>E.includes(i)?E.filter(n=>n!==i):E.length>=D?E:[...E,i])},z=async()=>{var N,F,O,B,M,f,r,c,_,h,k,W,ae,xe,we;if(A.length===0||D===0)return;q(!0);let i=0,E=0;const n=[];try{const ye=A.map(K=>m.find(Ne=>Ne.id===K)).filter(Boolean),he=[...P];let je=0;for(;he.length>0&&ye.length>0;){const K=ye[je%ye.length],Ne=he.shift();try{const me=w[K.id]||Number(v)||0||0,pe=await Y.post("/staffing",{assignment:{shift_id:Ne,worker_id:K.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:me}});if(((N=pe.data)==null?void 0:N.status)==="success")i+=1;else{E+=1;const de=`${K.first_name} ${K.last_name}`,ve=((F=pe.data)==null?void 0:F.message)||((B=(O=pe.data)==null?void 0:O.error)==null?void 0:B.message)||((f=(M=pe.data)==null?void 0:M.errors)==null?void 0:f.join(", "))||"Unknown error";let te="Unable to assign";const t=String(ve).toLowerCase();t.includes("overlapping")||t.includes("conflict")?te="Has overlapping shift":t.includes("capacity")||t.includes("full")?te="Shift is full":t.includes("skill")||t.includes("certification")||t.includes("requirement")?te="Missing required skill":t.includes("status")?te="Cannot be assigned":te="Unable to assign",n.push(`${de}: ${te}`)}}catch(me){E+=1;const pe=`${K.first_name} ${K.last_name}`;let de="Unable to assign";const ve=((c=(r=me.response)==null?void 0:r.data)==null?void 0:c.message)||((k=(h=(_=me.response)==null?void 0:_.data)==null?void 0:h.error)==null?void 0:k.message)||((xe=(ae=(W=me.response)==null?void 0:W.data)==null?void 0:ae.errors)==null?void 0:xe.join(", "))||null;if(ve){const te=String(ve).toLowerCase();te.includes("overlapping")||te.includes("conflict")?de="Has overlapping shift":te.includes("capacity")||te.includes("full")?de="Shift is full":te.includes("skill")||te.includes("certification")||te.includes("requirement")?de="Missing required skill":te.includes("status")?de="Cannot be assigned":de="Unable to assign"}else((we=me.response)==null?void 0:we.status)===422?de="Unable to assign":me.message&&!me.message.includes("status code")&&(de=me.message);n.push(`${pe}: ${de}`)}je+=1}let _e="";E>0&&n.length>0&&(_e=n.join(", ")),y({assigned:i,conflicts:E,details:_e})}finally{q(!1)}};if(!a)return null;const V=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:o,disabled:g,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:z,disabled:g||A.length===0||D===0,className:"btn-primary",children:g?"Filling Shifts...":A.length===1?`Assign worker to ${D} shift${D!==1?"s":""}`:`Assign ${A.length} workers to ${D} shifts`})]});return e.jsxs(ze,{isOpen:a,onClose:o,title:`Quick Fill â€” ${j}`,subtitle:`Unfilled shifts: ${D}`,size:"lg",footer:V,children:[e.jsxs("div",{className:"relative",children:[e.jsx(We,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{value:oe,onChange:i=>Z(i.target.value),placeholder:"Search eligible workersâ€¦",className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsx("div",{className:"max-h-[340px] overflow-y-auto border border-gray-200 rounded-lg",children:le?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loadingâ€¦"}):U.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"No eligible workers"}):e.jsx("ul",{children:U.map(i=>{const E=A.includes(i.id);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${E?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[i.first_name[0],i.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[i.first_name," ",i.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(i.skills_json||[]).map((n,N)=>{const F=n===j;return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${F?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:n},N)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[w[i.id]&&w[i.id]!==(Number(v)||0)&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ye,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:Number(v)?(Number(v)||0).toString():"Rate",value:w[i.id]||Number(v)||0||"",onChange:n=>{const N=n.target.value;(N===""||/^\d*\.?\d*$/.test(N))&&R(i.id,parseFloat(N)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:n=>n.stopPropagation(),onFocus:n=>n.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>G(i.id),disabled:!E&&A.length>=D,className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${E?"bg-teal-600 text-white border-teal-600":A.length>=D?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:E?"Selected":"Select"})]})]},i.id)})})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(Le,{size:16,className:"text-teal-600"}),e.jsxs("span",{children:["Will assign ",e.jsx("strong",{children:A.length})," worker",A.length!==1?"s":""," to ",e.jsx("strong",{children:D})," shift",D!==1?"s":"","."]})]}),(Number(v)||0)>0&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Default rate for ",j,":"]}),e.jsxs("span",{className:"font-medium",children:["$",(Number(v)||0).toFixed(2),"/hr"]})]}),Object.keys(w).length>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["ðŸ’¡ Empty fields will use default rate ($",(Number(v)||0).toFixed(2),"/hr)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(as,{size:14,className:"text-yellow-600"}),"Conflicts and already-filled shifts will be skipped automatically."]})]})}function Ns({event:a,isOpen:x,onClose:j,onSuccess:P}){var M,f;const l=Ke(),[o,y]=d.useState(!1),[m,T]=d.useState([]),[A,X]=d.useState(!1),[oe,Z]=d.useState(!1),[le,ne]=d.useState(null),[g,q]=d.useState(null),[w,$]=d.useState({isVisible:!1,message:"",type:"error"}),[v,S]=d.useState(null),[R,U]=d.useState(!1);d.useEffect(()=>{x&&a.id&&D()},[x,a.id]);const D=async()=>{Z(!0);try{const r=await Y.get(`/events/${a.id}`);r.data.status==="success"&&ne(r.data.data)}catch(r){console.error("Failed to load full event details:",r),ne(a)}finally{Z(!1)}},G=()=>{j(),l(`/events/${a.id}/edit`)},z=[{name:"Bartender",icon:ms},{name:"Banquet Server/Runner",icon:us},{name:"Captain",icon:xs},{name:"Event Helper",icon:hs},{name:"Prep Cook",icon:gs}],V=le||a,i=le||a;d.useEffect(()=>{if(V){if(V.skill_requirements&&Array.isArray(V.skill_requirements)){const r=V.skill_requirements.map(c=>{var k,W;const _=(k=V.shifts_by_role)==null?void 0:k.find(ae=>(ae.skill_name||ae.role_name)===c.skill_name),h=((W=_==null?void 0:_.shifts)==null?void 0:W.length)||(_==null?void 0:_.total_shifts)||c.needed_workers||1;return{skill_name:c.skill_name,needed_workers:h,pay_rate:c.pay_rate||15,description:c.description||"",uniform_id:void 0,cert_id:void 0}});T(r)}else if(V.shifts_by_role&&Array.isArray(V.shifts_by_role)){const r=V.shifts_by_role.map(c=>{const _=c.shifts?c.shifts.length:c.total_shifts||1;return{skill_name:c.skill_name||c.role_name||"",needed_workers:_,pay_rate:c.pay_rate||15,description:"",uniform_id:void 0,cert_id:void 0}});T(r)}}},[V]),d.useEffect(()=>{const r=le||a;r!=null&&r.schedule&&S({start_time_utc:r.schedule.start_time_utc,end_time_utc:r.schedule.end_time_utc,break_minutes:r.schedule.break_minutes||0})},[le,a]);const E=(r,c,_)=>{if(r<0||r>=m.length)return;const h=[...m];h[r]={...h[r],[c]:_},T(h)},n=()=>{T([...m,{skill_name:"",needed_workers:1,pay_rate:15,description:"",uniform_id:void 0,cert_id:void 0}])},N=r=>{var _;if(r<0||r>=m.length)return;const c=m[r];if((c==null?void 0:c.needed_workers)>0){const h=(_=i==null?void 0:i.shifts_by_role)==null?void 0:_[r];if(((h==null?void 0:h.assigned_workers)||(h==null?void 0:h.filled_shifts)||0)>0){$({isVisible:!0,message:"Cannot remove role with assigned workers. Please unassign workers first.",type:"error"});return}}T(m.filter((h,k)=>k!==r))},F=(r,c)=>{if(r<0||r>=m.length)return;z.find(h=>h.name===c);const _=[...m];_[r]={..._[r],skill_name:c},T(_),q(null)},O=async()=>{var c,_,h;const r=le||a;if(r.schedule&&new Date(r.schedule.start_time_utc)<=new Date){$({isVisible:!0,message:"Cannot edit event that has already started",type:"error"});return}X(!0);try{const k=le||a,W=await Y.patch(`/events/${k.id}`,{event:{roles:m.map(ae=>({skill_name:ae.skill_name,needed:ae.needed_workers,pay_rate:ae.pay_rate,description:ae.description,uniform_id:ae.uniform_id,cert_id:ae.cert_id})),schedule:v?{start_time_utc:v.start_time_utc,end_time_utc:v.end_time_utc,break_minutes:v.break_minutes}:k.schedule?{start_time_utc:k.schedule.start_time_utc,end_time_utc:k.schedule.end_time_utc,break_minutes:k.schedule.break_minutes||0}:void 0}});W.data.status==="success"?($({isVisible:!0,message:W.data.message||"Event updated successfully",type:"success"}),P(),j()):$({isVisible:!0,message:W.data.message||"Failed to update event",type:"error"})}catch(k){console.error("Failed to update event:",k);const W=(c=k==null?void 0:k.response)==null?void 0:c.data;if((W==null?void 0:W.status)==="validation_error"&&((h=(_=W==null?void 0:W.data)==null?void 0:_.conflicts)!=null&&h.length)){const ae=W.data.conflicts.map(xe=>{const we=new Date(xe.conflicting_shift_start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),ye=new Date(xe.conflicting_shift_end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});return`${xe.worker_name} conflicts with ${xe.conflicting_event_title} (${we} â€“ ${ye})`});$({isVisible:!0,message:`Can't save changes: ${ae.length} worker${ae.length!==1?"s":""} would be double-booked
â€¢ `+ae.join(`
â€¢ `),type:"error"})}else $({isVisible:!0,message:(W==null?void 0:W.message)||"Failed to update event",type:"error"})}finally{X(!1)}},B=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:j,disabled:A,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:O,disabled:A,className:"btn-primary",children:A?"Saving...":"Save Changes"})]});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-0 sm:p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white w-full h-full sm:h-auto sm:max-w-4xl sm:rounded-lg shadow-xl overflow-hidden flex flex-col sm:max-h-[90vh]",children:[e.jsxs("div",{className:"sticky top-0 bg-white px-4 sm:px-6 py-4 border-b border-gray-200 flex items-center justify-between z-10",children:[e.jsxs("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-gray-900 truncate",children:["Edit Event: ",i.title]}),e.jsx("button",{onClick:j,className:"p-2 text-gray-400 hover:text-gray-600 min-h-touch min-w-touch","aria-label":"Close",children:e.jsx(Se,{className:"h-5 w-5 sm:h-6 sm:w-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 sm:px-6 py-4 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Event Details"}),e.jsxs("button",{onClick:G,className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-white border border-gray-300 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all shadow-sm",children:[e.jsx(Ge,{size:14}),"Edit"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Venue"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:(M=i.venue)==null?void 0:M.name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:i.schedule&&new Date(i.schedule.start_time_utc).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"space-y-1 md:col-span-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Location"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900 leading-relaxed",children:(f=i.venue)==null?void 0:f.formatted_address})]}),e.jsxs("div",{className:"space-y-1 md:col-start-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Time"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:i.schedule&&e.jsxs(e.Fragment,{children:[new Date(i.schedule.start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})," - ",new Date(i.schedule.end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})]})})]}),e.jsx("div",{})]})]}),e.jsxs("div",{className:"col-span-2 bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 uppercase tracking-wide",children:"Event Schedule"}),e.jsx("button",{type:"button",onClick:()=>U(!R),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:R?"Cancel":"Edit Schedule"})]}),R?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Start Time"}),e.jsx("input",{type:"datetime-local",value:v!=null&&v.start_time_utc?new Date(v.start_time_utc).toISOString().slice(0,16):"",onChange:r=>S(c=>c?{...c,start_time_utc:new Date(r.target.value).toISOString()}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"End Time"}),e.jsx("input",{type:"datetime-local",value:v!=null&&v.end_time_utc?new Date(v.end_time_utc).toISOString().slice(0,16):"",onChange:r=>S(c=>c?{...c,end_time_utc:new Date(r.target.value).toISOString()}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Break Minutes"}),e.jsx("input",{type:"number",min:"0",value:(v==null?void 0:v.break_minutes)||0,onChange:r=>S(c=>c?{...c,break_minutes:parseInt(r.target.value)||0}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3",children:e.jsx("p",{className:"text-xs text-blue-800",children:"âš ï¸ Changing schedule times will update ALL shifts and worker schedules for this event."})})]}):e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:i.schedule&&new Date(i.schedule.start_time_utc).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Time"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:v&&e.jsxs(e.Fragment,{children:[new Date(v.start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})," -",new Date(v.end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})]})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Break"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[(v==null?void 0:v.break_minutes)||0," minutes"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"Roles"}),e.jsxs("button",{onClick:n,className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white text-sm font-semibold rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(qe,{size:16}),"Add Role"]})]}),m.map((r,c)=>{var _;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[e.jsxs("div",{className:"flex-1 relative overflow-visible",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Role Name *"}),e.jsxs("div",{className:"relative",style:{zIndex:g===c?1e3:1},children:[e.jsxs("button",{type:"button",onClick:()=>q(g===c?null:c),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white text-left flex items-center justify-between",children:[r.skill_name?e.jsxs("div",{className:"flex items-center gap-2",children:[((_=z.find(h=>h.name===r.skill_name))==null?void 0:_.icon)&&e.jsx("img",{src:z.find(h=>h.name===r.skill_name).icon,alt:r.skill_name,className:"w-5 h-5"}),e.jsx("span",{className:"text-gray-900",children:r.skill_name})]}):e.jsx("span",{className:"text-gray-400",children:"Pick the Skills the Worker Has"}),e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M19 9l-7 7-7-7"})})]}),g===c&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border-2 border-gray-200 rounded-xl shadow-2xl z-[9999] max-h-[300px] overflow-y-auto w-full min-w-max",children:z.filter(h=>!m.some((k,W)=>W!==c&&k.skill_name===h.name)).map(h=>e.jsxs("div",{onClick:()=>F(c,h.name),className:"flex items-center gap-3 px-4 py-3 cursor-pointer hover:bg-teal-50 border-b border-gray-100 last:border-0",children:[e.jsx("img",{src:h.icon,width:"24",height:"24",alt:h.name,className:"flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:h.name})]},h.name))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Needed Workers *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>E(c,"needed_workers",Math.max(1,r.needed_workers-1)),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"-"}),e.jsx("input",{type:"number",value:r.needed_workers,onChange:h=>E(c,"needed_workers",parseInt(h.target.value)||1),min:"1",className:"w-16 px-2 py-2 border border-gray-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-teal-500 font-medium"}),e.jsx("button",{onClick:()=>E(c,"needed_workers",r.needed_workers+1),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"+"}),e.jsx("button",{onClick:()=>N(c),className:"ml-2 w-8 h-8 flex items-center justify-center text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove role",children:e.jsx(es,{size:18})})]})]})]}),(()=>{var W;const h=(W=i==null?void 0:i.shifts_by_role)==null?void 0:W[c],k=(h==null?void 0:h.assigned_workers)||(h==null?void 0:h.filled_shifts)||0;return k>0?e.jsxs("div",{className:"text-sm text-amber-600 font-semibold bg-amber-50 px-3 py-2 rounded-lg",children:[k," worker(s) assigned"]}):null})()]},c)})]})]}),e.jsx("div",{className:"sticky bottom-0 bg-white px-4 sm:px-6 py-4 border-t border-gray-200 flex flex-col sm:flex-row gap-3 sm:justify-end z-10",children:B})]})}),e.jsx(He,{isVisible:w.isVisible,message:w.message,type:w.type,onClose:()=>$({...w,isVisible:!1})})]})}function vs({event:a,isOpen:x,onClose:j,onSuccess:P}){var ee,re;const[l,o]=d.useState([]),[y,m]=d.useState(null),[T,A]=d.useState(!1),[X,oe]=d.useState(null),[Z,le]=d.useState(""),[ne,g]=d.useState(!1),[q,w]=d.useState(!1),[$,v]=d.useState({}),[S,R]=d.useState(!1),[U,D]=d.useState(new Set),[G,z]=d.useState({isVisible:!1,message:"",type:"success"}),[V,i]=d.useState({open:!1,title:"",variant:"default"}),[E,n]=d.useState(new Set),[N,F]=d.useState({});d.useEffect(()=>{x&&a&&(O(),D(new Set),n(new Set),F({}))},[x,a]);const O=async()=>{var s,b;if(a!=null&&a.id){A(!0);try{const u=await Y.get(`/events/${a.id}/approvals`),L=u.data.data.assignments||[],se=Array.from(new Map(L.map(Q=>[Q.id,Q])).values()),J=Array.from(new Map(se.map(Q=>[`${Q.shift_id}-${Q.worker_id}`,Q])).values()),ie=Array.from(new Map(J.sort((Q,Ce)=>Ce.id-Q.id).map(Q=>[`${Q.worker_id}-${Q.shift_role}-${Q.scheduled_start}-${Q.scheduled_end}`,Q])).values());console.log(`Loaded ${L.length} assignments, deduplicated to ${ie.length}`,{before:L.length,afterById:se.length,afterByShiftWorker:J.length,final:ie.length}),o(ie),m(u.data.data.cost_summary||null)}catch(u){console.error("Error loading assignments:",u),z({isVisible:!0,type:"error",message:((b=(s=u.response)==null?void 0:s.data)==null?void 0:b.error)||u.message||"Unable to load assignments for approval"}),o([]),m(null)}finally{A(!1)}}},B=s=>{n(b=>{const u=new Set(b);return u.has(s)?u.delete(s):u.add(s),u})},M=(s,b,u)=>{try{const L=new Date(s),ie=(new Date(b).getTime()-L.getTime())/(1e3*60*60),Q=u/60;return Math.max(0,ie-Q)}catch(L){return console.error("Error calculating hours:",L),0}},f=s=>{try{const b=new Date(s),u=b.getHours().toString().padStart(2,"0"),L=b.getMinutes().toString().padStart(2,"0");return`${u}:${L}`}catch(b){return console.error("Error formatting time:",b),"09:00"}},r=(s,b,u)=>{const L=l.find(Q=>Q.id===s);if(!L)return;const[se,J]=u.split(":").map(Number),ie=b==="timeIn"?new Date(L.scheduled_start):new Date(L.scheduled_end);ie.setHours(se,J,0,0),F(Q=>({...Q,[s]:{...Q[s],[b]:ie.toISOString()}}))},c=async(s,b)=>{var u,L,se;try{const J=l.find(ce=>ce.id===s);if(!J)return;const ie=b.timeIn||J.scheduled_start,Q=b.timeOut||J.scheduled_end,Ce=b.breakMinutes??(((u=a==null?void 0:a.schedule)==null?void 0:u.break_minutes)||0),$e={hours_worked:M(ie,Q,Ce)};b.hourlyRate!==void 0&&($e.hourly_rate=b.hourlyRate),b.notes!==void 0&&($e.approval_notes=b.notes),(await Y.patch(`/approvals/${s}/update_hours`,$e)).data&&(z({isVisible:!0,type:"success",message:"Changes saved successfully"}),await O(),F(ce=>{const Ae={...ce};return delete Ae[s],Ae}))}catch(J){console.error("Error saving changes:",J),z({isVisible:!0,type:"error",message:((se=(L=J.response)==null?void 0:L.data)==null?void 0:se.message)||"Failed to save changes"})}},_=s=>{i({open:!0,title:"Mark No-Show",message:`Mark ${s.worker_name} as no-show? This will set hours to 0.`,requireNote:!0,note:"",variant:"warning",onConfirm:async b=>{var L,se;const u=b||V.note||"";i({open:!1,title:""});try{await Y.post(`/approvals/${s.id}/mark_no_show`,{notes:u}),await O(),z({isVisible:!0,type:"success",message:"Marked as no-show"})}catch(J){console.error("Error marking no-show:",J),z({isVisible:!0,type:"error",message:((se=(L=J.response)==null?void 0:L.data)==null?void 0:se.message)||"Failed to mark no-show"})}}})},h=l.filter(s=>!s.approved&&s.can_approve&&s.status!=="no_show"&&s.status!=="cancelled"),k=h.filter(s=>U.has(s.id)),W=s=>{D(b=>{const u=new Set(b);return u.has(s)?u.delete(s):u.add(s),u})},ae=()=>{k.length===h.length&&h.length>0?D(new Set):D(new Set(h.map(s=>s.id)))},xe=async()=>{if(k.length===0){z({isVisible:!0,type:"error",message:"Please select at least one assignment to approve"});return}i({open:!0,title:"Approve Selected Hours",message:`Approve hours for ${k.length} selected ${k.length===1?"worker":"workers"}?`,onConfirm:async()=>{var s,b;R(!0);try{await Y.post(`/events/${a.id}/approve_selected`,{assignment_ids:Array.from(k.map(u=>u.id))}),await O(),D(new Set),P(),z({isVisible:!0,type:"success",message:`Approved ${k.length} ${k.length===1?"assignment":"assignments"}`})}catch(u){console.error("Error approving selected:",u),z({isVisible:!0,type:"error",message:((b=(s=u.response)==null?void 0:s.data)==null?void 0:b.message)||"Failed to approve selected hours"})}finally{R(!1),i({open:!1,title:""})}}})},we=async()=>{const s=h.length;i({open:!0,title:"Approve All Hours",message:`Approve hours for all ${s} eligible workers?`,onConfirm:async()=>{var b,u;R(!0);try{await Y.post(`/events/${a.id}/approve_all`),await O(),D(new Set),P(),z({isVisible:!0,type:"success",message:`Approved ${s} assignments`})}catch(L){console.error("Error approving all:",L),z({isVisible:!0,type:"error",message:((u=(b=L.response)==null?void 0:b.data)==null?void 0:u.message)||"Failed to approve all hours"})}finally{R(!1),i({open:!1,title:""})}}})};if(!x)return null;const ye=l,he=l.filter(s=>s.status!=="no_show"&&s.status!=="cancelled"&&s.status!=="removed"),je=l.filter(s=>s.status==="no_show"),_e=l.filter(s=>s.status==="cancelled"||s.status==="removed"),K=he.filter(s=>!s.approved).length,Ne=he.filter(s=>s.approved).length,me=he.length,pe=ye.length,de=he.filter(s=>!s.approved).reduce((s,b)=>s+Number(b.effective_pay||0),0),ve=he.filter(s=>s.approved).reduce((s,b)=>s+Number(b.effective_pay||0),0),te=de+ve,t=he.reduce((s,b)=>s+Number(b.effective_hours||0),0),p=he.filter(s=>s.approved).reduce((s,b)=>s+Number(b.effective_hours||0),0),C=s=>{if(!s)return"";try{return be(fe(s),"MMM d, yyyy")}catch{return new Date(s).toLocaleDateString()}},I=s=>s.status==="no_show"?e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:"No-Show"}):s.status==="cancelled"||s.status==="removed"?e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:"Denied"}):s.approved?e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Approved"}):e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-amber-100 text-amber-800",children:"Pending"});return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-0 sm:p-4 overflow-y-auto",children:[e.jsx(He,{isVisible:G.isVisible,message:G.message,type:G.type,onClose:()=>z({...G,isVisible:!1})}),e.jsxs("div",{className:"bg-white w-full h-full sm:h-auto sm:max-w-5xl sm:rounded-lg shadow-xl overflow-hidden flex flex-col sm:max-h-[90vh] my-0 sm:my-4",children:[e.jsx("header",{className:"border-b px-6 py-4 bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Approve Hours"}),e.jsxs("div",{className:"mt-1.5 flex flex-wrap items-center gap-3 text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium text-gray-900",children:a==null?void 0:a.title}),((ee=a==null?void 0:a.schedule)==null?void 0:ee.start_time_utc)&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Me,{className:"h-3.5 w-3.5 text-gray-400"}),be(fe(a.schedule.start_time_utc),"MMM d, yyyy h:mm a")," - ",be(fe(a.schedule.end_time_utc),"h:mm a")]}),((re=a==null?void 0:a.venue)==null?void 0:re.name)&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Te,{className:"h-3.5 w-3.5 text-gray-400"}),a.venue.name]})]})]}),e.jsx("button",{onClick:j,className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close modal",children:e.jsx(Se,{className:"h-5 w-5"})})]})}),K>0&&e.jsx("div",{className:"bg-amber-50 border-l-4 border-amber-400 px-6 py-3 flex-shrink-0",children:e.jsxs("p",{className:"text-sm text-amber-800 flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx("strong",{children:K})," ",K===1?"assignment":"assignments"," pending approval"]})}),e.jsx("div",{className:"flex-1 overflow-auto px-3 sm:px-6 py-4",children:T?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading assignments..."})]}):l.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(De,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No assignments found for this event."})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b border-gray-200 hidden sm:table-header-group",children:e.jsxs("tr",{className:"text-left",children:[e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider w-12 px-3",children:h.length>0&&e.jsx("input",{type:"checkbox",checked:k.length===h.length&&h.length>0,onChange:ae,className:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded cursor-pointer",title:k.length===h.length?"Deselect all":"Select all"})}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider w-[25%]",children:"Worker"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider w-[15%]",children:"Role"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider w-[18%]",children:"Time Worked"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right w-[10%]",children:"Hours"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right w-[10%]",children:"Rate"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right w-[12%]",children:"Total"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right w-[10%]",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:l.map(s=>{var $e;const b=E.has(s.id),u=N[s.id]||{},L=u.timeIn||s.scheduled_start,se=u.timeOut||s.scheduled_end,J=u.breakMinutes??((($e=a==null?void 0:a.schedule)==null?void 0:$e.break_minutes)||0),ie=u.hourlyRate??s.effective_hourly_rate,Q=s.status==="no_show"||s.status==="cancelled"||s.status==="removed"?0:u.timeIn||u.timeOut||u.breakMinutes!==void 0?M(L,se,J):s.effective_hours,Ce=(Q*ie).toFixed(2),Qe=!s.approved&&s.can_approve&&s.status!=="no_show"&&s.status!=="cancelled";return e.jsxs(ls.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>B(s.id),children:[e.jsx("td",{className:"py-4 px-3",children:Qe&&e.jsx("input",{type:"checkbox",checked:U.has(s.id),onChange:()=>W(s.id),className:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded cursor-pointer",onClick:H=>H.stopPropagation()})}),e.jsx("td",{className:"py-4 px-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"text-gray-400",onClick:H=>{H.stopPropagation(),B(s.id)},children:b?e.jsx(ss,{className:"h-5 w-5"}):e.jsx(Ie,{className:"h-5 w-5"})}),e.jsx(ds,{name:s.worker_name,src:s.worker_profile_photo_url,size:36}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:Ee("font-medium truncate",(s.status==="cancelled"||s.status==="removed")&&"line-through text-gray-500",s.status==="no_show"&&"text-gray-700",!s.status||s.status!=="no_show"&&s.status!=="cancelled"&&s.status!=="removed"&&"text-gray-900"),children:s.worker_name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.shift_role})]})]})}),e.jsx("td",{className:"py-4 px-3 text-sm text-gray-700",children:s.shift_role||"N/A"}),e.jsx("td",{className:"py-4 px-3",children:e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-gray-700",children:[e.jsx(Me,{className:"h-3.5 w-3.5 text-gray-400"}),e.jsxs("span",{children:[f(L)," - ",f(se)]})]})}),e.jsxs("td",{className:"py-4 px-3 text-sm font-medium text-right",children:[ge(Q,2,"0.00"),"h"]}),e.jsxs("td",{className:"py-4 px-3 text-sm text-right text-gray-600",children:["$",ge(ie,2,"0.00")]}),e.jsxs("td",{className:"py-4 px-3 text-sm font-semibold text-right text-gray-900",children:["$",Ce]}),e.jsx("td",{className:"py-4 px-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[I(s),s.approved&&e.jsx(Le,{className:"h-5 w-5 text-green-600"})]})})]}),b&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"p-0",children:e.jsx("div",{className:"px-4 pb-4 bg-gray-50 border-t border-gray-200",children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-4 pt-4",children:[e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),e.jsx("div",{className:"text-sm text-gray-900",children:C(s.shift_date||s.scheduled_start)})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Time In"}),e.jsx("input",{type:"time",value:f(L),onChange:H=>r(s.id,"timeIn",H.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-teal-500 focus:border-transparent",onClick:H=>H.stopPropagation()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Time Out"}),e.jsx("input",{type:"time",value:f(se),onChange:H=>r(s.id,"timeOut",H.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-teal-500 focus:border-transparent",onClick:H=>H.stopPropagation()})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Less Break (minutes)"}),e.jsx("input",{type:"number",min:"0",step:"15",value:J,onChange:H=>F(ce=>({...ce,[s.id]:{...ce[s.id],breakMinutes:parseInt(H.target.value)||0}})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-teal-500 focus:border-transparent",onClick:H=>H.stopPropagation()}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[(J/60).toFixed(2)," hours"]})]})}),e.jsx("div",{className:"border-t border-gray-300 pt-4",children:e.jsxs("div",{className:"flex justify-between items-center text-lg font-semibold",children:[e.jsx("span",{className:"text-gray-700",children:"Total Hours:"}),e.jsxs("span",{className:"text-gray-900",children:[ge(Q,2,"0.00")," hours"]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hourly Rate"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2 text-gray-500",children:"$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:ie,onChange:H=>F(ce=>({...ce,[s.id]:{...ce[s.id],hourlyRate:parseFloat(H.target.value)||0}})),className:"w-full pl-7 pr-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-teal-500 focus:border-transparent",onClick:H=>H.stopPropagation()})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Total Pay"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900 pt-2",children:["$",Ce]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("div",{className:"flex items-center gap-2",children:[I(s),s.approved&&s.approved_by_name&&e.jsxs("span",{className:"text-sm text-green-600 flex items-center gap-1",children:[e.jsx(Le,{className:"h-4 w-4"}),"Approved by ",s.approved_by_name.split("@")[0]]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{rows:2,value:u.notes??s.approval_notes??"",onChange:H=>F(ce=>({...ce,[s.id]:{...ce[s.id],notes:H.target.value}})),placeholder:"Add notes about this shift...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-teal-500 focus:border-transparent",onClick:H=>H.stopPropagation()})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-300",children:[!s.approved&&s.can_approve&&e.jsxs("button",{onClick:async H=>{var ce,Ae;H.stopPropagation();try{await Y.post(`/events/${a.id}/approve_selected`,{assignment_ids:[s.id]}),await O(),P(),z({isVisible:!0,type:"success",message:"Assignment approved"})}catch(Be){console.error("Error approving assignment:",Be),z({isVisible:!0,type:"error",message:((Ae=(ce=Be.response)==null?void 0:ce.data)==null?void 0:Ae.message)||"Failed to approve assignment"})}},className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 font-medium flex items-center justify-center gap-2",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Approve"]}),s.status!=="no_show"&&e.jsxs("button",{onClick:H=>{H.stopPropagation(),_(s)},className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 font-medium flex items-center justify-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),"Mark No-Show"]}),Object.keys(u).length>0&&e.jsx("button",{onClick:H=>{H.stopPropagation(),c(s.id,u)},className:"flex-1 px-4 py-2 bg-teal-600 text-white rounded-md hover:bg-teal-700 font-medium",children:"Save Changes"})]})]})})})})]},s.id)})})]})}),e.jsxs("footer",{className:"border-t bg-gray-50 px-3 sm:px-6 py-4 flex-shrink-0",children:[(je.length>0||_e.length>0)&&e.jsxs("div",{className:"mb-4 grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4 text-sm border-b border-gray-200 pb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"Total Assigned"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:pe})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"Approved"}),e.jsx("div",{className:"text-base font-semibold text-green-600",children:Ne})]}),je.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"No-Shows"}),e.jsx("div",{className:"text-base font-semibold text-red-600",children:je.length})]}),_e.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"Denied"}),e.jsx("div",{className:"text-base font-semibold text-gray-500",children:_e.length})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-600",children:K===0?"Final approved cost:":"Total cost:"}),e.jsxs("span",{className:"ml-2 text-lg font-bold text-gray-900",children:["$",ge(K===0?ve:te,2,"0.00")]}),e.jsxs("span",{className:"ml-1 text-gray-600",children:["(",K===0?Ne:me," ",K===0?Ne===1?"worker":"workers":me===1?"worker":"workers",", ",ge(K===0?p:t,2,"0.00"),"h)"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:j,className:"px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 transition-colors",children:"Close"}),K>0&&e.jsx("button",{onClick:()=>{k.length>0?xe():we()},disabled:S||k.length===0&&K===0,className:Ee("px-5 py-2.5 text-white text-sm font-semibold rounded-lg shadow-sm flex items-center gap-2 transition-colors",k.length>0||K>0?"bg-green-600 hover:bg-green-700 disabled:bg-green-400":"bg-gray-400 cursor-not-allowed"),children:S?e.jsxs(e.Fragment,{children:[e.jsx(cs,{className:"h-4 w-4 animate-spin"}),"Approving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"h-4 w-4"}),k.length>0?`Approve Selected (${k.length})`:`Approve All (${K})`]})})]})]})]})]}),V.open&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>i({open:!1,title:""})}),e.jsxs("div",{className:"relative bg-white w-full max-w-md rounded-lg shadow-xl p-5",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:V.title}),V.message&&e.jsx("p",{className:"mt-2 text-sm text-gray-700",children:V.message}),V.requireNote&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes (optional)"}),e.jsx("textarea",{value:V.note||"",onChange:s=>i(b=>({...b,note:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]}),e.jsxs("div",{className:"mt-5 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>i({open:!1,title:""}),className:"px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-200",children:"Cancel"}),e.jsx("button",{onClick:async()=>{const s=V.note||"";V.onConfirm&&await V.onConfirm(s)},className:"px-4 py-2 text-white text-sm font-medium rounded-md "+(V.variant==="danger"?"bg-red-600 hover:bg-red-700":V.variant==="warning"?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:"Confirm"})]})]})]})]})}function ue({className:a="",count:x=1}){return e.jsx(e.Fragment,{children:Array.from({length:x}).map((j,P)=>e.jsx("div",{className:`animate-pulse bg-gray-200 rounded-lg ${a}`},P))})}function Oe(){return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(ue,{className:"h-6 w-48 mb-2"}),e.jsx(ue,{className:"h-4 w-32"})]}),e.jsx(ue,{className:"h-8 w-8 rounded-full"})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4 rounded"}),e.jsx(ue,{className:"h-4 w-40"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4 rounded"}),e.jsx(ue,{className:"h-4 w-36"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4 rounded"}),e.jsx(ue,{className:"h-4 w-32"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(ue,{className:"h-2 w-full rounded-full mb-2"}),e.jsx(ue,{className:"h-3 w-24"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ue,{className:"h-9 w-24 rounded-md"}),e.jsx(ue,{className:"h-9 w-24 rounded-md"})]})]})})}function ws(a,x=500){const[j,P]=d.useState(a);return d.useEffect(()=>{const l=setTimeout(()=>{P(a)},x);return()=>{clearTimeout(l)}},[a,x]),j}const Xe=a=>{var l,o;if(a.cost_summary){const{all_approved:y,total_count:m=0,pending_count:T=0}=a.cost_summary,A=m>0||(a.assigned_workers_count??0)>0;if(typeof y=="boolean"&&y||T===0&&A)return!0}if(a.approval_status){const{total:y=0,pending:m=0}=a.approval_status,T=y>0||(((l=a.cost_summary)==null?void 0:l.total_count)??0)>0||(a.assigned_workers_count??0)>0;if(m===0&&T)return!0}const x=((o=a.shifts_by_role)==null?void 0:o.flatMap(y=>y.shifts||[]))||[];if(!(Array.isArray(x)&&x.length>0))return!1;const P=x.flatMap(y=>y.assignments||[]);return P.length===0?!1:P.every(y=>y.approved===!0||y.status==="no_show"||y.status==="cancelled"||y.status==="removed"||y.status==="denied"||y.denied===!0)},_s=a=>{var P,l,o;if(((P=a.approval_status)==null?void 0:P.pending)!==void 0)return a.approval_status.pending;if(((l=a.cost_summary)==null?void 0:l.pending_count)!==void 0)return a.cost_summary.pending_count;const x=((o=a.shifts_by_role)==null?void 0:o.flatMap(y=>y.shifts||[]))||[];if(x.length===0)return 0;const j=x.flatMap(y=>y.assignments||[]);return j.length===0?0:j.filter(y=>!(y.approved===!0||y.status==="no_show"||y.status==="cancelled"||y.status==="removed"||y.status==="denied"||y.denied===!0)).length},Ue=a=>{const x=a.schedule||a.event_schedule||{},j=x.start_time_utc||x.start_time||a.start_time_utc,P=x.end_time_utc||x.end_time||a.end_time_utc;return{start:j,end:P}},ts=(a,x=new Date)=>{const{end:j}=Ue(a);if(!j)return!1;try{const P=new Date(j);return isNaN(P.getTime())?!1:P<x}catch{return console.warn("Invalid end time for event:",a.id,j),!1}},ks=a=>a.status==="published"&&!ts(a),Ss=a=>a.status==="archived"||a.status==="completed"||a.status==="published"&&ts(a);function Ks(){const a=Ke(),[x,j]=ns(),P=(x.get("tab")==="completed"?"completed":x.get("tab"))||"active",l=x.get("filter")||"all",[o,y]=d.useState(P),[m,T]=d.useState(l),[A,X]=d.useState(""),oe=ws(A,500),[Z,le]=d.useState("date"),[ne,g]=d.useState(!0),[q,w]=d.useState([]),[$,v]=d.useState(new Set),[S,R]=d.useState(new Set),[U,D]=d.useState({isOpen:!1}),[G,z]=d.useState({isOpen:!1}),[V,i]=d.useState({isVisible:!1,message:"",type:"success"}),[E,n]=d.useState({isOpen:!1,isLoading:!1}),[N,F]=d.useState({isOpen:!1,isLoading:!1}),[O,B]=d.useState({isOpen:!1,isLoading:!1}),[M,f]=d.useState({isOpen:!1,unfilledShiftIds:[]}),[r,c]=d.useState({isOpen:!1});d.useEffect(()=>{_()},[o,m,x]),d.useEffect(()=>{const t=(x.get("tab")==="completed"?"completed":x.get("tab"))||"active",p=x.get("filter")||"all";t!==o&&y(t),p!==m&&T(p)},[x,o,m]),d.useEffect(()=>{const t=x.get("event_id"),p=x.get("shift_id");if(t){const C=parseInt(t);isNaN(C)||(v(new Set([C])),p&&console.log(`Auto-expanding event ${C} with shift ${p}`))}},[x]),d.useEffect(()=>{const t=x.get("event_id");if(!t)return;const p=parseInt(t);if(isNaN(p))return;const C=q.find(I=>I.id===p);C&&(!C.shifts_by_role||C.shifts_by_role.length===0)&&(W(p),v(new Set([p])))},[x,q]);async function _(){g(!0);try{const t=o==="completed"?"completed":o,p=x.get("date");let C=`/events?tab=${t}`;m!=="all"&&(o==="active"||o==="draft")&&(C+=`&filter=${m}`),p&&(C+=`&date=${p}`),console.log("Loading events with URL:",C,"filterStatus:",m,"date:",p);const I=await Y.get(C);if(I.data.status==="success"){console.log("Received events:",I.data.data.length);const ee=I.data.data;if(o==="completed"){const re=await Promise.all(ee.map(async s=>{var b;try{const u=await Y.get(`/events/${s.id}/approvals`);if(((b=u.data)==null?void 0:b.status)==="success"){const L=u.data.data.assignments||[],se=L.length,J=L.filter(Q=>Q.approved).length,ie=u.data.data.cost_summary||null;return{...s,approval_status:{total:se,approved:J,pending:se-J},cost_summary:ie}}}catch(u){console.warn(`Failed to load approval status for event ${s.id}:`,u)}return s}));w(re)}else{const re=Array.from($);w(s=>{const b=new Map(s.map(u=>[u.id,u]));return ee.map(u=>{const L=b.get(u.id);return re.includes(u.id)&&(L!=null&&L.shifts_by_role)&&L.shifts_by_role.length>0?{...u,shifts_by_role:L.shifts_by_role,full_details:L.full_details||L}:u})}),re.length>0&&Promise.all(re.map(s=>W(s))).catch(s=>{console.error("Failed to refresh expanded event details:",s)})}}}catch(t){console.error("Failed to load events:",t),q.length===0&&w([])}finally{g(!1)}}const h=t=>{y(t),j({tab:t}),T(t==="active"?"needs_workers":"all")},k=t=>{T(t);const p=new URLSearchParams;p.set("tab",o),t!=="all"&&p.set("filter",t),j(p)},W=async t=>{var p,C;R(I=>new Set(I).add(t));try{const[I,ee]=await Promise.all([Y.get(`/events/${t}`),Y.get(`/events/${t}/approvals`).catch(()=>null)]);if(((p=I.data)==null?void 0:p.status)==="success"){const re=I.data.data;if(((C=ee==null?void 0:ee.data)==null?void 0:C.status)==="success"){const s=ee.data.data.assignments||[],b=new Map(s.map(u=>[u.id,u]));re.shifts_by_role&&(re.shifts_by_role=re.shifts_by_role.map(u=>({...u,shifts:u.shifts.map(L=>({...L,assignments:L.assignments.map(se=>{const J=b.get(se.id);return J&&typeof J=="object"?{...se,...J}:se})}))})))}w(s=>s.map(b=>b.id===t?{...b,...re}:b))}}catch(I){console.error("Failed to load event details",I)}finally{R(I=>{const ee=new Set(I);return ee.delete(t),ee})}},ae=t=>{const p=new Set($);if(p.has(t))p.delete(t),R(C=>{const I=new Set(C);return I.delete(t),I});else{p.add(t);const C=q.find(re=>re.id===t),I=S.has(t),ee=(C==null?void 0:C.shifts_by_role)&&C.shifts_by_role.length>0;!I&&!ee&&W(t)}v(p)};async function xe(t){const p=q==null?void 0:q.find(C=>C.id===t);B({isOpen:!0,isLoading:!1,eventId:t,eventTitle:p==null?void 0:p.title})}async function we(){if(O.eventId){B(t=>({...t,isLoading:!0}));try{const t=await Y.delete(`/events/${O.eventId}`);t.data.status==="success"?(B({isOpen:!1,isLoading:!1}),i({isVisible:!0,message:`"${t.data.event_title}" moved to trash`,type:"success",action:{label:"Undo",onClick:()=>ye(t.data.event_id),variant:"primary"}}),_()):i({isVisible:!0,message:t.data.message||"Unable to delete event",type:"error"})}catch(t){console.error("Failed to delete event:",t),i({isVisible:!0,message:"Unable to delete event",type:"error"})}finally{B(t=>({...t,isLoading:!1}))}}}async function ye(t){try{const p=await Y.post(`/events/${t}/restore`);p.data.status==="success"?(i({isVisible:!0,message:"Event restored to draft",type:"success"}),_()):i({isVisible:!0,message:p.data.message||"Unable to restore event",type:"error"})}catch(p){console.error("Failed to restore event:",p),i({isVisible:!0,message:"Unable to restore event",type:"error"})}}function he(){B({isOpen:!1,isLoading:!1})}function je(t){n({isOpen:!0,eventId:t,isLoading:!1})}async function _e(){if(E.eventId){n(t=>({...t,isLoading:!0}));try{const t=await Y.post(`/events/${E.eventId}/publish`);t.data.status==="success"?(i({isVisible:!0,message:"Event published successfully",type:"success"}),n({isOpen:!1,isLoading:!1}),_()):(i({isVisible:!0,message:t.data.message||"Unable to publish event",type:"error"}),n({isOpen:!1,isLoading:!1}))}catch(t){console.error("Failed to publish event:",t),i({isVisible:!0,message:"Unable to publish event",type:"error"}),n({isOpen:!1,isLoading:!1})}}}function K(){n({isOpen:!1,isLoading:!1})}function Ne(t,p){F({isOpen:!0,assignmentId:t,isLoading:!1,workerName:p})}async function me(){var t,p;if(N.assignmentId){F(C=>({...C,isLoading:!0}));try{const C=await Y.delete(`/staffing/${N.assignmentId}`);((t=C.data)==null?void 0:t.status)==="success"?(i({isVisible:!0,message:"Worker unassigned successfully",type:"success"}),F({isOpen:!1,isLoading:!1}),_()):(i({isVisible:!0,message:((p=C.data)==null?void 0:p.message)||"Unable to unassign worker",type:"error"}),F({isOpen:!1,isLoading:!1}))}catch(C){console.error("Failed to unassign worker:",C),i({isVisible:!0,message:"Unable to unassign worker",type:"error"}),F({isOpen:!1,isLoading:!1})}}}const pe=(t,p)=>{z({isOpen:!0,shiftId:t,suggestedPayRate:p})},de=()=>{z({isOpen:!1})},ve=()=>{de(),i({isVisible:!0,message:"Worker assigned",type:"success"}),_()},te=d.useMemo(()=>q.filter(t=>{var p,C,I;if(oe){const ee=oe.toLowerCase();if(!(((p=t.title)==null?void 0:p.toLowerCase().includes(ee))||((I=(C=t.venue)==null?void 0:C.name)==null?void 0:I.toLowerCase().includes(ee))))return!1}if(o==="active"){if(!ks(t))return!1;if(m&&m!=="all")switch(m){case"needs_workers":return t.unfilled_roles_count>0;case"partially_filled":return t.unfilled_roles_count>0&&t.assigned_workers_count>0;case"fully_staffed":return t.unfilled_roles_count===0&&t.assigned_workers_count>0;default:return!0}}return!(o==="completed"&&!Ss(t))}).sort((t,p)=>{switch(Z){case"name":return t.title.localeCompare(p.title);case"staffing":return t.staffing_percentage-p.staffing_percentage;case"date":default:const C=Ue(t),I=Ue(p),ee=C.start||C.end||t.created_at,re=I.start||I.end||p.created_at;return!ee&&!re?0:ee?re?new Date(ee).getTime()-new Date(re).getTime():-1:1}}),[q,o,m,oe,Z]);return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold text-gray-900",children:"Events"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage events and assign workers"})]}),e.jsxs("button",{onClick:()=>a("/events/create"),className:"w-full sm:w-auto inline-flex items-center justify-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors shadow-sm min-h-touch",children:[e.jsx(qe,{size:20}),"Create New Event"]})]}),x.get("date")&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-teal-50 border border-teal-200 rounded-lg",children:[e.jsx(Pe,{size:16,className:"text-teal-600"}),e.jsxs("span",{className:"text-sm font-medium text-teal-900",children:["Showing events for ",be(fe(x.get("date")),"EEEE, MMMM d, yyyy")]}),e.jsx("button",{onClick:()=>{const t=new URLSearchParams(x);t.delete("date"),j(t)},className:"ml-auto text-teal-600 hover:text-teal-700",title:"Clear date filter",children:e.jsx(Se,{size:16})})]})]}),e.jsxs("div",{className:"flex gap-6 border-b border-gray-200 mb-6",children:[e.jsx("button",{onClick:()=>h("draft"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${o==="draft"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Draft Events"}),e.jsx("button",{onClick:()=>h("active"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${o==="active"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Active Events"}),e.jsx("button",{onClick:()=>h("completed"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${o==="completed"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Completed Events"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-3 sm:gap-4 mb-6",children:[e.jsxs("div",{className:"w-full md:flex-1 md:max-w-md relative",children:[e.jsx(We,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search events or venues...",value:A,onChange:t=>X(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),e.jsxs("select",{value:Z,onChange:t=>le(t.target.value),className:"w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"name",children:"Sort by Name"}),o!=="draft"&&e.jsx("option",{value:"staffing",children:"Sort by Staffing"})]}),o==="active"&&e.jsxs("div",{className:"w-full sm:w-auto flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>k("all"),className:`w-full sm:w-auto px-3 py-2 text-sm font-medium rounded-lg transition ${m==="all"?"bg-gray-100 text-gray-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"All"}),e.jsx("button",{onClick:()=>k("needs_workers"),className:`w-full sm:w-auto px-3 py-2 text-sm font-medium rounded-lg transition ${m==="needs_workers"?"bg-red-100 text-red-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Needs Workers"}),e.jsx("button",{onClick:()=>k("fully_staffed"),className:`w-full sm:w-auto px-3 py-2 text-sm font-medium rounded-lg transition ${m==="fully_staffed"?"bg-green-100 text-green-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Ready"})]})]}),ne?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Oe,{}),e.jsx(Oe,{}),e.jsx(Oe,{})]}):e.jsxs(e.Fragment,{children:[o==="draft"&&e.jsx(Cs,{events:te,onDelete:xe,onPublish:je,onNavigate:t=>a(t),searchQuery:A}),o==="active"&&e.jsx($s,{events:te,expandedEvents:$,loadingEventDetails:S,onToggleEvent:ae,onAssignWorker:pe,onUnassign:Ne,onQuickFill:(t,p,C,I)=>f({isOpen:!0,eventId:t,roleName:p,unfilledShiftIds:C,payRate:I}),onPublish:je,onDelete:xe,onEdit:t=>c({isOpen:!0,event:t}),searchQuery:A}),o==="completed"&&e.jsx(Es,{events:te,searchQuery:A,onApproveHours:t=>D({isOpen:!0,event:t})})]})]}),G.isOpen&&G.shiftId&&e.jsx(ys,{shiftId:G.shiftId,suggestedPayRate:G.suggestedPayRate,onClose:de,onSuccess:ve}),e.jsx(He,{isVisible:V.isVisible,message:V.message,type:V.type,action:V.action,onClose:()=>i({...V,isVisible:!1})}),e.jsx(Re,{isOpen:E.isOpen,onClose:K,onConfirm:_e,title:"Publish Event",message:"Ready to publish? This will create shifts and make them available for worker assignment.",confirmText:E.isLoading?"Publishingâ€¦":"Publish",cancelText:"Cancel",isLoading:E.isLoading,isDestructive:!1}),e.jsx(Re,{isOpen:N.isOpen,onClose:()=>F({isOpen:!1,isLoading:!1}),onConfirm:me,title:"Unassign Worker",message:`Remove ${N.workerName||"this worker"} from this shift?`,confirmText:N.isLoading?"Removingâ€¦":"Unassign",cancelText:"Cancel",isLoading:N.isLoading,isDestructive:!0}),e.jsx(Re,{isOpen:O.isOpen,onClose:he,onConfirm:we,title:"Delete Event",message:`Delete "${O.eventTitle}"? This action cannot be undone.`,confirmText:O.isLoading?"Deletingâ€¦":"Delete",cancelText:"Cancel",isLoading:O.isLoading,isDestructive:!0}),e.jsx(js,{isOpen:M.isOpen,eventId:M.eventId||0,roleName:M.roleName||"",unfilledShiftIds:M.unfilledShiftIds,defaultPayRate:M.payRate,onClose:()=>f({isOpen:!1,unfilledShiftIds:[]}),onDone:({assigned:t,conflicts:p,details:C})=>{f({isOpen:!1,unfilledShiftIds:[]});let I=`Assigned ${t} workers â€¢ ${p} skipped`;p>0&&C&&(I+=`: ${C}`),i({isVisible:!0,message:I,type:p>0?"error":"success"}),_()}}),r.event&&e.jsx(Ns,{event:r.event,isOpen:r.isOpen,onClose:()=>c({isOpen:!1,event:void 0}),onSuccess:()=>{_(),c({isOpen:!1,event:void 0})}}),U.isOpen&&U.event&&e.jsx(vs,{event:U.event,isOpen:U.isOpen,onClose:()=>{D({isOpen:!1}),_()},onSuccess:()=>{_(),D({isOpen:!1})}})]})}function Cs({events:a,onDelete:x,onPublish:j,onNavigate:P,searchQuery:l}){const o=m=>{if(!m)return"No date set";const T=fe(m);return be(T,"MMM d, yyyy")},y=m=>{if(!m)return"";const T=fe(m);return be(T,"h:mm a")};return a.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:l?"No draft events found":"No draft events yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:l?"Try adjusting your search query":"Create your first event to get started"}),!l&&e.jsxs("button",{onClick:()=>P("/events/create"),className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:[e.jsx(qe,{size:20}),"Create Event"]})]}):e.jsx("div",{className:"space-y-4",children:a.map(m=>{var T;return e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[m.title,m.schedule&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-600",children:["â€¢ ",y(m.schedule.start_time_utc),"â€“",y(m.schedule.end_time_utc)]})]})}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Draft"})]}),m.venue&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[e.jsx(Te,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:((T=m.venue)==null?void 0:T.name)||"No venue"})]}),m.schedule&&e.jsx("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{children:o(m.schedule.start_time_utc)})]})}),m.total_workers_needed>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Ve,{size:16,className:"text-gray-400"}),e.jsxs("span",{children:[m.total_workers_needed," workers needed"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>P(`/events/${m.id}/edit`),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Edit",children:e.jsx(Ge,{size:18})})})]})})},m.id)})})}function $s({events:a,expandedEvents:x,loadingEventDetails:j,onToggleEvent:P,onAssignWorker:l,onUnassign:o,onQuickFill:y,onPublish:m,onDelete:T,onEdit:A,searchQuery:X}){const oe=g=>{const q=fe(g);return be(q,"EEE, MMM d, yyyy")},Z=g=>{const q=fe(g);return be(q,"h:mm a")},le=g=>{if(!g.schedule)return!1;const w=(fe(g.schedule.start_time_utc).getTime()-new Date().getTime())/(1e3*60*60);return w>0&&w<=48},ne=g=>{switch(g){case"fully_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[e.jsx(Fe,{size:14}),"Ready"]});case"partially_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full",children:[e.jsx(De,{size:14}),"Partial"]});case"needs_workers":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[e.jsx(Se,{size:14}),"Needs Workers"]});default:return null}};return a.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:X?"No active events found":"No active events"}),e.jsx("p",{className:"text-gray-600",children:X?"Try adjusting your search query or filters":"Publish draft events to see them here"})]}):e.jsx("div",{className:"space-y-4",children:a.map(g=>{const q=x.has(g.id);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-5 hover:border-gray-300 hover:shadow-sm transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1 truncate",children:g.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 flex-wrap",children:[g.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"h-4 w-4 flex-shrink-0"}),oe(g.schedule.start_time_utc)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Me,{className:"h-4 w-4 flex-shrink-0"}),Z(g.schedule.start_time_utc)," - ",Z(g.schedule.end_time_utc),le(g)&&e.jsxs("span",{className:"bg-red-50 text-red-800 text-xs font-bold px-2.5 py-1 rounded-full ml-2 inline-flex items-center gap-1.5","aria-label":"Urgent: starts within 48 hours",children:[e.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full"}),"URGENT"]})]})]}),g.venue&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Te,{className:"h-4 w-4 flex-shrink-0"}),g.venue.name]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 ml-4",children:[ne(g.staffing_status),A&&g.status==="published"&&e.jsx("button",{onClick:w=>{w.stopPropagation(),A(g)},title:"Edit Event",className:"p-1.5 text-teal-600 hover:text-teal-700 hover:bg-teal-50 rounded transition-colors",children:e.jsx(ps,{size:14})}),T&&e.jsx("button",{onClick:w=>{w.stopPropagation(),T(g.id)},title:"Delete",className:"p-1.5 text-red-600 hover:text-red-700 hover:bg-red-50 rounded transition-colors",children:e.jsx(es,{size:14})}),e.jsx("button",{onClick:()=>P(g.id),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:q?e.jsx(rs,{size:20,className:"text-gray-600"}):e.jsx(ss,{size:20,className:"text-gray-600"})})]})]}),e.jsx("div",{className:"py-3 border-y border-gray-100 space-y-2",children:(()=>{const w=g.assigned_workers_count||0,$=g.total_workers_needed||0,v=$>0?Math.round(w/$*100):0;g.unfilled_roles_count;const S=(()=>{if(g.shifts_by_role&&g.shifts_by_role.length>0){const D=g.shifts_by_role.length,G=g.shifts_by_role.filter(z=>{var i;return(i=z.shifts)==null?void 0:i.some(E=>E.assignments&&E.assignments.length>0)}).length;return{totalRoles:D,filledRoles:G}}return null})(),R=(()=>{const D=g.estimated_cost??g.total_cost??g.total_pay_amount??0;return ge(D,2,"0.00")})(),U=()=>v>=100?"bg-green-500":v>=75?"bg-amber-500":v>=50?"bg-orange-500":"bg-red-500";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 whitespace-nowrap",children:S?`${S.filledRoles} of ${S.totalRoles} roles filled`:`${w} of ${$} workers hired`}),e.jsx("div",{className:"flex-1 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:Ee("h-full rounded-full transition-all duration-300",U()),style:{width:`${v}%`}})}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900 whitespace-nowrap",children:[v,"%"]})]}),e.jsxs("div",{className:"text-sm font-medium text-gray-700",children:[w,"/",$," hired"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{children:"Est. Cost: "}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["$",R]})]})]})})()}),q&&e.jsx("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:j.has(g.id)?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-teal-600 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading assignments..."})]})}):g.shifts_by_role&&g.shifts_by_role.length>0?e.jsx("div",{className:"space-y-4",children:g.shifts_by_role.map(w=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:w.role_name}),e.jsxs("span",{className:"text-sm text-gray-600",children:[w.filled_shifts,"/",w.total_shifts," hired"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[w.filled_shifts<w.total_shifts&&e.jsxs("span",{className:"px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[w.total_shifts-w.filled_shifts," needed"]}),w.filled_shifts<w.total_shifts&&e.jsx("button",{onClick:$=>{var R;$.stopPropagation();const v=w.shifts.filter(U=>U.staffing_progress.percentage<100).sort((U,D)=>new Date(U.start_time_utc).getTime()-new Date(D.start_time_utc).getTime()).map(U=>U.id),S=ke(w.pay_rate||((R=w.shifts[0])==null?void 0:R.pay_rate)||0);y(g.id,w.role_name,v,S)},className:"px-2.5 py-1 text-xs font-semibold bg-teal-600 text-white rounded hover:bg-teal-700",title:"Quick Fill by Skill",children:"Quick Fill by Skill"})]})]}),e.jsx("div",{className:"space-y-2",children:w.shifts.length===0?e.jsx("div",{className:"py-4 px-3 bg-amber-50 border border-amber-200 rounded text-center",children:e.jsx("p",{className:"text-sm text-amber-700 font-medium",children:"No shifts created yet for this role. Shifts will be generated when the event is published."})}):w.shifts.map(($,v)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 text-gray-700 rounded-md flex items-center justify-center text-xs font-medium",children:v+1}),e.jsxs("span",{className:"text-sm text-gray-700",children:[Z($.start_time_utc)," - ",Z($.end_time_utc)]}),$.assignments&&$.assignments.length>0&&e.jsx("div",{className:"flex flex-col gap-1.5",children:$.assignments.map(S=>{const R=`${S.worker.first_name} ${S.worker.last_name}`,U=ke(S.hourly_rate||$.pay_rate||0),D=os(S),G=D?`${R} â€¢ $${ge(U,0,"0")}/hr â€¢ ${D}`:`${R} â€¢ $${ge(U,0,"0")}/hr`;return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:Ee("bg-white text-black border rounded-full px-2.5 py-1 text-sm font-medium shadow-sm max-w-[140px] truncate",S.status==="no_show"||S.status==="cancelled"||S.status==="removed"?"border-red-200 opacity-60":S.approved?"border-green-200":"border-gray-200"),title:G,children:R}),e.jsx("button",{onClick:z=>{z.stopPropagation(),o(S.id,R)},className:"w-5 h-5 flex items-center justify-center text-red-600 hover:text-red-700 hover:bg-red-50 rounded",title:"Unassign worker",children:e.jsx(Se,{size:12})})]}),D&&e.jsx("div",{className:Ee("text-xs font-medium ml-2",S.status==="no_show"||S.status==="cancelled"||S.status==="removed"?"text-red-600":S.approved?"text-green-700":"text-gray-500"),children:D})]},S.id)})})]}),$.staffing_progress&&$.staffing_progress.percentage===100?e.jsxs("span",{className:"flex items-center gap-1.5 text-sm font-medium text-green-600",children:[e.jsx(Fe,{size:16}),"Assigned"]}):e.jsx("button",{onClick:S=>{S.stopPropagation(),l($.id,ke(w.pay_rate||$.pay_rate||0))},className:"px-3 py-1.5 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Assign Worker"})]},$.id))})]},w.role_name))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:g.status==="draft"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"This event is still in draft status"}),e.jsx("p",{className:"text-sm",children:"Publish the event to generate shifts and assign workers"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"No shifts available"}),e.jsx("p",{className:"text-sm",children:"This event may not have any shifts generated yet"})]})}),e.jsx("div",{className:"flex items-center justify-center gap-3",children:g.status==="draft"&&e.jsx("button",{onClick:()=>m(g.id),className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors",children:"Publish Event"})})]})})]},g.id)})})}function Es({events:a,searchQuery:x,onApproveHours:j}){const P=o=>{const y=fe(o);return be(y,"MMM d, yyyy")},l=o=>{const y=fe(o);return be(y,"h:mm a")};return a.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“‹"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:x?"No past events found":"No past events yet"}),e.jsx("p",{className:"text-gray-600",children:x?"Try adjusting your search query":"Completed events will appear here"})]}):e.jsx("div",{className:"space-y-4",children:a.map(o=>{var ne,g,q,w;const y=o.approval_status&&o.approval_status.total>0,m=ke(o.total_hours??o.total_hours_worked??0),T=ke(((ne=o.cost_summary)==null?void 0:ne.total_estimated_cost)??o.total_pay_amount??0),A=ke(((g=o.cost_summary)==null?void 0:g.approved_cost)??0),X=ke(((q=o.cost_summary)==null?void 0:q.pending_cost)??0),oe=ke(((w=o.approval_status)==null?void 0:w.pending)??0),Z=o.cost_summary&&T>0&&m>0?A/T*m:m,le=o.cost_summary&&T>0&&m>0&&X>0?X/T*m:0;return e.jsxs("div",{onClick:()=>j&&y&&j(o),className:Ee("border border-gray-200 rounded-lg p-5 transition-all cursor-pointer",y&&"hover:border-gray-300 hover:shadow-md"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1 truncate",children:o.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 flex-wrap",children:[o.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"h-4 w-4 flex-shrink-0"}),P(o.schedule.start_time_utc)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Me,{className:"h-4 w-4 flex-shrink-0"}),l(o.schedule.start_time_utc)," - ",l(o.schedule.end_time_utc)]})]}),o.venue&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Te,{className:"h-4 w-4 flex-shrink-0"}),o.venue.name]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 ml-4",children:[e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-700 rounded",children:"Completed"}),Xe(o)&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-50 text-green-700 text-xs font-medium rounded border border-green-200",children:[e.jsx(Le,{className:"h-3 w-3"}),"Reviewed"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4 py-3 border-y border-gray-100",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Workers"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:o.assigned_workers_count||0})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Hours"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900 tabular-nums flex items-center justify-end gap-1.5",children:y?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:ge(Z,2,"0.00")}),oe>0&&le>0&&e.jsxs("span",{className:"text-xs font-medium text-amber-600 bg-amber-50 px-1.5 py-0.5 rounded",children:["+",ge(le,2,"0.0"),"h pending"]})]}):e.jsx("span",{className:"text-gray-400",children:"â€”"})})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Cost"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900 tabular-nums flex items-center justify-end gap-1.5",children:y?e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["$",ge(A,2,"0.00")]}),X>0&&e.jsxs("span",{className:"text-xs font-medium text-amber-700 bg-amber-100 px-1.5 py-0.5 rounded",children:["+$",ge(X,2,"0.00")]})]}):e.jsx("span",{className:"text-gray-400",children:"â€”"})})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",onClick:$=>$.stopPropagation(),children:j&&(()=>{var G,z;const $=o.total_workers_needed||0,v=o.assigned_workers_count||0,S=(((G=o.approval_status)==null?void 0:G.total)??0)>0||(((z=o.cost_summary)==null?void 0:z.total_count)??0)>0||v>0,R=Xe(o),U=_s(o);if($===0&&v===0&&!S)return null;if(!S)return e.jsxs("button",{disabled:!0,className:"px-4 py-2 text-sm font-medium rounded-lg flex items-center gap-2 bg-gray-300 text-gray-500 cursor-not-allowed shadow-sm",children:[e.jsx(Fe,{className:"h-4 w-4"}),"No assignments"]});const D=()=>j(o);return R?e.jsxs("button",{onClick:D,"aria-label":"Review assignments (already reviewed)",className:"px-4 py-2 text-sm font-medium rounded-lg flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white transition-colors shadow-sm",title:"All assignments reviewed. Click to adjust if needed.",children:[e.jsx(Le,{className:"h-4 w-4"}),e.jsx("span",{children:"Reviewed"}),e.jsx(Ie,{className:"h-4 w-4"})]}):e.jsxs("button",{onClick:D,"aria-label":U>0?`Review and approve ${U} pending assignment${U!==1?"s":""}`:"Review & Approve",className:"px-4 py-2 text-sm font-medium rounded-lg flex items-center gap-2 bg-amber-600 hover:bg-amber-700 text-white transition-colors shadow-sm",children:[e.jsx(fs,{className:"h-4 w-4"}),e.jsx("span",{children:U>0?`Review & Approve (${U})`:"Review & Approve"}),e.jsx(Ie,{className:"h-4 w-4"})]})})()})]},o.id)})})}export{Ks as EventsPage};
