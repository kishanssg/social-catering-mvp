import{c as oe,a as V,j as e}from"./index-BvBF2lIx.js";import{i as ce,b as de,r as o}from"./vendor-79DyBOV9.js";import{L as me}from"./LoadingSpinner-Z6nkPnDm.js";import{X as pe,T as xe}from"./Toast-Bv2lZaAm.js";import{c as fe}from"./check-Bp3f4Z94.js";import{b as S,a as $,c as z,e as O,p as U}from"./Prep Cook-CE8OFMb5.js";import{C as he}from"./chevron-right-t1i58LSh.js";import{U as ge}from"./user-BJzFfhl0.js";import{P as ue}from"./plus-Bo42lQNo.js";import"./x-circle-DyNRR2uC.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=oe("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),je=[{id:79,name:"Food Handler Certificate"},{id:78,name:"ServSafe"},{id:80,name:"TIPS Certification"},{id:77,name:"Alcohol Service License"}];function Ee(){const{id:u}=ce(),v=de(),h=!!u,P=o.useRef(null),[d,F]=o.useState("details"),[L,y]=o.useState(!1),[q,E]=o.useState(!1),[W,I]=o.useState(!1),[B,R]=o.useState(!1),[t,l]=o.useState({first_name:"",last_name:"",email:"",phone:"",address_line1:"",address_line2:"",profile_photo_url:"",skills:[],certifications:[]}),[T,D]=o.useState(null),[b,k]=o.useState(null),[n,G]=o.useState({}),[j,w]=o.useState({isVisible:!1,message:"",type:"success"}),_=s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s),N=s=>{const r=s.replace(/\D/g,"");return r.length>=10&&r.length<=15},J=s=>{const r=s.replace(/\D/g,"");l({...t,phone:r})},A=[{name:"Bartender",icon:S},{name:"Banquet Server/Runner",icon:$},{name:"Captain",icon:z},{name:"Event Helper",icon:O},{name:"Prep Cook",icon:U}],X=s=>({Bartender:S,"Banquet Server/Runner":$,Captain:z,"Event Helper":O,"Prep Cook":U})[s]||S;o.useEffect(()=>{h&&K()},[u]);async function K(){var s;E(!0);try{const r=await V.get(`/workers/${u}`);if(r.data.status==="success"){const a=r.data.data.worker;l({first_name:a.first_name||"",last_name:a.last_name||"",email:a.email||"",phone:a.phone?a.phone.replace(/\D/g,""):"",address_line1:a.address_line1||"",address_line2:a.address_line2||"",profile_photo_url:a.profile_photo_url||"",skills:a.skills_json||[],certifications:((s=a.worker_certifications)==null?void 0:s.map(i=>{var g;return{certification_id:i.certification_id,name:((g=i.certification)==null?void 0:g.name)||"",expires_at_utc:i.expires_at_utc?i.expires_at_utc.split("T")[0]:""}}))||[]}),a.profile_photo_url&&k(a.profile_photo_url)}}catch(r){console.error("Failed to load worker:",r)}finally{E(!1)}}function Q(){var s;(s=P.current)==null||s.click()}function Y(s){var i;const r=(i=s.target.files)==null?void 0:i[0];if(!r||!r.type.startsWith("image/")||r.size>5*1024*1024)return;D(r);const a=new FileReader;a.onloadend=()=>k(a.result),a.readAsDataURL(r)}async function Z(){var s,r,a,i,g;y(!0);try{p("first_name",t.first_name),p("last_name",t.last_name),p("email",t.email),p("phone",t.phone);const m=t.first_name.trim().length>=2,f=t.last_name.trim().length>=2,ae=!!t.email.trim()&&_(t.email),ie=!!t.phone.trim()&&N(t.phone);if(!m||!f||!ae||!ie){y(!1);return}const le=h?"PATCH":"POST",ne=h?`/workers/${u}`:"/workers",c=new FormData;c.append("worker[first_name]",t.first_name),c.append("worker[last_name]",t.last_name),c.append("worker[email]",t.email),c.append("worker[phone]",t.phone),c.append("worker[address_line1]",t.address_line1),c.append("worker[address_line2]",t.address_line2),t.skills.forEach(x=>c.append("worker[skills_json][]",x)),t.certifications.filter(x=>!!x.expires_at_utc&&!!x.certification_id).forEach((x,H)=>{c.append(`worker[worker_certifications_attributes][${H}][certification_id]`,String(x.certification_id)),c.append(`worker[worker_certifications_attributes][${H}][expires_at_utc]`,x.expires_at_utc)}),T&&c.append("profile_photo",T);const M=await V.request({method:le,url:ne,data:c});M.data.status==="success"?v("/workers"):w({isVisible:!0,message:((s=M.data.errors)==null?void 0:s.join(", "))||"Failed to save worker",type:"error"})}catch(m){console.error("Failed to save worker:",m);let f="Failed to save worker";(a=(r=m.response)==null?void 0:r.data)!=null&&a.errors?f=m.response.data.errors.join(", "):(g=(i=m.response)==null?void 0:i.data)!=null&&g.message?f=m.response.data.message:m.message&&(f=m.message),w({isVisible:!0,message:f,type:"error"})}finally{y(!1)}}const ee=je.filter(s=>!t.certifications.some(r=>r.certification_id===s.id)),C=[{id:1,title:"Add New Worker",description:"Invite a new user to join as a Worker.",completed:d==="skills",active:d==="details"},{id:2,title:"Add Skills",description:"Specify Worker's Skills.",completed:!1,active:d==="skills"}],p=(s,r)=>{const a={...n};switch(s){case"first_name":r.length<2?a.first_name="First name must be at least 2 characters":delete a.first_name;break;case"last_name":r.length<2?a.last_name="Last name must be at least 2 characters":delete a.last_name;break;case"email":r.trim()?_(r)?delete a.email:a.email="Please enter a valid email address":a.email="Email is required";break;case"phone":r.length>0&&!N(r)?a.phone="Please enter a valid phone number (10-15 digits only, no hyphens or spaces)":delete a.phone;break}G(a)},se=()=>{if(d==="details"){const s=t.first_name.trim().length>=2,r=t.last_name.trim().length>=2,a=!!t.email.trim()&&_(t.email),i=!!t.phone.trim()&&N(t.phone);return s&&r&&a&&i}return!0},te=()=>{d==="details"?F("skills"):Z()},re=()=>{d==="skills"&&F("details")};return q?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(me,{})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-8 py-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("button",{onClick:()=>v("/workers"),className:"hover:text-gray-900 transition",children:"Workers"}),e.jsx(he,{size:16}),e.jsx("span",{className:"text-gray-900",children:h?"Edit Worker":"Add New Worker"})]})})}),e.jsxs("div",{className:"flex flex-1 justify-center gap-12 px-8 min-h-0",style:{paddingTop:"80px",paddingBottom:"40px"},children:[e.jsx("div",{className:"w-[280px] flex-shrink-0 self-start",children:C.map((s,r)=>e.jsxs("div",{className:"flex gap-4",style:{minHeight:r<C.length-1?"100px":"auto"},children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full flex-shrink-0",style:{backgroundColor:s.completed?"#FFFFFF":s.active?"#000000":"transparent",border:s.completed||s.active?"2px solid #000000":"0.8px solid #292826",boxShadow:s.active||s.completed?"0 2px 8px 0 rgba(0,0,0,0.04)":"none"},children:s.completed?e.jsx("img",{src:fe,width:"18",height:"18",alt:"Completed",className:"flex-shrink-0"}):s.active?e.jsx("div",{className:"rounded-full bg-white",style:{width:"12px",height:"12px"}}):null}),r<C.length-1&&e.jsx("div",{className:"flex-1",style:{width:"2px",backgroundColor:"rgba(0,0,0,0.5)"}})]}),e.jsxs("div",{className:"flex flex-col gap-1 pt-1",children:[e.jsx("span",{className:"text-sm font-bold font-manrope leading-[140%] text-font-primary",children:s.title}),e.jsx("span",{className:"text-sm font-normal font-manrope leading-[140%] text-font-secondary",children:s.description})]})]},s.id))}),e.jsxs("div",{className:"flex flex-col p-8 rounded-lg border border-primary-color/10 bg-white self-start overflow-visible",style:{boxShadow:"0 2px 8px 0 rgba(0,0,0,0.04)",maxWidth:"850px",width:"100%",minHeight:"600px"},children:[e.jsx("div",{className:"flex flex-col gap-6 flex-1 overflow-visible pr-2",style:{fontFamily:"Manrope, sans-serif"},children:d==="details"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx("h2",{className:"text-xl font-bold text-font-primary",children:"Worker Details"})}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Phone number"}),e.jsx("input",{type:"tel",value:t.phone,onChange:s=>J(s.target.value),onBlur:()=>p("phone",t.phone),className:`px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent ${n.phone?"border-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"1234567890"}),n.phone&&e.jsx("p",{className:"text-sm text-red-600",children:n.phone})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"First name"}),e.jsx("input",{type:"text",value:t.first_name,onChange:s=>l({...t,first_name:s.target.value}),onBlur:()=>p("first_name",t.first_name),className:`px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent ${n.first_name?"border-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"First name"}),n.first_name&&e.jsx("p",{className:"text-sm text-red-600",children:n.first_name})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Last name"}),e.jsx("input",{type:"text",value:t.last_name,onChange:s=>l({...t,last_name:s.target.value}),onBlur:()=>p("last_name",t.last_name),className:`px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent ${n.last_name?"border-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"Last name"}),n.last_name&&e.jsx("p",{className:"text-sm text-red-600",children:n.last_name})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Email address"}),e.jsx("input",{type:"email",value:t.email,onChange:s=>l({...t,email:s.target.value}),onBlur:()=>p("email",t.email),className:`px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent ${n.email?"border-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"Email address"}),n.email&&e.jsx("p",{className:"text-sm text-red-600",children:n.email})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Home address"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx("input",{type:"text",value:t.address_line1,onChange:s=>l({...t,address_line1:s.target.value}),className:"px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"Address line 1"}),e.jsx("input",{type:"text",value:t.address_line2,onChange:s=>l({...t,address_line2:s.target.value}),className:"px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"Address line 2"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Profile Photo"}),e.jsxs("div",{className:"flex items-center gap-4 p-4 border border-gray-300 rounded-lg",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden",children:b?e.jsx("img",{src:b,alt:"Preview",className:"w-16 h-16 object-cover"}):e.jsx(ge,{size:24,className:"text-gray-500"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{ref:P,type:"file",accept:"image/*",className:"hidden",onChange:Y}),e.jsxs("button",{type:"button",onClick:Q,className:"text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center gap-2",children:[e.jsx(be,{size:16}),b?"Change Photo":"Upload Photo"]}),b&&e.jsx("button",{type:"button",onClick:()=>{D(null),k(null)},className:"text-red-600 hover:text-red-700 text-sm",children:"Remove"}),e.jsx("span",{className:"text-xs text-gray-500",children:"JPG, PNG up to 5MB"})]})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx("h2",{className:"text-xl font-bold text-font-primary",children:"Worker Skills"})}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("label",{className:"text-sm font-semibold font-manrope leading-[140%] text-font-primary",children:"Skills"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between h-11 px-4 rounded-lg border border-primary-color/10 bg-white cursor-pointer hover:border-primary-color/30 transition-colors",onClick:()=>I(!W),children:[e.jsx("span",{className:"text-sm font-normal font-manrope leading-[140%] text-primary-color",children:t.skills.length>0?t.skills.join(", "):"Pick the Skills the Worker Has"}),e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M4 6L8 10L12 6",stroke:"#292826",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]}),W&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border border-primary-color/10 rounded-lg shadow-lg z-50 max-h-[200px] overflow-y-auto",children:[A.filter(s=>!t.skills.includes(s.name)).map(s=>e.jsxs("div",{className:"flex items-center gap-3 px-3 py-2.5 cursor-pointer hover:bg-gray-50",onClick:()=>{l({...t,skills:[...t.skills,s.name]}),I(!1)},children:[e.jsx("img",{src:s.icon,width:"20",height:"20",alt:s.name,className:"flex-shrink-0",style:{imageRendering:"crisp-edges"}}),e.jsx("span",{className:"text-sm font-normal font-manrope leading-[140%] text-font-primary",children:s.name})]},s.name)),t.skills.length===A.length&&e.jsx("div",{className:"px-3 py-2.5 text-sm text-gray-500 text-center",children:"All skills selected"})]})]}),t.skills.length>0&&e.jsx("div",{className:"flex flex-col gap-3",children:t.skills.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-primary-color/10 bg-white",style:{boxShadow:"0 1px 2px rgba(0,0,0,0.06)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:X(s),width:"24",height:"24",alt:s,className:"flex-shrink-0",style:{imageRendering:"crisp-edges"}}),e.jsx("span",{className:"text-sm font-semibold font-manrope leading-[140%] text-font-primary",children:s})]}),e.jsx("button",{onClick:()=>l({...t,skills:t.skills.filter(r=>r!==s)}),className:"flex items-center justify-center w-6 h-6 text-red-500 hover:bg-red-50 rounded",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 4L4 12M4 4L12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]},s))})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Certifications"}),e.jsx("div",{className:"space-y-3",children:t.certifications.map((s,r)=>e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",value:s.name,onChange:a=>{const i=[...t.certifications];i[r].name=a.target.value,l({...t,certifications:i})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500",placeholder:"Certification name"})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"date",value:s.expires_at_utc,onChange:a=>{const i=[...t.certifications];i[r].expires_at_utc=a.target.value,l({...t,certifications:i})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})}),e.jsx("button",{onClick:()=>l({...t,certifications:t.certifications.filter((a,i)=>i!==r)}),className:"text-red-600 hover:text-red-800",children:e.jsx(pe,{size:16})})]},r))}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>R(!B),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:[e.jsx(ue,{size:16}),e.jsx("span",{children:"Add Certification"})]}),B&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-10",children:ee.map(s=>e.jsx("button",{onClick:()=>{l({...t,certifications:[...t.certifications,{certification_id:s.id,name:s.name,expires_at_utc:""}]}),R(!1)},className:"w-full text-left px-4 py-2 hover:bg-gray-50 first:rounded-t-lg last:rounded-b-lg",children:s.name},s.id))})]})]})]})]})}),e.jsxs("div",{className:"flex justify-between items-center gap-4 pt-6 border-t border-gray-200",children:[e.jsx("div",{children:d==="skills"&&e.jsxs("button",{onClick:re,className:"flex items-center gap-2 px-6 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M10 12L6 8L10 4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Back"]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>v("/workers"),className:"px-6 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{onClick:te,disabled:!se()||L,className:"px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transition",children:L?"Saving...":d==="details"?"Continue":h?"Update Worker":"Create Worker"})]})]})]})]}),e.jsx(xe,{isVisible:j.isVisible,message:j.message,type:j.type,onClose:()=>w({...j,isVisible:!1})})]})}export{Ee as WorkerCreatePage};
