import{c as Ie,a as ee,j as e,X as Ae}from"./index-fXy5iQFc.js";import{i as Pe,b as Fe,r as d}from"./vendor-79DyBOV9.js";import{L as Ee}from"./LoadingSpinner-B5pmX339.js";import{T as Le}from"./Toast-B1W7u3HX.js";import{u as Re,c as We}from"./useCertificationsCatalog-DMvZH_fq.js";import{b as B,a as te,c as se,e as re,p as ae}from"./Prep Cook-li-JR_eG.js";import{C as Be}from"./chevron-right-BVUGiwj6.js";import{U as Me}from"./user-BiYkVXdT.js";import{P as $e}from"./plus-YtIunigY.js";import"./x-circle-Cp-1Myis.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=Ie("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function Qe(){const{id:j}=Pe(),S=Fe(),g=!!j,M=d.useRef(null),[p,$]=d.useState("details"),[D,I]=d.useState(!1),[ie,V]=d.useState(!1),[H,z]=d.useState(!1),A=d.useRef([]),[b,y]=d.useState([]),{certifications:v}=Re(),[r,x]=d.useState({first_name:"",last_name:"",email:"",phone:"",address_line1:"",address_line2:"",profile_photo_url:"",skills:[]}),[O,U]=d.useState(null),[k,P]=d.useState(null),[c,ne]=d.useState({}),[_,F]=d.useState({isVisible:!1,message:"",type:"success"}),E=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),L=t=>{const s=t.replace(/\D/g,"");return s.length>=10&&s.length<=15},oe=t=>{const s=t.replace(/\D/g,"");x({...r,phone:s})},T=[{name:"Bartender",icon:B},{name:"Banquet Server/Runner",icon:te},{name:"Captain",icon:se},{name:"Event Helper",icon:re},{name:"Prep Cook",icon:ae}],le=t=>({Bartender:B,"Banquet Server/Runner":te,Captain:se,"Event Helper":re,"Prep Cook":ae})[t]||B;d.useEffect(()=>{g?ce():(A.current=[],y([]))},[j,g]);async function ce(){V(!0);try{const t=await ee.get(`/workers/${j}`);if(t.data.status==="success"){const s=t.data.data.worker;let i=[];Array.isArray(s==null?void 0:s.worker_certifications)?i=s.worker_certifications.map(a=>{var l,m;return{worker_certification_id:a.id,certification_id:a.certification_id??((l=a.certification)==null?void 0:l.id),certification_name:((m=a.certification)==null?void 0:m.name)??a.name,expires_at_utc:a.expires_at_utc}}):Array.isArray(s==null?void 0:s.certifications)&&(i=s.certifications.map(a=>{var l,m;return{worker_certification_id:a.worker_certification_id||((l=a.worker_certification)==null?void 0:l.id)||null,certification_id:a.id??a.certification_id,certification_name:a.name??((m=a.certification)==null?void 0:m.name),expires_at_utc:a.expires_at_utc}}));const n=i.filter(a=>a.certification_id!=null&&a.certification_id!==void 0&&a.certification_id!=="").map(a=>({workerCertificationId:a.worker_certification_id||void 0,certificationId:a.certification_id,certificationName:a.certification_name,expiresAt:a.expires_at_utc?String(a.expires_at_utc).split("T")[0]:""}));A.current=n,y(n),x(a=>({...a,first_name:s.first_name||"",last_name:s.last_name||"",email:s.email||"",phone:s.phone?s.phone.replace(/\D/g,""):"",address_line1:s.address_line1||"",address_line2:s.address_line2||"",profile_photo_url:s.profile_photo_url||"",skills:s.skills_json||[]})),s.profile_photo_url&&P(s.profile_photo_url)}}catch(t){console.error("Failed to load worker:",t)}finally{V(!1)}}function de(){var t;(t=M.current)==null||t.click()}function me(t){var n;const s=(n=t.target.files)==null?void 0:n[0];if(!s||!s.type.startsWith("image/")||s.size>5*1024*1024)return;U(s);const i=new FileReader;i.onloadend=()=>P(i.result),i.readAsDataURL(s)}const fe=b.map(t=>t.certificationId).filter(t=>typeof t=="number"),N=v.filter(t=>!fe.includes(t.id)).length>0,pe=t=>{const s=b[t],i=b.filter((a,l)=>l!==t).map(a=>a.certificationId).filter(a=>typeof a=="number");let n=v.filter(a=>!i.includes(a.id));return s.certificationId&&!n.some(a=>a.id===s.certificationId)&&(n=[{id:s.certificationId,name:s.certificationName||"Unknown certification"},...n]),n},xe=()=>{N&&y(t=>[...t,{certificationId:void 0,certificationName:"",expiresAt:""}])},he=(t,s)=>{y(i=>i.map((n,a)=>{if(a!==t)return n;const l=v.find(m=>m.id===s||m.id===Number(s));return{...n,certificationId:s??void 0,certificationName:(l==null?void 0:l.name)||n.certificationName}}))},ue=(t,s)=>{y(i=>i.map((n,a)=>a===t?{...n,expiresAt:s}:n))},ge=t=>{y(s=>s.filter((i,n)=>n!==t))},be=()=>{const t=new Map;b.forEach(n=>{n.certificationId&&t.set(n.certificationId,n)});const s=[],i=new Set;return Array.from(t.values()).forEach(n=>{if(!n.certificationId)return;const a={certification_id:n.certificationId};n.expiresAt&&(a.expires_at_utc=n.expiresAt),n.workerCertificationId&&(a.id=n.workerCertificationId,i.add(n.workerCertificationId)),s.push(a)}),A.current.forEach(n=>{n.workerCertificationId&&!i.has(n.workerCertificationId)&&s.push({id:n.workerCertificationId,_destroy:!0})}),s};async function ye(){var t,s,i,n,a,l,m,q,G,J,X,K,Q;I(!0);try{h("first_name",r.first_name),h("last_name",r.last_name),h("email",r.email),h("phone",r.phone);const o=r.first_name.trim().length>=2,u=r.last_name.trim().length>=2,_e=!!r.email.trim()&&E(r.email),Ne=!!r.phone.trim()&&L(r.phone);if(!o||!u||!_e||!Ne){I(!1);return}const we=g?"PATCH":"POST",Ce=g?`/workers/${j}`:"/workers",f=new FormData;f.append("worker[first_name]",r.first_name||""),f.append("worker[last_name]",r.last_name||""),f.append("worker[email]",r.email||""),f.append("worker[phone]",r.phone||""),r.address_line1&&f.append("worker[address_line1]",r.address_line1),r.address_line2&&f.append("worker[address_line2]",r.address_line2),r.skills.forEach(w=>f.append("worker[skills_json][]",w));const W=be();console.log("Worker certification payload:",W),W.forEach((w,Z)=>{Object.entries(w).forEach(([Se,C])=>{C==null||C===""||f.append(`worker[worker_certifications_attributes][${Z}][${Se}]`,String(C))}),w._destroy&&f.append(`worker[worker_certifications_attributes][${Z}][_destroy]`,"true")}),O&&f.append("profile_photo",O),console.log("Submitting worker form:",{first_name:r.first_name,last_name:r.last_name,email:r.email,phone:r.phone,skills_count:r.skills.length,certifications_count:W.length});const Y=await ee.request({method:we,url:Ce,data:f});Y.data.status==="success"?S("/workers"):F({isVisible:!0,message:((t=Y.data.errors)==null?void 0:t.join(", "))||"Failed to save worker",type:"error"})}catch(o){console.error("Failed to save worker:",o),console.error("Error response:",(s=o.response)==null?void 0:s.data),console.error("Error status:",(i=o.response)==null?void 0:i.status);let u="Failed to save worker";((a=(n=o.response)==null?void 0:n.data)==null?void 0:a.status)==="validation_error"&&((m=(l=o.response)==null?void 0:l.data)!=null&&m.errors)||(G=(q=o.response)==null?void 0:q.data)!=null&&G.errors?u=Array.isArray(o.response.data.errors)?o.response.data.errors.join(", "):String(o.response.data.errors):(X=(J=o.response)==null?void 0:J.data)!=null&&X.message?u=o.response.data.message:(Q=(K=o.response)==null?void 0:K.data)!=null&&Q.error?u=o.response.data.error:o.message&&(u=o.message),F({isVisible:!0,message:u,type:"error"})}finally{I(!1)}}const R=[{id:1,title:"Add New Worker",description:"Invite a new user to join as a Worker.",completed:p==="skills",active:p==="details"},{id:2,title:"Add Skills",description:"Specify Worker's Skills.",completed:!1,active:p==="skills"}],h=(t,s)=>{const i={...c};switch(t){case"first_name":s.length<2?i.first_name="First name must be at least 2 characters":delete i.first_name;break;case"last_name":s.length<2?i.last_name="Last name must be at least 2 characters":delete i.last_name;break;case"email":s.trim()?E(s)?delete i.email:i.email="Please enter a valid email address":i.email="Email is required";break;case"phone":s.length>0&&!L(s)?i.phone="Please enter a valid phone number (10-15 digits only, no hyphens or spaces)":delete i.phone;break}ne(i)},je=()=>{if(p==="details"){const t=r.first_name.trim().length>=2,s=r.last_name.trim().length>=2,i=!!r.email.trim()&&E(r.email),n=!!r.phone.trim()&&L(r.phone);return t&&s&&i&&n}return!0},ve=()=>{p==="details"?$("skills"):ye()},ke=()=>{p==="skills"&&$("details")};return ie?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Ee,{})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-8 py-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("button",{onClick:()=>S("/workers"),className:"hover:text-gray-900 transition",children:"Workers"}),e.jsx(Be,{size:16}),e.jsx("span",{className:"text-gray-900",children:g?"Edit Worker":"Add New Worker"})]})})}),e.jsxs("div",{className:"flex flex-1 justify-center gap-12 px-8 min-h-0",style:{paddingTop:"80px",paddingBottom:"40px"},children:[e.jsx("div",{className:"w-[280px] flex-shrink-0 self-start",children:R.map((t,s)=>e.jsxs("div",{className:"flex gap-4",style:{minHeight:s<R.length-1?"100px":"auto"},children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full flex-shrink-0",style:{backgroundColor:t.completed?"#FFFFFF":t.active?"#000000":"transparent",border:t.completed||t.active?"2px solid #000000":"0.8px solid #292826",boxShadow:t.active||t.completed?"0 2px 8px 0 rgba(0,0,0,0.04)":"none"},children:t.completed?e.jsx("img",{src:We,width:"18",height:"18",alt:"Completed",className:"flex-shrink-0"}):t.active?e.jsx("div",{className:"rounded-full bg-white",style:{width:"12px",height:"12px"}}):null}),s<R.length-1&&e.jsx("div",{className:"flex-1",style:{width:"2px",backgroundColor:"rgba(0,0,0,0.5)"}})]}),e.jsxs("div",{className:"flex flex-col gap-1 pt-1",children:[e.jsx("span",{className:"text-sm font-bold font-manrope leading-[140%] text-font-primary",children:t.title}),e.jsx("span",{className:"text-sm font-normal font-manrope leading-[140%] text-font-secondary",children:t.description})]})]},t.id))}),e.jsxs("div",{className:"flex flex-col p-8 rounded-lg border border-primary-color/10 bg-white self-start overflow-visible",style:{boxShadow:"0 2px 8px 0 rgba(0,0,0,0.04)",maxWidth:"850px",width:"100%",minHeight:"600px"},children:[e.jsx("div",{className:"flex flex-col gap-6 flex-1 overflow-visible pr-2",style:{fontFamily:"Manrope, sans-serif"},children:p==="details"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx("h2",{className:"text-xl font-bold text-font-primary",children:"Worker Details"})}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Phone number"}),e.jsx("input",{type:"tel",value:r.phone,onChange:t=>oe(t.target.value),onBlur:()=>h("phone",r.phone),className:`px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent ${c.phone?"border-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"1234567890"}),c.phone&&e.jsx("p",{className:"text-sm text-red-600",children:c.phone})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"First name"}),e.jsx("input",{type:"text",value:r.first_name,onChange:t=>x({...r,first_name:t.target.value}),onBlur:()=>h("first_name",r.first_name),className:`px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent ${c.first_name?"border-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"First name"}),c.first_name&&e.jsx("p",{className:"text-sm text-red-600",children:c.first_name})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Last name"}),e.jsx("input",{type:"text",value:r.last_name,onChange:t=>x({...r,last_name:t.target.value}),onBlur:()=>h("last_name",r.last_name),className:`px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent ${c.last_name?"border-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"Last name"}),c.last_name&&e.jsx("p",{className:"text-sm text-red-600",children:c.last_name})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Email address"}),e.jsx("input",{type:"email",value:r.email,onChange:t=>x({...r,email:t.target.value}),onBlur:()=>h("email",r.email),className:`px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent ${c.email?"border-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"Email address"}),c.email&&e.jsx("p",{className:"text-sm text-red-600",children:c.email})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Home address"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx("input",{type:"text",value:r.address_line1,onChange:t=>x({...r,address_line1:t.target.value}),className:"px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"Address line 1"}),e.jsx("input",{type:"text",value:r.address_line2,onChange:t=>x({...r,address_line2:t.target.value}),className:"px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"Address line 2"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Profile Photo"}),e.jsxs("div",{className:"flex items-center gap-4 p-4 border border-gray-300 rounded-lg",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden",children:k?e.jsx("img",{src:k,alt:"Preview",className:"w-16 h-16 object-cover"}):e.jsx(Me,{size:24,className:"text-gray-500"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{ref:M,type:"file",accept:"image/*",className:"hidden",onChange:me}),e.jsxs("button",{type:"button",onClick:de,className:"text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center gap-2",children:[e.jsx(De,{size:16}),k?"Change Photo":"Upload Photo"]}),k&&e.jsx("button",{type:"button",onClick:()=>{U(null),P(null)},className:"text-red-600 hover:text-red-700 text-sm",children:"Remove"}),e.jsx("span",{className:"text-xs text-gray-500",children:"JPG, PNG up to 5MB"})]})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx("h2",{className:"text-xl font-bold text-font-primary",children:"Worker Skills"})}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("label",{className:"text-sm font-semibold font-manrope leading-[140%] text-font-primary",children:"Skills"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between h-11 px-4 rounded-lg border border-primary-color/10 bg-white cursor-pointer hover:border-primary-color/30 transition-colors",onClick:()=>z(!H),children:[e.jsx("span",{className:"text-sm font-normal font-manrope leading-[140%] text-primary-color",children:r.skills.length>0?r.skills.join(", "):"Pick the Skills the Worker Has"}),e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M4 6L8 10L12 6",stroke:"#292826",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]}),H&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border border-primary-color/10 rounded-lg shadow-lg z-50 max-h-[200px] overflow-y-auto",children:[T.filter(t=>!r.skills.includes(t.name)).map(t=>e.jsxs("div",{className:"flex items-center gap-3 px-3 py-2.5 cursor-pointer hover:bg-gray-50",onClick:()=>{x({...r,skills:[...r.skills,t.name]}),z(!1)},children:[e.jsx("img",{src:t.icon,width:"20",height:"20",alt:t.name,className:"flex-shrink-0",style:{imageRendering:"crisp-edges"}}),e.jsx("span",{className:"text-sm font-normal font-manrope leading-[140%] text-font-primary",children:t.name})]},t.name)),r.skills.length===T.length&&e.jsx("div",{className:"px-3 py-2.5 text-sm text-gray-500 text-center",children:"All skills selected"})]})]}),r.skills.length>0&&e.jsx("div",{className:"flex flex-col gap-3",children:r.skills.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-primary-color/10 bg-white",style:{boxShadow:"0 1px 2px rgba(0,0,0,0.06)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:le(t),width:"24",height:"24",alt:t,className:"flex-shrink-0",style:{imageRendering:"crisp-edges"}}),e.jsx("span",{className:"text-sm font-semibold font-manrope leading-[140%] text-font-primary",children:t})]}),e.jsx("button",{onClick:()=>x({...r,skills:r.skills.filter(s=>s!==t)}),className:"flex items-center justify-center w-6 h-6 text-red-500 hover:bg-red-50 rounded",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 4L4 12M4 4L12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]},t))})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Certifications"}),e.jsxs("div",{className:"space-y-3",children:[b.length===0&&e.jsx("p",{className:"text-sm text-font-secondary",children:"No certifications selected."}),b.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("select",{value:t.certificationId??"",onChange:i=>{const n=i.target.value?parseInt(i.target.value,10):null;he(s,n)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"",children:"Select certificationâ€¦"}),pe(s).map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"date",value:t.expiresAt??"",onChange:i=>ue(s,i.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})}),e.jsx("button",{type:"button",onClick:()=>ge(s),className:"text-red-600 hover:text-red-800",children:e.jsx(Ae,{size:16})})]},t.workerCertificationId??`cert-row-${s}`))]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("button",{type:"button",onClick:xe,disabled:!N,className:`flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg transition ${N?"hover:bg-gray-50":"opacity-50 cursor-not-allowed"}`,children:[e.jsx($e,{size:16}),e.jsx("span",{children:"Add Certification"})]}),!N&&v.length>0&&e.jsx("p",{className:"text-xs text-font-secondary",children:"All available certifications have been assigned."})]})]})]})]})}),e.jsxs("div",{className:"flex justify-between items-center gap-4 pt-6 border-t border-gray-200",children:[e.jsx("div",{children:p==="skills"&&e.jsxs("button",{onClick:ke,className:"flex items-center gap-2 px-6 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M10 12L6 8L10 4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Back"]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>S("/workers"),className:"px-6 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{onClick:ve,disabled:!je()||D,className:"px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transition",children:D?"Saving...":p==="details"?"Continue":g?"Update Worker":"Create Worker"})]})]})]})]}),e.jsx(Le,{isVisible:_.isVisible,message:_.message,type:_.type,onClose:()=>F({..._,isVisible:!1})})]})}export{Qe as WorkerCreatePage};
