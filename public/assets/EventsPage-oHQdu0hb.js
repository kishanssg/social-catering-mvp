import{c as Ne,j as e,a as q,C as ve}from"./index-DPWeK9zB.js";import{r as c,b as _e,f as Ee}from"./vendor-79DyBOV9.js";import{f as $e,a as ye}from"./dateUtils-CHmZs4Ub.js";import{X as oe,T as we}from"./Toast-BOasg72G.js";import{C as ce}from"./clock-NVVGrvp8.js";import{M as me}from"./map-pin-CXArT-w9.js";import{U as ge}from"./users-DAtxdVXe.js";import{A as fe}from"./alert-circle-BHToPuiG.js";import{S as he,A as Fe,T as pe,C as ue}from"./ConfirmationModal-CA8CYf0-.js";import{D as ke}from"./dollar-sign-C2osTqdc.js";import{C as Le}from"./x-circle-DW06jDGE.js";import{b as De,a as Pe,c as Me,e as Te,p as ze}from"./Prep Cook-CE8OFMb5.js";import{P as Se}from"./pen-square-CGpGY-kw.js";import{P as be}from"./plus-DgslpA9L.js";import{C as xe}from"./calendar-DJImmAKn.js";import{f as K}from"./index-C_slYh2M.js";import{p as Y}from"./index-BK_MyBzW.js";import{C as Ce}from"./chevron-down-1YmjI6uC.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=Ne("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=Ne("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),Oe={sm:"max-w-md",md:"max-w-2xl",lg:"max-w-4xl",xl:"max-w-6xl"},de=({isOpen:d,onClose:p,title:v,subtitle:a,children:W,footer:b,size:h="md",closeOnOverlayClick:r=!0})=>{if(c.useEffect(()=>(d?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[d]),c.useEffect(()=>{const u=O=>{O.key==="Escape"&&d&&p()};return document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)},[d,p]),!d)return null;const E=u=>{u.target===u.currentTarget&&r&&p()};return e.jsx("div",{className:"modal-overlay",onClick:E,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:e.jsxs("div",{className:`modal-container ${Oe[h]}`,children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{id:"modal-title",className:"text-xl font-semibold text-gray-900 font-manrope",children:v}),a&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a})]}),e.jsx("button",{onClick:p,className:"p-1.5 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors","aria-label":"Close modal",children:e.jsx(oe,{size:20,className:"text-gray-600"})})]}),e.jsx("div",{className:"modal-body",children:W}),b&&e.jsx("div",{className:"modal-footer",children:b})]})})};function Ae({shiftId:d,onClose:p,onSuccess:v}){var C,o;const[a,W]=c.useState(null),[b,h]=c.useState([]),[r,E]=c.useState([]),[u,O]=c.useState(""),[_,w]=c.useState(null),[i,z]=c.useState({}),[f,M]=c.useState(!0),[L,T]=c.useState(!1),[F,A]=c.useState(null),Q=(t,l)=>{z(k=>({...k,[t]:l}))};c.useEffect(()=>{U()},[d]),c.useEffect(()=>{a&&x()},[a]),c.useEffect(()=>{if(!u)E(b);else{const t=u.toLowerCase();E(b.filter(l=>{var k;return l.first_name.toLowerCase().includes(t)||l.last_name.toLowerCase().includes(t)||l.email.toLowerCase().includes(t)||((k=l.skills_json)==null?void 0:k.some(D=>D.toLowerCase().includes(t)))}))}},[u,b]);async function U(){try{const t=await q.get(`/shifts/${d}`);t.data.status==="success"?W(t.data.data):A("Failed to load shift details")}catch(t){console.error("Failed to load shift details:",t),A("Failed to load shift details")}}async function x(){var t;try{const l=new Set;if(a!=null&&a.event_id)try{const $=((t=(await q.get(`/events/${a.event_id}`)).data)==null?void 0:t.data)||{};if($.shifts_by_role){const S=$.shifts_by_role.find(N=>N.skill_name===a.role_needed||N.role_name===a.role_needed);S!=null&&S.shifts&&S.shifts.forEach(N=>{N.assignments&&N.assignments.forEach(g=>{var B;const P=g.worker_id||((B=g.worker)==null?void 0:B.id),I=g.status;P&&I!=="cancelled"&&I!=="no_show"&&l.add(P)})})}}catch(D){console.log("Could not fetch event to filter assigned workers:",D)}console.log(`AssignmentModal: Found ${l.size} already assigned workers for "${a==null?void 0:a.role_needed}"`);const k=await q.get("/workers?active=true");if(k.data.status==="success"){const D=k.data.data.workers||k.data.data;if(a!=null&&a.role_needed){const $=D.filter(S=>{var N;return((N=S.skills_json)==null?void 0:N.includes(a.role_needed))&&!l.has(S.id)});console.log(`AssignmentModal: Showing ${$.length} eligible workers`),h($)}else{const $=D.filter(S=>!l.has(S.id));h($)}}else A("Failed to load workers")}catch(l){console.error("Failed to load workers:",l),A("Failed to load workers")}finally{M(!1)}}async function m(){var t,l,k,D,$,S;if(!(!_||!a)){T(!0),A(null);try{const g=(await q.post("/staffing",{assignment:{shift_id:a.id,worker_id:_.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:i[_.id]||Number(a.pay_rate)||0}})).data;if(g.status==="success")v();else{let P=g.message||"Failed to assign worker";g.details&&g.details.length>0?P+=`

Details:
â€¢ `+g.details.join(`
â€¢ `):g.errors&&(P+=`

Details:
â€¢ `+g.errors.join(`
â€¢ `)),A(P)}}catch(N){console.error("Failed to assign worker:",N);let g="Failed to assign worker";if((l=(t=N.response)==null?void 0:t.data)!=null&&l.details&&N.response.data.details.length>0){const P=N.response.data.details.map(I=>(I.includes("conflicting shift"),I));g+=`

`+P.join(`
`)}else(D=(k=N.response)==null?void 0:k.data)!=null&&D.errors?g+=`

`+N.response.data.errors.join(`
`):(S=($=N.response)==null?void 0:$.data)!=null&&S.message?g=N.response.data.message:N.message&&(g=N.message);A(g)}finally{T(!1)}}}if(f)return e.jsx(de,{isOpen:!0,onClose:p,title:"Assign Worker",size:"lg",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-600"})})});const j=e.jsxs(e.Fragment,{children:[F&&e.jsxs("div",{className:"mb-4 p-3 bg-gradient-to-r from-red-50 to-amber-50 border-l-4 border-red-500 rounded-r-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsx("h4",{className:"text-sm font-semibold text-red-900",children:"âš ï¸ Scheduling Conflict Detected"})]}),e.jsx("p",{className:"text-xs text-gray-600 ml-8",children:"Please resolve the conflict before attempting to assign this worker"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:p,disabled:L,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:m,disabled:!_||L||!!F,className:`btn-primary ${F?"opacity-50 cursor-not-allowed":""}`,title:F?"Cannot assign due to scheduling conflict":"",children:L?"Assigning Worker...":"Assign Worker"})]})]});return e.jsx(de,{isOpen:!0,onClose:p,title:a?`${a.client_name} â€¢ ${a.role_needed}`:"Assign Worker",size:"xl",footer:j,children:e.jsxs("div",{className:"flex h-[600px]",children:[e.jsx("div",{className:"w-1/3 border-r border-gray-200 p-6 bg-gray-50",children:a?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Shift Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ce,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:$e(a.start_time_utc)}),e.jsxs("div",{className:"text-sm text-gray-600",children:[ye(a.start_time_utc)," - ",ye(a.end_time_utc)]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(me,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"text-sm text-gray-900",children:a.location||((o=(C=a.event)==null?void 0:C.venue)==null?void 0:o.formatted_address)||"Location not specified"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ge,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900",children:a.role_needed}),a.required_skill&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Requires: ",a.required_skill]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Pay Rate:"})," $",(Number(a.pay_rate)||0).toFixed(2),"/hour"]}),a.uniform_name&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",a.uniform_name]})]}),a.notes&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Notes:"}),e.jsx("div",{className:"mt-1 whitespace-pre-line",children:a.notes.split("Uniform:").map((t,l)=>l===0?t.trim():e.jsxs("div",{children:[e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",t.trim()]},l))})]})})]})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fe,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Failed to load shift details"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search workers...",value:u,onChange:t=>O(t.target.value),className:"w-full pl-9 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-teal-500 focus:border-teal-500"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:F?e.jsx("div",{className:"p-6 flex items-center justify-center h-full",children:e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 rounded-lg p-5 shadow-sm w-full max-w-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(fe,{size:20,className:"text-red-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg font-semibold text-red-900 mb-1",children:"âš ï¸ Scheduling Conflict"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"This worker cannot be assigned due to a scheduling conflict"}),e.jsx("div",{className:"bg-white border border-red-200 rounded p-3 mt-3",children:e.jsx("div",{className:"text-sm text-red-800 font-mono",children:F.split(`
`).map((t,l)=>t.trim()===""?null:t.startsWith("â€¢")?e.jsxs("div",{className:"mt-1 flex items-start gap-2",children:[e.jsx("span",{className:"text-red-500",children:"â—"}),e.jsx("span",{className:"flex-1",children:t.replace("â€¢","").trim()})]},l):t.startsWith("Details:")?null:t.includes("conflicting shift")?e.jsx("div",{className:"mt-1 text-red-700 font-medium",children:t},l):e.jsx("div",{className:"text-gray-700",children:t},l))})})]})]})})}):r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ge,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:u?"No workers found matching your search":a!=null&&a.role_needed?`No workers found with "${a.role_needed}" skill`:"No available workers"}),(a==null?void 0:a.role_needed)&&!u&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:['Try adding "',a.role_needed,'" skill to workers or select a different shift.']})]}):e.jsx("ul",{children:r.map(t=>{const l=(_==null?void 0:_.id)===t.id,k=i[t.id]||Number(a.pay_rate)||0,D=i[t.id]&&i[t.id]!==(Number(a.pay_rate)||0);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${l?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[t.first_name[0],t.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[t.first_name," ",t.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(t.skills_json||[]).map(($,S)=>{const N=$===(a==null?void 0:a.role_needed);return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${N?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:$},S)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[D&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ke,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:(Number(a.pay_rate)||0).toString(),value:k||"",onChange:$=>{const S=$.target.value;(S===""||/^\d*\.?\d*$/.test(S))&&Q(t.id,parseFloat(S)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:$=>$.stopPropagation(),onFocus:$=>$.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>w(t),className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${l?"bg-teal-600 text-white border-teal-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:l?"Selected":"Select"})]})]},t.id)})})})]})]})})}function Ue({isOpen:d,eventId:p,roleName:v,unfilledShiftIds:a,defaultPayRate:W,onClose:b,onDone:h}){const[r,E]=c.useState([]),[u,O]=c.useState([]),[_,w]=c.useState(""),[i,z]=c.useState(!1),[f,M]=c.useState(!1),[L,T]=c.useState({}),[F,A]=c.useState(0),Q=(o,t)=>{T(l=>({...l,[o]:t}))};c.useEffect(()=>{d&&(E([]),O([]),w(""),T({}),z(!0),(async()=>{var o,t;try{const k=((o=(await q.get(`/events/${p}`)).data)==null?void 0:o.data)||{};console.log("QuickFill: Full event data:",JSON.stringify(k,null,2)),console.log("QuickFill: Looking for role:",v),console.log("QuickFill: shifts_by_role:",k.shifts_by_role);const D=new Set;if(k.shifts_by_role){const g=k.shifts_by_role.find(P=>(console.log("QuickFill: Checking role:",P.skill_name,P.role_name,"vs",v),P.skill_name===v||P.role_name===v));g?(console.log("QuickFill: Found role shifts:",g),g.shifts&&g.shifts.forEach(P=>{P.assignments&&(console.log("QuickFill: Shift has assignments:",P.assignments),P.assignments.forEach(I=>{var Z;const B=I.worker_id||((Z=I.worker)==null?void 0:Z.id),X=I.status;B&&X!=="cancelled"&&(D.add(B),console.log("QuickFill: Adding worker_id to exclude:",B,"status:",X))}))})):console.log("QuickFill: No role shifts found for:",v)}console.log(`QuickFill: Found ${D.size} already assigned worker IDs:`,Array.from(D));const $=await q.get("/workers?active=true"),N=(((t=$.data)==null?void 0:t.data)||$.data||[]).filter(g=>{const P=(g.skills_json||[]).includes(v),I=D.has(g.id);return I&&console.log(`QuickFill: Excluding ${g.first_name} ${g.last_name} (ID: ${g.id}) - already assigned`),P&&!I});if(console.log(`QuickFill: Found ${N.length} eligible workers for "${v}"`),console.log("QuickFill: Eligible workers:",N.map(g=>`${g.first_name} ${g.last_name}`)),E(N),W){const g=Number(W)||0;A(g),console.log(`QuickFill: Default pay rate for ${v}: $${g}/hr`)}else console.log(`QuickFill: No default pay rate provided for ${v}`)}catch(l){console.error("Error loading workers:",l)}finally{z(!1)}})())},[d,p,v,W]);const U=c.useMemo(()=>{const o=_.trim().toLowerCase(),t=r;return o?t.filter(l=>`${l.first_name} ${l.last_name}`.toLowerCase().includes(o)||(l.email||"").toLowerCase().includes(o)):t},[r,_]),x=a.length,m=o=>{O(t=>t.includes(o)?t.filter(l=>l!==o):t.length>=x?t:[...t,o])},j=async()=>{var k,D,$,S,N,g,P,I,B,X,Z,ee,ae,re,ie;if(u.length===0||x===0)return;M(!0);let o=0,t=0;const l=[];try{const se=u.map(H=>r.find(s=>s.id===H)).filter(Boolean),le=[...a];let te=0;for(;le.length>0&&se.length>0;){const H=se[te%se.length],s=le.shift();try{const n=L[H.id]||Number(F)||0||0,y=await q.post("/staffing",{assignment:{shift_id:s,worker_id:H.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:n}});if(((k=y.data)==null?void 0:k.status)==="success")o+=1;else{t+=1;const R=`${H.first_name} ${H.last_name}`,G=((D=y.data)==null?void 0:D.message)||((S=($=y.data)==null?void 0:$.error)==null?void 0:S.message)||((g=(N=y.data)==null?void 0:N.errors)==null?void 0:g.join(", "))||"Unknown error";let V="Unable to assign";const J=String(G).toLowerCase();J.includes("overlapping")||J.includes("conflict")?V="Has overlapping shift":J.includes("capacity")||J.includes("full")?V="Shift is full":J.includes("skill")||J.includes("certification")||J.includes("requirement")?V="Missing required skill":J.includes("status")?V="Cannot be assigned":V="Unable to assign",l.push(`${R}: ${V}`)}}catch(n){t+=1;const y=`${H.first_name} ${H.last_name}`;let R="Unable to assign";const G=((I=(P=n.response)==null?void 0:P.data)==null?void 0:I.message)||((Z=(X=(B=n.response)==null?void 0:B.data)==null?void 0:X.error)==null?void 0:Z.message)||((re=(ae=(ee=n.response)==null?void 0:ee.data)==null?void 0:ae.errors)==null?void 0:re.join(", "))||null;if(G){const V=String(G).toLowerCase();V.includes("overlapping")||V.includes("conflict")?R="Has overlapping shift":V.includes("capacity")||V.includes("full")?R="Shift is full":V.includes("skill")||V.includes("certification")||V.includes("requirement")?R="Missing required skill":V.includes("status")?R="Cannot be assigned":R="Unable to assign"}else((ie=n.response)==null?void 0:ie.status)===422?R="Unable to assign":n.message&&!n.message.includes("status code")&&(R=n.message);l.push(`${y}: ${R}`)}te+=1}let ne="";t>0&&l.length>0&&(ne=l.join(", ")),h({assigned:o,conflicts:t,details:ne})}finally{M(!1)}};if(!d)return null;const C=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,disabled:f,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:j,disabled:f||u.length===0||x===0,className:"btn-primary",children:f?"Filling Shifts...":u.length===1?`Assign worker to ${x} shift${x!==1?"s":""}`:`Assign ${u.length} workers to ${x} shifts`})]});return e.jsxs(de,{isOpen:d,onClose:b,title:`Quick Fill â€” ${v}`,subtitle:`Unfilled shifts: ${x}`,size:"lg",footer:C,children:[e.jsxs("div",{className:"relative",children:[e.jsx(he,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{value:_,onChange:o=>w(o.target.value),placeholder:"Search eligible workersâ€¦",className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsx("div",{className:"max-h-[340px] overflow-y-auto border border-gray-200 rounded-lg",children:i?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loadingâ€¦"}):U.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"No eligible workers"}):e.jsx("ul",{children:U.map(o=>{const t=u.includes(o.id);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${t?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[o.first_name[0],o.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[o.first_name," ",o.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(o.skills_json||[]).map((l,k)=>{const D=l===v;return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${D?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:l},k)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[L[o.id]&&L[o.id]!==(Number(F)||0)&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ke,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:Number(F)?(Number(F)||0).toString():"Rate",value:L[o.id]||Number(F)||0||"",onChange:l=>{const k=l.target.value;(k===""||/^\d*\.?\d*$/.test(k))&&Q(o.id,parseFloat(k)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:l=>l.stopPropagation(),onFocus:l=>l.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>m(o.id),disabled:!t&&u.length>=x,className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${t?"bg-teal-600 text-white border-teal-600":u.length>=x?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:t?"Selected":"Select"})]})]},o.id)})})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(Le,{size:16,className:"text-teal-600"}),e.jsxs("span",{children:["Will assign ",e.jsx("strong",{children:u.length})," worker",u.length!==1?"s":""," to ",e.jsx("strong",{children:x})," shift",x!==1?"s":"","."]})]}),(Number(F)||0)>0&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Default rate for ",v,":"]}),e.jsxs("span",{className:"font-medium",children:["$",(Number(F)||0).toFixed(2),"/hr"]})]}),Object.keys(L).length>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["ðŸ’¡ Empty fields will use default rate ($",(Number(F)||0).toFixed(2),"/hr)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(Fe,{size:14,className:"text-yellow-600"}),"Conflicts and already-filled shifts will be skipped automatically."]})]})}function We({event:d,isOpen:p,onClose:v,onSuccess:a}){const W=_e(),[b,h]=c.useState(!1),[r,E]=c.useState([]),[u,O]=c.useState(!1),[_,w]=c.useState(null),[i,z]=c.useState({isVisible:!1,message:"",type:"error"}),f=()=>{v(),W(`/events/${d.id}/edit`)},M=[{name:"Bartender",icon:De},{name:"Banquet Server/Runner",icon:Pe},{name:"Captain",icon:Me},{name:"Event Helper",icon:Te},{name:"Prep Cook",icon:ze}];c.useEffect(()=>{if(d.shifts_by_role&&Array.isArray(d.shifts_by_role)){const x=d.shifts_by_role.map(m=>{const j=m.shifts?m.shifts.length:m.total_shifts||1;return{skill_name:m.skill_name||m.role_name||"",needed_workers:j,pay_rate:m.pay_rate||15,description:"",uniform_id:void 0,cert_id:void 0}});E(x)}},[d]);const L=(x,m,j)=>{const C=[...r];C[x]={...C[x],[m]:j},E(C)},T=()=>{E([...r,{skill_name:"",needed_workers:1,pay_rate:15,description:"",uniform_id:void 0,cert_id:void 0}])},F=x=>{var m;if(r[x].needed_workers>0){const j=(m=d.shifts_by_role)==null?void 0:m[x];if(j&&(j.assigned_workers>0||j.filled_shifts>0)){z({isVisible:!0,message:"Cannot remove role with assigned workers. Please unassign workers first.",type:"error"});return}}E(r.filter((j,C)=>C!==x))},A=(x,m)=>{M.find(C=>C.name===m);const j=[...r];j[x]={...j[x],skill_name:m},E(j),w(null)},Q=async()=>{var x,m;if(d.schedule&&new Date(d.schedule.start_time_utc)<=new Date){z({isVisible:!0,message:"Cannot edit event that has already started",type:"error"});return}O(!0);try{const j=await q.patch(`/events/${d.id}`,{event:{roles:r.map(C=>({skill_name:C.skill_name,needed:C.needed_workers,pay_rate:C.pay_rate,description:C.description,uniform_id:C.uniform_id,cert_id:C.cert_id}))}});j.data.status==="success"?(z({isVisible:!0,message:j.data.message||"Event updated successfully",type:"success"}),a(),v()):z({isVisible:!0,message:j.data.message||"Failed to update event",type:"error"})}catch(j){console.error("Failed to update event:",j),z({isVisible:!0,message:((m=(x=j.response)==null?void 0:x.data)==null?void 0:m.message)||"Failed to update event",type:"error"})}finally{O(!1)}},U=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:v,disabled:u,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:Q,disabled:u,className:"btn-primary",children:u?"Saving...":"Save Changes"})]});return e.jsxs(e.Fragment,{children:[e.jsx(de,{isOpen:p,onClose:v,title:`Edit Event: ${d.title}`,size:"lg",footer:U,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Event Details"}),e.jsxs("button",{onClick:f,className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-white border border-gray-300 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all shadow-sm",children:[e.jsx(Se,{size:14}),"Edit"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Venue"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:d.venue.name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:new Date(d.schedule.start_time_utc).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"space-y-1 md:col-span-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Location"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900 leading-relaxed",children:d.venue.formatted_address})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Time"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[new Date(d.schedule.start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})," - ",new Date(d.schedule.end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})]})]}),e.jsx("div",{})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"Roles"}),e.jsxs("button",{onClick:T,className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white text-sm font-semibold rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(be,{size:16}),"Add Role"]})]}),r.map((x,m)=>{var j,C;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[e.jsxs("div",{className:"flex-1 relative overflow-visible",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Role Name *"}),e.jsxs("div",{className:"relative",style:{zIndex:_===m?1e3:1},children:[e.jsxs("button",{type:"button",onClick:()=>w(_===m?null:m),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white text-left flex items-center justify-between",children:[x.skill_name?e.jsxs("div",{className:"flex items-center gap-2",children:[((j=M.find(o=>o.name===x.skill_name))==null?void 0:j.icon)&&e.jsx("img",{src:M.find(o=>o.name===x.skill_name).icon,alt:x.skill_name,className:"w-5 h-5"}),e.jsx("span",{className:"text-gray-900",children:x.skill_name})]}):e.jsx("span",{className:"text-gray-400",children:"Pick the Skills the Worker Has"}),e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M19 9l-7 7-7-7"})})]}),_===m&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border-2 border-gray-200 rounded-xl shadow-2xl z-[9999] max-h-[300px] overflow-y-auto w-full min-w-max",children:M.filter(o=>!r.some((t,l)=>l!==m&&t.skill_name===o.name)).map(o=>e.jsxs("div",{onClick:()=>A(m,o.name),className:"flex items-center gap-3 px-4 py-3 cursor-pointer hover:bg-teal-50 border-b border-gray-100 last:border-0",children:[e.jsx("img",{src:o.icon,width:"24",height:"24",alt:o.name,className:"flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:o.name})]},o.name))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Needed Workers *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>L(m,"needed_workers",Math.max(1,x.needed_workers-1)),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"-"}),e.jsx("input",{type:"number",value:x.needed_workers,onChange:o=>L(m,"needed_workers",parseInt(o.target.value)||1),min:"1",className:"w-16 px-2 py-2 border border-gray-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-teal-500 font-medium"}),e.jsx("button",{onClick:()=>L(m,"needed_workers",x.needed_workers+1),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"+"}),e.jsx("button",{onClick:()=>F(m),className:"ml-2 w-8 h-8 flex items-center justify-center text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove role",children:e.jsx(pe,{size:18})})]})]})]}),((C=d.shifts_by_role)==null?void 0:C[m])&&(d.shifts_by_role[m].assigned_workers>0||d.shifts_by_role[m].filled_shifts>0)&&e.jsxs("div",{className:"text-sm text-amber-600 font-semibold bg-amber-50 px-3 py-2 rounded-lg",children:[d.shifts_by_role[m].assigned_workers||d.shifts_by_role[m].filled_shifts," worker(s) assigned"]})]},m)})]})]})}),e.jsx(we,{isVisible:i.isVisible,message:i.message,type:i.type,onClose:()=>z({...i,isVisible:!1})})]})}function ds(){const d=_e(),[p,v]=Ee(),a=(p.get("tab")==="completed"?"completed":p.get("tab"))||"active",W=p.get("filter")||"needs_workers",[b,h]=c.useState(a),[r,E]=c.useState(W),[u,O]=c.useState(""),[_,w]=c.useState("date"),[i,z]=c.useState(!0),[f,M]=c.useState([]),[L,T]=c.useState(new Set),[F,A]=c.useState({isOpen:!1}),[Q,U]=c.useState({isVisible:!1,message:"",type:"success"}),[x,m]=c.useState({isOpen:!1,isLoading:!1}),[j,C]=c.useState({isOpen:!1,isLoading:!1}),[o,t]=c.useState({isOpen:!1,isLoading:!1}),[l,k]=c.useState({isOpen:!1,unfilledShiftIds:[]}),[D,$]=c.useState({isOpen:!1});c.useEffect(()=>{S()},[b,r,p]),c.useEffect(()=>{const s=(p.get("tab")==="completed"?"completed":p.get("tab"))||"active",n=p.get("filter")||"all";s!==b&&h(s),n!==r&&E(n)},[p,b,r]),c.useEffect(()=>{const s=p.get("event_id"),n=p.get("shift_id");if(s){const y=parseInt(s);isNaN(y)||(T(new Set([y])),n&&console.log(`Auto-expanding event ${y} with shift ${n}`))}},[p]);async function S(){z(!0);try{const s=b==="completed"?"completed":b,n=p.get("date");let y=`/events?tab=${s}`;r!=="all"&&(y+=`&filter=${r}`),n&&(y+=`&date=${n}`),console.log("Loading events with URL:",y,"filterStatus:",r,"date:",n);const R=await q.get(y);R.data.status==="success"&&(console.log("Received events:",R.data.data.length),M(R.data.data))}catch(s){console.error("Failed to load events:",s)}finally{z(!1)}}const N=s=>{h(s),v({tab:s}),E(s==="active"?"needs_workers":"all")},g=s=>{E(s);const n=new URLSearchParams;n.set("tab",b),n.set("filter",s),v(n)},P=s=>{const n=new Set(L);n.has(s)?n.delete(s):n.add(s),T(n)};async function I(s){const n=f==null?void 0:f.find(y=>y.id===s);t({isOpen:!0,isLoading:!1,eventId:s,eventTitle:n==null?void 0:n.title})}async function B(){if(o.eventId){t(s=>({...s,isLoading:!0}));try{const s=await q.delete(`/events/${o.eventId}`);s.data.status==="success"?(t({isOpen:!1,isLoading:!1}),U({isVisible:!0,message:`"${s.data.event_title}" moved to trash`,type:"success",action:{label:"Undo",onClick:()=>X(s.data.event_id),variant:"primary"}}),S()):U({isVisible:!0,message:s.data.message||"Unable to delete event",type:"error"})}catch(s){console.error("Failed to delete event:",s),U({isVisible:!0,message:"Unable to delete event",type:"error"})}finally{t(s=>({...s,isLoading:!1}))}}}async function X(s){try{const n=await q.post(`/events/${s}/restore`);n.data.status==="success"?(U({isVisible:!0,message:"Event restored to draft",type:"success"}),S()):U({isVisible:!0,message:n.data.message||"Unable to restore event",type:"error"})}catch(n){console.error("Failed to restore event:",n),U({isVisible:!0,message:"Unable to restore event",type:"error"})}}function Z(){t({isOpen:!1,isLoading:!1})}function ee(s){m({isOpen:!0,eventId:s,isLoading:!1})}async function ae(){if(x.eventId){m(s=>({...s,isLoading:!0}));try{const s=await q.post(`/events/${x.eventId}/publish`);s.data.status==="success"?(U({isVisible:!0,message:"Event published successfully",type:"success"}),m({isOpen:!1,isLoading:!1}),S()):(U({isVisible:!0,message:s.data.message||"Unable to publish event",type:"error"}),m({isOpen:!1,isLoading:!1}))}catch(s){console.error("Failed to publish event:",s),U({isVisible:!0,message:"Unable to publish event",type:"error"}),m({isOpen:!1,isLoading:!1})}}}function re(){m({isOpen:!1,isLoading:!1})}function ie(s,n){C({isOpen:!0,assignmentId:s,isLoading:!1,workerName:n})}async function se(){var s,n;if(j.assignmentId){C(y=>({...y,isLoading:!0}));try{const y=await q.delete(`/staffing/${j.assignmentId}`);((s=y.data)==null?void 0:s.status)==="success"?(U({isVisible:!0,message:"Worker unassigned successfully",type:"success"}),C({isOpen:!1,isLoading:!1}),S()):(U({isVisible:!0,message:((n=y.data)==null?void 0:n.message)||"Unable to unassign worker",type:"error"}),C({isOpen:!1,isLoading:!1}))}catch(y){console.error("Failed to unassign worker:",y),U({isVisible:!0,message:"Unable to unassign worker",type:"error"}),C({isOpen:!1,isLoading:!1})}}}const le=s=>{A({isOpen:!0,shiftId:s})},te=()=>{A({isOpen:!1})},ne=()=>{te(),U({isVisible:!0,message:"Worker assigned",type:"success"}),S()},H=f.filter(s=>{var n;if(u){const y=u.toLowerCase();if(!(s.title.toLowerCase().includes(y)||((n=s.venue)==null?void 0:n.name.toLowerCase().includes(y))))return!1}if(b==="active")switch(r){case"needs_workers":return s.unfilled_roles_count>0;case"partially_filled":return s.unfilled_roles_count>0&&s.assigned_workers_count>0;case"fully_staffed":return s.unfilled_roles_count===0&&s.assigned_workers_count>0;case"all":default:return!0}return!0}).sort((s,n)=>{var y,R;switch(_){case"name":return s.title.localeCompare(n.title);case"staffing":return s.staffing_percentage-n.staffing_percentage;case"date":default:const G=((y=s.schedule)==null?void 0:y.start_time_utc)||s.created_at,V=((R=n.schedule)==null?void 0:R.start_time_utc)||n.created_at;return new Date(G).getTime()-new Date(V).getTime()}});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Events"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage events and assign workers"})]}),e.jsxs("button",{onClick:()=>d("/events/create"),className:"flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(be,{size:20}),"Create New Event"]})]}),p.get("date")&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-teal-50 border border-teal-200 rounded-lg",children:[e.jsx(xe,{size:16,className:"text-teal-600"}),e.jsxs("span",{className:"text-sm font-medium text-teal-900",children:["Showing events for ",K(Y(p.get("date")),"EEEE, MMMM d, yyyy")]}),e.jsx("button",{onClick:()=>{const s=new URLSearchParams(p);s.delete("date"),v(s)},className:"ml-auto text-teal-600 hover:text-teal-700",title:"Clear date filter",children:e.jsx(oe,{size:16})})]})]}),e.jsxs("div",{className:"flex gap-6 border-b border-gray-200 mb-6",children:[e.jsx("button",{onClick:()=>N("draft"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${b==="draft"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Draft Events"}),e.jsx("button",{onClick:()=>N("active"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${b==="active"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Active Events"}),e.jsx("button",{onClick:()=>N("completed"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${b==="completed"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Completed Events"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 max-w-md relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search events or venues...",value:u,onChange:s=>O(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),e.jsxs("select",{value:_,onChange:s=>w(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"name",children:"Sort by Name"}),b!=="draft"&&e.jsx("option",{value:"staffing",children:"Sort by Staffing"})]}),b==="active"&&e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:()=>g("needs_workers"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${r==="needs_workers"?"bg-red-100 text-red-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Needs Workers"})})]}),i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600"})}):e.jsxs(e.Fragment,{children:[b==="draft"&&e.jsx(Ie,{events:H,onDelete:I,onPublish:ee,onNavigate:s=>d(s),searchQuery:u}),b==="active"&&e.jsx(Ve,{events:H,expandedEvents:L,onToggleEvent:P,onAssignWorker:le,onUnassign:ie,onQuickFill:(s,n,y,R)=>k({isOpen:!0,eventId:s,roleName:n,unfilledShiftIds:y,payRate:R}),onPublish:ee,onDelete:I,onEdit:s=>$({isOpen:!0,event:s}),searchQuery:u}),b==="completed"&&e.jsx(Qe,{events:H,expandedEvents:L,onToggleEvent:P,searchQuery:u})]})]}),F.isOpen&&F.shiftId&&e.jsx(Ae,{shiftId:F.shiftId,onClose:te,onSuccess:ne}),e.jsx(we,{isVisible:Q.isVisible,message:Q.message,type:Q.type,action:Q.action,onClose:()=>U({...Q,isVisible:!1})}),e.jsx(ue,{isOpen:x.isOpen,onClose:re,onConfirm:ae,title:"Publish Event",message:"Ready to publish? This will create shifts and make them available for worker assignment.",confirmText:x.isLoading?"Publishingâ€¦":"Publish",cancelText:"Cancel",isLoading:x.isLoading,isDestructive:!1}),e.jsx(ue,{isOpen:j.isOpen,onClose:()=>C({isOpen:!1,isLoading:!1}),onConfirm:se,title:"Unassign Worker",message:`Remove ${j.workerName||"this worker"} from this shift?`,confirmText:j.isLoading?"Removingâ€¦":"Unassign",cancelText:"Cancel",isLoading:j.isLoading,isDestructive:!0}),e.jsx(ue,{isOpen:o.isOpen,onClose:Z,onConfirm:B,title:"Delete Event",message:`Delete "${o.eventTitle}"? This action cannot be undone.`,confirmText:o.isLoading?"Deletingâ€¦":"Delete",cancelText:"Cancel",isLoading:o.isLoading,isDestructive:!0}),e.jsx(Ue,{isOpen:l.isOpen,eventId:l.eventId||0,roleName:l.roleName||"",unfilledShiftIds:l.unfilledShiftIds,defaultPayRate:l.payRate,onClose:()=>k({isOpen:!1,unfilledShiftIds:[]}),onDone:({assigned:s,conflicts:n,details:y})=>{k({isOpen:!1,unfilledShiftIds:[]});let R=`Assigned ${s} workers â€¢ ${n} skipped`;n>0&&y&&(R+=`: ${y}`),U({isVisible:!0,message:R,type:n>0?"error":"success"}),S()}}),D.event&&e.jsx(We,{event:D.event,isOpen:D.isOpen,onClose:()=>$({isOpen:!1,event:void 0}),onSuccess:()=>{S(),$({isOpen:!1,event:void 0})}})]})}function Ie({events:d,onDelete:p,onPublish:v,onNavigate:a,searchQuery:W}){const b=r=>{if(!r)return"No date set";const E=Y(r);return K(E,"MMM d, yyyy")},h=r=>{if(!r)return"";const E=Y(r);return K(E,"h:mm a")};return d.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:W?"No draft events found":"No draft events yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:W?"Try adjusting your search query":"Create your first event to get started"}),!W&&e.jsxs("button",{onClick:()=>a("/events/create"),className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:[e.jsx(be,{size:20}),"Create Event"]})]}):e.jsx("div",{className:"space-y-4",children:d.map(r=>e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 flex-1",children:r.title}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Draft"})]}),r.venue&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[e.jsx(me,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:r.venue.name})]}),r.schedule&&e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{children:b(r.schedule.start_time_utc)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsxs("span",{children:[h(r.schedule.start_time_utc)," - ",h(r.schedule.end_time_utc)]})]})]}),r.total_workers_needed>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ge,{size:16,className:"text-gray-400"}),e.jsxs("span",{children:[r.total_workers_needed," workers needed"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>a(`/events/${r.id}/edit`),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Edit",children:e.jsx(Se,{size:18})}),e.jsx("button",{onClick:()=>v(r.id),className:"px-4 py-2 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Publish"}),e.jsx("button",{onClick:()=>p(r.id),className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition",title:"Delete",children:e.jsx(pe,{size:18})})]})]})})},r.id))})}function Ve({events:d,expandedEvents:p,onToggleEvent:v,onAssignWorker:a,onUnassign:W,onQuickFill:b,onPublish:h,onDelete:r,onEdit:E,searchQuery:u}){const O=i=>{const z=Y(i);return K(z,"EEE, MMM d, yyyy")},_=i=>{const z=Y(i);return K(z,"h:mm a")},w=i=>{switch(i){case"fully_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[e.jsx(je,{size:14}),"Ready"]});case"partially_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full",children:[e.jsx(fe,{size:14}),"Partial"]});case"needs_workers":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[e.jsx(oe,{size:14}),"Needs Workers"]});default:return null}};return d.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:u?"No active events found":"No active events"}),e.jsx("p",{className:"text-gray-600",children:u?"Try adjusting your search query or filters":"Publish draft events to see them here"})]}):e.jsx("div",{className:"space-y-4",children:d.map(i=>{const z=p.has(i.id);return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{onClick:()=>v(i.id),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:i.title}),w(i.staffing_status)]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[i.venue&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(me,{size:14,className:"text-gray-400"}),i.venue.name]}),i.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(xe,{size:14,className:"text-gray-400"}),O(i.schedule.start_time_utc)]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ce,{size:14,className:"text-gray-400"}),_(i.schedule.start_time_utc)]})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:[i.assigned_workers_count," of ",i.total_workers_needed," roles filled"]}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[i.staffing_percentage,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-full rounded-full transition-all ${i.staffing_percentage===100?"bg-green-500":i.staffing_percentage>0?"bg-yellow-500":"bg-red-500"}`,style:{width:`${i.staffing_percentage}%`}})})]}),i.unfilled_roles_count>0&&e.jsxs("p",{className:"text-sm text-red-600 font-medium",children:[i.unfilled_roles_count," role",i.unfilled_roles_count!==1?"s":""," still need workers"]}),i.shifts_by_role&&i.shifts_by_role.length>0&&e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Est. Cost: "}),e.jsxs("span",{className:"font-semibold text-green-600",children:["$",(()=>{let f=0;return i.shifts_by_role.forEach(M=>{M.shifts.forEach(L=>{const T=(new Date(L.end_time_utc).getTime()-new Date(L.start_time_utc).getTime())/36e5;L.assignments.forEach(F=>{const A=Number(F.hourly_rate||L.pay_rate||0);f+=A*T})})}),f.toFixed(0)})()]})]})]}),e.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[(!i.shifts_by_role||i.shifts_by_role.length===0)&&r&&e.jsx("button",{onClick:f=>{f.stopPropagation(),r(i.id)},className:"px-3 py-1.5 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition-colors",children:"Delete Event"}),E&&i.status==="published"&&e.jsx("button",{onClick:f=>{f.stopPropagation(),E(i)},title:"Edit Event",className:"p-1.5 text-teal-600 hover:text-teal-700 hover:bg-teal-50 rounded transition-colors",children:e.jsx(Re,{size:14})}),r&&e.jsx("button",{onClick:f=>{f.stopPropagation(),r(i.id)},title:"Delete",className:"p-1.5 text-red-600 hover:text-red-700 hover:bg-red-50 rounded transition-colors",children:e.jsx(pe,{size:14})}),e.jsx("div",{className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:z?e.jsx(ve,{size:24,className:"text-gray-600 hover:text-gray-800"}):e.jsx(Ce,{size:24,className:"text-gray-600 hover:text-gray-800"})})]})]}),z&&e.jsx("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:i.shifts_by_role&&i.shifts_by_role.length>0?e.jsx("div",{className:"space-y-4",children:i.shifts_by_role.map(f=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:f.role_name}),e.jsxs("span",{className:"text-sm text-gray-600",children:[f.filled_shifts,"/",f.total_shifts," assigned"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[f.filled_shifts<f.total_shifts&&e.jsxs("span",{className:"px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[f.total_shifts-f.filled_shifts," needed"]}),f.filled_shifts<f.total_shifts&&e.jsx("button",{onClick:M=>{var F;M.stopPropagation();const L=f.shifts.filter(A=>A.staffing_progress.percentage<100).sort((A,Q)=>new Date(A.start_time_utc).getTime()-new Date(Q.start_time_utc).getTime()).map(A=>A.id),T=(F=f.shifts[0])==null?void 0:F.pay_rate;b(i.id,f.role_name,L,T)},className:"px-2.5 py-1 text-xs font-semibold bg-teal-600 text-white rounded hover:bg-teal-700",title:"Quick Fill by Skill",children:"Quick Fill by Skill"})]})]}),e.jsx("div",{className:"space-y-2",children:f.shifts.map((M,L)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 text-gray-700 rounded-md flex items-center justify-center text-xs font-medium",children:L+1}),e.jsxs("span",{className:"text-sm text-gray-700",children:[_(M.start_time_utc)," - ",_(M.end_time_utc)]}),M.assignments.length>0&&e.jsx("div",{className:"flex items-center gap-1",children:M.assignments.map(T=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"px-2 py-0.5 bg-teal-100 text-teal-700 text-xs rounded",children:[T.worker.first_name," ",T.worker.last_name[0],".",e.jsxs("span",{className:"ml-1 text-teal-600 font-medium",children:["$",Number(T.hourly_rate||M.pay_rate||0).toFixed(0),"/hr"]})]}),e.jsx("button",{onClick:F=>{F.stopPropagation(),W(T.id,`${T.worker.first_name} ${T.worker.last_name}`)},className:"w-5 h-5 flex items-center justify-center text-red-600 hover:text-red-700 hover:bg-red-50 rounded",title:"Unassign worker",children:e.jsx(oe,{size:12})})]},T.id))})]}),M.staffing_progress.percentage===100?e.jsxs("span",{className:"flex items-center gap-1.5 text-sm font-medium text-green-600",children:[e.jsx(je,{size:16}),"Assigned"]}):e.jsx("button",{onClick:T=>{T.stopPropagation(),a(M.id)},className:"px-3 py-1.5 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Assign Worker"})]},M.id))})]},f.role_name))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:i.status==="draft"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"This event is still in draft status"}),e.jsx("p",{className:"text-sm",children:"Publish the event to generate shifts and assign workers"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"No shifts available"}),e.jsx("p",{className:"text-sm",children:"This event may not have any shifts generated yet"})]})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[i.status==="draft"&&e.jsx("button",{onClick:()=>h(i.id),className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors",children:"Publish Event"}),r&&e.jsx("button",{onClick:()=>r(i.id),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Delete Event"})]})]})})]},i.id)})})}function Qe({events:d,expandedEvents:p,onToggleEvent:v,searchQuery:a}){const W=h=>{const r=Y(h);return K(r,"MMM d, yyyy")},b=h=>{const r=Y(h);return K(r,"h:mm a")};return d.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“‹"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:a?"No past events found":"No past events yet"}),e.jsx("p",{className:"text-gray-600",children:a?"Try adjusting your search query":"Completed events will appear here"})]}):e.jsx("div",{className:"space-y-4",children:d.map(h=>{var u;const r=p.has(h.id);let E=0;return(u=h.shifts_by_role)==null||u.forEach(O=>{O.shifts.forEach(_=>{_.assignments.forEach(w=>{const i=w.hours_worked?parseFloat(w.hours_worked.toString()):0;E+=i})})}),E=Number(E)||0,e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{onClick:()=>v(h.id),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:h.title}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Completed"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[h.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(xe,{size:14,className:"text-gray-400"}),W(h.schedule.start_time_utc)]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ce,{size:14,className:"text-gray-400"}),b(h.schedule.start_time_utc)," - ",b(h.schedule.end_time_utc)]})]}),h.venue&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(me,{size:14,className:"text-gray-400"}),h.venue.name]})]})]}),e.jsx("div",{className:"ml-4 flex items-center",children:e.jsx("div",{className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:r?e.jsx(ve,{size:24,className:"text-gray-600 hover:text-gray-800"}):e.jsx(Ce,{size:24,className:"text-gray-600 hover:text-gray-800"})})})]}),r&&h.shifts_by_role&&e.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:[e.jsx("div",{className:"mb-4 p-4 bg-white rounded-lg border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Workers"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:h.assigned_workers_count})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Hours"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:E.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Event Cost"}),e.jsxs("p",{className:"text-2xl font-semibold text-green-600",children:["$",(()=>{let O=0;return h.shifts_by_role.forEach(_=>{_.shifts.forEach(w=>{const i=(new Date(w.end_time_utc).getTime()-new Date(w.start_time_utc).getTime())/36e5;w.assignments.forEach(z=>{const f=Number(z.hourly_rate||w.pay_rate||0);O+=f*i})})}),O.toFixed(0)})()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Staffing"}),e.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[h.staffing_percentage,"%"]})]})]})}),e.jsx("div",{className:"space-y-3",children:h.shifts_by_role.map(O=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:O.role_name}),e.jsx("div",{className:"space-y-2",children:O.shifts.flatMap(_=>_.assignments.map(w=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 text-teal-700 flex items-center justify-center text-sm font-medium",children:[w.worker.first_name[0],w.worker.last_name[0]]}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[w.worker.first_name," ",w.worker.last_name]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[w.hours_worked&&e.jsxs("span",{className:"font-medium",children:[parseFloat(w.hours_worked.toString()).toFixed(2)," hrs"]}),e.jsxs("span",{className:"font-medium text-green-600",children:["$",Number(w.hourly_rate||_.pay_rate||0).toFixed(0),"/hr"]}),w.hours_worked&&e.jsxs("span",{className:"font-semibold text-blue-600",children:["$",(parseFloat(w.hours_worked.toString())*Number(w.hourly_rate||_.pay_rate||0)).toFixed(0)]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[b(_.start_time_utc)," - ",b(_.end_time_utc)]})]})]},w.id)))})]},O.role_name))})]})]},h.id)})})}export{ds as EventsPage};
