import{a as z,j as e}from"./index-CHlUjhV3.js";import{r as m,c as G,f as ee}from"./vendor-Z5FP5jVZ.js";import{X as U,P as J}from"./x-Ie4PY792.js";import{C as q,f as k}from"./index-DM8BBHfE.js";import{M as O}from"./map-pin-CqRl3AqD.js";import{U as R}from"./users-CpXYwZgL.js";import{A as B}from"./alert-circle-CuRrzopE.js";import{S as K,T as se}from"./trash-2-BVeOl9Zs.js";import{p as C}from"./index-CrQ3XRgF.js";import{C as I}from"./calendar-CzLs7Meh.js";import{P as te}from"./pen-square-B2Diqmyv.js";import{C as Q,a as V}from"./chevron-up-CaLpeZeU.js";import{c as ae}from"./createLucideIcon-VuOQmetB.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=ae("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);function re({shiftId:h,onClose:y,onSuccess:N}){var P,A;const[a,f]=m.useState(null),[c,n]=m.useState([]),[l,j]=m.useState([]),[s,u]=m.useState(""),[i,o]=m.useState(null),[T,b]=m.useState(!0),[D,L]=m.useState(!1),[_,v]=m.useState(null);m.useEffect(()=>{F()},[h]),m.useEffect(()=>{a&&W()},[a]),m.useEffect(()=>{if(!s)j(c);else{const t=s.toLowerCase();j(c.filter(x=>{var p;return x.first_name.toLowerCase().includes(t)||x.last_name.toLowerCase().includes(t)||x.email.toLowerCase().includes(t)||((p=x.skills_json)==null?void 0:p.some(w=>w.toLowerCase().includes(t)))}))}},[s,c]);async function F(){try{const t=await z.get(`/shifts/${h}`);t.data.status==="success"?f(t.data.data):v("Failed to load shift details")}catch(t){console.error("Failed to load shift details:",t),v("Failed to load shift details")}}async function W(){try{const t=await z.get("/workers?active=true");if(t.data.status==="success"){const x=t.data.data.workers||t.data.data;if(a!=null&&a.role_needed){const p=x.filter(w=>{var g;return(g=w.skills_json)==null?void 0:g.includes(a.role_needed)});n(p)}else n(x)}else v("Failed to load workers")}catch(t){console.error("Failed to load workers:",t),v("Failed to load workers")}finally{b(!1)}}async function E(){var t,x,p,w;if(!(!i||!a)){L(!0),v(null);try{const r=(await z.post("/staffing",{assignment:{shift_id:a.id,worker_id:i.id,status:"assigned",assigned_at_utc:new Date().toISOString()}})).data;if(r.status==="success")N();else{const d=r.errors?r.errors.join(". "):r.message||"Failed to assign worker";v(d)}}catch(g){console.error("Failed to assign worker:",g);let r="Failed to assign worker";(x=(t=g.response)==null?void 0:t.data)!=null&&x.errors?r=g.response.data.errors.join(". "):(w=(p=g.response)==null?void 0:p.data)!=null&&w.message?r=g.response.data.message:g.message&&(r=g.message),v(r)}finally{L(!1)}}}const M=t=>{try{return k(C(t),"MMM d, yyyy h:mm a")}catch{return t}},S=t=>{try{return k(C(t),"h:mm a")}catch{return t}};return T?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-600"})})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Assign Worker"}),a&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[a.client_name," â€¢ ",a.role_needed]})]}),e.jsx("button",{onClick:y,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition",children:e.jsx(U,{size:20})})]}),e.jsxs("div",{className:"flex h-[600px]",children:[e.jsx("div",{className:"w-1/3 border-r border-gray-200 p-6 bg-gray-50",children:a?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Shift Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(q,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:M(a.start_time_utc)}),e.jsxs("div",{className:"text-sm text-gray-600",children:[S(a.start_time_utc)," - ",S(a.end_time_utc)]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(O,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"text-sm text-gray-900",children:a.location||((A=(P=a.event)==null?void 0:P.venue)==null?void 0:A.formatted_address)||"Location not specified"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(R,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900",children:a.role_needed}),a.required_skill&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Requires: ",a.required_skill]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Pay Rate:"})," $",a.pay_rate,"/hour"]}),a.uniform_name&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",a.uniform_name]})]}),a.notes&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Notes:"}),e.jsx("div",{className:"mt-1 whitespace-pre-line",children:a.notes.split("Uniform:").map((t,x)=>x===0?t.trim():e.jsxs("div",{children:[e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",t.trim()]},x))})]})})]})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(B,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Failed to load shift details"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search workers by name, email, or skills...",value:s,onChange:t=>u(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:_?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(B,{size:32,className:"text-red-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-red-600",children:_})]}):l.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(R,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:s?"No workers found matching your search":a!=null&&a.role_needed?`No workers found with "${a.role_needed}" skill`:"No available workers"}),(a==null?void 0:a.role_needed)&&!s&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:['Try adding "',a.role_needed,'" skill to workers or select a different shift.']})]}):e.jsx("div",{className:"space-y-3",children:l.map(t=>e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${(i==null?void 0:i.id)===t.id?"border-teal-500 bg-teal-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,onClick:()=>o(t),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-teal-100 flex items-center justify-center",children:e.jsxs("span",{className:"text-sm font-medium text-teal-700",children:[t.first_name[0],t.last_name[0]]})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900",children:[t.first_name," ",t.last_name]}),e.jsx("p",{className:"text-sm text-gray-600",children:t.email})]})]}),t.skills_json&&t.skills_json.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[t.skills_json.slice(0,3).map((x,p)=>e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded",children:x},p)),t.skills_json&&t.skills_json.length>3&&e.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded",children:["+",t.skills_json.length-3," more"]})]}),t.phone&&e.jsx("p",{className:"text-sm text-gray-600",children:t.phone})]}),(i==null?void 0:i.id)===t.id&&e.jsx("div",{className:"w-6 h-6 rounded-full bg-teal-600 flex items-center justify-center",children:e.jsx(U,{size:14,className:"text-white"})})]})},t.id))})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:[_&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-600",children:_})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:y,className:"flex-1 px-4 py-2 bg-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-400 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:E,disabled:!i||D,className:"flex-1 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:D?"Assigning...":"Assign Worker"})]})]})]})]})]})})}function Ne(){const h=G(),[y,N]=ee(),a=y.get("tab")||"active",f=y.get("filter")||"all",[c,n]=m.useState(a),[l,j]=m.useState(f),[s,u]=m.useState(""),[i,o]=m.useState("date"),[T,b]=m.useState(!0),[D,L]=m.useState([]),[_,v]=m.useState(new Set),[F,W]=m.useState({isOpen:!1});m.useEffect(()=>{E()},[c,l]);async function E(){b(!0);try{const r=`/events?tab=${c}${l!=="all"?`&filter=${l}`:""}`,d=await z.get(r);d.data.status==="success"&&L(d.data.data)}catch(r){console.error("Failed to load events:",r)}finally{b(!1)}}const M=r=>{n(r),N({tab:r}),j("all")},S=r=>{j(r)},P=r=>{const d=new Set(_);d.has(r)?d.delete(r):d.add(r),v(d)};async function A(r){if(confirm("Are you sure you want to delete this event?"))try{(await z.delete(`/events/${r}`)).data.status==="success"&&E()}catch(d){console.error("Failed to delete event:",d)}}async function t(r){if(confirm("Publish this event? This will create shifts and make them available for staffing."))try{const d=await z.post(`/events/${r}/publish`);d.data.status==="success"?(alert(d.data.message),E()):alert(d.data.message||"Failed to publish event")}catch(d){console.error("Failed to publish event:",d)}}const x=r=>{W({isOpen:!0,shiftId:r})},p=()=>{W({isOpen:!1})},w=()=>{p(),E()},g=D.filter(r=>{var $;if(!s)return!0;const d=s.toLowerCase();return r.title.toLowerCase().includes(d)||(($=r.venue)==null?void 0:$.name.toLowerCase().includes(d))}).sort((r,d)=>{var $,H;switch(i){case"name":return r.title.localeCompare(d.title);case"staffing":return r.staffing_percentage-d.staffing_percentage;case"date":default:const Y=(($=r.schedule)==null?void 0:$.start_time_utc)||r.created_at,Z=((H=d.schedule)==null?void 0:H.start_time_utc)||d.created_at;return new Date(Y).getTime()-new Date(Z).getTime()}});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Events"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage events and assign workers"})]}),e.jsxs("button",{onClick:()=>h("/events/create"),className:"flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(J,{size:20}),"Create New Event"]})]}),e.jsxs("div",{className:"flex gap-6 border-b border-gray-200 mb-6",children:[e.jsx("button",{onClick:()=>M("draft"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${c==="draft"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Draft Events"}),e.jsx("button",{onClick:()=>M("active"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${c==="active"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Active Events"}),e.jsx("button",{onClick:()=>M("past"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${c==="past"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Past Events"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 max-w-md relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search events or venues...",value:s,onChange:r=>u(r.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),e.jsxs("select",{value:i,onChange:r=>o(r.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"name",children:"Sort by Name"}),c!=="draft"&&e.jsx("option",{value:"staffing",children:"Sort by Staffing"})]}),c==="active"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>S("all"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${l==="all"?"bg-teal-100 text-teal-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"All"}),e.jsx("button",{onClick:()=>S("needs_workers"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${l==="needs_workers"?"bg-red-100 text-red-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Needs Workers"}),e.jsx("button",{onClick:()=>S("partially_filled"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${l==="partially_filled"?"bg-yellow-100 text-yellow-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Partial"}),e.jsx("button",{onClick:()=>S("fully_staffed"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${l==="fully_staffed"?"bg-green-100 text-green-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Ready"})]})]}),T?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600"})}):e.jsxs(e.Fragment,{children:[c==="draft"&&e.jsx(le,{events:g,onDelete:A,onPublish:t,onNavigate:r=>h(r),searchQuery:s}),c==="active"&&e.jsx(ie,{events:g,expandedEvents:_,onToggleEvent:P,onAssignWorker:x,onDelete:A,searchQuery:s}),c==="past"&&e.jsx(ne,{events:g,expandedEvents:_,onToggleEvent:P,searchQuery:s})]})]}),F.isOpen&&F.shiftId&&e.jsx(re,{shiftId:F.shiftId,onClose:p,onSuccess:w})]})}function le({events:h,onDelete:y,onPublish:N,onNavigate:a,searchQuery:f}){const c=l=>l?k(C(l),"MMM d, yyyy"):"No date set",n=l=>l?k(C(l),"h:mm a"):"";return h.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:f?"No draft events found":"No draft events yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:f?"Try adjusting your search query":"Create your first event to get started"}),!f&&e.jsxs("button",{onClick:()=>a("/events/create"),className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:[e.jsx(J,{size:20}),"Create Event"]})]}):e.jsx("div",{className:"space-y-4",children:h.map(l=>e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 flex-1",children:l.title}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Draft"})]}),l.venue&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[e.jsx(O,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:l.venue.name})]}),l.schedule&&e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{children:c(l.schedule.start_time_utc)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsxs("span",{children:[n(l.schedule.start_time_utc)," - ",n(l.schedule.end_time_utc)]})]})]}),l.total_workers_needed>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(R,{size:16,className:"text-gray-400"}),e.jsxs("span",{children:[l.total_workers_needed," workers needed"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>a(`/events/${l.id}/edit`),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Edit",children:e.jsx(te,{size:18})}),e.jsx("button",{onClick:()=>N(l.id),className:"px-4 py-2 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Publish"}),e.jsx("button",{onClick:()=>y(l.id),className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition",title:"Delete",children:e.jsx(se,{size:18})})]})]})})},l.id))})}function ie({events:h,expandedEvents:y,onToggleEvent:N,onAssignWorker:a,onDelete:f,searchQuery:c}){const n=s=>k(C(s),"EEE, MMM d, yyyy"),l=s=>k(C(s),"h:mm a"),j=s=>{switch(s){case"fully_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[e.jsx(X,{size:14}),"Ready"]});case"partially_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full",children:[e.jsx(B,{size:14}),"Partial"]});case"needs_workers":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[e.jsx(U,{size:14}),"Needs Workers"]});default:return null}};return h.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:c?"No active events found":"No active events"}),e.jsx("p",{className:"text-gray-600",children:c?"Try adjusting your search query or filters":"Publish draft events to see them here"})]}):e.jsx("div",{className:"space-y-4",children:h.map(s=>{const u=y.has(s.id);return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("button",{onClick:()=>N(s.id),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.title}),j(s.staffing_status)]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[s.venue&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(O,{size:14,className:"text-gray-400"}),s.venue.name]}),s.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(I,{size:14,className:"text-gray-400"}),n(s.schedule.start_time_utc)]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(q,{size:14,className:"text-gray-400"}),l(s.schedule.start_time_utc)]})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:[s.assigned_workers_count," of ",s.total_workers_needed," roles filled"]}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[s.staffing_percentage,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-full rounded-full transition-all ${s.staffing_percentage===100?"bg-green-500":s.staffing_percentage>0?"bg-yellow-500":"bg-red-500"}`,style:{width:`${s.staffing_percentage}%`}})})]}),s.unfilled_roles_count>0&&e.jsxs("p",{className:"text-sm text-red-600 font-medium",children:[s.unfilled_roles_count," role",s.unfilled_roles_count!==1?"s":""," still need workers"]})]}),e.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[(!s.shifts_by_role||s.shifts_by_role.length===0)&&f&&e.jsx("button",{onClick:i=>{i.stopPropagation(),f(s.id)},className:"px-3 py-1.5 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition-colors",children:"Delete Event"}),e.jsx("div",{className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:u?e.jsx(Q,{size:24,className:"text-gray-600 hover:text-gray-800"}):e.jsx(V,{size:24,className:"text-gray-600 hover:text-gray-800"})})]})]}),u&&e.jsx("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:s.shifts_by_role&&s.shifts_by_role.length>0?e.jsx("div",{className:"space-y-4",children:s.shifts_by_role.map(i=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:i.role_name}),e.jsxs("span",{className:"text-sm text-gray-600",children:[i.filled_shifts,"/",i.total_shifts," assigned"]})]}),i.filled_shifts<i.total_shifts&&e.jsxs("span",{className:"px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[i.total_shifts-i.filled_shifts," needed"]})]}),e.jsx("div",{className:"space-y-2",children:i.shifts.map((o,T)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["#",T+1]}),e.jsxs("span",{className:"text-sm text-gray-700",children:[l(o.start_time_utc)," - ",l(o.end_time_utc)]}),o.assignments.length>0&&e.jsx("div",{className:"flex items-center gap-1",children:o.assignments.map(b=>e.jsxs("span",{className:"px-2 py-0.5 bg-teal-100 text-teal-700 text-xs rounded",children:[b.worker.first_name," ",b.worker.last_name[0],"."]},b.id))})]}),o.staffing_progress.percentage===100?e.jsxs("span",{className:"flex items-center gap-1.5 text-sm font-medium text-green-600",children:[e.jsx(X,{size:16}),"Assigned"]}):e.jsx("button",{onClick:b=>{b.stopPropagation(),a(o.id)},className:"px-3 py-1.5 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Assign Worker"})]},o.id))})]},i.role_name))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:s.status==="draft"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"This event is still in draft status"}),e.jsx("p",{className:"text-sm",children:"Publish the event to generate shifts and assign workers"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"No shifts available"}),e.jsx("p",{className:"text-sm",children:"This event may not have any shifts generated yet"})]})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[s.status==="draft"&&e.jsx("button",{onClick:()=>{console.log("Publish event:",s.id)},className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors",children:"Publish Event"}),f&&e.jsx("button",{onClick:()=>f(s.id),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Delete Event"})]})]})})]},s.id)})})}function ne({events:h,expandedEvents:y,onToggleEvent:N,searchQuery:a}){const f=n=>k(C(n),"MMM d, yyyy"),c=n=>k(C(n),"h:mm a");return h.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“‹"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:a?"No past events found":"No past events yet"}),e.jsx("p",{className:"text-gray-600",children:a?"Try adjusting your search query":"Completed events will appear here"})]}):e.jsx("div",{className:"space-y-4",children:h.map(n=>{var s;const l=y.has(n.id);let j=0;return(s=n.shifts_by_role)==null||s.forEach(u=>{u.shifts.forEach(i=>{i.assignments.forEach(o=>{j+=o.hours_worked||0})})}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("button",{onClick:()=>N(n.id),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:n.title}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Completed"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[n.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(I,{size:14,className:"text-gray-400"}),f(n.schedule.start_time_utc)]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(q,{size:14,className:"text-gray-400"}),c(n.schedule.start_time_utc)," - ",c(n.schedule.end_time_utc)]})]}),n.venue&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(O,{size:14,className:"text-gray-400"}),n.venue.name]})]})]}),e.jsx("div",{className:"ml-4 flex items-center",children:e.jsx("div",{className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:l?e.jsx(Q,{size:24,className:"text-gray-600 hover:text-gray-800"}):e.jsx(V,{size:24,className:"text-gray-600 hover:text-gray-800"})})})]}),l&&n.shifts_by_role&&e.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:[e.jsx("div",{className:"mb-4 p-4 bg-white rounded-lg border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Workers"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:n.assigned_workers_count})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Hours"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:j.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Staffing"}),e.jsxs("p",{className:"text-2xl font-semibold text-green-600",children:[n.staffing_percentage,"%"]})]})]})}),e.jsx("div",{className:"space-y-3",children:n.shifts_by_role.map(u=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:u.role_name}),e.jsx("div",{className:"space-y-2",children:u.shifts.flatMap(i=>i.assignments.map(o=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 text-teal-700 flex items-center justify-center text-sm font-medium",children:[o.worker.first_name[0],o.worker.last_name[0]]}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[o.worker.first_name," ",o.worker.last_name]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[o.hours_worked&&e.jsxs("span",{className:"font-medium",children:[o.hours_worked.toFixed(2)," hrs"]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[c(i.start_time_utc)," - ",c(i.end_time_utc)]})]})]},o.id)))})]},u.role_name))})]})]},n.id)})})}export{Ne as EventsPage};
