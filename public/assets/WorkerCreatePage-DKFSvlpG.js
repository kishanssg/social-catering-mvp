import{c as Pe,a as Y,j as e,X as Ae}from"./index-rF7AQh94.js";import{i as Fe,b as Ee,r as m}from"./vendor-79DyBOV9.js";import{L as Le}from"./LoadingSpinner-DHEncy09.js";import{T as Re}from"./Toast-BXu6Fpt7.js";import{u as We,c as Be}from"./useCertificationsCatalog-D8KmlJIX.js";import{b as $,a as Z,c as ee,e as te,p as se}from"./Prep Cook-li-JR_eG.js";import{f as Me,a as $e,n as re}from"./phone-DFL4-DJ9.js";import{C as ze}from"./chevron-right-C97807_j.js";import{U as Oe}from"./user-DJuaEQ8T.js";import{P as Ve}from"./plus-CJS0K595.js";import"./x-circle-V7-SXx_8.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=Pe("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function tt(){const{id:k}=Fe(),I=Ee(),b=!!k,z=m.useRef(null),[p,O]=m.useState("details"),[V,P]=m.useState(!1),[ae,H]=m.useState(!1),[D,U]=m.useState(!1),A=m.useRef([]),[y,j]=m.useState([]),{certifications:_}=We(),[r,x]=m.useState({first_name:"",last_name:"",email:"",phone:"",address_line1:"",address_line2:"",profile_photo_url:"",skills:[]}),[T,q]=m.useState(null),[N,F]=m.useState(null),[c,ie]=m.useState({}),[w,E]=m.useState({isVisible:!1,message:"",type:"success"}),L=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),R=t=>re(t).length===10,ne=t=>{const s=$e(t);x({...r,phone:s})},G=[{name:"Bartender",icon:$},{name:"Banquet Server/Runner",icon:Z},{name:"Captain",icon:ee},{name:"Event Helper",icon:te},{name:"Prep Cook",icon:se}],oe=t=>({Bartender:$,"Banquet Server/Runner":Z,Captain:ee,"Event Helper":te,"Prep Cook":se})[t]||$;m.useEffect(()=>{b?le():(A.current=[],j([]))},[k,b]);async function le(){H(!0);try{const t=await Y.get(`/workers/${k}`);if(t.data.status==="success"){const s=t.data.data.worker;let n=[];Array.isArray(s==null?void 0:s.worker_certifications)?n=s.worker_certifications.map(a=>{var l,d;return{worker_certification_id:a.id,certification_id:a.certification_id??((l=a.certification)==null?void 0:l.id),certification_name:((d=a.certification)==null?void 0:d.name)??a.name,expires_at_utc:a.expires_at_utc}}):Array.isArray(s==null?void 0:s.certifications)&&(n=s.certifications.map(a=>{var l,d;return{worker_certification_id:a.worker_certification_id||((l=a.worker_certification)==null?void 0:l.id)||null,certification_id:a.id??a.certification_id,certification_name:a.name??((d=a.certification)==null?void 0:d.name),expires_at_utc:a.expires_at_utc}}));const i=n.filter(a=>a.certification_id!=null&&a.certification_id!==void 0&&a.certification_id!=="").map(a=>({workerCertificationId:a.worker_certification_id||void 0,certificationId:a.certification_id,certificationName:a.certification_name,expiresAt:a.expires_at_utc?String(a.expires_at_utc).split("T")[0]:""}));A.current=i,j(i),x(a=>({...a,first_name:s.first_name||"",last_name:s.last_name||"",email:s.email||"",phone:s.phone_formatted||Me(s.phone)||"",address_line1:s.address_line1||"",address_line2:s.address_line2||"",profile_photo_url:s.profile_photo_url||"",skills:s.skills_json||[]})),s.profile_photo_url&&F(s.profile_photo_url)}}catch(t){console.error("Failed to load worker:",t)}finally{H(!1)}}function ce(){var t;(t=z.current)==null||t.click()}function de(t){var i;const s=(i=t.target.files)==null?void 0:i[0];if(!s||!s.type.startsWith("image/")||s.size>5*1024*1024)return;q(s);const n=new FileReader;n.onloadend=()=>F(n.result),n.readAsDataURL(s)}const me=y.map(t=>t.certificationId).filter(t=>typeof t=="number"),C=_.filter(t=>!me.includes(t.id)).length>0,fe=t=>{const s=y[t],n=y.filter((a,l)=>l!==t).map(a=>a.certificationId).filter(a=>typeof a=="number");let i=_.filter(a=>!n.includes(a.id));return s.certificationId&&!i.some(a=>a.id===s.certificationId)&&(i=[{id:s.certificationId,name:s.certificationName||"Unknown certification"},...i]),i},pe=()=>{C&&j(t=>[...t,{certificationId:void 0,certificationName:"",expiresAt:""}])},xe=(t,s)=>{j(n=>n.map((i,a)=>{if(a!==t)return i;const l=_.find(d=>d.id===s||d.id===Number(s));return{...i,certificationId:s??void 0,certificationName:(l==null?void 0:l.name)||i.certificationName}}))},he=(t,s)=>{j(n=>n.map((i,a)=>a===t?{...i,expiresAt:s}:i))},ue=t=>{j(s=>s.filter((n,i)=>i!==t))},ge=()=>{const t=new Map;y.forEach(i=>{i.certificationId&&t.set(i.certificationId,i)});const s=[],n=new Set;return Array.from(t.values()).forEach(i=>{if(!i.certificationId)return;const a={certification_id:i.certificationId};i.expiresAt&&(a.expires_at_utc=i.expiresAt),i.workerCertificationId&&(a.id=i.workerCertificationId,n.add(i.workerCertificationId)),s.push(a)}),A.current.forEach(i=>{i.workerCertificationId&&!n.has(i.workerCertificationId)&&s.push({id:i.workerCertificationId,_destroy:!0})}),s.reduce((i,a,l)=>{const d=Object.entries(a).reduce((v,[S,g])=>(g!=null&&g!==""&&(v[S]=g),v),{});return i[l.toString()]=d,i},{})};async function be(){var t,s,n,i,a,l,d,v,S,g,J,X,K;P(!0);try{h("first_name",r.first_name),h("last_name",r.last_name),h("email",r.email),h("phone",r.phone);const o=r.first_name.trim().length>=2,u=r.last_name.trim().length>=2,ke=!!r.email.trim()&&L(r.email),_e=!!r.phone.trim()&&R(r.phone);if(!o||!u||!ke||!_e){P(!1);return}const Ne=b?"PATCH":"POST",we=b?`/workers/${k}`:"/workers",f=new FormData;f.append("worker[first_name]",r.first_name||""),f.append("worker[last_name]",r.last_name||""),f.append("worker[email]",r.email||""),f.append("worker[phone]",re(r.phone)||""),r.address_line1&&f.append("worker[address_line1]",r.address_line1),r.address_line2&&f.append("worker[address_line2]",r.address_line2),r.skills.forEach(M=>f.append("worker[skills_json][]",M));const B=ge();console.log("Worker certification payload:",B),Object.entries(B).forEach(([M,Ce])=>{Object.entries(Ce).forEach(([Se,Ie])=>{f.append(`worker[worker_certifications_attributes][${M}][${Se}]`,String(Ie))})}),T&&f.append("profile_photo",T),console.log("Submitting worker form:",{first_name:r.first_name,last_name:r.last_name,email:r.email,phone:r.phone,skills_count:r.skills.length,certifications_count:B.length});const Q=await Y.request({method:Ne,url:we,data:f});Q.data.status==="success"?I("/workers"):E({isVisible:!0,message:((t=Q.data.errors)==null?void 0:t.join(", "))||"Failed to save worker",type:"error"})}catch(o){console.error("Failed to save worker:",o),console.error("Error response:",(s=o.response)==null?void 0:s.data),console.error("Error status:",(n=o.response)==null?void 0:n.status);let u="Failed to save worker";((a=(i=o.response)==null?void 0:i.data)==null?void 0:a.status)==="validation_error"&&((d=(l=o.response)==null?void 0:l.data)!=null&&d.errors)||(S=(v=o.response)==null?void 0:v.data)!=null&&S.errors?u=Array.isArray(o.response.data.errors)?o.response.data.errors.join(", "):String(o.response.data.errors):(J=(g=o.response)==null?void 0:g.data)!=null&&J.message?u=o.response.data.message:(K=(X=o.response)==null?void 0:X.data)!=null&&K.error?u=o.response.data.error:o.message&&(u=o.message),E({isVisible:!0,message:u,type:"error"})}finally{P(!1)}}const W=[{id:1,title:"Add New Worker",description:"Invite a new user to join as a Worker.",completed:p==="skills",active:p==="details"},{id:2,title:"Add Skills",description:"Specify Worker's Skills.",completed:!1,active:p==="skills"}],h=(t,s)=>{const n={...c};switch(t){case"first_name":s.length<2?n.first_name="First name must be at least 2 characters":delete n.first_name;break;case"last_name":s.length<2?n.last_name="Last name must be at least 2 characters":delete n.last_name;break;case"email":s.trim()?L(s)?delete n.email:n.email="Please enter a valid email address":n.email="Email is required";break;case"phone":s.length>0&&!R(s)?n.phone="Please enter a valid phone number (10-15 digits only, no hyphens or spaces)":delete n.phone;break}ie(n)},ye=()=>{if(p==="details"){const t=r.first_name.trim().length>=2,s=r.last_name.trim().length>=2,n=!!r.email.trim()&&L(r.email),i=!!r.phone.trim()&&R(r.phone);return t&&s&&n&&i}return!0},je=()=>{p==="details"?O("skills"):be()},ve=()=>{p==="skills"&&O("details")};return ae?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Le,{})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-8 py-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("button",{onClick:()=>I("/workers"),className:"hover:text-gray-900 transition",children:"Workers"}),e.jsx(ze,{size:16}),e.jsx("span",{className:"text-gray-900",children:b?"Edit Worker":"Add New Worker"})]})})}),e.jsxs("div",{className:"flex flex-1 justify-center gap-12 px-8 min-h-0",style:{paddingTop:"80px",paddingBottom:"40px"},children:[e.jsx("div",{className:"w-[280px] flex-shrink-0 self-start",children:W.map((t,s)=>e.jsxs("div",{className:"flex gap-4",style:{minHeight:s<W.length-1?"100px":"auto"},children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full flex-shrink-0",style:{backgroundColor:t.completed?"#FFFFFF":t.active?"#000000":"transparent",border:t.completed||t.active?"2px solid #000000":"0.8px solid #292826",boxShadow:t.active||t.completed?"0 2px 8px 0 rgba(0,0,0,0.04)":"none"},children:t.completed?e.jsx("img",{src:Be,width:"18",height:"18",alt:"Completed",className:"flex-shrink-0"}):t.active?e.jsx("div",{className:"rounded-full bg-white",style:{width:"12px",height:"12px"}}):null}),s<W.length-1&&e.jsx("div",{className:"flex-1",style:{width:"2px",backgroundColor:"rgba(0,0,0,0.5)"}})]}),e.jsxs("div",{className:"flex flex-col gap-1 pt-1",children:[e.jsx("span",{className:"text-sm font-bold font-manrope leading-[140%] text-font-primary",children:t.title}),e.jsx("span",{className:"text-sm font-normal font-manrope leading-[140%] text-font-secondary",children:t.description})]})]},t.id))}),e.jsxs("div",{className:"flex flex-col p-8 rounded-lg border border-primary-color/10 bg-white self-start overflow-visible",style:{boxShadow:"0 2px 8px 0 rgba(0,0,0,0.04)",maxWidth:"850px",width:"100%",minHeight:"600px"},children:[e.jsx("div",{className:"flex flex-col gap-6 flex-1 overflow-visible pr-2",style:{fontFamily:"Manrope, sans-serif"},children:p==="details"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx("h2",{className:"text-xl font-bold text-font-primary",children:"Worker Details"})}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Phone number"}),e.jsx("input",{type:"tel",value:r.phone,onChange:t=>ne(t.target.value),onBlur:()=>h("phone",r.phone),className:`px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent ${c.phone?"border-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"386-456-8799"}),c.phone&&e.jsx("p",{className:"text-sm text-red-600",children:c.phone})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"First name"}),e.jsx("input",{type:"text",value:r.first_name,onChange:t=>x({...r,first_name:t.target.value}),onBlur:()=>h("first_name",r.first_name),className:`px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent ${c.first_name?"border-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"First name"}),c.first_name&&e.jsx("p",{className:"text-sm text-red-600",children:c.first_name})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Last name"}),e.jsx("input",{type:"text",value:r.last_name,onChange:t=>x({...r,last_name:t.target.value}),onBlur:()=>h("last_name",r.last_name),className:`px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent ${c.last_name?"border-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"Last name"}),c.last_name&&e.jsx("p",{className:"text-sm text-red-600",children:c.last_name})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Email address"}),e.jsx("input",{type:"email",value:r.email,onChange:t=>x({...r,email:t.target.value}),onBlur:()=>h("email",r.email),className:`px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:border-transparent ${c.email?"border-red-500":"border-gray-300 focus:ring-teal-500"}`,placeholder:"Email address"}),c.email&&e.jsx("p",{className:"text-sm text-red-600",children:c.email})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Home address"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx("input",{type:"text",value:r.address_line1,onChange:t=>x({...r,address_line1:t.target.value}),className:"px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"Address line 1"}),e.jsx("input",{type:"text",value:r.address_line2,onChange:t=>x({...r,address_line2:t.target.value}),className:"px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"Address line 2"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Profile Photo"}),e.jsxs("div",{className:"flex items-center gap-4 p-4 border border-gray-300 rounded-lg",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden",children:N?e.jsx("img",{src:N,alt:"Preview",className:"w-16 h-16 object-cover"}):e.jsx(Oe,{size:24,className:"text-gray-500"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{ref:z,type:"file",accept:"image/*",className:"hidden",onChange:de}),e.jsxs("button",{type:"button",onClick:ce,className:"text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center gap-2",children:[e.jsx(He,{size:16}),N?"Change Photo":"Upload Photo"]}),N&&e.jsx("button",{type:"button",onClick:()=>{q(null),F(null)},className:"text-red-600 hover:text-red-700 text-sm",children:"Remove"}),e.jsx("span",{className:"text-xs text-gray-500",children:"JPG, PNG up to 5MB"})]})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx("h2",{className:"text-xl font-bold text-font-primary",children:"Worker Skills"})}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("label",{className:"text-sm font-semibold font-manrope leading-[140%] text-font-primary",children:"Skills"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between h-11 px-4 rounded-lg border border-primary-color/10 bg-white cursor-pointer hover:border-primary-color/30 transition-colors",onClick:()=>U(!D),children:[e.jsx("span",{className:"text-sm font-normal font-manrope leading-[140%] text-primary-color",children:r.skills.length>0?r.skills.join(", "):"Pick the Skills the Worker Has"}),e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M4 6L8 10L12 6",stroke:"#292826",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]}),D&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border border-primary-color/10 rounded-lg shadow-lg z-50 max-h-[200px] overflow-y-auto",children:[G.filter(t=>!r.skills.includes(t.name)).map(t=>e.jsxs("div",{className:"flex items-center gap-3 px-3 py-2.5 cursor-pointer hover:bg-gray-50",onClick:()=>{x({...r,skills:[...r.skills,t.name]}),U(!1)},children:[e.jsx("img",{src:t.icon,width:"20",height:"20",alt:t.name,className:"flex-shrink-0",style:{imageRendering:"crisp-edges"}}),e.jsx("span",{className:"text-sm font-normal font-manrope leading-[140%] text-font-primary",children:t.name})]},t.name)),r.skills.length===G.length&&e.jsx("div",{className:"px-3 py-2.5 text-sm text-gray-500 text-center",children:"All skills selected"})]})]}),r.skills.length>0&&e.jsx("div",{className:"flex flex-col gap-3",children:r.skills.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-primary-color/10 bg-white",style:{boxShadow:"0 1px 2px rgba(0,0,0,0.06)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:oe(t),width:"24",height:"24",alt:t,className:"flex-shrink-0",style:{imageRendering:"crisp-edges"}}),e.jsx("span",{className:"text-sm font-semibold font-manrope leading-[140%] text-font-primary",children:t})]}),e.jsx("button",{onClick:()=>x({...r,skills:r.skills.filter(s=>s!==t)}),className:"flex items-center justify-center w-6 h-6 text-red-500 hover:bg-red-50 rounded",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 4L4 12M4 4L12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]},t))})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-font-primary",children:"Certifications"}),e.jsxs("div",{className:"space-y-3",children:[y.length===0&&e.jsx("p",{className:"text-sm text-font-secondary",children:"No certifications selected."}),y.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("select",{value:t.certificationId??"",onChange:n=>{const i=n.target.value?parseInt(n.target.value,10):null;xe(s,i)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"",children:"Select certificationâ€¦"}),fe(s).map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"date",value:t.expiresAt??"",onChange:n=>he(s,n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})}),e.jsx("button",{type:"button",onClick:()=>ue(s),className:"text-red-600 hover:text-red-800",children:e.jsx(Ae,{size:16})})]},t.workerCertificationId??`cert-row-${s}`))]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("button",{type:"button",onClick:pe,disabled:!C,className:`flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg transition ${C?"hover:bg-gray-50":"opacity-50 cursor-not-allowed"}`,children:[e.jsx(Ve,{size:16}),e.jsx("span",{children:"Add Certification"})]}),!C&&_.length>0&&e.jsx("p",{className:"text-xs text-font-secondary",children:"All available certifications have been assigned."})]})]})]})]})}),e.jsxs("div",{className:"flex justify-between items-center gap-4 pt-6 border-t border-gray-200",children:[e.jsx("div",{children:p==="skills"&&e.jsxs("button",{onClick:ve,className:"flex items-center gap-2 px-6 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M10 12L6 8L10 4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Back"]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>I("/workers"),className:"px-6 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{onClick:je,disabled:!ye()||V,className:"px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transition",children:V?"Saving...":p==="details"?"Continue":b?"Update Worker":"Create Worker"})]})]})]})]}),e.jsx(Re,{isVisible:w.isVisible,message:w.message,type:w.type,onClose:()=>E({...w,isVisible:!1})})]})}export{tt as WorkerCreatePage};
