import{f,p as j,j as e,U as z,t as F,d as V,v as R,w as O,g as W,X as G,x as I}from"./index-Bd8lQwgm.js";import{b as c,L as h}from"./vendor-B6rXSep8.js";import{u as X,A as u}from"./AssignmentStatusBadge-CSZhdFBw.js";import{B as q,T as H,C as J}from"./BulkAssignModal-BZtF-K0l.js";import{L as K,E as P}from"./ErrorMessage-BvqYYWcT.js";import{B as Q}from"./briefcase-FnnDe_KB.js";import{U as Y}from"./user-lk6zFlcK.js";const ie=()=>{const[t,n]=c.useState(""),[r,g]=c.useState(""),[l,y]=c.useState(""),[o,x]=c.useState("grouped"),[i,p]=c.useState(null),[B,w]=c.useState(!1),[b,v]=c.useState(null),{assignments:N,loading:T,error:S,refetch:C}=X(),k=N.filter(s=>{const a=!t||s.worker.first_name.toLowerCase().includes(t.toLowerCase())||s.worker.last_name.toLowerCase().includes(t.toLowerCase())||s.shift.client_name.toLowerCase().includes(t.toLowerCase())||s.shift.role_needed.toLowerCase().includes(t.toLowerCase()),d=!r||s.status===r,$=!l||f(j(s.shift.start_time_utc),"yyyy-MM-dd")===l;return a&&d&&$}),m=k.reduce((s,a)=>{const d=f(j(a.shift.start_time_utc),"yyyy-MM-dd");return s[d]||(s[d]=[]),s[d].push(a),s},{}),_=async(s,a)=>{p(s);try{await I(s,a),v({message:`Assignment status updated to ${a}`,type:"success"}),C()}catch{v({message:"Failed to update assignment status",type:"error"})}finally{p(null)}},A=s=>{try{return f(j(s),"EEE, MMM d, yyyy")}catch{return s}},L=s=>{try{return f(j(s),"h:mm a")}catch{return s}},M=s=>{switch(s){case"completed":return e.jsx(J,{className:"h-4 w-4 text-green-600"});case"no_show":return e.jsx(G,{className:"h-4 w-4 text-red-600"});case"cancelled":return e.jsx(W,{className:"h-4 w-4 text-gray-600"});default:return null}},U=()=>N.filter(s=>new Date(s.shift.start_time_utc)>new Date&&s.status==="assigned").length,E=()=>N.filter(s=>s.status==="completed").length;return T?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(K,{message:"Loading assignments..."})}):S?e.jsx("div",{className:"py-8",children:e.jsx(P,{message:S,onRetry:C})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Assignments"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Track worker assignments and shift staffing"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>w(!0),className:"btn-green flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Bulk Assign"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 text-center min-w-[100px]",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:U()}),e.jsx("div",{className:"text-xs text-blue-700 mt-1",children:"Upcoming"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 text-center min-w-[100px]",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:E()}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"Completed"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative md:col-span-2",children:[e.jsx(F,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search workers, shifts, or clients...",value:t,onChange:s=>n(s.target.value),className:"pl-10 pr-4 py-2 w-full border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:r,onChange:s=>g(s.target.value),className:"px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"no_show",children:"No Show"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]}),e.jsx("input",{type:"date",value:l,onChange:s=>y(s.target.value),className:"px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"View:"}),e.jsx("button",{onClick:()=>x("list"),className:`px-3 py-1 text-sm rounded ${o==="list"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"List"}),e.jsx("button",{onClick:()=>x("grouped"),className:`px-3 py-1 text-sm rounded ${o==="grouped"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Grouped by Date"})]})]}),k.length===0?e.jsx("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:e.jsxs("div",{className:"max-w-sm mx-auto",children:[e.jsx(Q,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:t||r||l?"No assignments found":"No assignments yet"}),e.jsx("p",{className:"text-gray-500 mb-6",children:t||r||l?"Try adjusting your filters to see more results":"Start by creating shifts and assigning workers. Assignments will appear here as you schedule your team."}),!t&&!r&&!l&&e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(h,{to:"/shifts/new",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Create Shift"}),e.jsx(h,{to:"/workers",className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"View Workers"})]})]})}):o==="grouped"?e.jsx("div",{className:"space-y-6",children:Object.keys(m).sort().reverse().map(s=>e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-6 py-3 border-b",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:A(m[s][0].shift.start_time_utc)}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[m[s].length," ",m[s].length===1?"assignment":"assignments"]})]}),e.jsx("div",{className:"divide-y",children:m[s].map(a=>e.jsx(D,{assignment:a,onStatusChange:_,updatingStatus:i,formatTime:L,getStatusIcon:M},a.id))})]},s))}):e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"divide-y",children:k.map(s=>e.jsx(D,{assignment:s,onStatusChange:_,updatingStatus:i,formatTime:L,formatDate:A,getStatusIcon:M,showDate:!0},s.id))})}),B&&e.jsx(q,{onClose:()=>w(!1),onSuccess:()=>{C(),w(!1)}}),b&&e.jsx(H,{message:b.message,type:b.type,onClose:()=>v(null)})]})},D=({assignment:t,onStatusChange:n,updatingStatus:r,formatTime:g,formatDate:l,getStatusIcon:y,showDate:o=!1})=>{const[x,i]=c.useState(!1),p=r===t.id;return e.jsx("div",{className:"p-6 hover:bg-gray-50",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Worker"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{to:`/workers/${t.worker.id}`,className:"font-medium text-blue-600 hover:text-blue-700 flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),t.worker.first_name," ",t.worker.last_name]}),e.jsx(h,{to:`/workers/${t.worker.id}/schedule`,className:"text-xs text-gray-500 hover:text-green-600",title:"View schedule",children:e.jsx(V,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Shift"}),e.jsx(h,{to:`/shifts/${t.shift.id}`,className:"font-medium text-gray-900 hover:text-blue-600",children:t.shift.client_name}),e.jsx("div",{className:"text-sm text-gray-600",children:t.shift.role_needed})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Time"}),o&&e.jsx("div",{className:"text-sm text-gray-900 mb-1",children:l(t.shift.start_time_utc)}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[e.jsx(R,{className:"h-4 w-4"}),g(t.shift.start_time_utc)," - ",g(t.shift.end_time_utc)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Status"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>i(!x),disabled:p,className:"flex items-center gap-2",children:[e.jsx(u,{status:t.status}),y(t.status),e.jsx(O,{className:"h-4 w-4 text-gray-400"})]}),x&&e.jsxs("div",{className:"absolute top-full left-0 mt-1 bg-white border rounded-lg shadow-lg z-10 min-w-[150px]",children:[e.jsx("button",{onClick:()=>{n(t.id,"assigned"),i(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:e.jsx(u,{status:"assigned",size:"sm"})}),e.jsx("button",{onClick:()=>{n(t.id,"completed"),i(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:e.jsx(u,{status:"completed",size:"sm"})}),e.jsx("button",{onClick:()=>{n(t.id,"no_show"),i(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:e.jsx(u,{status:"no_show",size:"sm"})}),e.jsx("button",{onClick:()=>{n(t.id,"cancelled"),i(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:e.jsx(u,{status:"cancelled",size:"sm"})})]})]})]})]})})})};export{ie as default};
