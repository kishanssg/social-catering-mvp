import{c as Ne,j as e,a as q,C as ve}from"./index-BvBF2lIx.js";import{r as c,b as _e,f as $e}from"./vendor-79DyBOV9.js";import{f as Ee,a as ye}from"./dateUtils-CHmZs4Ub.js";import{X as oe,T as we}from"./Toast-Bv2lZaAm.js";import{C as ce}from"./clock-CZSrv5kB.js";import{M as me}from"./map-pin-jzCHpgRS.js";import{U as ge}from"./users-6r0ImOB_.js";import{A as fe}from"./alert-circle-C2LIvogM.js";import{S as he,A as Fe,T as pe,C as ue}from"./ConfirmationModal-BG2RJRo2.js";import{D as ke}from"./dollar-sign-D1rVwLSV.js";import{C as Le}from"./x-circle-DyNRR2uC.js";import{b as De,a as Pe,c as Te,e as Me,p as ze}from"./Prep Cook-CE8OFMb5.js";import{P as Se}from"./pen-square-CWtKlROp.js";import{P as be}from"./plus-Bo42lQNo.js";import{C as xe}from"./calendar-Br5PP4r3.js";import{f as K}from"./index-C_slYh2M.js";import{p as Y}from"./index-BK_MyBzW.js";import{C as Ce}from"./chevron-down-Dsa6IZZA.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=Ne("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=Ne("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),Oe={sm:"max-w-md",md:"max-w-2xl",lg:"max-w-4xl",xl:"max-w-6xl"},de=({isOpen:d,onClose:p,title:v,subtitle:r,children:W,footer:b,size:h="md",closeOnOverlayClick:l=!0})=>{if(c.useEffect(()=>(d?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[d]),c.useEffect(()=>{const u=O=>{O.key==="Escape"&&d&&p()};return document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)},[d,p]),!d)return null;const C=u=>{u.target===u.currentTarget&&l&&p()};return e.jsx("div",{className:"modal-overlay",onClick:C,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:e.jsxs("div",{className:`modal-container ${Oe[h]}`,children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{id:"modal-title",className:"text-xl font-semibold text-gray-900 font-manrope",children:v}),r&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:r})]}),e.jsx("button",{onClick:p,className:"p-1.5 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors","aria-label":"Close modal",children:e.jsx(oe,{size:20,className:"text-gray-600"})})]}),e.jsx("div",{className:"modal-body",children:W}),b&&e.jsx("div",{className:"modal-footer",children:b})]})})};function Ae({shiftId:d,onClose:p,onSuccess:v}){var w,a;const[r,W]=c.useState(null),[b,h]=c.useState([]),[l,C]=c.useState([]),[u,O]=c.useState(""),[_,k]=c.useState(null),[n,T]=c.useState({}),[f,M]=c.useState(!0),[D,z]=c.useState(!1),[F,A]=c.useState(null),Q=(t,i)=>{T(j=>({...j,[t]:i}))};c.useEffect(()=>{U()},[d]),c.useEffect(()=>{r&&x()},[r]),c.useEffect(()=>{if(!u)C(b);else{const t=u.toLowerCase();C(b.filter(i=>{var j;return i.first_name.toLowerCase().includes(t)||i.last_name.toLowerCase().includes(t)||i.email.toLowerCase().includes(t)||((j=i.skills_json)==null?void 0:j.some(L=>L.toLowerCase().includes(t)))}))}},[u,b]);async function U(){try{const t=await q.get(`/shifts/${d}`);t.data.status==="success"?W(t.data.data):A("Failed to load shift details")}catch(t){console.error("Failed to load shift details:",t),A("Failed to load shift details")}}async function x(){var t;try{const i=new Set;if(r!=null&&r.event_id)try{const E=((t=(await q.get(`/events/${r.event_id}`)).data)==null?void 0:t.data)||{};if(E.shifts_by_role){const S=E.shifts_by_role.find(N=>N.skill_name===r.role_needed||N.role_name===r.role_needed);S!=null&&S.shifts&&S.shifts.forEach(N=>{N.assignments&&N.assignments.forEach(g=>{var B;const P=g.worker_id||((B=g.worker)==null?void 0:B.id),I=g.status;P&&I!=="cancelled"&&I!=="no_show"&&i.add(P)})})}}catch(L){console.log("Could not fetch event to filter assigned workers:",L)}console.log(`AssignmentModal: Found ${i.size} already assigned workers for "${r==null?void 0:r.role_needed}"`);const j=await q.get("/workers?active=true");if(j.data.status==="success"){const L=j.data.data.workers||j.data.data;if(r!=null&&r.role_needed){const E=L.filter(S=>{var N;return((N=S.skills_json)==null?void 0:N.includes(r.role_needed))&&!i.has(S.id)});console.log(`AssignmentModal: Showing ${E.length} eligible workers`),h(E)}else{const E=L.filter(S=>!i.has(S.id));h(E)}}else A("Failed to load workers")}catch(i){console.error("Failed to load workers:",i),A("Failed to load workers")}finally{M(!1)}}async function m(){var t,i,j,L,E,S;if(!(!_||!r)){z(!0),A(null);try{const g=(await q.post("/staffing",{assignment:{shift_id:r.id,worker_id:_.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:n[_.id]||Number(r.pay_rate)||0}})).data;if(g.status==="success")v();else{let P=g.message||"Failed to assign worker";g.details&&g.details.length>0?P+=`

Details:
â€¢ `+g.details.join(`
â€¢ `):g.errors&&(P+=`

Details:
â€¢ `+g.errors.join(`
â€¢ `)),A(P)}}catch(N){console.error("Failed to assign worker:",N);let g="Failed to assign worker";if((i=(t=N.response)==null?void 0:t.data)!=null&&i.details&&N.response.data.details.length>0){const P=N.response.data.details.map(I=>(I.includes("conflicting shift"),I));g+=`

`+P.join(`
`)}else(L=(j=N.response)==null?void 0:j.data)!=null&&L.errors?g+=`

`+N.response.data.errors.join(`
`):(S=(E=N.response)==null?void 0:E.data)!=null&&S.message?g=N.response.data.message:N.message&&(g=N.message);A(g)}finally{z(!1)}}}if(f)return e.jsx(de,{isOpen:!0,onClose:p,title:"Assign Worker",size:"lg",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-600"})})});const $=e.jsxs(e.Fragment,{children:[F&&e.jsxs("div",{className:"mb-4 p-3 bg-gradient-to-r from-red-50 to-amber-50 border-l-4 border-red-500 rounded-r-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsx("h4",{className:"text-sm font-semibold text-red-900",children:"âš ï¸ Scheduling Conflict Detected"})]}),e.jsx("p",{className:"text-xs text-gray-600 ml-8",children:"Please resolve the conflict before attempting to assign this worker"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:p,disabled:D,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:m,disabled:!_||D||!!F,className:`btn-primary ${F?"opacity-50 cursor-not-allowed":""}`,title:F?"Cannot assign due to scheduling conflict":"",children:D?"Assigning Worker...":"Assign Worker"})]})]});return e.jsx(de,{isOpen:!0,onClose:p,title:r?`${r.client_name} â€¢ ${r.role_needed}`:"Assign Worker",size:"xl",footer:$,children:e.jsxs("div",{className:"flex h-[600px]",children:[e.jsx("div",{className:"w-1/3 border-r border-gray-200 p-6 bg-gray-50",children:r?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Shift Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ce,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:Ee(r.start_time_utc)}),e.jsxs("div",{className:"text-sm text-gray-600",children:[ye(r.start_time_utc)," - ",ye(r.end_time_utc)]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(me,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"text-sm text-gray-900",children:r.location||((a=(w=r.event)==null?void 0:w.venue)==null?void 0:a.formatted_address)||"Location not specified"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ge,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900",children:r.role_needed}),r.required_skill&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Requires: ",r.required_skill]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Pay Rate:"})," $",(Number(r.pay_rate)||0).toFixed(2),"/hour"]}),r.uniform_name&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",r.uniform_name]})]}),r.notes&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Notes:"}),e.jsx("div",{className:"mt-1 whitespace-pre-line",children:r.notes.split("Uniform:").map((t,i)=>i===0?t.trim():e.jsxs("div",{children:[e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",t.trim()]},i))})]})})]})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fe,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Failed to load shift details"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search workers...",value:u,onChange:t=>O(t.target.value),className:"w-full pl-9 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-teal-500 focus:border-teal-500"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:F?e.jsx("div",{className:"p-6 flex items-center justify-center h-full",children:e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 rounded-lg p-5 shadow-sm w-full max-w-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(fe,{size:20,className:"text-red-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg font-semibold text-red-900 mb-1",children:"âš ï¸ Scheduling Conflict"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"This worker cannot be assigned due to a scheduling conflict"}),e.jsx("div",{className:"bg-white border border-red-200 rounded p-3 mt-3",children:e.jsx("div",{className:"text-sm text-red-800 font-mono",children:F.split(`
`).map((t,i)=>t.trim()===""?null:t.startsWith("â€¢")?e.jsxs("div",{className:"mt-1 flex items-start gap-2",children:[e.jsx("span",{className:"text-red-500",children:"â—"}),e.jsx("span",{className:"flex-1",children:t.replace("â€¢","").trim()})]},i):t.startsWith("Details:")?null:t.includes("conflicting shift")?e.jsx("div",{className:"mt-1 text-red-700 font-medium",children:t},i):e.jsx("div",{className:"text-gray-700",children:t},i))})})]})]})})}):l.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ge,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:u?"No workers found matching your search":r!=null&&r.role_needed?`No workers found with "${r.role_needed}" skill`:"No available workers"}),(r==null?void 0:r.role_needed)&&!u&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:['Try adding "',r.role_needed,'" skill to workers or select a different shift.']})]}):e.jsx("ul",{children:l.map(t=>{const i=(_==null?void 0:_.id)===t.id,j=n[t.id]||Number(r.pay_rate)||0,L=n[t.id]&&n[t.id]!==(Number(r.pay_rate)||0);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${i?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[t.first_name[0],t.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[t.first_name," ",t.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(t.skills_json||[]).map((E,S)=>{const N=E===(r==null?void 0:r.role_needed);return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${N?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:E},S)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[L&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ke,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:(Number(r.pay_rate)||0).toString(),value:j||"",onChange:E=>{const S=E.target.value;(S===""||/^\d*\.?\d*$/.test(S))&&Q(t.id,parseFloat(S)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:E=>E.stopPropagation(),onFocus:E=>E.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>k(t),className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${i?"bg-teal-600 text-white border-teal-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:i?"Selected":"Select"})]})]},t.id)})})})]})]})})}function Ue({isOpen:d,eventId:p,roleName:v,unfilledShiftIds:r,defaultPayRate:W,onClose:b,onDone:h}){const[l,C]=c.useState([]),[u,O]=c.useState([]),[_,k]=c.useState(""),[n,T]=c.useState(!1),[f,M]=c.useState(!1),[D,z]=c.useState({}),[F,A]=c.useState(0),Q=(a,t)=>{z(i=>({...i,[a]:t}))};c.useEffect(()=>{d&&(C([]),O([]),k(""),z({}),T(!0),(async()=>{var a,t;try{const j=((a=(await q.get(`/events/${p}`)).data)==null?void 0:a.data)||{};console.log("QuickFill: Full event data:",JSON.stringify(j,null,2)),console.log("QuickFill: Looking for role:",v),console.log("QuickFill: shifts_by_role:",j.shifts_by_role);const L=new Set;if(j.shifts_by_role){const g=j.shifts_by_role.find(P=>(console.log("QuickFill: Checking role:",P.skill_name,P.role_name,"vs",v),P.skill_name===v||P.role_name===v));g?(console.log("QuickFill: Found role shifts:",g),g.shifts&&g.shifts.forEach(P=>{P.assignments&&(console.log("QuickFill: Shift has assignments:",P.assignments),P.assignments.forEach(I=>{var Z;const B=I.worker_id||((Z=I.worker)==null?void 0:Z.id),X=I.status;B&&X!=="cancelled"&&(L.add(B),console.log("QuickFill: Adding worker_id to exclude:",B,"status:",X))}))})):console.log("QuickFill: No role shifts found for:",v)}console.log(`QuickFill: Found ${L.size} already assigned worker IDs:`,Array.from(L));const E=await q.get("/workers?active=true"),N=(((t=E.data)==null?void 0:t.data)||E.data||[]).filter(g=>{const P=(g.skills_json||[]).includes(v),I=L.has(g.id);return I&&console.log(`QuickFill: Excluding ${g.first_name} ${g.last_name} (ID: ${g.id}) - already assigned`),P&&!I});if(console.log(`QuickFill: Found ${N.length} eligible workers for "${v}"`),console.log("QuickFill: Eligible workers:",N.map(g=>`${g.first_name} ${g.last_name}`)),C(N),W){const g=Number(W)||0;A(g),console.log(`QuickFill: Default pay rate for ${v}: $${g}/hr`)}else console.log(`QuickFill: No default pay rate provided for ${v}`)}catch(i){console.error("Error loading workers:",i)}finally{T(!1)}})())},[d,p,v,W]);const U=c.useMemo(()=>{const a=_.trim().toLowerCase(),t=l;return a?t.filter(i=>`${i.first_name} ${i.last_name}`.toLowerCase().includes(a)||(i.email||"").toLowerCase().includes(a)):t},[l,_]),x=r.length,m=a=>{O(t=>t.includes(a)?t.filter(i=>i!==a):t.length>=x?t:[...t,a])},$=async()=>{var j,L,E,S,N,g,P,I,B,X,Z,ee,ae,re,ie;if(u.length===0||x===0)return;M(!0);let a=0,t=0;const i=[];try{const se=u.map(H=>l.find(s=>s.id===H)).filter(Boolean),le=[...r];let te=0;for(;le.length>0&&se.length>0;){const H=se[te%se.length],s=le.shift();try{const o=D[H.id]||Number(F)||0||0,y=await q.post("/staffing",{assignment:{shift_id:s,worker_id:H.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:o}});if(((j=y.data)==null?void 0:j.status)==="success")a+=1;else{t+=1;const R=`${H.first_name} ${H.last_name}`,G=((L=y.data)==null?void 0:L.message)||((S=(E=y.data)==null?void 0:E.error)==null?void 0:S.message)||((g=(N=y.data)==null?void 0:N.errors)==null?void 0:g.join(", "))||"Unknown error";let V="Unable to assign";const J=String(G).toLowerCase();J.includes("overlapping")||J.includes("conflict")?V="Has overlapping shift":J.includes("capacity")||J.includes("full")?V="Shift is full":J.includes("skill")||J.includes("certification")||J.includes("requirement")?V="Missing required skill":J.includes("status")?V="Cannot be assigned":V="Unable to assign",i.push(`${R}: ${V}`)}}catch(o){t+=1;const y=`${H.first_name} ${H.last_name}`;let R="Unable to assign";const G=((I=(P=o.response)==null?void 0:P.data)==null?void 0:I.message)||((Z=(X=(B=o.response)==null?void 0:B.data)==null?void 0:X.error)==null?void 0:Z.message)||((re=(ae=(ee=o.response)==null?void 0:ee.data)==null?void 0:ae.errors)==null?void 0:re.join(", "))||null;if(G){const V=String(G).toLowerCase();V.includes("overlapping")||V.includes("conflict")?R="Has overlapping shift":V.includes("capacity")||V.includes("full")?R="Shift is full":V.includes("skill")||V.includes("certification")||V.includes("requirement")?R="Missing required skill":V.includes("status")?R="Cannot be assigned":R="Unable to assign"}else((ie=o.response)==null?void 0:ie.status)===422?R="Unable to assign":o.message&&!o.message.includes("status code")&&(R=o.message);i.push(`${y}: ${R}`)}te+=1}let ne="";t>0&&i.length>0&&(ne=i.join(", ")),h({assigned:a,conflicts:t,details:ne})}finally{M(!1)}};if(!d)return null;const w=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,disabled:f,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:$,disabled:f||u.length===0||x===0,className:"btn-primary",children:f?"Filling Shifts...":u.length===1?`Assign worker to ${x} shift${x!==1?"s":""}`:`Assign ${u.length} workers to ${x} shifts`})]});return e.jsxs(de,{isOpen:d,onClose:b,title:`Quick Fill â€” ${v}`,subtitle:`Unfilled shifts: ${x}`,size:"lg",footer:w,children:[e.jsxs("div",{className:"relative",children:[e.jsx(he,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{value:_,onChange:a=>k(a.target.value),placeholder:"Search eligible workersâ€¦",className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsx("div",{className:"max-h-[340px] overflow-y-auto border border-gray-200 rounded-lg",children:n?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loadingâ€¦"}):U.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"No eligible workers"}):e.jsx("ul",{children:U.map(a=>{const t=u.includes(a.id);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${t?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[a.first_name[0],a.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[a.first_name," ",a.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(a.skills_json||[]).map((i,j)=>{const L=i===v;return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${L?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:i},j)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[D[a.id]&&D[a.id]!==(Number(F)||0)&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ke,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:Number(F)?(Number(F)||0).toString():"Rate",value:D[a.id]||Number(F)||0||"",onChange:i=>{const j=i.target.value;(j===""||/^\d*\.?\d*$/.test(j))&&Q(a.id,parseFloat(j)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:i=>i.stopPropagation(),onFocus:i=>i.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>m(a.id),disabled:!t&&u.length>=x,className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${t?"bg-teal-600 text-white border-teal-600":u.length>=x?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:t?"Selected":"Select"})]})]},a.id)})})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(Le,{size:16,className:"text-teal-600"}),e.jsxs("span",{children:["Will assign ",e.jsx("strong",{children:u.length})," worker",u.length!==1?"s":""," to ",e.jsx("strong",{children:x})," shift",x!==1?"s":"","."]})]}),(Number(F)||0)>0&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Default rate for ",v,":"]}),e.jsxs("span",{className:"font-medium",children:["$",(Number(F)||0).toFixed(2),"/hr"]})]}),Object.keys(D).length>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["ðŸ’¡ Empty fields will use default rate ($",(Number(F)||0).toFixed(2),"/hr)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(Fe,{size:14,className:"text-yellow-600"}),"Conflicts and already-filled shifts will be skipped automatically."]})]})}function We({event:d,isOpen:p,onClose:v,onSuccess:r}){const W=_e(),[b,h]=c.useState(!1),[l,C]=c.useState([]),[u,O]=c.useState(!1),[_,k]=c.useState(null),[n,T]=c.useState({isVisible:!1,message:"",type:"error"}),f=()=>{v(),W(`/events/${d.id}/edit`)},M=[{name:"Bartender",icon:De},{name:"Banquet Server/Runner",icon:Pe},{name:"Captain",icon:Te},{name:"Event Helper",icon:Me},{name:"Prep Cook",icon:ze}];c.useEffect(()=>{if(d.shifts_by_role&&Array.isArray(d.shifts_by_role)){const x=d.shifts_by_role.map(m=>{const $=m.shifts?m.shifts.length:m.total_shifts||1;return{skill_name:m.skill_name||m.role_name||"",needed_workers:$,pay_rate:m.pay_rate||15,description:"",uniform_id:void 0,cert_id:void 0}});C(x)}},[d]);const D=(x,m,$)=>{const w=[...l];w[x]={...w[x],[m]:$},C(w)},z=()=>{C([...l,{skill_name:"",needed_workers:1,pay_rate:15,description:"",uniform_id:void 0,cert_id:void 0}])},F=x=>{var m;if(l[x].needed_workers>0){const $=(m=d.shifts_by_role)==null?void 0:m[x];if($&&($.assigned_workers>0||$.filled_shifts>0)){T({isVisible:!0,message:"Cannot remove role with assigned workers. Please unassign workers first.",type:"error"});return}}C(l.filter(($,w)=>w!==x))},A=(x,m)=>{M.find(w=>w.name===m);const $=[...l];$[x]={...$[x],skill_name:m},C($),k(null)},Q=async()=>{var x,m,$;if(d.schedule&&new Date(d.schedule.start_time_utc)<=new Date){T({isVisible:!0,message:"Cannot edit event that has already started",type:"error"});return}O(!0);try{const w=await q.patch(`/events/${d.id}`,{event:{roles:l.map(a=>({skill_name:a.skill_name,needed:a.needed_workers,pay_rate:a.pay_rate,description:a.description,uniform_id:a.uniform_id,cert_id:a.cert_id}))}});w.data.status==="success"?(T({isVisible:!0,message:w.data.message||"Event updated successfully",type:"success"}),r(),v()):T({isVisible:!0,message:w.data.message||"Failed to update event",type:"error"})}catch(w){console.error("Failed to update event:",w);const a=(x=w==null?void 0:w.response)==null?void 0:x.data;if((a==null?void 0:a.status)==="validation_error"&&(($=(m=a==null?void 0:a.data)==null?void 0:m.conflicts)!=null&&$.length)){const t=a.data.conflicts.map(i=>{const j=new Date(i.conflicting_shift_start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),L=new Date(i.conflicting_shift_end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});return`${i.worker_name} conflicts with ${i.conflicting_event_title} (${j} â€“ ${L})`});T({isVisible:!0,message:`Can't save changes: ${t.length} worker${t.length!==1?"s":""} would be double-booked
â€¢ `+t.join(`
â€¢ `),type:"error"})}else T({isVisible:!0,message:(a==null?void 0:a.message)||"Failed to update event",type:"error"})}finally{O(!1)}},U=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:v,disabled:u,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:Q,disabled:u,className:"btn-primary",children:u?"Saving...":"Save Changes"})]});return e.jsxs(e.Fragment,{children:[e.jsx(de,{isOpen:p,onClose:v,title:`Edit Event: ${d.title}`,size:"lg",footer:U,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Event Details"}),e.jsxs("button",{onClick:f,className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-white border border-gray-300 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all shadow-sm",children:[e.jsx(Se,{size:14}),"Edit"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Venue"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:d.venue.name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:new Date(d.schedule.start_time_utc).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"space-y-1 md:col-span-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Location"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900 leading-relaxed",children:d.venue.formatted_address})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Time"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[new Date(d.schedule.start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})," - ",new Date(d.schedule.end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})]})]}),e.jsx("div",{})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"Roles"}),e.jsxs("button",{onClick:z,className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white text-sm font-semibold rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(be,{size:16}),"Add Role"]})]}),l.map((x,m)=>{var $,w;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[e.jsxs("div",{className:"flex-1 relative overflow-visible",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Role Name *"}),e.jsxs("div",{className:"relative",style:{zIndex:_===m?1e3:1},children:[e.jsxs("button",{type:"button",onClick:()=>k(_===m?null:m),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white text-left flex items-center justify-between",children:[x.skill_name?e.jsxs("div",{className:"flex items-center gap-2",children:[(($=M.find(a=>a.name===x.skill_name))==null?void 0:$.icon)&&e.jsx("img",{src:M.find(a=>a.name===x.skill_name).icon,alt:x.skill_name,className:"w-5 h-5"}),e.jsx("span",{className:"text-gray-900",children:x.skill_name})]}):e.jsx("span",{className:"text-gray-400",children:"Pick the Skills the Worker Has"}),e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M19 9l-7 7-7-7"})})]}),_===m&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border-2 border-gray-200 rounded-xl shadow-2xl z-[9999] max-h-[300px] overflow-y-auto w-full min-w-max",children:M.filter(a=>!l.some((t,i)=>i!==m&&t.skill_name===a.name)).map(a=>e.jsxs("div",{onClick:()=>A(m,a.name),className:"flex items-center gap-3 px-4 py-3 cursor-pointer hover:bg-teal-50 border-b border-gray-100 last:border-0",children:[e.jsx("img",{src:a.icon,width:"24",height:"24",alt:a.name,className:"flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.name})]},a.name))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Needed Workers *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>D(m,"needed_workers",Math.max(1,x.needed_workers-1)),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"-"}),e.jsx("input",{type:"number",value:x.needed_workers,onChange:a=>D(m,"needed_workers",parseInt(a.target.value)||1),min:"1",className:"w-16 px-2 py-2 border border-gray-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-teal-500 font-medium"}),e.jsx("button",{onClick:()=>D(m,"needed_workers",x.needed_workers+1),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"+"}),e.jsx("button",{onClick:()=>F(m),className:"ml-2 w-8 h-8 flex items-center justify-center text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove role",children:e.jsx(pe,{size:18})})]})]})]}),((w=d.shifts_by_role)==null?void 0:w[m])&&(d.shifts_by_role[m].assigned_workers>0||d.shifts_by_role[m].filled_shifts>0)&&e.jsxs("div",{className:"text-sm text-amber-600 font-semibold bg-amber-50 px-3 py-2 rounded-lg",children:[d.shifts_by_role[m].assigned_workers||d.shifts_by_role[m].filled_shifts," worker(s) assigned"]})]},m)})]})]})}),e.jsx(we,{isVisible:n.isVisible,message:n.message,type:n.type,onClose:()=>T({...n,isVisible:!1})})]})}function ds(){const d=_e(),[p,v]=$e(),r=(p.get("tab")==="completed"?"completed":p.get("tab"))||"active",W=p.get("filter")||"needs_workers",[b,h]=c.useState(r),[l,C]=c.useState(W),[u,O]=c.useState(""),[_,k]=c.useState("date"),[n,T]=c.useState(!0),[f,M]=c.useState([]),[D,z]=c.useState(new Set),[F,A]=c.useState({isOpen:!1}),[Q,U]=c.useState({isVisible:!1,message:"",type:"success"}),[x,m]=c.useState({isOpen:!1,isLoading:!1}),[$,w]=c.useState({isOpen:!1,isLoading:!1}),[a,t]=c.useState({isOpen:!1,isLoading:!1}),[i,j]=c.useState({isOpen:!1,unfilledShiftIds:[]}),[L,E]=c.useState({isOpen:!1});c.useEffect(()=>{S()},[b,l,p]),c.useEffect(()=>{const s=(p.get("tab")==="completed"?"completed":p.get("tab"))||"active",o=p.get("filter")||"all";s!==b&&h(s),o!==l&&C(o)},[p,b,l]),c.useEffect(()=>{const s=p.get("event_id"),o=p.get("shift_id");if(s){const y=parseInt(s);isNaN(y)||(z(new Set([y])),o&&console.log(`Auto-expanding event ${y} with shift ${o}`))}},[p]);async function S(){T(!0);try{const s=b==="completed"?"completed":b,o=p.get("date");let y=`/events?tab=${s}`;l!=="all"&&(y+=`&filter=${l}`),o&&(y+=`&date=${o}`),console.log("Loading events with URL:",y,"filterStatus:",l,"date:",o);const R=await q.get(y);R.data.status==="success"&&(console.log("Received events:",R.data.data.length),M(R.data.data))}catch(s){console.error("Failed to load events:",s)}finally{T(!1)}}const N=s=>{h(s),v({tab:s}),C(s==="active"?"needs_workers":"all")},g=s=>{C(s);const o=new URLSearchParams;o.set("tab",b),s!=="all"&&o.set("filter",s),v(o)},P=s=>{const o=new Set(D);o.has(s)?o.delete(s):o.add(s),z(o)};async function I(s){const o=f==null?void 0:f.find(y=>y.id===s);t({isOpen:!0,isLoading:!1,eventId:s,eventTitle:o==null?void 0:o.title})}async function B(){if(a.eventId){t(s=>({...s,isLoading:!0}));try{const s=await q.delete(`/events/${a.eventId}`);s.data.status==="success"?(t({isOpen:!1,isLoading:!1}),U({isVisible:!0,message:`"${s.data.event_title}" moved to trash`,type:"success",action:{label:"Undo",onClick:()=>X(s.data.event_id),variant:"primary"}}),S()):U({isVisible:!0,message:s.data.message||"Unable to delete event",type:"error"})}catch(s){console.error("Failed to delete event:",s),U({isVisible:!0,message:"Unable to delete event",type:"error"})}finally{t(s=>({...s,isLoading:!1}))}}}async function X(s){try{const o=await q.post(`/events/${s}/restore`);o.data.status==="success"?(U({isVisible:!0,message:"Event restored to draft",type:"success"}),S()):U({isVisible:!0,message:o.data.message||"Unable to restore event",type:"error"})}catch(o){console.error("Failed to restore event:",o),U({isVisible:!0,message:"Unable to restore event",type:"error"})}}function Z(){t({isOpen:!1,isLoading:!1})}function ee(s){m({isOpen:!0,eventId:s,isLoading:!1})}async function ae(){if(x.eventId){m(s=>({...s,isLoading:!0}));try{const s=await q.post(`/events/${x.eventId}/publish`);s.data.status==="success"?(U({isVisible:!0,message:"Event published successfully",type:"success"}),m({isOpen:!1,isLoading:!1}),S()):(U({isVisible:!0,message:s.data.message||"Unable to publish event",type:"error"}),m({isOpen:!1,isLoading:!1}))}catch(s){console.error("Failed to publish event:",s),U({isVisible:!0,message:"Unable to publish event",type:"error"}),m({isOpen:!1,isLoading:!1})}}}function re(){m({isOpen:!1,isLoading:!1})}function ie(s,o){w({isOpen:!0,assignmentId:s,isLoading:!1,workerName:o})}async function se(){var s,o;if($.assignmentId){w(y=>({...y,isLoading:!0}));try{const y=await q.delete(`/staffing/${$.assignmentId}`);((s=y.data)==null?void 0:s.status)==="success"?(U({isVisible:!0,message:"Worker unassigned successfully",type:"success"}),w({isOpen:!1,isLoading:!1}),S()):(U({isVisible:!0,message:((o=y.data)==null?void 0:o.message)||"Unable to unassign worker",type:"error"}),w({isOpen:!1,isLoading:!1}))}catch(y){console.error("Failed to unassign worker:",y),U({isVisible:!0,message:"Unable to unassign worker",type:"error"}),w({isOpen:!1,isLoading:!1})}}}const le=s=>{A({isOpen:!0,shiftId:s})},te=()=>{A({isOpen:!1})},ne=()=>{te(),U({isVisible:!0,message:"Worker assigned",type:"success"}),S()},H=f.filter(s=>{var o;if(u){const y=u.toLowerCase();if(!(s.title.toLowerCase().includes(y)||((o=s.venue)==null?void 0:o.name.toLowerCase().includes(y))))return!1}if(b==="active")switch(l){case"needs_workers":return s.unfilled_roles_count>0;case"partially_filled":return s.unfilled_roles_count>0&&s.assigned_workers_count>0;case"fully_staffed":return s.unfilled_roles_count===0&&s.assigned_workers_count>0;case"all":default:return!0}return!0}).sort((s,o)=>{var y,R;switch(_){case"name":return s.title.localeCompare(o.title);case"staffing":return s.staffing_percentage-o.staffing_percentage;case"date":default:const G=((y=s.schedule)==null?void 0:y.start_time_utc)||s.created_at,V=((R=o.schedule)==null?void 0:R.start_time_utc)||o.created_at;return new Date(G).getTime()-new Date(V).getTime()}});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Events"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage events and assign workers"})]}),e.jsxs("button",{onClick:()=>d("/events/create"),className:"flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(be,{size:20}),"Create New Event"]})]}),p.get("date")&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-teal-50 border border-teal-200 rounded-lg",children:[e.jsx(xe,{size:16,className:"text-teal-600"}),e.jsxs("span",{className:"text-sm font-medium text-teal-900",children:["Showing events for ",K(Y(p.get("date")),"EEEE, MMMM d, yyyy")]}),e.jsx("button",{onClick:()=>{const s=new URLSearchParams(p);s.delete("date"),v(s)},className:"ml-auto text-teal-600 hover:text-teal-700",title:"Clear date filter",children:e.jsx(oe,{size:16})})]})]}),e.jsxs("div",{className:"flex gap-6 border-b border-gray-200 mb-6",children:[e.jsx("button",{onClick:()=>N("draft"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${b==="draft"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Draft Events"}),e.jsx("button",{onClick:()=>N("active"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${b==="active"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Active Events"}),e.jsx("button",{onClick:()=>N("completed"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${b==="completed"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Completed Events"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 max-w-md relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search events or venues...",value:u,onChange:s=>O(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),e.jsxs("select",{value:_,onChange:s=>k(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"name",children:"Sort by Name"}),b!=="draft"&&e.jsx("option",{value:"staffing",children:"Sort by Staffing"})]}),b==="active"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>g("needs_workers"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${l==="needs_workers"?"bg-red-100 text-red-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Needs Workers"}),e.jsx("button",{onClick:()=>g("fully_staffed"),className:`px-3 py-2 text-sm font-medium rounded-lg transition ${l==="fully_staffed"?"bg-green-100 text-green-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Ready"})]})]}),n?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600"})}):e.jsxs(e.Fragment,{children:[b==="draft"&&e.jsx(Ie,{events:H,onDelete:I,onPublish:ee,onNavigate:s=>d(s),searchQuery:u}),b==="active"&&e.jsx(Ve,{events:H,expandedEvents:D,onToggleEvent:P,onAssignWorker:le,onUnassign:ie,onQuickFill:(s,o,y,R)=>j({isOpen:!0,eventId:s,roleName:o,unfilledShiftIds:y,payRate:R}),onPublish:ee,onDelete:I,onEdit:s=>E({isOpen:!0,event:s}),searchQuery:u}),b==="completed"&&e.jsx(Qe,{events:H,expandedEvents:D,onToggleEvent:P,searchQuery:u})]})]}),F.isOpen&&F.shiftId&&e.jsx(Ae,{shiftId:F.shiftId,onClose:te,onSuccess:ne}),e.jsx(we,{isVisible:Q.isVisible,message:Q.message,type:Q.type,action:Q.action,onClose:()=>U({...Q,isVisible:!1})}),e.jsx(ue,{isOpen:x.isOpen,onClose:re,onConfirm:ae,title:"Publish Event",message:"Ready to publish? This will create shifts and make them available for worker assignment.",confirmText:x.isLoading?"Publishingâ€¦":"Publish",cancelText:"Cancel",isLoading:x.isLoading,isDestructive:!1}),e.jsx(ue,{isOpen:$.isOpen,onClose:()=>w({isOpen:!1,isLoading:!1}),onConfirm:se,title:"Unassign Worker",message:`Remove ${$.workerName||"this worker"} from this shift?`,confirmText:$.isLoading?"Removingâ€¦":"Unassign",cancelText:"Cancel",isLoading:$.isLoading,isDestructive:!0}),e.jsx(ue,{isOpen:a.isOpen,onClose:Z,onConfirm:B,title:"Delete Event",message:`Delete "${a.eventTitle}"? This action cannot be undone.`,confirmText:a.isLoading?"Deletingâ€¦":"Delete",cancelText:"Cancel",isLoading:a.isLoading,isDestructive:!0}),e.jsx(Ue,{isOpen:i.isOpen,eventId:i.eventId||0,roleName:i.roleName||"",unfilledShiftIds:i.unfilledShiftIds,defaultPayRate:i.payRate,onClose:()=>j({isOpen:!1,unfilledShiftIds:[]}),onDone:({assigned:s,conflicts:o,details:y})=>{j({isOpen:!1,unfilledShiftIds:[]});let R=`Assigned ${s} workers â€¢ ${o} skipped`;o>0&&y&&(R+=`: ${y}`),U({isVisible:!0,message:R,type:o>0?"error":"success"}),S()}}),L.event&&e.jsx(We,{event:L.event,isOpen:L.isOpen,onClose:()=>E({isOpen:!1,event:void 0}),onSuccess:()=>{S(),E({isOpen:!1,event:void 0})}})]})}function Ie({events:d,onDelete:p,onPublish:v,onNavigate:r,searchQuery:W}){const b=l=>{if(!l)return"No date set";const C=Y(l);return K(C,"MMM d, yyyy")},h=l=>{if(!l)return"";const C=Y(l);return K(C,"h:mm a")};return d.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:W?"No draft events found":"No draft events yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:W?"Try adjusting your search query":"Create your first event to get started"}),!W&&e.jsxs("button",{onClick:()=>r("/events/create"),className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:[e.jsx(be,{size:20}),"Create Event"]})]}):e.jsx("div",{className:"space-y-4",children:d.map(l=>e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 flex-1",children:l.title}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Draft"})]}),l.venue&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[e.jsx(me,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:l.venue.name})]}),l.schedule&&e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{children:b(l.schedule.start_time_utc)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsxs("span",{children:[h(l.schedule.start_time_utc)," - ",h(l.schedule.end_time_utc)]})]})]}),l.total_workers_needed>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ge,{size:16,className:"text-gray-400"}),e.jsxs("span",{children:[l.total_workers_needed," workers needed"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>r(`/events/${l.id}/edit`),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Edit",children:e.jsx(Se,{size:18})}),e.jsx("button",{onClick:()=>v(l.id),className:"px-4 py-2 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Publish"}),e.jsx("button",{onClick:()=>p(l.id),className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition",title:"Delete",children:e.jsx(pe,{size:18})})]})]})})},l.id))})}function Ve({events:d,expandedEvents:p,onToggleEvent:v,onAssignWorker:r,onUnassign:W,onQuickFill:b,onPublish:h,onDelete:l,onEdit:C,searchQuery:u}){const O=n=>{const T=Y(n);return K(T,"EEE, MMM d, yyyy")},_=n=>{const T=Y(n);return K(T,"h:mm a")},k=n=>{switch(n){case"fully_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[e.jsx(je,{size:14}),"Ready"]});case"partially_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full",children:[e.jsx(fe,{size:14}),"Partial"]});case"needs_workers":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[e.jsx(oe,{size:14}),"Needs Workers"]});default:return null}};return d.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:u?"No active events found":"No active events"}),e.jsx("p",{className:"text-gray-600",children:u?"Try adjusting your search query or filters":"Publish draft events to see them here"})]}):e.jsx("div",{className:"space-y-4",children:d.map(n=>{const T=p.has(n.id);return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{onClick:()=>v(n.id),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:n.title}),k(n.staffing_status)]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[n.venue&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(me,{size:14,className:"text-gray-400"}),n.venue.name]}),n.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(xe,{size:14,className:"text-gray-400"}),O(n.schedule.start_time_utc)]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ce,{size:14,className:"text-gray-400"}),_(n.schedule.start_time_utc)]})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:[n.assigned_workers_count," of ",n.total_workers_needed," roles filled"]}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[n.staffing_percentage,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-full rounded-full transition-all ${n.staffing_percentage===100?"bg-green-500":n.staffing_percentage>0?"bg-yellow-500":"bg-red-500"}`,style:{width:`${n.staffing_percentage}%`}})})]}),n.unfilled_roles_count>0&&e.jsxs("p",{className:"text-sm text-red-600 font-medium",children:[n.unfilled_roles_count," role",n.unfilled_roles_count!==1?"s":""," still need workers"]}),n.shifts_by_role&&n.shifts_by_role.length>0&&e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Est. Cost: "}),e.jsxs("span",{className:"font-semibold text-green-600",children:["$",(()=>{let f=0;return n.shifts_by_role.forEach(M=>{M.shifts.forEach(D=>{const z=(new Date(D.end_time_utc).getTime()-new Date(D.start_time_utc).getTime())/36e5;D.assignments.forEach(F=>{const A=Number(F.hourly_rate||D.pay_rate||0);f+=A*z})})}),f.toFixed(0)})()]})]})]}),e.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[(!n.shifts_by_role||n.shifts_by_role.length===0)&&l&&e.jsx("button",{onClick:f=>{f.stopPropagation(),l(n.id)},className:"px-3 py-1.5 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition-colors",children:"Delete Event"}),C&&n.status==="published"&&e.jsx("button",{onClick:f=>{f.stopPropagation(),C(n)},title:"Edit Event",className:"p-1.5 text-teal-600 hover:text-teal-700 hover:bg-teal-50 rounded transition-colors",children:e.jsx(Re,{size:14})}),l&&e.jsx("button",{onClick:f=>{f.stopPropagation(),l(n.id)},title:"Delete",className:"p-1.5 text-red-600 hover:text-red-700 hover:bg-red-50 rounded transition-colors",children:e.jsx(pe,{size:14})}),e.jsx("div",{className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:T?e.jsx(ve,{size:24,className:"text-gray-600 hover:text-gray-800"}):e.jsx(Ce,{size:24,className:"text-gray-600 hover:text-gray-800"})})]})]}),T&&e.jsx("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:n.shifts_by_role&&n.shifts_by_role.length>0?e.jsx("div",{className:"space-y-4",children:n.shifts_by_role.map(f=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:f.role_name}),e.jsxs("span",{className:"text-sm text-gray-600",children:[f.filled_shifts,"/",f.total_shifts," assigned"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[f.filled_shifts<f.total_shifts&&e.jsxs("span",{className:"px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[f.total_shifts-f.filled_shifts," needed"]}),f.filled_shifts<f.total_shifts&&e.jsx("button",{onClick:M=>{var F;M.stopPropagation();const D=f.shifts.filter(A=>A.staffing_progress.percentage<100).sort((A,Q)=>new Date(A.start_time_utc).getTime()-new Date(Q.start_time_utc).getTime()).map(A=>A.id),z=(F=f.shifts[0])==null?void 0:F.pay_rate;b(n.id,f.role_name,D,z)},className:"px-2.5 py-1 text-xs font-semibold bg-teal-600 text-white rounded hover:bg-teal-700",title:"Quick Fill by Skill",children:"Quick Fill by Skill"})]})]}),e.jsx("div",{className:"space-y-2",children:f.shifts.map((M,D)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 text-gray-700 rounded-md flex items-center justify-center text-xs font-medium",children:D+1}),e.jsxs("span",{className:"text-sm text-gray-700",children:[_(M.start_time_utc)," - ",_(M.end_time_utc)]}),M.assignments.length>0&&e.jsx("div",{className:"flex items-center gap-1",children:M.assignments.map(z=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"px-2 py-0.5 bg-teal-100 text-teal-700 text-xs rounded",children:[z.worker.first_name," ",z.worker.last_name[0],".",e.jsxs("span",{className:"ml-1 text-teal-600 font-medium",children:["$",Number(z.hourly_rate||M.pay_rate||0).toFixed(0),"/hr"]})]}),e.jsx("button",{onClick:F=>{F.stopPropagation(),W(z.id,`${z.worker.first_name} ${z.worker.last_name}`)},className:"w-5 h-5 flex items-center justify-center text-red-600 hover:text-red-700 hover:bg-red-50 rounded",title:"Unassign worker",children:e.jsx(oe,{size:12})})]},z.id))})]}),M.staffing_progress.percentage===100?e.jsxs("span",{className:"flex items-center gap-1.5 text-sm font-medium text-green-600",children:[e.jsx(je,{size:16}),"Assigned"]}):e.jsx("button",{onClick:z=>{z.stopPropagation(),r(M.id)},className:"px-3 py-1.5 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Assign Worker"})]},M.id))})]},f.role_name))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:n.status==="draft"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"This event is still in draft status"}),e.jsx("p",{className:"text-sm",children:"Publish the event to generate shifts and assign workers"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"No shifts available"}),e.jsx("p",{className:"text-sm",children:"This event may not have any shifts generated yet"})]})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[n.status==="draft"&&e.jsx("button",{onClick:()=>h(n.id),className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors",children:"Publish Event"}),l&&e.jsx("button",{onClick:()=>l(n.id),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Delete Event"})]})]})})]},n.id)})})}function Qe({events:d,expandedEvents:p,onToggleEvent:v,searchQuery:r}){const W=h=>{const l=Y(h);return K(l,"MMM d, yyyy")},b=h=>{const l=Y(h);return K(l,"h:mm a")};return d.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“‹"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:r?"No past events found":"No past events yet"}),e.jsx("p",{className:"text-gray-600",children:r?"Try adjusting your search query":"Completed events will appear here"})]}):e.jsx("div",{className:"space-y-4",children:d.map(h=>{var u;const l=p.has(h.id);let C=0;return(u=h.shifts_by_role)==null||u.forEach(O=>{O.shifts.forEach(_=>{_.assignments.forEach(k=>{const n=k.hours_worked?parseFloat(k.hours_worked.toString()):0;C+=n})})}),C=Number(C)||0,e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{onClick:()=>v(h.id),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:h.title}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Completed"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[h.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(xe,{size:14,className:"text-gray-400"}),W(h.schedule.start_time_utc)]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ce,{size:14,className:"text-gray-400"}),b(h.schedule.start_time_utc)," - ",b(h.schedule.end_time_utc)]})]}),h.venue&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(me,{size:14,className:"text-gray-400"}),h.venue.name]})]})]}),e.jsx("div",{className:"ml-4 flex items-center",children:e.jsx("div",{className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:l?e.jsx(ve,{size:24,className:"text-gray-600 hover:text-gray-800"}):e.jsx(Ce,{size:24,className:"text-gray-600 hover:text-gray-800"})})})]}),l&&h.shifts_by_role&&e.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:[e.jsx("div",{className:"mb-4 p-4 bg-white rounded-lg border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Workers"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:h.assigned_workers_count})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Hours"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:C.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Event Cost"}),e.jsxs("p",{className:"text-2xl font-semibold text-green-600",children:["$",(()=>{let O=0;return h.shifts_by_role.forEach(_=>{_.shifts.forEach(k=>{const n=(new Date(k.end_time_utc).getTime()-new Date(k.start_time_utc).getTime())/36e5;k.assignments.forEach(T=>{const f=Number(T.hourly_rate||k.pay_rate||0);O+=f*n})})}),O.toFixed(0)})()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Staffing"}),e.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[h.staffing_percentage,"%"]})]})]})}),e.jsx("div",{className:"space-y-3",children:h.shifts_by_role.map(O=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:O.role_name}),e.jsx("div",{className:"space-y-2",children:O.shifts.flatMap(_=>_.assignments.map(k=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 text-teal-700 flex items-center justify-center text-sm font-medium",children:[k.worker.first_name[0],k.worker.last_name[0]]}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[k.worker.first_name," ",k.worker.last_name]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[k.hours_worked&&e.jsxs("span",{className:"font-medium",children:[parseFloat(k.hours_worked.toString()).toFixed(2)," hrs"]}),e.jsxs("span",{className:"font-medium text-green-600",children:["$",Number(k.hourly_rate||_.pay_rate||0).toFixed(0),"/hr"]}),k.hours_worked&&e.jsxs("span",{className:"font-semibold text-blue-600",children:["$",(parseFloat(k.hours_worked.toString())*Number(k.hourly_rate||_.pay_rate||0)).toFixed(0)]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[b(_.start_time_utc)," - ",b(_.end_time_utc)]})]})]},k.id)))})]},O.role_name))})]})]},h.id)})})}export{ds as EventsPage};
