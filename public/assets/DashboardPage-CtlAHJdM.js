import{c as z,a as U,j as e,A as B}from"./index-KGRtwDRZ.js";import{b as G,u as H,r as p}from"./vendor-79DyBOV9.js";import{s as A,e as F}from"./index-6Qs-loHP.js";import{p as w}from"./index-BK_MyBzW.js";import{r as k,t as _,a as K,f as D}from"./index-C_slYh2M.js";import{s as Q,e as J}from"./index-PThmsgkk.js";import{C as X}from"./chevron-right-DLbNRayH.js";import{M as Z}from"./map-pin-C3v-DIiZ.js";import{C as ee}from"./clock-DDOy5EFz.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=z("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=z("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);function q(t,o){k(2,arguments);var r=_(t),l=K(o);if(isNaN(l))return new Date(NaN);if(!l)return r;var i=r.getDate(),d=new Date(r.getTime());d.setMonth(r.getMonth()+l+1,0);var a=d.getDate();return i>=a?d:(r.setFullYear(d.getFullYear(),d.getMonth(),i),r)}function T(t){k(1,arguments);var o=_(t);return o.setHours(0,0,0,0),o}function P(t,o){k(2,arguments);var r=T(t),l=T(o);return r.getTime()===l.getTime()}function se(t,o){var r;k(1,arguments);var l=t||{},i=_(l.start),d=_(l.end),a=d.getTime();if(!(i.getTime()<=a))throw new RangeError("Invalid interval");var c=[],x=i;x.setHours(0,0,0,0);var b=Number((r=void 0)!==null&&r!==void 0?r:1);if(b<1||isNaN(b))throw new RangeError("`options.step` must be a number greater than 1");for(;x.getTime()<=a;)c.push(_(x)),x.setDate(x.getDate()+b),x.setHours(0,0,0,0);return c}function ae(t,o){k(2,arguments);var r=_(t),l=_(o);return r.getFullYear()===l.getFullYear()&&r.getMonth()===l.getMonth()}function re(t){return k(1,arguments),P(t,Date.now())}function fe(){const t=G(),o=H(),[r,l]=p.useState({draft_events:0,published_events:0,completed_events:0,total_workers:0,gaps_to_fill:0,urgent_events:0,month_events:0}),[i,d]=p.useState(new Date),[a,c]=p.useState([]),[x,b]=p.useState([]),[$,E]=p.useState(!0);p.useEffect(()=>{j()},[i]),p.useEffect(()=>{const s=()=>{document.hidden||j()},m=()=>{j()};return document.addEventListener("visibilitychange",s),window.addEventListener("focus",m),()=>{document.removeEventListener("visibilitychange",s),window.removeEventListener("focus",m)}},[i]),p.useEffect(()=>{if(o.pathname==="/dashboard"){const s=setTimeout(()=>{j()},100);return()=>clearTimeout(s)}},[o.pathname]);async function j(){E(!0);try{const s=await U.get("/dashboard");if(s.data.status==="success"){const m=s.data.data;l({draft_events:m.draft_events,published_events:m.published_events,completed_events:m.completed_events,total_workers:m.total_workers,gaps_to_fill:m.gaps_to_fill,urgent_events:m.urgent_events,month_events:m.month_events});const y=await U.get("/events");if(y.data.status==="success"){const N=y.data.data,g=A(i),W=F(i),L=N.filter(n=>n.status==="published"),v={};L.forEach(n=>{if(!n.schedule)return;const f=w(n.schedule.start_time_utc);if(f>=g&&f<=W){const h=D(f,"yyyy-MM-dd");v[h]||(v[h]={date:f,status:"fully_staffed",events:[],shifts_count:0,needs_workers_count:0,total_hired_today:0});const M=n.assigned_workers_count||0,V=n.total_workers_needed||0;v[h].events.push({id:n.id,title:n.title,unfilled_roles_count:n.unfilled_roles_count||0,hired_count:M,required_count:V}),v[h].shifts_count+=n.total_shifts_count||0,v[h].needs_workers_count+=n.unfilled_roles_count||0,v[h].total_hired_today+=M,n.staffing_status==="needs_workers"?v[h].status="needs_workers":n.staffing_status==="partially_staffed"&&v[h].status!=="needs_workers"&&(v[h].status="partially_staffed")}}),c(Object.values(v));const Y=L.filter(n=>{if(!n.schedule||(n.unfilled_roles_count||0)===0)return!1;const f=w(n.schedule.start_time_utc),h=new Date;if(f<h)return!1;const M=(f.getTime()-h.getTime())/(1e3*60*60);return M>0&&M<=48}).map(n=>{const h=(w(n.schedule.start_time_utc).getTime()-new Date().getTime())/(1e3*60*60);return{...n,venue:n.venue||{name:"",formatted_address:""},hours_until:h}}).sort((n,f)=>n.hours_until!==f.hours_until?n.hours_until-f.hours_until:n.staffing_percentage-f.staffing_percentage).slice(0,5);b(Y)}}}catch(s){console.error("Failed to load dashboard data:",s)}finally{E(!1)}}const O=()=>{d(q(i,-1))},R=()=>{d(q(i,1))},u=()=>{d(new Date)},C=s=>{const m=D(s,"yyyy-MM-dd"),y=T(new Date),g=T(s)<y?"completed":"active";t(`/events?tab=${g}&date=${m}`)};return $?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600"})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Overview of events and staffing needs"})]}),e.jsx("button",{onClick:()=>t("/events/create"),className:"px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Create New Event"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsx(S,{label:"Draft Events",value:r.draft_events,onClick:()=>t("/events?tab=draft"),color:"gray"}),e.jsx(S,{label:"Active Events",value:r.published_events,onClick:()=>t("/events?tab=active"),color:"blue"}),e.jsx(S,{label:"Completed Events",value:r.completed_events,onClick:()=>t("/events?tab=completed"),color:"green"}),e.jsx(S,{label:"Unfilled Roles",value:r.gaps_to_fill,onClick:()=>t("/events?tab=active&filter=needs_workers"),color:"red",isHero:!0})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6 mb-8",children:e.jsx(ne,{currentMonth:i,calendarData:a,onPreviousMonth:O,onNextMonth:R,onToday:u,onDayClick:C})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200",children:e.jsx(ie,{events:x,onEventClick:s=>t(`/events?tab=active&event_id=${s}`)})})]})})}function S({label:t,value:o,onClick:r,color:l,isHero:i}){const d={gray:"bg-white hover:border-gray-300",blue:"bg-white hover:border-blue-300",green:"bg-white hover:border-green-300",red:i?"bg-red-50 border-red-200 hover:border-red-300":"bg-white hover:border-red-300"},a={gray:"text-gray-900",blue:"text-blue-900",green:"text-green-900",red:"text-red-900"},c={gray:"text-gray-600",blue:"text-blue-600",green:"text-green-600",red:i?"text-red-700":"text-red-600"};return e.jsxs("button",{onClick:r,className:`relative overflow-hidden rounded-lg border p-6 transition-all duration-200 text-left ${d[l]} hover:shadow-lg`,children:[i&&o>5&&e.jsxs("div",{className:"absolute top-0 right-0 w-3 h-3 m-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-red-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`text-sm font-medium mb-1 ${c[l]}`,children:t}),e.jsx("span",{className:`text-4xl font-bold ${a[l]}`,children:o})]}),i&&o>0&&e.jsxs("div",{className:"mt-3 flex items-center gap-1 text-sm font-medium text-red-600",children:[e.jsx(B,{size:16}),e.jsx("span",{children:"Requires attention"})]}),!i&&e.jsxs("div",{className:"mt-3 flex items-center gap-1 text-sm font-medium text-gray-500",children:[e.jsx("span",{children:"View all"}),e.jsx(I,{size:16})]})]})}function ne({currentMonth:t,calendarData:o,onPreviousMonth:r,onNextMonth:l,onToday:i,onDayClick:d}){const a=A(t),c=F(t),x=Q(a,{weekStartsOn:0}),b=J(c,{weekStartsOn:0}),$=se({start:x,end:b}),E=u=>o.find(C=>P(C.date,u)),j=u=>{switch(u){case"fully_staffed":return"âœ“";case"partially_staffed":return"ðŸŸ¡";case"needs_workers":return"ðŸ”´";default:return null}},O=u=>{switch(u){case"fully_staffed":return"bg-green-50 border-green-200";case"partially_staffed":return"bg-yellow-50 border-yellow-200";case"needs_workers":return"bg-red-50 border-red-200";default:return""}},R=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:D(t,"MMMM yyyy")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Previous month",children:e.jsx(te,{size:20})}),e.jsx("button",{onClick:i,className:"px-3 py-1.5 text-sm font-medium text-teal-600 hover:bg-teal-50 rounded-lg transition",children:"Today"}),e.jsx("button",{onClick:l,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Next month",children:e.jsx(X,{size:20})})]})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[R.map(u=>e.jsx("div",{className:"text-center text-sm font-medium text-gray-600 py-2",children:u},u)),$.map((u,C)=>{const s=E(u),m=ae(u,t),y=re(u),N=s&&s.events.length>0;return e.jsxs("button",{onClick:()=>N&&d(u),disabled:!N,className:`
                relative min-h-[80px] p-2 rounded-lg border transition-all text-left
                ${y?"border-teal-500 bg-teal-50 ring-2 ring-teal-200":N?`${O(s.status)} hover:shadow-md cursor-pointer`:"border-gray-100 bg-white"}
                ${m?"":"opacity-40"}
              `,children:[e.jsx("div",{className:`text-sm font-medium mb-1 ${y?"text-teal-600":m?"text-gray-900":"text-gray-400"}`,children:D(u,"d")}),s&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-2xl text-center",children:j(s.status)}),s.events.length>0&&e.jsxs("div",{className:"text-xs text-center text-gray-600",children:[s.events.length," event",s.events.length!==1?"s":""]}),s.events.length>0&&s.events.length<=2&&e.jsx("div",{className:"space-y-0.5",children:s.events.map(g=>e.jsxs("div",{className:"text-xs text-center font-medium text-gray-700 truncate",title:`${g.title}: ${g.hired_count}/${g.required_count} hired`,"aria-label":`Staffing progress: ${g.hired_count} of ${g.required_count} hired`,children:[g.hired_count,"/",g.required_count," hired"]},g.id))}),s.events.length>2&&e.jsxs("div",{className:"text-xs text-center font-medium text-gray-700",children:[s.total_hired_today," hired today"]}),s.events.length===1&&s.total_hired_today>0&&e.jsxs("div",{className:"text-xs text-center text-gray-500 mt-0.5",children:["Hired today: ",s.total_hired_today]})]})]},C)})]}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-6 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-xl",children:"âœ“"}),e.jsx("span",{className:"text-gray-600",children:"Ready"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-xl",children:"ðŸŸ¡"}),e.jsx("span",{className:"text-gray-600",children:"Partial"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-xl",children:"ðŸ”´"}),e.jsx("span",{className:"text-gray-600",children:"Needs Workers"})]})]})]})}function ie({events:t,onEventClick:o}){const r=a=>{if(!a.schedule)return!1;const x=(w(a.schedule.start_time_utc).getTime()-new Date().getTime())/(1e3*60*60);return x>0&&x<=48},l=()=>e.jsx("span",{className:"bg-red-600 text-white text-xs font-semibold px-2 py-0.5 rounded-full","aria-label":"Urgent: starts within 48 hours",children:"Urgent"}),i=a=>{const c=w(a);return D(c,"EEE, MMM d")},d=a=>{const c=w(a);return D(c,"h:mm a")};return t.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽ‰"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"All Caught Up!"}),e.jsx("p",{className:"text-gray-600",children:"No urgent staffing needs at the moment. Great work!"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"âš ï¸ Priority Staffing Queue"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[t.length," event",t.length!==1?"s":""," need",t.length===1?"s":""," workers â€¢ Sorted by urgency"]})]}),e.jsx("div",{className:"divide-y divide-gray-200",children:t.map(a=>{var c;return e.jsx("div",{className:"px-6 py-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:i(a.schedule.start_time_utc)}),r(a)&&e.jsx(e.Fragment,{children:l()})]}),e.jsx("h4",{className:"text-base font-semibold text-gray-900 mb-1",children:a.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Z,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"truncate",children:((c=a.venue)==null?void 0:c.name)||"No venue"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ee,{size:14,className:"text-gray-400"}),e.jsxs("span",{children:[d(a.schedule.start_time_utc)," - ",d(a.schedule.end_time_utc)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs("span",{className:"font-medium text-red-600",children:[a.unfilled_roles_count," role",a.unfilled_roles_count!==1?"s":""," still needed"]}),e.jsx("span",{className:"text-gray-400",children:"â€¢"}),e.jsxs("span",{className:"text-gray-600",children:[a.staffing_percentage,"% staffed"]})]})]}),e.jsxs("button",{onClick:()=>o(a.id),className:"px-4 py-2 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors whitespace-nowrap flex items-center gap-2",children:["Assign Workers",e.jsx(I,{size:16})]})]})},a.id)})})]})}export{fe as DashboardPage};
