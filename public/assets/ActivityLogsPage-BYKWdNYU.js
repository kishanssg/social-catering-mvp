import{c as A,_ as D,l as $,j as e,d as S,v as k,f as o,p as L,$ as T,T as E,a0 as P,P as U,a1 as h}from"./index-Dr3sk2XK.js";import{b as m}from"./vendor-B6rXSep8.js";import{L as W,E as O}from"./ErrorMessage-DRHYfHwU.js";import{a as H,F as I}from"./addDays-DgireJ18.js";import{U as R}from"./user-C1Nft8U3.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],N=A("file-text",q);function f(s,n){const l=D(s,n?.in);return l.setHours(23,59,59,999),l}function j(s,n,l){return H(s,-n,l)}const z=async s=>(await $.get("/activity_logs",{params:s})).data,J=s=>{const[n,l]=m.useState([]),[_,g]=m.useState(!0),[r,y]=m.useState(null),[b,v]=m.useState(null),p=async()=>{try{g(!0),y(null);const i=await z(s);i.status==="success"?(l(i.data.activity_logs),v(i.data.pagination)):y("Failed to fetch activity logs")}catch(i){y(i?.response?.data?.error||"Failed to load activity logs"),console.error("Error fetching activity logs:",i)}finally{g(!1)}};return m.useEffect(()=>{p()},[JSON.stringify(s)]),{logs:n,loading:_,error:r,pagination:b,refetch:p}},K=()=>{const[s,n]=m.useState({entity_type:"",log_action:"",actor_user_id:void 0,page:1,per_page:20,date_from:"",date_to:"",date_preset:""}),{logs:l,loading:_,error:g,pagination:r,refetch:y}=J(s),b=t=>{const a=new Date;switch(t){case"today":return{date_from:o(h(a),"yyyy-MM-dd"),date_to:o(f(a),"yyyy-MM-dd")};case"yesterday":const u=j(a,1);return{date_from:o(h(u),"yyyy-MM-dd"),date_to:o(f(u),"yyyy-MM-dd")};case"this_week":const c=j(a,a.getDay());return{date_from:o(h(c),"yyyy-MM-dd"),date_to:o(f(a),"yyyy-MM-dd")};case"last_week":const d=j(a,a.getDay()+7),F=j(a,a.getDay()+1);return{date_from:o(h(d),"yyyy-MM-dd"),date_to:o(f(F),"yyyy-MM-dd")};default:return{date_from:"",date_to:""}}},v=t=>{switch(t){case"created":return e.jsx(U,{className:"h-4 w-4 text-green-600"});case"updated":return e.jsx(P,{className:"h-4 w-4 text-blue-600"});case"destroyed":return e.jsx(E,{className:"h-4 w-4 text-red-600"});default:return e.jsx(T,{className:"h-4 w-4 text-gray-600"})}},p=t=>{switch(t){case"created":return"bg-green-100 text-green-800";case"updated":return"bg-blue-100 text-blue-800";case"destroyed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},i=t=>{switch(t){case"Worker":return e.jsx(R,{className:"h-4 w-4 text-blue-600"});case"Shift":return e.jsx(k,{className:"h-4 w-4 text-green-600"});case"Assignment":return e.jsx(N,{className:"h-4 w-4 text-purple-600"});default:return e.jsx(N,{className:"h-4 w-4 text-gray-600"})}},M=t=>{const{entity_type:a,action:u,actor_user:c}=t,d=c?.email||"System";switch(u){case"created":return`${d} created ${a} #${t.entity_id}`;case"updated":return`${d} updated ${a} #${t.entity_id}`;case"destroyed":return`${d} deleted ${a} #${t.entity_id}`;default:return`${d} performed ${u} on ${a} #${t.entity_id}`}},x=(t,a)=>{n(u=>{const c={...u,[t]:a,page:1};if(t==="date_preset"){if(a==="custom")return c;if(a==="")return{...c,date_from:"",date_to:""};{const d=b(a);return{...c,date_from:d.date_from,date_to:d.date_to}}}return c})},w=t=>{n(a=>({...a,page:t}))},C=()=>{n({entity_type:"",log_action:"",actor_user_id:void 0,page:1,per_page:20,date_from:"",date_to:"",date_preset:""})};return _?e.jsx(W,{}):g?e.jsx(O,{message:g,onRetry:y}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Activity Log"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Track all changes and actions in the system"})]}),e.jsx("div",{className:"text-sm text-gray-500",children:r&&`${r.total_count} total logs`})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx(I,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Filters"}),e.jsx("button",{onClick:C,className:"text-sm text-blue-600 hover:text-blue-800",children:"Clear all"}),(s.date_from||s.date_to)&&e.jsx("div",{className:"text-sm text-gray-600 bg-blue-50 px-3 py-1 rounded-lg",children:s.date_preset==="custom"?e.jsx(e.Fragment,{children:s.date_from&&s.date_to?e.jsxs(e.Fragment,{children:["ðŸ“… ",s.date_from," to ",s.date_to]}):s.date_from?e.jsxs(e.Fragment,{children:["ðŸ“… From ",s.date_from]}):s.date_to?e.jsxs(e.Fragment,{children:["ðŸ“… Until ",s.date_to]}):null}):e.jsxs(e.Fragment,{children:["ðŸ“… ",s.date_preset?.charAt(0).toUpperCase()+s.date_preset?.slice(1)]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(S,{className:"h-4 w-4 inline mr-1"}),"Date Range"]}),e.jsxs("select",{value:s.date_preset,onChange:t=>x("date_preset",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"yesterday",children:"Yesterday"}),e.jsx("option",{value:"this_week",children:"This Week"}),e.jsx("option",{value:"last_week",children:"Last Week"}),e.jsx("option",{value:"custom",children:"Custom Range"})]})]}),s.date_preset==="custom"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"From Date"}),e.jsx("input",{type:"date",value:s.date_from,onChange:t=>x("date_from",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.date_preset==="custom"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"To Date"}),e.jsx("input",{type:"date",value:s.date_to,onChange:t=>x("date_to",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Entity Type"}),e.jsxs("select",{value:s.entity_type,onChange:t=>x("entity_type",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"Worker",children:"Worker"}),e.jsx("option",{value:"Shift",children:"Shift"}),e.jsx("option",{value:"Assignment",children:"Assignment"}),e.jsx("option",{value:"User",children:"User"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Action"}),e.jsxs("select",{value:s.log_action,onChange:t=>x("log_action",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"All Actions"}),e.jsx("option",{value:"created",children:"Created"}),e.jsx("option",{value:"updated",children:"Updated"}),e.jsx("option",{value:"destroyed",children:"Deleted"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Per Page"}),e.jsxs("select",{value:s.per_page,onChange:t=>x("per_page",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[l.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No activity logs found"}),e.jsx("p",{className:"text-gray-600",children:Object.values(s).some(t=>t&&t!=="")?"Try adjusting your filters to see more results.":"Activity logs will appear here as users perform actions."})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:l.map(t=>e.jsx("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:v(t.action)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[i(t.entity_type),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.entity_type})]}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${p(t.action)}`,children:t.action}),e.jsxs("span",{className:"text-sm text-gray-500",children:["#",t.entity_id]})]}),e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:M(t)}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(k,{className:"h-3 w-3"}),e.jsx("span",{children:t.created_at_utc?o(L(t.created_at_utc),"MMM d, yyyy h:mm a"):"Unknown date"}),t.actor_user&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["by ",t.actor_user.email]})]})]})]})]})},t.id))}),r&&r.total_pages>1&&e.jsx("div",{className:"px-6 py-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",(r.current_page-1)*r.per_page+1," to"," ",Math.min(r.current_page*r.per_page,r.total_count)," of"," ",r.total_count," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>w(r.current_page-1),disabled:!r.has_prev_page,className:"px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsxs("span",{className:"px-3 py-1 text-sm text-gray-700",children:["Page ",r.current_page," of ",r.total_pages]}),e.jsx("button",{onClick:()=>w(r.current_page+1),disabled:!r.has_next_page,className:"px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})})]})]})};export{K as default};
