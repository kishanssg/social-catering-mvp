import{a as y,j as e}from"./index-DFHoM1w_.js";import{r as a}from"./vendor-79DyBOV9.js";import{s as b}from"./index-DLaGpDWO.js";import{e as N}from"./index-DzIxPjLh.js";import{s as F,e as M}from"./index-BMB4szy_.js";import{f as m,C as O}from"./index-DT-zkhKU.js";import{D as W}from"./dollar-sign-B0aCNmyh.js";import{U}from"./users-_Z_oMNju.js";import{C as $}from"./calendar-C9VN_jEI.js";import{D as I}from"./download-DCJX372e.js";function Y(){const[w,P]=a.useState([]),[v,A]=a.useState([]),[u,k]=a.useState([]),[i,S]=a.useState(null),[_,p]=a.useState(!1),[x,D]=a.useState("week"),[l,f]=a.useState(""),[d,g]=a.useState(""),[n,C]=a.useState("all"),[o,L]=a.useState("all"),[h,T]=a.useState("");a.useEffect(()=>{const s=new Date;let t,r;switch(x){case"week":t=b(s,{weekStartsOn:0}),r=N(s,{weekStartsOn:0});break;case"month":t=F(s),r=M(s);break;case"custom":return;default:t=b(s,{weekStartsOn:0}),r=N(s,{weekStartsOn:0})}f(m(t,"yyyy-MM-dd")),g(m(r,"yyyy-MM-dd"))},[x]),a.useEffect(()=>{l&&d&&E()},[l,d,n,o]);const E=async()=>{p(!0);try{const s=new URLSearchParams({start_date:l,end_date:d,...n!=="all"&&{worker_id:n},...o!=="all"&&{location_id:o}}),t=await y.get(`/reports/timesheet/preview?${s}`);t.data.status==="success"&&(k(t.data.data.assignments),S(t.data.data.summary))}catch(s){console.error("Failed to fetch timesheet data:",s),alert("Failed to load timesheet data")}finally{p(!1)}},R=async()=>{try{const s=new URLSearchParams({start_date:l,end_date:d,...n!=="all"&&{worker_id:n},...o!=="all"&&{location_id:o}}),t=await y.get(`/reports/timesheet?${s}`,{responseType:"blob"}),r=window.URL.createObjectURL(new Blob([t.data])),c=document.createElement("a");c.href=r,c.setAttribute("download",`timesheet_${l}_to_${d}.csv`),document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(r),alert("Timesheet exported successfully")}catch(s){console.error("Failed to export timesheet:",s),alert("Failed to export timesheet")}},j=u.filter(s=>{if(!h)return!0;const t=h.toLowerCase();return s.worker.name.toLowerCase().includes(t)||s.worker.email.toLowerCase().includes(t)||s.shift.client_name.toLowerCase().includes(t)||s.shift.role_needed.toLowerCase().includes(t)});return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Timesheet Report"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Track hours worked and generate payroll reports"})]}),i&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Hours"}),e.jsx("p",{className:"text-2xl font-bold",children:i.total_hours.toFixed(2)})]}),e.jsx(O,{className:"w-8 h-8 text-blue-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Pay"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",i.total_pay.toFixed(2)]})]}),e.jsx(W,{className:"w-8 h-8 text-green-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Workers"}),e.jsx("p",{className:"text-2xl font-bold",children:i.worker_count})]}),e.jsx(U,{className:"w-8 h-8 text-purple-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Shifts"}),e.jsx("p",{className:"text-2xl font-bold",children:i.shift_count})]}),e.jsx($,{className:"w-8 h-8 text-orange-500"})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date Range"}),e.jsxs("select",{value:x,onChange:s=>D(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"week",children:"This Week"}),e.jsx("option",{value:"month",children:"This Month"}),e.jsx("option",{value:"custom",children:"Custom Range"})]})]}),x==="custom"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:l,onChange:s=>f(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:d,onChange:s=>g(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search"}),e.jsx("input",{type:"text",placeholder:"Search workers, events...",value:h,onChange:s=>T(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Worker"}),e.jsxs("select",{value:n,onChange:s=>C(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Workers"}),w.map(s=>e.jsxs("option",{value:s.id.toString(),children:[s.first_name," ",s.last_name]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Location"}),e.jsxs("select",{value:o,onChange:s=>L(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Locations"}),v.map(s=>e.jsx("option",{value:s.id.toString(),children:s.display_name},s.id))]})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs("button",{onClick:R,disabled:!u.length,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5"}),"Export CSV"]})})]}),_?e.jsx("div",{className:"flex items-center justify-center h-64 bg-white rounded-lg shadow",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:j.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:e.jsx("p",{children:"No timesheet data found for the selected period"})}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Worker"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Shift Details"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Hours"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Rate"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Total"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-700",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:j.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:m(new Date(s.date),"MMM dd, yyyy")}),e.jsx("div",{className:"text-xs text-gray-500",children:m(new Date(s.date),"EEEE")})]})}),e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.worker.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.worker.email})]})}),e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.shift.client_name}),e.jsx("div",{className:"text-sm text-gray-600",children:s.shift.role_needed}),e.jsx("div",{className:"text-xs text-gray-500",children:s.shift.location})]})}),e.jsx("td",{className:"py-4 px-6",children:e.jsx("span",{className:"font-medium",children:s.hours_worked.toFixed(2)})}),e.jsx("td",{className:"py-4 px-6",children:e.jsxs("span",{children:["$",s.hourly_rate.toFixed(2)]})}),e.jsx("td",{className:"py-4 px-6",children:e.jsxs("span",{className:"font-semibold text-green-600",children:["$",s.total_pay.toFixed(2)]})}),e.jsx("td",{className:"py-4 px-6",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${s.status==="completed"?"bg-green-100 text-green-800":s.status==="assigned"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:s.status})})]},s.id))})]})})]})}export{Y as default};
