import{c as Fe,j as e,X as ke,a as G,A as he,b as Xe,C as Ze}from"./index-DjM69P9M.js";import{r as m,b as Ie,f as Je}from"./vendor-79DyBOV9.js";import{f as Ye,a as ze,g as Ge}from"./dateUtils-DugSZKu1.js";import{c as de,C as ve}from"./utils-CrCQwwu7.js";import{C as pe}from"./clock--KLHzKj9.js";import{M as $e}from"./map-pin-RC76E-th.js";import{U as Pe}from"./users-IQO4Ba0d.js";import{S as Ve,L as Re,A as We,C as Te}from"./Avatar-BZHdwYif.js";import{D as He}from"./dollar-sign-BCsWre07.js";import{T as Oe}from"./Toast-B7QMzGwx.js";import{C as es,X as Se}from"./x-circle-Q5DY-owt.js";import{b as ss,a as ts,c as as,e as rs,p as ls}from"./Prep Cook-li-JR_eG.js";import{P as qe}from"./pen-square-C_v5nb9l.js";import{P as De}from"./plus-BVtBODWQ.js";import{T as Qe}from"./trash-2-nv0c4uEm.js";import{f as fe}from"./index-C_slYh2M.js";import{p as ce}from"./index-BK_MyBzW.js";import{B as Ae}from"./ban-BcHwsq-3.js";import{C as Me}from"./calendar-78rH5bRI.js";import{C as ns}from"./chevron-down-CRxSKIkZ.js";import{C as is}from"./chevron-right-D7bzFd2I.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=Fe("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=Fe("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=Fe("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=Fe("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11",key:"llx8ln"}]]);function Be(s,c=0){const j=typeof s=="string"?Number(s):s;return Number.isFinite(j)?j:c}function le(s,c=2,j="0"){const l=Be(s,NaN);if(!Number.isFinite(l))return j;try{return l.toFixed(c)}catch{return j}}const ms={sm:"max-w-md",md:"max-w-2xl",lg:"max-w-4xl",xl:"max-w-6xl"},Ue=({isOpen:s,onClose:c,title:j,subtitle:l,children:V,footer:n,size:J="md",closeOnOverlayClick:u=!0})=>{if(m.useEffect(()=>(s?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[s]),m.useEffect(()=>{const v=L=>{L.key==="Escape"&&s&&c()};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[s,c]),!s)return null;const M=v=>{v.target===v.currentTarget&&u&&c()};return e.jsx("div",{className:"modal-overlay",onClick:M,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:e.jsxs("div",{className:`modal-container ${ms[J]}`,children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{id:"modal-title",className:"text-xl font-semibold text-gray-900 font-manrope",children:j}),l&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:l})]}),e.jsx("button",{onClick:c,className:"p-1.5 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors","aria-label":"Close modal",children:e.jsx(ke,{size:20,className:"text-gray-600"})})]}),e.jsx("div",{className:"modal-body",children:V}),n&&e.jsx("div",{className:"modal-footer",children:n})]})})};function xs({shiftId:s,onClose:c,onSuccess:j}){var T,i;const[l,V]=m.useState(null),[n,J]=m.useState([]),[u,M]=m.useState([]),[v,L]=m.useState(""),[B,X]=m.useState(null),[K,ne]=m.useState({}),[p,H]=m.useState(!0),[N,R]=m.useState(!1),[h,w]=m.useState(null),q=(r,o)=>{ne(_=>({..._,[r]:o}))};m.useEffect(()=>{Q()},[s]),m.useEffect(()=>{l&&O()},[l]),m.useEffect(()=>{if(!v)M(n);else{const r=v.toLowerCase();M(n.filter(o=>{var _;return o.first_name.toLowerCase().includes(r)||o.last_name.toLowerCase().includes(r)||o.email.toLowerCase().includes(r)||((_=o.skills_json)==null?void 0:_.some(E=>E.toLowerCase().includes(r)))}))}},[v,n]);async function Q(){try{const r=await G.get(`/shifts/${s}`);r.data.status==="success"?V(r.data.data):w("Failed to load shift details")}catch(r){console.error("Failed to load shift details:",r),w("Failed to load shift details")}}async function O(){var r;try{const o=new Set;if(l!=null&&l.event_id)try{const D=((r=(await G.get(`/events/${l.event_id}`)).data)==null?void 0:r.data)||{};if(D.shifts_by_role){const P=D.shifts_by_role.find(F=>F.skill_name===l.role_needed||F.role_name===l.role_needed);P!=null&&P.shifts&&P.shifts.forEach(F=>{F.assignments&&F.assignments.forEach(k=>{var S;const d=k.worker_id||((S=k.worker)==null?void 0:S.id),x=k.status;d&&x!=="cancelled"&&x!=="no_show"&&o.add(d)})})}}catch(E){console.log("Could not fetch event to filter assigned workers:",E)}console.log(`AssignmentModal: Found ${o.size} already assigned workers for "${l==null?void 0:l.role_needed}"`);const _=await G.get("/workers?active=true");if(_.data.status==="success"){const E=_.data.data.workers||_.data.data;if(l!=null&&l.role_needed){const D=E.filter(P=>{var F;return((F=P.skills_json)==null?void 0:F.includes(l.role_needed))&&!o.has(P.id)});console.log(`AssignmentModal: Showing ${D.length} eligible workers`),J(D)}else{const D=E.filter(P=>!o.has(P.id));J(D)}}else w("Failed to load workers")}catch(o){console.error("Failed to load workers:",o),w("Failed to load workers")}finally{H(!1)}}async function Y(){var r,o,_,E,D,P;if(!(!B||!l)){R(!0),w(null);try{const k=(await G.post("/staffing",{assignment:{shift_id:l.id,worker_id:B.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:K[B.id]||Number(l.pay_rate)||0}})).data;if(k.status==="success")j();else{let d=k.message||"Failed to assign worker";k.details&&k.details.length>0?d+=`

Details:
â€¢ `+k.details.join(`
â€¢ `):k.errors&&(d+=`

Details:
â€¢ `+k.errors.join(`
â€¢ `)),w(d)}}catch(F){console.error("Failed to assign worker:",F);let k="Failed to assign worker";if((o=(r=F.response)==null?void 0:r.data)!=null&&o.details&&F.response.data.details.length>0){const d=F.response.data.details.map(x=>(x.includes("conflicting shift"),x));k+=`

`+d.join(`
`)}else(E=(_=F.response)==null?void 0:_.data)!=null&&E.errors?k+=`

`+F.response.data.errors.join(`
`):(P=(D=F.response)==null?void 0:D.data)!=null&&P.message?k=F.response.data.message:F.message&&(k=F.message);w(k)}finally{R(!1)}}}if(p)return e.jsx(Ue,{isOpen:!0,onClose:c,title:"Assign Worker",size:"lg",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-600"})})});const A=e.jsxs(e.Fragment,{children:[h&&e.jsxs("div",{className:"mb-4 p-3 bg-gradient-to-r from-red-50 to-amber-50 border-l-4 border-red-500 rounded-r-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsx("h4",{className:"text-sm font-semibold text-red-900",children:"âš ï¸ Scheduling Conflict Detected"})]}),e.jsx("p",{className:"text-xs text-gray-600 ml-8",children:"Please resolve the conflict before attempting to assign this worker"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:c,disabled:N,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:Y,disabled:!B||N||!!h,className:`btn-primary ${h?"opacity-50 cursor-not-allowed":""}`,title:h?"Cannot assign due to scheduling conflict":"",children:N?"Assigning Worker...":"Assign Worker"})]})]});return e.jsx(Ue,{isOpen:!0,onClose:c,title:l?`${l.client_name} â€¢ ${l.role_needed}`:"Assign Worker",size:"xl",footer:A,children:e.jsxs("div",{className:"flex h-[600px]",children:[e.jsx("div",{className:"w-1/3 border-r border-gray-200 p-6 bg-gray-50",children:l?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Shift Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(pe,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:Ye(l.start_time_utc)}),e.jsxs("div",{className:"text-sm text-gray-600",children:[ze(l.start_time_utc)," - ",ze(l.end_time_utc)]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($e,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"text-sm text-gray-900",children:l.location||((i=(T=l.event)==null?void 0:T.venue)==null?void 0:i.formatted_address)||"Location not specified"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Pe,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900",children:l.role_needed}),l.required_skill&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Requires: ",l.required_skill]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Pay Rate:"})," $",(Number(l.pay_rate)||0).toFixed(2),"/hour"]}),l.uniform_name&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",l.uniform_name]})]}),l.notes&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Notes:"}),e.jsx("div",{className:"mt-1 whitespace-pre-line",children:l.notes.split("Uniform:").map((r,o)=>o===0?r.trim():e.jsxs("div",{children:[e.jsx("br",{}),e.jsx("span",{className:"font-medium",children:"Uniform:"})," ",r.trim()]},o))})]})})]})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(he,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Failed to load shift details"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search workers...",value:v,onChange:r=>L(r.target.value),className:"w-full pl-9 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-teal-500 focus:border-teal-500"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:h?e.jsx("div",{className:"p-6 flex items-center justify-center h-full",children:e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 rounded-lg p-5 shadow-sm w-full max-w-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(he,{size:20,className:"text-red-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg font-semibold text-red-900 mb-1",children:"âš ï¸ Scheduling Conflict"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"This worker cannot be assigned due to a scheduling conflict"}),e.jsx("div",{className:"bg-white border border-red-200 rounded p-3 mt-3",children:e.jsx("div",{className:"text-sm text-red-800 font-mono",children:h.split(`
`).map((r,o)=>r.trim()===""?null:r.startsWith("â€¢")?e.jsxs("div",{className:"mt-1 flex items-start gap-2",children:[e.jsx("span",{className:"text-red-500",children:"â—"}),e.jsx("span",{className:"flex-1",children:r.replace("â€¢","").trim()})]},o):r.startsWith("Details:")?null:r.includes("conflicting shift")?e.jsx("div",{className:"mt-1 text-red-700 font-medium",children:r},o):e.jsx("div",{className:"text-gray-700",children:r},o))})})]})]})})}):u.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Pe,{size:32,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:v?"No workers found matching your search":l!=null&&l.role_needed?`No workers found with "${l.role_needed}" skill`:"No available workers"}),(l==null?void 0:l.role_needed)&&!v&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:['Try adding "',l.role_needed,'" skill to workers or select a different shift.']})]}):e.jsx("ul",{children:u.map(r=>{const o=(B==null?void 0:B.id)===r.id,_=K[r.id]||Number(l.pay_rate)||0,E=K[r.id]&&K[r.id]!==(Number(l.pay_rate)||0);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${o?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[r.first_name[0],r.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[r.first_name," ",r.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(r.skills_json||[]).map((D,P)=>{const F=D===(l==null?void 0:l.role_needed);return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${F?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:D},P)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[E&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(He,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:(Number(l.pay_rate)||0).toString(),value:_||"",onChange:D=>{const P=D.target.value;(P===""||/^\d*\.?\d*$/.test(P))&&q(r.id,parseFloat(P)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:D=>D.stopPropagation(),onFocus:D=>D.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>X(r),className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${o?"bg-teal-600 text-white border-teal-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:o?"Selected":"Select"})]})]},r.id)})})})]})]})})}function us({isOpen:s,eventId:c,roleName:j,unfilledShiftIds:l,defaultPayRate:V,onClose:n,onDone:J}){const[u,M]=m.useState([]),[v,L]=m.useState([]),[B,X]=m.useState(""),[K,ne]=m.useState(!1),[p,H]=m.useState(!1),[N,R]=m.useState({}),[h,w]=m.useState(0),q=(i,r)=>{R(o=>({...o,[i]:r}))};m.useEffect(()=>{s&&(M([]),L([]),X(""),R({}),ne(!0),(async()=>{var i,r;try{const _=((i=(await G.get(`/events/${c}`)).data)==null?void 0:i.data)||{};console.log("QuickFill: Full event data:",JSON.stringify(_,null,2)),console.log("QuickFill: Looking for role:",j),console.log("QuickFill: shifts_by_role:",_.shifts_by_role);const E=new Set;if(_.shifts_by_role){const k=_.shifts_by_role.find(d=>(console.log("QuickFill: Checking role:",d.skill_name,d.role_name,"vs",j),d.skill_name===j||d.role_name===j));k?(console.log("QuickFill: Found role shifts:",k),k.shifts&&k.shifts.forEach(d=>{d.assignments&&(console.log("QuickFill: Shift has assignments:",d.assignments),d.assignments.forEach(x=>{var C;const S=x.worker_id||((C=x.worker)==null?void 0:C.id),f=x.status;S&&f!=="cancelled"&&(E.add(S),console.log("QuickFill: Adding worker_id to exclude:",S,"status:",f))}))})):console.log("QuickFill: No role shifts found for:",j)}console.log(`QuickFill: Found ${E.size} already assigned worker IDs:`,Array.from(E));const D=await G.get("/workers?active=true"),F=(((r=D.data)==null?void 0:r.data)||D.data||[]).filter(k=>{const d=(k.skills_json||[]).includes(j),x=E.has(k.id);return x&&console.log(`QuickFill: Excluding ${k.first_name} ${k.last_name} (ID: ${k.id}) - already assigned`),d&&!x});if(console.log(`QuickFill: Found ${F.length} eligible workers for "${j}"`),console.log("QuickFill: Eligible workers:",F.map(k=>`${k.first_name} ${k.last_name}`)),M(F),V){const k=Number(V)||0;w(k),console.log(`QuickFill: Default pay rate for ${j}: $${k}/hr`)}else console.log(`QuickFill: No default pay rate provided for ${j}`)}catch(o){console.error("Error loading workers:",o)}finally{ne(!1)}})())},[s,c,j,V]);const Q=m.useMemo(()=>{const i=B.trim().toLowerCase(),r=u;return i?r.filter(o=>`${o.first_name} ${o.last_name}`.toLowerCase().includes(i)||(o.email||"").toLowerCase().includes(i)):r},[u,B]),O=l.length,Y=i=>{L(r=>r.includes(i)?r.filter(o=>o!==i):r.length>=O?r:[...r,i])},A=async()=>{var _,E,D,P,F,k,d,x,S,f,C,z,te,xe,we;if(v.length===0||O===0)return;H(!0);let i=0,r=0;const o=[];try{const be=v.map(ae=>u.find(je=>je.id===ae)).filter(Boolean),ue=[...l];let ye=0;for(;ue.length>0&&be.length>0;){const ae=be[ye%be.length],je=ue.shift();try{const oe=N[ae.id]||Number(h)||0||0,ge=await G.post("/staffing",{assignment:{shift_id:je,worker_id:ae.id,status:"assigned",assigned_at_utc:new Date().toISOString(),hourly_rate:oe}});if(((_=ge.data)==null?void 0:_.status)==="success")i+=1;else{r+=1;const ie=`${ae.first_name} ${ae.last_name}`,Ne=((E=ge.data)==null?void 0:E.message)||((P=(D=ge.data)==null?void 0:D.error)==null?void 0:P.message)||((k=(F=ge.data)==null?void 0:F.errors)==null?void 0:k.join(", "))||"Unknown error";let ee="Unable to assign";const a=String(Ne).toLowerCase();a.includes("overlapping")||a.includes("conflict")?ee="Has overlapping shift":a.includes("capacity")||a.includes("full")?ee="Shift is full":a.includes("skill")||a.includes("certification")||a.includes("requirement")?ee="Missing required skill":a.includes("status")?ee="Cannot be assigned":ee="Unable to assign",o.push(`${ie}: ${ee}`)}}catch(oe){r+=1;const ge=`${ae.first_name} ${ae.last_name}`;let ie="Unable to assign";const Ne=((x=(d=oe.response)==null?void 0:d.data)==null?void 0:x.message)||((C=(f=(S=oe.response)==null?void 0:S.data)==null?void 0:f.error)==null?void 0:C.message)||((xe=(te=(z=oe.response)==null?void 0:z.data)==null?void 0:te.errors)==null?void 0:xe.join(", "))||null;if(Ne){const ee=String(Ne).toLowerCase();ee.includes("overlapping")||ee.includes("conflict")?ie="Has overlapping shift":ee.includes("capacity")||ee.includes("full")?ie="Shift is full":ee.includes("skill")||ee.includes("certification")||ee.includes("requirement")?ie="Missing required skill":ee.includes("status")?ie="Cannot be assigned":ie="Unable to assign"}else((we=oe.response)==null?void 0:we.status)===422?ie="Unable to assign":oe.message&&!oe.message.includes("status code")&&(ie=oe.message);o.push(`${ge}: ${ie}`)}ye+=1}let _e="";r>0&&o.length>0&&(_e=o.join(", ")),J({assigned:i,conflicts:r,details:_e})}finally{H(!1)}};if(!s)return null;const T=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:n,disabled:p,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:A,disabled:p||v.length===0||O===0,className:"btn-primary",children:p?"Filling Shifts...":v.length===1?`Assign worker to ${O} shift${O!==1?"s":""}`:`Assign ${v.length} workers to ${O} shifts`})]});return e.jsxs(Ue,{isOpen:s,onClose:n,title:`Quick Fill â€” ${j}`,subtitle:`Unfilled shifts: ${O}`,size:"lg",footer:T,children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{value:B,onChange:i=>X(i.target.value),placeholder:"Search eligible workersâ€¦",className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsx("div",{className:"max-h-[340px] overflow-y-auto border border-gray-200 rounded-lg",children:K?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loadingâ€¦"}):Q.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"No eligible workers"}):e.jsx("ul",{children:Q.map(i=>{const r=v.includes(i.id);return e.jsxs("li",{className:`flex items-center justify-between px-4 py-3 border-b last:border-b-0 ${r?"bg-teal-50":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 text-xs font-semibold",children:[i.first_name[0],i.last_name[0]]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[i.first_name," ",i.last_name]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(i.skills_json||[]).map((o,_)=>{const E=o===j;return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${E?"bg-teal-100 text-teal-700 font-medium":"bg-gray-100 text-gray-600"}`,children:o},_)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[N[i.id]&&N[i.id]!==(Number(h)||0)&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Custom"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(He,{className:"h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"1",min:"0",placeholder:Number(h)?(Number(h)||0).toString():"Rate",value:N[i.id]||Number(h)||0||"",onChange:o=>{const _=o.target.value;(_===""||/^\d*\.?\d*$/.test(_))&&q(i.id,parseFloat(_)||0)},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",onMouseDown:o=>o.stopPropagation(),onFocus:o=>o.stopPropagation()}),e.jsx("span",{className:"text-xs text-gray-600",children:"/hr"})]}),e.jsx("button",{onClick:()=>Y(i.id),disabled:!r&&v.length>=O,className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${r?"bg-teal-600 text-white border-teal-600":v.length>=O?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:r?"Selected":"Select"})]})]},i.id)})})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(es,{size:16,className:"text-teal-600"}),e.jsxs("span",{children:["Will assign ",e.jsx("strong",{children:v.length})," worker",v.length!==1?"s":""," to ",e.jsx("strong",{children:O})," shift",O!==1?"s":"","."]})]}),(Number(h)||0)>0&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Default rate for ",j,":"]}),e.jsxs("span",{className:"font-medium",children:["$",(Number(h)||0).toFixed(2),"/hr"]})]}),Object.keys(N).length>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["ðŸ’¡ Empty fields will use default rate ($",(Number(h)||0).toFixed(2),"/hr)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(Xe,{size:14,className:"text-yellow-600"}),"Conflicts and already-filled shifts will be skipped automatically."]})]})}function hs({event:s,isOpen:c,onClose:j,onSuccess:l}){var F,k;const V=Ie(),[n,J]=m.useState(!1),[u,M]=m.useState([]),[v,L]=m.useState(!1),[B,X]=m.useState(!1),[K,ne]=m.useState(null),[p,H]=m.useState(null),[N,R]=m.useState({isVisible:!1,message:"",type:"error"}),[h,w]=m.useState(null),[q,Q]=m.useState(!1);m.useEffect(()=>{c&&s.id&&O()},[c,s.id]);const O=async()=>{X(!0);try{const d=await G.get(`/events/${s.id}`);d.data.status==="success"&&ne(d.data.data)}catch(d){console.error("Failed to load full event details:",d),ne(s)}finally{X(!1)}},Y=()=>{j(),V(`/events/${s.id}/edit`)},A=[{name:"Bartender",icon:ss},{name:"Banquet Server/Runner",icon:ts},{name:"Captain",icon:as},{name:"Event Helper",icon:rs},{name:"Prep Cook",icon:ls}],T=K||s,i=K||s;m.useEffect(()=>{if(T){if(T.skill_requirements&&Array.isArray(T.skill_requirements)){const d=T.skill_requirements.map(x=>{var C,z;const S=(C=T.shifts_by_role)==null?void 0:C.find(te=>(te.skill_name||te.role_name)===x.skill_name),f=((z=S==null?void 0:S.shifts)==null?void 0:z.length)||(S==null?void 0:S.total_shifts)||x.needed_workers||1;return{skill_name:x.skill_name,needed_workers:f,pay_rate:x.pay_rate||15,description:x.description||"",uniform_id:void 0,cert_id:void 0}});M(d)}else if(T.shifts_by_role&&Array.isArray(T.shifts_by_role)){const d=T.shifts_by_role.map(x=>{const S=x.shifts?x.shifts.length:x.total_shifts||1;return{skill_name:x.skill_name||x.role_name||"",needed_workers:S,pay_rate:x.pay_rate||15,description:"",uniform_id:void 0,cert_id:void 0}});M(d)}}},[T]),m.useEffect(()=>{const d=K||s;d!=null&&d.schedule&&w({start_time_utc:d.schedule.start_time_utc,end_time_utc:d.schedule.end_time_utc,break_minutes:d.schedule.break_minutes||0})},[K,s]);const r=(d,x,S)=>{if(d<0||d>=u.length)return;const f=[...u];f[d]={...f[d],[x]:S},M(f)},o=()=>{M([...u,{skill_name:"",needed_workers:1,pay_rate:15,description:"",uniform_id:void 0,cert_id:void 0}])},_=d=>{var S;if(d<0||d>=u.length)return;const x=u[d];if((x==null?void 0:x.needed_workers)>0){const f=(S=i==null?void 0:i.shifts_by_role)==null?void 0:S[d];if(((f==null?void 0:f.assigned_workers)||(f==null?void 0:f.filled_shifts)||0)>0){R({isVisible:!0,message:"Cannot remove role with assigned workers. Please unassign workers first.",type:"error"});return}}M(u.filter((f,C)=>C!==d))},E=(d,x)=>{if(d<0||d>=u.length)return;A.find(f=>f.name===x);const S=[...u];S[d]={...S[d],skill_name:x},M(S),H(null)},D=async()=>{var x,S,f;const d=K||s;if(d.schedule&&new Date(d.schedule.start_time_utc)<=new Date){R({isVisible:!0,message:"Cannot edit event that has already started",type:"error"});return}L(!0);try{const C=K||s,z=await G.patch(`/events/${C.id}`,{event:{roles:u.map(te=>({skill_name:te.skill_name,needed:te.needed_workers,pay_rate:te.pay_rate,description:te.description,uniform_id:te.uniform_id,cert_id:te.cert_id})),schedule:h?{start_time_utc:h.start_time_utc,end_time_utc:h.end_time_utc,break_minutes:h.break_minutes}:C.schedule?{start_time_utc:C.schedule.start_time_utc,end_time_utc:C.schedule.end_time_utc,break_minutes:C.schedule.break_minutes||0}:void 0}});z.data.status==="success"?(R({isVisible:!0,message:z.data.message||"Event updated successfully",type:"success"}),l(),j()):R({isVisible:!0,message:z.data.message||"Failed to update event",type:"error"})}catch(C){console.error("Failed to update event:",C);const z=(x=C==null?void 0:C.response)==null?void 0:x.data;if((z==null?void 0:z.status)==="validation_error"&&((f=(S=z==null?void 0:z.data)==null?void 0:S.conflicts)!=null&&f.length)){const te=z.data.conflicts.map(xe=>{const we=new Date(xe.conflicting_shift_start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),be=new Date(xe.conflicting_shift_end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});return`${xe.worker_name} conflicts with ${xe.conflicting_event_title} (${we} â€“ ${be})`});R({isVisible:!0,message:`Can't save changes: ${te.length} worker${te.length!==1?"s":""} would be double-booked
â€¢ `+te.join(`
â€¢ `),type:"error"})}else R({isVisible:!0,message:(z==null?void 0:z.message)||"Failed to update event",type:"error"})}finally{L(!1)}},P=e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:j,disabled:v,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:D,disabled:v,className:"btn-primary",children:v?"Saving...":"Save Changes"})]});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-0 sm:p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white w-full h-full sm:h-auto sm:max-w-4xl sm:rounded-lg shadow-xl overflow-hidden flex flex-col sm:max-h-[90vh]",children:[e.jsxs("div",{className:"sticky top-0 bg-white px-4 sm:px-6 py-4 border-b border-gray-200 flex items-center justify-between z-10",children:[e.jsxs("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-gray-900 truncate",children:["Edit Event: ",i.title]}),e.jsx("button",{onClick:j,className:"p-2 text-gray-400 hover:text-gray-600 min-h-touch min-w-touch","aria-label":"Close",children:e.jsx(ke,{className:"h-5 w-5 sm:h-6 sm:w-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 sm:px-6 py-4 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Event Details"}),e.jsxs("button",{onClick:Y,className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-white border border-gray-300 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all shadow-sm",children:[e.jsx(qe,{size:14}),"Edit"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Venue"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:(F=i.venue)==null?void 0:F.name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:i.schedule&&new Date(i.schedule.start_time_utc).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"space-y-1 md:col-span-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Location"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900 leading-relaxed",children:(k=i.venue)==null?void 0:k.formatted_address})]}),e.jsxs("div",{className:"space-y-1 md:col-start-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Time"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:i.schedule&&e.jsxs(e.Fragment,{children:[new Date(i.schedule.start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})," - ",new Date(i.schedule.end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})]})})]}),e.jsx("div",{})]})]}),e.jsxs("div",{className:"col-span-2 bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 uppercase tracking-wide",children:"Event Schedule"}),e.jsx("button",{type:"button",onClick:()=>Q(!q),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:q?"Cancel":"Edit Schedule"})]}),q?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Start Time"}),e.jsx("input",{type:"datetime-local",value:h!=null&&h.start_time_utc?new Date(h.start_time_utc).toISOString().slice(0,16):"",onChange:d=>w(x=>x?{...x,start_time_utc:new Date(d.target.value).toISOString()}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"End Time"}),e.jsx("input",{type:"datetime-local",value:h!=null&&h.end_time_utc?new Date(h.end_time_utc).toISOString().slice(0,16):"",onChange:d=>w(x=>x?{...x,end_time_utc:new Date(d.target.value).toISOString()}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Break Minutes"}),e.jsx("input",{type:"number",min:"0",value:(h==null?void 0:h.break_minutes)||0,onChange:d=>w(x=>x?{...x,break_minutes:parseInt(d.target.value)||0}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3",children:e.jsx("p",{className:"text-xs text-blue-800",children:"âš ï¸ Changing schedule times will update ALL shifts and worker schedules for this event."})})]}):e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:i.schedule&&new Date(i.schedule.start_time_utc).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Time"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:h&&e.jsxs(e.Fragment,{children:[new Date(h.start_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})," -",new Date(h.end_time_utc).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})]})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Break"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[(h==null?void 0:h.break_minutes)||0," minutes"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"Roles"}),e.jsxs("button",{onClick:o,className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white text-sm font-semibold rounded-lg hover:bg-teal-700 transition-colors shadow-sm",children:[e.jsx(De,{size:16}),"Add Role"]})]}),u.map((d,x)=>{var S;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[e.jsxs("div",{className:"flex-1 relative overflow-visible",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Role Name *"}),e.jsxs("div",{className:"relative",style:{zIndex:p===x?1e3:1},children:[e.jsxs("button",{type:"button",onClick:()=>H(p===x?null:x),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white text-left flex items-center justify-between",children:[d.skill_name?e.jsxs("div",{className:"flex items-center gap-2",children:[((S=A.find(f=>f.name===d.skill_name))==null?void 0:S.icon)&&e.jsx("img",{src:A.find(f=>f.name===d.skill_name).icon,alt:d.skill_name,className:"w-5 h-5"}),e.jsx("span",{className:"text-gray-900",children:d.skill_name})]}):e.jsx("span",{className:"text-gray-400",children:"Pick the Skills the Worker Has"}),e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M19 9l-7 7-7-7"})})]}),p===x&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border-2 border-gray-200 rounded-xl shadow-2xl z-[9999] max-h-[300px] overflow-y-auto w-full min-w-max",children:A.filter(f=>!u.some((C,z)=>z!==x&&C.skill_name===f.name)).map(f=>e.jsxs("div",{onClick:()=>E(x,f.name),className:"flex items-center gap-3 px-4 py-3 cursor-pointer hover:bg-teal-50 border-b border-gray-100 last:border-0",children:[e.jsx("img",{src:f.icon,width:"24",height:"24",alt:f.name,className:"flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:f.name})]},f.name))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Needed Workers *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>r(x,"needed_workers",Math.max(1,d.needed_workers-1)),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"-"}),e.jsx("input",{type:"number",value:d.needed_workers,onChange:f=>r(x,"needed_workers",parseInt(f.target.value)||1),min:"1",className:"w-16 px-2 py-2 border border-gray-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-teal-500 font-medium"}),e.jsx("button",{onClick:()=>r(x,"needed_workers",d.needed_workers+1),className:"w-8 h-8 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-50 rounded-lg transition-colors font-semibold text-gray-700",children:"+"}),e.jsx("button",{onClick:()=>_(x),className:"ml-2 w-8 h-8 flex items-center justify-center text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove role",children:e.jsx(Qe,{size:18})})]})]})]}),(()=>{var z;const f=(z=i==null?void 0:i.shifts_by_role)==null?void 0:z[x],C=(f==null?void 0:f.assigned_workers)||(f==null?void 0:f.filled_shifts)||0;return C>0?e.jsxs("div",{className:"text-sm text-amber-600 font-semibold bg-amber-50 px-3 py-2 rounded-lg",children:[C," worker(s) assigned"]}):null})()]},x)})]})]}),e.jsx("div",{className:"sticky bottom-0 bg-white px-4 sm:px-6 py-4 border-t border-gray-200 flex flex-col sm:flex-row gap-3 sm:justify-end z-10",children:P})]})}),e.jsx(Oe,{isVisible:N.isVisible,message:N.message,type:N.type,onClose:()=>R({...N,isVisible:!1})})]})}function fs({assignment:s,isEditing:c,editHours:j,isSavingEdit:l,wasApprovedBeforeEdit:V,validationError:n,isSelected:J,canSelect:u,onToggleSelect:M,onStartEdit:v,onSaveEdit:L,onCancelEdit:B,onEditHoursChange:X,onEditKeyDown:K,calculateLiveTotal:ne,onNoShow:p,onRemove:H,onReEdit:N}){const[R,h]=m.useState(!1),w=r=>{if(!r)return"N/A";try{const o=ce(r);return fe(o,"MMM d, h:mm a, yyyy")}catch{try{const o=new Date(r),_=o.toLocaleString("en-US",{month:"short"}),E=o.getDate(),D=o.toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),P=o.getFullYear();return`${_} ${E}, ${D}, ${P}`}catch{return"N/A"}}},q=r=>{if(!r)return"";try{const o=ce(r);return fe(o,"h:mm a")}catch{return new Date(r).toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}},Q=()=>{const r=s.actual_start||s.scheduled_start,o=s.actual_end||s.scheduled_end;return!r||!o?"Not set":`${q(r)} - ${q(o)}`},O=()=>{const r=s.actual_start||s.scheduled_start,o=s.actual_end||s.scheduled_end;if(!r||!o)return 0;try{const _=ce(r),P=(ce(o).getTime()-_.getTime())/(1e3*60*60);return Math.round(P*10)/10}catch{return 0}},Y=r=>{const o=parseFloat(j)||0,_=Math.max(0,Math.min(24,o+r));X(_.toFixed(2))},A=s.approved,T=Q(),i=O();return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:de("hidden sm:table-row group transition-all duration-150 ease-in-out border-b",A&&!c&&s.status!=="no_show"&&s.status!=="cancelled"&&s.status!=="removed"&&"bg-green-50/30 hover:bg-green-50/50",!A&&!c&&s.status==="no_show"&&"bg-red-50/30 opacity-60",!A&&!c&&(s.status==="cancelled"||s.status==="removed")&&"bg-gray-50/30 opacity-60",!A&&!c&&s.status!=="no_show"&&s.status!=="cancelled"&&s.status!=="removed"&&"bg-white hover:bg-gray-50",c&&"bg-slate-50",l&&"opacity-60 pointer-events-none"),onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),children:[e.jsx("td",{className:"py-4 px-3 w-12",children:u&&e.jsx("input",{type:"checkbox",checked:J,onChange:()=>M(s.id),className:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded cursor-pointer",onClick:r=>r.stopPropagation()})}),e.jsx("td",{className:"py-4 px-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(We,{name:s.worker_name,src:s.worker_profile_photo_url,size:36}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:de("font-medium truncate",(s.status==="cancelled"||s.status==="removed")&&"line-through text-gray-500",s.status==="no_show"&&"text-gray-700",!s.status||s.status!=="no_show"&&s.status!=="cancelled"&&s.status!=="removed"&&"text-gray-900"),children:s.worker_name}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Scheduled: ",le(s.scheduled_hours,2,"0.00"),"h"]}),s.status==="no_show"&&!c&&e.jsx("div",{className:"mt-1 text-xs text-red-600 font-medium",children:s.approved_by_name?e.jsxs("span",{children:["Marked as no-show by ",s.approved_by_name.split("@")[0]," on ",s.approved_at?w(s.approved_at):"N/A"]}):e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ae,{className:"h-3 w-3"}),e.jsx("span",{children:"No-Show"})]})}),(s.status==="cancelled"||s.status==="removed")&&!c&&e.jsx("div",{className:"mt-1 text-xs text-red-600 font-medium",children:s.approved_by_name?e.jsxs("span",{children:["Denied by ",s.approved_by_name.split("@")[0]," on ",s.approved_at?w(s.approved_at):"N/A"]}):e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Se,{className:"h-3 w-3"}),e.jsx("span",{children:"Denied"})]})}),A&&!c&&s.approved_by_name&&s.status!=="no_show"&&s.status!=="cancelled"&&s.status!=="removed"&&e.jsxs("div",{className:"mt-1 text-xs text-green-700 font-medium",children:["Approved by ",s.approved_by_name.split("@")[0]," on"," ",s.approved_at?w(s.approved_at):"N/A"]})]})]})}),e.jsx("td",{className:"py-4 px-3 text-sm text-gray-700",children:e.jsx("span",{className:de((s.status==="cancelled"||s.status==="removed"||s.status==="no_show")&&"text-gray-400"),children:s.shift_role||"N/A"})}),e.jsx("td",{className:"py-4 px-3",children:e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-gray-700",children:[e.jsx(pe,{className:de("h-3.5 w-3.5 flex-shrink-0",s.status==="cancelled"||s.status==="removed"||s.status==="no_show"?"text-gray-300":"text-gray-400")}),e.jsx("span",{className:de("whitespace-nowrap",(s.status==="cancelled"||s.status==="removed"||s.status==="no_show")&&"text-gray-400"),children:T})]})}),e.jsx("td",{className:"py-4 px-3 text-sm font-medium text-right",children:s.status==="no_show"?e.jsx("span",{className:"text-red-600",children:"0h"}):s.status==="cancelled"||s.status==="removed"?e.jsx("div",{className:"flex items-center justify-end gap-1.5",children:e.jsx("span",{className:"text-gray-400",children:"-"})}):e.jsx("div",{className:"flex items-center justify-end gap-1.5",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-gray-400 line-through",children:[le(s.effective_hours||s.scheduled_hours||0,2,"0.00"),"h"]}),e.jsxs("span",{className:"text-gray-900 font-bold",children:["â†’ ",j,"h"]})]}):e.jsxs("span",{className:"text-gray-900",children:[le(s.effective_hours,2,"0.00"),"h"]})})}),e.jsx("td",{className:"py-4 px-3 text-sm text-gray-700 text-right",children:e.jsxs("span",{className:de((s.status==="cancelled"||s.status==="removed"||s.status==="no_show")&&"text-gray-400"),children:["$",le(s.effective_hourly_rate,2,"0.00"),"/h"]})}),e.jsx("td",{className:"py-4 px-3 text-sm font-semibold text-right",children:s.status==="no_show"?e.jsx("span",{className:"text-red-600 line-through",children:"$0.00"}):s.status==="cancelled"||s.status==="removed"?e.jsx("span",{className:"text-gray-400",children:"-"}):e.jsxs("span",{className:"text-gray-900",children:["$",le(s.effective_pay,2,"0.00")]})}),e.jsx("td",{className:"py-4 text-right",children:c?e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium text-sky-700 bg-sky-50 border border-sky-100 rounded",children:"Editing"}):e.jsx("div",{className:"flex items-center justify-end gap-2",children:s.status==="no_show"?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-red-700",children:[e.jsx(Ae,{className:"h-3.5 w-3.5"}),"No-Show"]}),s.can_edit_hours&&e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("button",{onClick:()=>v(s),className:"p-1.5 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Edit Hours",children:e.jsx(Ce,{className:"h-4 w-4"})})})]}):s.status==="cancelled"||s.status==="removed"?e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-gray-700 bg-gray-100 rounded flex-shrink-0",children:[e.jsx(ke,{className:"h-3.5 w-3.5"}),"Cancelled"]}),s.can_edit_hours&&e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("button",{onClick:()=>v(s),className:"p-1.5 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Edit Hours",children:e.jsx(Ce,{className:"h-4 w-4"})})})]}):e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[A?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 bg-green-100 rounded flex-shrink-0",children:[e.jsx(ve,{className:"h-3.5 w-3.5"}),"Approved"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-amber-700 bg-amber-100 rounded flex-shrink-0",children:[e.jsx(pe,{className:"h-3.5 w-3.5"}),"Pending"]}),s.can_edit_hours&&e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>A?N(s):v(s),className:"p-1.5 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors",title:A?"Re-edit":"Edit",children:e.jsx(Ce,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>p(s),className:"p-1.5 text-gray-600 hover:text-orange-600 hover:bg-orange-50 rounded transition-colors",title:"No-Show",children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>H(s),className:"p-1.5 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"Deny",children:e.jsx(Se,{className:"h-4 w-4"})})]})]})})})]}),c&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-3 py-0",children:e.jsx("div",{className:"overflow-hidden transition-all duration-300 ease-in-out",children:e.jsx("div",{className:"py-2",children:e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Edit Hours Worked"}),s.scheduled_hours&&e.jsxs("button",{onClick:()=>X(String(s.scheduled_hours)),className:"text-xs text-gray-500 hover:text-gray-700 underline flex items-center gap-1 focus:outline-none focus:ring-2 focus:ring-emerald-600 focus:ring-offset-1 rounded px-1",type:"button","aria-label":`Reset to scheduled ${s.scheduled_hours} hours`,children:[e.jsx(cs,{className:"h-3 w-3"}),"Reset to scheduled (",s.scheduled_hours,"h)"]})]}),e.jsxs("div",{className:"mb-3 flex items-center gap-2 text-xs text-gray-600 bg-white px-2 py-1 rounded",children:[e.jsx(pe,{className:"h-3.5 w-3.5 text-gray-400"}),e.jsx("span",{children:T}),i>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"Â·"}),e.jsxs("span",{children:[i," hour shift"]})]})]}),e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("button",{onClick:()=>Y(-1),disabled:l,className:"p-1.5 border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-600 focus:ring-offset-1",type:"button","aria-label":"Decrease hours",title:"Decrease by 1 hour",children:e.jsx(os,{className:"h-4 w-4 text-gray-600"})}),e.jsx("input",{type:"number",step:"0.5",min:"0",max:"24",value:j,onChange:r=>X(r.target.value),onKeyDown:K,disabled:l,className:"w-32 h-10 rounded-lg bg-white shadow-sm ring-1 ring-gray-300 focus:ring-2 focus:ring-emerald-600 focus:ring-offset-1 focus:outline-none px-3 text-center text-base font-semibold disabled:bg-gray-100",placeholder:"0.0",autoFocus:!0,"aria-label":"Hours worked","aria-invalid":!!n,"aria-describedby":n?`error-${s.id}`:void 0}),e.jsx("button",{onClick:()=>Y(1),disabled:l,className:"p-1.5 border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-600 focus:ring-offset-1",type:"button","aria-label":"Increase hours",title:"Increase by 1 hour",children:e.jsx(De,{className:"h-4 w-4 text-gray-600"})})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Updated Total"}),e.jsxs("div",{className:"text-lg font-bold text-gray-900","aria-live":"polite","aria-atomic":"true",children:["$",ne(j,s.effective_hourly_rate||0)]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsxs("span",{className:"text-gray-400 line-through",children:[le(s.effective_hours||s.scheduled_hours||0,1,"0.0"),"h"]}),e.jsx("span",{className:"mx-1",children:"â†’"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[parseFloat(j).toFixed(1),"h"]})]})]})]}),n&&e.jsxs("div",{id:`error-${s.id}`,className:"text-xs text-red-600 flex items-center gap-1",children:[e.jsx(he,{className:"h-3.5 w-3.5"}),n]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Quick:"}),e.jsx("button",{onClick:()=>Y(-1),disabled:l,className:"px-2 py-1 text-xs bg-white border border-gray-200 hover:border-gray-300 hover:bg-gray-50 disabled:opacity-50 transition-colors rounded",children:"-1h"}),e.jsx("button",{onClick:()=>Y(-.5),disabled:l,className:"px-2 py-1 text-xs bg-white border border-gray-200 hover:border-gray-300 hover:bg-gray-50 disabled:opacity-50 transition-colors rounded",children:"-0.5h"}),e.jsx("button",{onClick:()=>Y(.5),disabled:l,className:"px-2 py-1 text-xs bg-white border border-gray-200 hover:border-gray-300 hover:bg-gray-50 disabled:opacity-50 transition-colors rounded",children:"+0.5h"}),e.jsx("button",{onClick:()=>Y(1),disabled:l,className:"px-2 py-1 text-xs bg-white border border-gray-200 hover:border-gray-300 hover:bg-gray-50 disabled:opacity-50 transition-colors rounded",children:"+1h"})]}),V&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-amber-50 border-l-2 border-amber-400 rounded text-xs text-amber-800",children:[e.jsx(he,{className:"h-3.5 w-3.5 text-amber-600 flex-shrink-0"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Note:"})," Re-editing will un-approve these hours."]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("button",{onClick:()=>{p(s),B()},disabled:l,className:"px-2.5 py-1.5 text-xs font-medium text-orange-700 bg-transparent border border-transparent hover:bg-orange-50 hover:border-orange-200 rounded flex items-center gap-1 disabled:opacity-50 transition-colors focus:outline-none focus:ring-2 focus:ring-orange-600 focus:ring-offset-1",children:[e.jsx(he,{className:"h-3.5 w-3.5"}),"No-Show"]}),e.jsxs("button",{onClick:()=>{H(s),B()},disabled:l,className:"px-2.5 py-1.5 text-xs font-medium text-red-700 bg-transparent border border-transparent hover:bg-red-50 hover:border-red-200 rounded flex items-center gap-1 disabled:opacity-50 transition-colors focus:outline-none focus:ring-2 focus:ring-red-600 focus:ring-offset-1",children:[e.jsx(Se,{className:"h-3.5 w-3.5"}),"Deny"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:B,disabled:l,className:"px-3 py-1.5 text-sm font-medium text-gray-700 hover:text-gray-900 disabled:opacity-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:L,disabled:l||parseFloat(j)===(s.effective_hours||s.scheduled_hours||0),className:de("px-3 py-1.5 text-sm font-medium rounded-lg shadow-sm flex items-center gap-1.5 transition-colors",parseFloat(j)!==(s.effective_hours||s.scheduled_hours||0)?"bg-emerald-600 hover:bg-emerald-700 text-white":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:l?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"h-4 w-4"}),"Save Changes"]})})]})]})]})]})})})})}),e.jsx("tr",{className:"sm:hidden",children:e.jsx("td",{colSpan:8,className:"py-3 px-3",children:e.jsxs("div",{className:de("p-3 rounded-lg space-y-2 transition-all duration-150",c&&"bg-blue-50 border-2 border-blue-500",!c&&A&&s.status!=="no_show"&&s.status!=="cancelled"&&s.status!=="removed"&&"bg-green-50 border border-green-200",!c&&s.status==="no_show"&&"bg-red-50 border border-red-200 opacity-60",!c&&(s.status==="cancelled"||s.status==="removed")&&"bg-gray-50 border border-gray-200 opacity-60",!c&&s.status!=="no_show"&&s.status!=="cancelled"&&s.status!=="removed"&&"bg-white border border-gray-200"),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{name:s.worker_name,src:s.worker_profile_photo_url,size:32}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:s.worker_name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.shift_role||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-600 mt-1 ml-10",children:[e.jsx(pe,{className:"h-3 w-3 text-gray-400 flex-shrink-0"}),e.jsx("span",{children:T})]}),A&&!c&&s.approved_by_name&&e.jsxs("div",{className:"text-xs text-green-700 mt-1 ml-10 font-medium",children:["Approved by ",s.approved_by_name.split("@")[0]," on"," ",s.approved_at?w(s.approved_at):"N/A"]}),s.status==="no_show"&&!c&&e.jsx("div",{className:"text-xs text-red-600 mt-1 ml-10 font-medium",children:s.approved_by_name?e.jsxs("span",{children:["Marked as no-show by ",s.approved_by_name.split("@")[0]," on ",s.approved_at?w(s.approved_at):"N/A"]}):e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ae,{className:"h-3 w-3"}),e.jsx("span",{children:"No-Show"})]})}),(s.status==="cancelled"||s.status==="removed")&&!c&&e.jsx("div",{className:"text-xs text-red-600 mt-1 ml-10 font-medium",children:s.approved_by_name?e.jsxs("span",{children:["Denied by ",s.approved_by_name.split("@")[0]," on ",s.approved_at?w(s.approved_at):"N/A"]}):e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Se,{className:"h-3 w-3"}),e.jsx("span",{children:"Denied"})]})})]}),s.approved?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-green-700",children:[e.jsx(ve,{className:"h-3.5 w-3.5"}),"Approved"]}):s.status==="no_show"?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-red-700",children:[e.jsx(Ae,{className:"h-3.5 w-3.5"}),"No-Show"]}):s.status==="cancelled"||s.status==="removed"?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-gray-700",children:[e.jsx(Se,{className:"h-3.5 w-3.5"}),"Cancelled"]}),s.can_edit_hours&&e.jsxs("button",{onClick:()=>v(s),className:"px-2 py-1 text-xs font-medium text-blue-700 bg-blue-50 rounded hover:bg-blue-100 transition-colors flex items-center gap-1",children:[e.jsx(Ce,{className:"h-3 w-3"}),"Edit"]})]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-amber-700 bg-amber-50 rounded",children:[e.jsx(pe,{className:"h-3.5 w-3.5"}),"Pending"]})]}),c&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"bg-white border-2 border-blue-400 rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ce,{className:"h-4 w-4 text-blue-600"}),e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Edit Hours Worked"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Hours Worked"}),e.jsx("input",{type:"number",step:"0.25",min:"0",max:"24",value:j,onChange:r=>X(r.target.value),onKeyDown:K,disabled:l,className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",autoFocus:!0})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Updated Total"}),e.jsxs("div",{className:"text-lg font-bold text-blue-600",children:["$",ne(j,s.effective_hourly_rate||0)]})]}),V&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx(he,{className:"h-4 w-4 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-amber-800",children:[e.jsx("strong",{children:"Note:"})," Re-editing will un-approve these hours."]})]}),e.jsxs("div",{className:"flex gap-2 pt-2 border-t",children:[e.jsx("button",{onClick:B,disabled:l,className:"flex-1 px-3 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:L,disabled:l,className:"flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg flex items-center justify-center gap-2 disabled:bg-blue-400",children:l?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"h-4 w-4"}),"Save Changes"]})})]})]})]})}),!c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm pt-2 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Hours"}),e.jsx("div",{className:"font-medium flex items-center gap-1.5",children:s.status==="no_show"?e.jsx("span",{className:"text-red-600",children:"0h"}):s.status==="cancelled"||s.status==="removed"?e.jsx("span",{className:"text-gray-400",children:"-"}):e.jsxs("span",{className:"text-gray-900",children:[le(s.effective_hours,2,"0.00"),"h"]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Rate"}),e.jsxs("div",{className:"font-medium",children:["$",le(s.effective_hourly_rate,2,"0.00"),"/h"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Total"}),e.jsxs("div",{className:"font-semibold",children:["$",le(s.effective_pay,2,"0.00")]})]})]}),s.can_edit_hours&&e.jsx("div",{className:"flex items-center gap-2 pt-2 border-t border-gray-200",children:s.approved?e.jsx("button",{onClick:()=>N(s),className:"w-full px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-100 rounded hover:bg-gray-200 transition-colors",children:"Re-edit"}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>v(s),className:"flex-1 px-3 py-1.5 text-xs font-medium text-blue-700 bg-blue-50 rounded hover:bg-blue-100 transition-colors flex items-center justify-center gap-1",children:[e.jsx(Ce,{className:"h-3.5 w-3.5"}),"Edit"]}),e.jsxs("button",{onClick:()=>p(s),className:"flex-1 px-3 py-1.5 text-xs font-medium text-orange-700 bg-orange-50 rounded hover:bg-orange-100 transition-colors flex items-center justify-center gap-1",children:[e.jsx(he,{className:"h-3.5 w-3.5"}),"No-Show"]}),e.jsxs("button",{onClick:()=>H(s),className:"px-3 py-1.5 text-xs font-medium text-red-700 bg-red-50 rounded hover:bg-red-100 transition-colors flex items-center gap-1",children:[e.jsx(Se,{className:"h-3.5 w-3.5"}),"Deny"]})]})})]})]})})})]})}function gs({event:s,isOpen:c,onClose:j,onSuccess:l}){var $,W;const[V,n]=m.useState([]),[J,u]=m.useState(null),[M,v]=m.useState(!1),[L,B]=m.useState(null),[X,K]=m.useState(""),[ne,p]=m.useState(!1),[H,N]=m.useState(!1),[R,h]=m.useState({}),[w,q]=m.useState(!1),[Q,O]=m.useState(new Set),[Y,A]=m.useState({isVisible:!1,message:"",type:"success"}),[T,i]=m.useState({open:!1,title:"",variant:"default"});m.useEffect(()=>{c&&s&&(r(),O(new Set))},[c,s]);const r=async()=>{var t,b;if(s!=null&&s.id){v(!0);try{const g=await G.get(`/events/${s.id}/approvals`),U=g.data.data.assignments||[],I=Array.from(new Map(U.map(se=>[se.id,se])).values()),Z=Array.from(new Map(I.map(se=>[`${se.shift_id}-${se.worker_id}`,se])).values()),re=Array.from(new Map(Z.sort((se,Le)=>Le.id-se.id).map(se=>[`${se.worker_id}-${se.shift_role}-${se.scheduled_start}-${se.scheduled_end}`,se])).values());console.log(`Loaded ${U.length} assignments, deduplicated to ${re.length}`,{before:U.length,afterById:I.length,afterByShiftWorker:Z.length,final:re.length}),n(re),u(g.data.data.cost_summary||null)}catch(g){console.error("Error loading assignments:",g),A({isVisible:!0,type:"error",message:((b=(t=g.response)==null?void 0:t.data)==null?void 0:b.error)||g.message||"Unable to load assignments for approval"}),n([]),u(null)}finally{v(!1)}}},o=t=>{B(t.id),K(String(t.effective_hours||t.hours_worked||t.scheduled_hours||"0")),N(!1),h(b=>{const g={...b};return delete g[t.id],g})},_=()=>{L&&h(t=>{const b={...t};return delete b[L],b}),B(null),K(""),N(!1)},E=(t,b)=>{const g=parseFloat(t);if(isNaN(g))return"Please enter a valid number";if(g<0)return"Hours cannot be negative";if(g>24)return"Hours cannot exceed 24 per shift";const U=b.scheduled_hours||0;return U>0&&g>U?`Hours (${g.toFixed(1)}h) exceed scheduled (${U.toFixed(1)}h)`:null},D=t=>{if(K(t),!L)return;const b=V.find(U=>U.id===L);if(!b)return;const g=E(t,b);h(U=>({...U,[L]:g||""}))},P=async()=>{var U,I,Z;if(!L)return;const t=V.find(re=>re.id===L);if(!t)return;const b=parseFloat(X),g=E(X,t);if(g){h(re=>({...re,[L]:g})),A({isVisible:!0,type:"error",message:g});return}p(!0);try{const re=await G.patch(`/approvals/${L}/update_hours`,{hours_worked:b});await r(),_(),A({isVisible:!0,type:"success",message:((U=re.data)==null?void 0:U.message)||"Hours updated successfully"})}catch(re){console.error("Error updating hours:",re),A({isVisible:!0,type:"error",message:((Z=(I=re.response)==null?void 0:I.data)==null?void 0:Z.message)||"Failed to update hours. Please try again."})}finally{p(!1)}},F=t=>{if(t.key==="Enter")t.preventDefault(),P();else if(t.key==="Escape")t.preventDefault(),_();else if(t.key==="ArrowUp"||t.key==="ArrowDown"){t.preventDefault();const b=parseFloat(X)||0,g=t.shiftKey?1:.5,U=t.key==="ArrowUp"?Math.min(24,b+g):Math.max(0,b-g);K(U.toFixed(2))}},k=(t,b)=>{const g=parseFloat(t);return isNaN(g)?"0.00":(g*b).toFixed(2)},d=t=>{i({open:!0,title:"Re-Edit Approved Hours",message:`Re-editing will un-approve ${t.worker_name}'s hours. The assignment will need to be re-approved after you make changes. Continue?`,variant:"warning",onConfirm:async()=>{i({open:!1,title:""}),B(t.id),K(String(t.effective_hours||t.hours_worked||t.scheduled_hours||"0")),N(!0),A({isVisible:!0,type:"success",message:"Hours un-approved. Make your changes and save."})}})},x=t=>{i({open:!0,title:"Mark No-Show",message:`Mark ${t.worker_name} as no-show? This will set hours to 0.`,requireNote:!0,note:"",variant:"warning",onConfirm:async b=>{var U,I;const g=b||T.note||"";i({open:!1,title:""});try{await G.post(`/approvals/${t.id}/mark_no_show`,{notes:g}),await r(),A({isVisible:!0,type:"success",message:"Marked as no-show"})}catch(Z){console.error("Error marking no-show:",Z),A({isVisible:!0,type:"error",message:((I=(U=Z.response)==null?void 0:U.data)==null?void 0:I.message)||"Failed to mark no-show"})}}})},S=t=>{i({open:!0,title:"Deny Assignment",message:`Deny ${t.worker_name} from this job? This will cancel their assignment.`,requireNote:!0,note:"",variant:"danger",onConfirm:async b=>{var U,I;const g=b||T.note||"";i({open:!1,title:""});try{await G.delete(`/approvals/${t.id}/remove`,{data:{notes:g}}),await r(),A({isVisible:!0,type:"success",message:"Assignment denied"})}catch(Z){console.error("Error removing assignment:",Z),A({isVisible:!0,type:"error",message:((I=(U=Z.response)==null?void 0:U.data)==null?void 0:I.message)||"Failed to deny assignment"})}}})},f=V.filter(t=>!t.approved&&t.can_approve&&t.status!=="no_show"&&t.status!=="cancelled"),C=f.filter(t=>Q.has(t.id)),z=t=>{O(b=>{const g=new Set(b);return g.has(t)?g.delete(t):g.add(t),g})},te=()=>{C.length===f.length&&f.length>0?O(new Set):O(new Set(f.map(t=>t.id)))},xe=async()=>{if(C.length===0){A({isVisible:!0,type:"error",message:"Please select at least one assignment to approve"});return}i({open:!0,title:"Approve Selected Hours",message:`Approve hours for ${C.length} selected ${C.length===1?"worker":"workers"}?`,onConfirm:async()=>{var t,b;q(!0);try{await G.post(`/events/${s.id}/approve_selected`,{assignment_ids:Array.from(C.map(g=>g.id))}),await r(),O(new Set),l(),A({isVisible:!0,type:"success",message:`Approved ${C.length} ${C.length===1?"assignment":"assignments"}`})}catch(g){console.error("Error approving selected:",g),A({isVisible:!0,type:"error",message:((b=(t=g.response)==null?void 0:t.data)==null?void 0:b.message)||"Failed to approve selected hours"})}finally{q(!1),i({open:!1,title:""})}}})},we=async()=>{const t=f.length;i({open:!0,title:"Approve All Hours",message:`Approve hours for all ${t} eligible workers?`,onConfirm:async()=>{var b,g;q(!0);try{await G.post(`/events/${s.id}/approve_all`),await r(),O(new Set),l(),A({isVisible:!0,type:"success",message:`Approved ${t} assignments`})}catch(U){console.error("Error approving all:",U),A({isVisible:!0,type:"error",message:((g=(b=U.response)==null?void 0:b.data)==null?void 0:g.message)||"Failed to approve all hours"})}finally{q(!1),i({open:!1,title:""})}}})};if(!c)return null;const be=V,ue=V.filter(t=>t.status!=="no_show"&&t.status!=="cancelled"&&t.status!=="removed"),ye=V.filter(t=>t.status==="no_show"),_e=V.filter(t=>t.status==="cancelled"||t.status==="removed"),ae=ue.filter(t=>!t.approved).length,je=ue.filter(t=>t.approved).length,oe=ue.length,ge=be.length,ie=ue.filter(t=>!t.approved).reduce((t,b)=>t+Number(b.effective_pay||0),0),Ne=ue.filter(t=>t.approved).reduce((t,b)=>t+Number(b.effective_pay||0),0),ee=ie+Ne,a=ue.reduce((t,b)=>t+Number(b.effective_hours||0),0),y=ue.filter(t=>t.approved).reduce((t,b)=>t+Number(b.effective_hours||0),0);return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-0 sm:p-4 overflow-y-auto",children:[e.jsx(Oe,{isVisible:Y.isVisible,message:Y.message,type:Y.type,onClose:()=>A({...Y,isVisible:!1})}),e.jsxs("div",{className:"bg-white w-full h-full sm:h-auto sm:max-w-5xl sm:rounded-lg shadow-xl overflow-hidden flex flex-col sm:max-h-[90vh] my-0 sm:my-4",children:[e.jsx("header",{className:"border-b px-6 py-4 bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Approve Hours"}),e.jsxs("div",{className:"mt-1.5 flex flex-wrap items-center gap-3 text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium text-gray-900",children:s==null?void 0:s.title}),(($=s==null?void 0:s.schedule)==null?void 0:$.start_time_utc)&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"h-3.5 w-3.5 text-gray-400"}),fe(ce(s.schedule.start_time_utc),"MMM d, yyyy h:mm a")," - ",fe(ce(s.schedule.end_time_utc),"h:mm a")]}),((W=s==null?void 0:s.venue)==null?void 0:W.name)&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($e,{className:"h-3.5 w-3.5 text-gray-400"}),s.venue.name]})]})]}),e.jsx("button",{onClick:j,className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close modal",children:e.jsx(ke,{className:"h-5 w-5"})})]})}),ae>0&&e.jsx("div",{className:"bg-amber-50 border-l-4 border-amber-400 px-6 py-3 flex-shrink-0",children:e.jsxs("p",{className:"text-sm text-amber-800 flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx("strong",{children:ae})," ",ae===1?"assignment":"assignments"," pending approval"]})}),e.jsx("div",{className:"flex-1 overflow-auto px-3 sm:px-6 py-4",children:M?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading assignments..."})]}):V.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(he,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No assignments found for this event."})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b border-gray-200 hidden sm:table-header-group",children:e.jsxs("tr",{className:"text-left",children:[e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider w-12 px-3",children:f.length>0&&e.jsx("input",{type:"checkbox",checked:C.length===f.length&&f.length>0,onChange:te,className:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded cursor-pointer",title:C.length===f.length?"Deselect all":"Select all"})}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider w-[25%]",children:"Worker"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider w-[15%]",children:"Role"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider w-[18%]",children:"Time Worked"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right w-[10%]",children:"Hours"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right w-[10%]",children:"Rate"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right w-[12%]",children:"Total"}),e.jsx("th",{className:"pb-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right w-[10%]",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:V.map(t=>{const b=!t.approved&&t.can_approve&&t.status!=="no_show"&&t.status!=="cancelled";return e.jsx(fs,{assignment:t,isEditing:L===t.id,editHours:X,isSavingEdit:ne,wasApprovedBeforeEdit:H,validationError:R[t.id],isSelected:Q.has(t.id),canSelect:b,onToggleSelect:z,onStartEdit:o,onSaveEdit:P,onCancelEdit:_,onEditHoursChange:D,onEditKeyDown:F,calculateLiveTotal:k,onNoShow:x,onRemove:S,onReEdit:d},t.id)})})]})}),e.jsxs("footer",{className:"border-t bg-gray-50 px-3 sm:px-6 py-4 flex-shrink-0",children:[(ye.length>0||_e.length>0)&&e.jsxs("div",{className:"mb-4 grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4 text-sm border-b border-gray-200 pb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"Total Assigned"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:ge})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"Approved"}),e.jsx("div",{className:"text-base font-semibold text-green-600",children:je})]}),ye.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"No-Shows"}),e.jsx("div",{className:"text-base font-semibold text-red-600",children:ye.length})]}),_e.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"Denied"}),e.jsx("div",{className:"text-base font-semibold text-gray-500",children:_e.length})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-600",children:ae===0?"Final approved cost:":"Total cost:"}),e.jsxs("span",{className:"ml-2 text-lg font-bold text-gray-900",children:["$",le(ae===0?Ne:ee,2,"0.00")]}),e.jsxs("span",{className:"ml-1 text-gray-600",children:["(",ae===0?je:oe," ",ae===0?je===1?"worker":"workers":oe===1?"worker":"workers",", ",le(ae===0?y:a,2,"0.00"),"h)"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:j,className:"px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 transition-colors",children:"Close"}),ae>0&&e.jsx("button",{onClick:()=>{C.length>0?xe():we()},disabled:w||C.length===0,className:de("px-5 py-2.5 text-white text-sm font-semibold rounded-lg shadow-sm flex items-center gap-2 transition-colors",C.length>0?"bg-green-600 hover:bg-green-700 disabled:bg-green-400":"bg-gray-400 cursor-not-allowed"),children:w?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"h-4 w-4 animate-spin"}),"Approving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"h-4 w-4"}),C.length>0?`Approve Selected (${C.length})`:"Approve All"]})})]})]})]})]}),T.open&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>i({open:!1,title:""})}),e.jsxs("div",{className:"relative bg-white w-full max-w-md rounded-lg shadow-xl p-5",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:T.title}),T.message&&e.jsx("p",{className:"mt-2 text-sm text-gray-700",children:T.message}),T.requireNote&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes (optional)"}),e.jsx("textarea",{value:T.note||"",onChange:t=>i(b=>({...b,note:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]}),e.jsxs("div",{className:"mt-5 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>i({open:!1,title:""}),className:"px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-200",children:"Cancel"}),e.jsx("button",{onClick:async()=>{const t=T.note||"";T.onConfirm&&await T.onConfirm(t)},className:"px-4 py-2 text-white text-sm font-medium rounded-md "+(T.variant==="danger"?"bg-red-600 hover:bg-red-700":T.variant==="warning"?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:"Confirm"})]})]})]})]})}function me({className:s="",count:c=1}){return e.jsx(e.Fragment,{children:Array.from({length:c}).map((j,l)=>e.jsx("div",{className:`animate-pulse bg-gray-200 rounded-lg ${s}`},l))})}function Ee(){return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(me,{className:"h-6 w-48 mb-2"}),e.jsx(me,{className:"h-4 w-32"})]}),e.jsx(me,{className:"h-8 w-8 rounded-full"})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4 rounded"}),e.jsx(me,{className:"h-4 w-40"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4 rounded"}),e.jsx(me,{className:"h-4 w-36"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4 rounded"}),e.jsx(me,{className:"h-4 w-32"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(me,{className:"h-2 w-full rounded-full mb-2"}),e.jsx(me,{className:"h-3 w-24"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(me,{className:"h-9 w-24 rounded-md"}),e.jsx(me,{className:"h-9 w-24 rounded-md"})]})]})})}function ps(s,c=500){const[j,l]=m.useState(s);return m.useEffect(()=>{const V=setTimeout(()=>{l(s)},c);return()=>{clearTimeout(V)}},[s,c]),j}function Ws(){const s=Ie(),[c,j]=Je(),l=(c.get("tab")==="completed"?"completed":c.get("tab"))||"active",V=l==="active"?c.get("filter")||"needs_workers":c.get("filter")||"all",[n,J]=m.useState(l),[u,M]=m.useState(V),[v,L]=m.useState(""),B=ps(v,500),[X,K]=m.useState("date"),[ne,p]=m.useState(!0),[H,N]=m.useState([]),[R,h]=m.useState(new Set),[w,q]=m.useState(new Set),[Q,O]=m.useState({isOpen:!1}),[Y,A]=m.useState({isOpen:!1}),[T,i]=m.useState({isVisible:!1,message:"",type:"success"}),[r,o]=m.useState({isOpen:!1,isLoading:!1}),[_,E]=m.useState({isOpen:!1,isLoading:!1}),[D,P]=m.useState({isOpen:!1,isLoading:!1}),[F,k]=m.useState({isOpen:!1,unfilledShiftIds:[]}),[d,x]=m.useState({isOpen:!1});m.useEffect(()=>{S()},[n,u,c]),m.useEffect(()=>{const a=(c.get("tab")==="completed"?"completed":c.get("tab"))||"active",y=c.get("filter")||"all";a!==n&&J(a),y!==u&&M(y)},[c,n,u]),m.useEffect(()=>{const a=c.get("event_id"),y=c.get("shift_id");if(a){const $=parseInt(a);isNaN($)||(h(new Set([$])),y&&console.log(`Auto-expanding event ${$} with shift ${y}`))}},[c]),m.useEffect(()=>{const a=c.get("event_id");if(!a)return;const y=parseInt(a);if(isNaN(y))return;const $=H.find(W=>W.id===y);$&&(!$.shifts_by_role||$.shifts_by_role.length===0)&&(z(y),h(new Set([y])))},[c,H]);async function S(){p(!0);try{const a=n==="completed"?"completed":n,y=c.get("date");let $=`/events?tab=${a}`;u!=="all"&&(n==="active"||n==="draft")&&($+=`&filter=${u}`),y&&($+=`&date=${y}`),console.log("Loading events with URL:",$,"filterStatus:",u,"date:",y);const W=await G.get($);if(W.data.status==="success"){console.log("Received events:",W.data.data.length);const t=W.data.data;if(n==="completed"){const b=await Promise.all(t.map(async g=>{var U;try{const I=await G.get(`/events/${g.id}/approvals`);if(((U=I.data)==null?void 0:U.status)==="success"){const Z=I.data.data.assignments||[],re=Z.length,se=Z.filter(Ke=>Ke.approved).length,Le=I.data.data.cost_summary||null;return{...g,approval_status:{total:re,approved:se,pending:re-se},cost_summary:Le}}}catch(I){console.warn(`Failed to load approval status for event ${g.id}:`,I)}return g}));N(b)}else{const b=Array.from(R);N(g=>{const U=new Map(g.map(I=>[I.id,I]));return t.map(I=>{const Z=U.get(I.id);return b.includes(I.id)&&(Z!=null&&Z.shifts_by_role)&&Z.shifts_by_role.length>0?{...I,shifts_by_role:Z.shifts_by_role,full_details:Z.full_details||Z}:I})}),b.length>0&&Promise.all(b.map(g=>z(g))).catch(g=>{console.error("Failed to refresh expanded event details:",g)})}}}catch(a){console.error("Failed to load events:",a),H.length===0&&N([])}finally{p(!1)}}const f=a=>{J(a),j({tab:a}),M(a==="active"?"needs_workers":"all")},C=a=>{M(a);const y=new URLSearchParams;y.set("tab",n),a!=="all"&&y.set("filter",a),j(y)},z=async a=>{var y,$;q(W=>new Set(W).add(a));try{const[W,t]=await Promise.all([G.get(`/events/${a}`),G.get(`/events/${a}/approvals`).catch(()=>null)]);if(((y=W.data)==null?void 0:y.status)==="success"){const b=W.data.data;if((($=t==null?void 0:t.data)==null?void 0:$.status)==="success"){const g=t.data.data.assignments||[],U=new Map(g.map(I=>[I.id,I]));b.shifts_by_role&&(b.shifts_by_role=b.shifts_by_role.map(I=>({...I,shifts:I.shifts.map(Z=>({...Z,assignments:Z.assignments.map(re=>{const se=U.get(re.id);return se&&typeof se=="object"?{...re,...se}:re})}))})))}N(g=>g.map(U=>U.id===a?{...U,...b}:U))}}catch(W){console.error("Failed to load event details",W)}finally{q(W=>{const t=new Set(W);return t.delete(a),t})}},te=a=>{const y=new Set(R);if(y.has(a))y.delete(a),q($=>{const W=new Set($);return W.delete(a),W});else{y.add(a);const $=H.find(b=>b.id===a),W=w.has(a),t=($==null?void 0:$.shifts_by_role)&&$.shifts_by_role.length>0;!W&&!t&&z(a)}h(y)};async function xe(a){const y=H==null?void 0:H.find($=>$.id===a);P({isOpen:!0,isLoading:!1,eventId:a,eventTitle:y==null?void 0:y.title})}async function we(){if(D.eventId){P(a=>({...a,isLoading:!0}));try{const a=await G.delete(`/events/${D.eventId}`);a.data.status==="success"?(P({isOpen:!1,isLoading:!1}),i({isVisible:!0,message:`"${a.data.event_title}" moved to trash`,type:"success",action:{label:"Undo",onClick:()=>be(a.data.event_id),variant:"primary"}}),S()):i({isVisible:!0,message:a.data.message||"Unable to delete event",type:"error"})}catch(a){console.error("Failed to delete event:",a),i({isVisible:!0,message:"Unable to delete event",type:"error"})}finally{P(a=>({...a,isLoading:!1}))}}}async function be(a){try{const y=await G.post(`/events/${a}/restore`);y.data.status==="success"?(i({isVisible:!0,message:"Event restored to draft",type:"success"}),S()):i({isVisible:!0,message:y.data.message||"Unable to restore event",type:"error"})}catch(y){console.error("Failed to restore event:",y),i({isVisible:!0,message:"Unable to restore event",type:"error"})}}function ue(){P({isOpen:!1,isLoading:!1})}function ye(a){o({isOpen:!0,eventId:a,isLoading:!1})}async function _e(){if(r.eventId){o(a=>({...a,isLoading:!0}));try{const a=await G.post(`/events/${r.eventId}/publish`);a.data.status==="success"?(i({isVisible:!0,message:"Event published successfully",type:"success"}),o({isOpen:!1,isLoading:!1}),S()):(i({isVisible:!0,message:a.data.message||"Unable to publish event",type:"error"}),o({isOpen:!1,isLoading:!1}))}catch(a){console.error("Failed to publish event:",a),i({isVisible:!0,message:"Unable to publish event",type:"error"}),o({isOpen:!1,isLoading:!1})}}}function ae(){o({isOpen:!1,isLoading:!1})}function je(a,y){E({isOpen:!0,assignmentId:a,isLoading:!1,workerName:y})}async function oe(){var a,y;if(_.assignmentId){E($=>({...$,isLoading:!0}));try{const $=await G.delete(`/staffing/${_.assignmentId}`);((a=$.data)==null?void 0:a.status)==="success"?(i({isVisible:!0,message:"Worker unassigned successfully",type:"success"}),E({isOpen:!1,isLoading:!1}),S()):(i({isVisible:!0,message:((y=$.data)==null?void 0:y.message)||"Unable to unassign worker",type:"error"}),E({isOpen:!1,isLoading:!1}))}catch($){console.error("Failed to unassign worker:",$),i({isVisible:!0,message:"Unable to unassign worker",type:"error"}),E({isOpen:!1,isLoading:!1})}}}const ge=a=>{A({isOpen:!0,shiftId:a})},ie=()=>{A({isOpen:!1})},Ne=()=>{ie(),i({isVisible:!0,message:"Worker assigned",type:"success"}),S()},ee=H.filter(a=>{var y;if(B){const $=B.toLowerCase();if(!(a.title.toLowerCase().includes($)||((y=a.venue)==null?void 0:y.name.toLowerCase().includes($))))return!1}if(n==="active")switch(u){case"needs_workers":return a.unfilled_roles_count>0;case"partially_filled":return a.unfilled_roles_count>0&&a.assigned_workers_count>0;case"fully_staffed":return a.unfilled_roles_count===0&&a.assigned_workers_count>0;case"all":default:return!0}return!0}).sort((a,y)=>{var $,W;switch(X){case"name":return a.title.localeCompare(y.title);case"staffing":return a.staffing_percentage-y.staffing_percentage;case"date":default:const t=(($=a.schedule)==null?void 0:$.start_time_utc)||a.created_at,b=((W=y.schedule)==null?void 0:W.start_time_utc)||y.created_at;return new Date(t).getTime()-new Date(b).getTime()}});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold text-gray-900",children:"Events"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage events and assign workers"})]}),e.jsxs("button",{onClick:()=>s("/events/create"),className:"w-full sm:w-auto inline-flex items-center justify-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors shadow-sm min-h-touch",children:[e.jsx(De,{size:20}),"Create New Event"]})]}),c.get("date")&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-teal-50 border border-teal-200 rounded-lg",children:[e.jsx(Me,{size:16,className:"text-teal-600"}),e.jsxs("span",{className:"text-sm font-medium text-teal-900",children:["Showing events for ",fe(ce(c.get("date")),"EEEE, MMMM d, yyyy")]}),e.jsx("button",{onClick:()=>{const a=new URLSearchParams(c);a.delete("date"),j(a)},className:"ml-auto text-teal-600 hover:text-teal-700",title:"Clear date filter",children:e.jsx(ke,{size:16})})]})]}),e.jsxs("div",{className:"flex gap-6 border-b border-gray-200 mb-6",children:[e.jsx("button",{onClick:()=>f("draft"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${n==="draft"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Draft Events"}),e.jsx("button",{onClick:()=>f("active"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${n==="active"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Active Events"}),e.jsx("button",{onClick:()=>f("completed"),className:`pb-3 px-1 font-medium transition-colors border-b-2 ${n==="completed"?"border-teal-600 text-teal-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Completed Events"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-3 sm:gap-4 mb-6",children:[e.jsxs("div",{className:"w-full md:flex-1 md:max-w-md relative",children:[e.jsx(Ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search events or venues...",value:v,onChange:a=>L(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),e.jsxs("select",{value:X,onChange:a=>K(a.target.value),className:"w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white",children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"name",children:"Sort by Name"}),n!=="draft"&&e.jsx("option",{value:"staffing",children:"Sort by Staffing"})]}),n==="active"&&e.jsxs("div",{className:"w-full sm:w-auto flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>C("all"),className:`w-full sm:w-auto px-3 py-2 text-sm font-medium rounded-lg transition ${u==="all"?"bg-gray-100 text-gray-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"All"}),e.jsx("button",{onClick:()=>C("needs_workers"),className:`w-full sm:w-auto px-3 py-2 text-sm font-medium rounded-lg transition ${u==="needs_workers"?"bg-red-100 text-red-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Needs Workers"}),e.jsx("button",{onClick:()=>C("fully_staffed"),className:`w-full sm:w-auto px-3 py-2 text-sm font-medium rounded-lg transition ${u==="fully_staffed"?"bg-green-100 text-green-700":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-300"}`,children:"Ready"})]})]}),ne?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ee,{}),e.jsx(Ee,{}),e.jsx(Ee,{})]}):e.jsxs(e.Fragment,{children:[n==="draft"&&e.jsx(bs,{events:ee,onDelete:xe,onPublish:ye,onNavigate:a=>s(a),searchQuery:v}),n==="active"&&e.jsx(ys,{events:ee,expandedEvents:R,loadingEventDetails:w,onToggleEvent:te,onAssignWorker:ge,onUnassign:je,onQuickFill:(a,y,$,W)=>k({isOpen:!0,eventId:a,roleName:y,unfilledShiftIds:$,payRate:W}),onPublish:ye,onDelete:xe,onEdit:a=>x({isOpen:!0,event:a}),searchQuery:v}),n==="completed"&&e.jsx(js,{events:ee,searchQuery:v,onApproveHours:a=>O({isOpen:!0,event:a})})]})]}),Y.isOpen&&Y.shiftId&&e.jsx(xs,{shiftId:Y.shiftId,onClose:ie,onSuccess:Ne}),e.jsx(Oe,{isVisible:T.isVisible,message:T.message,type:T.type,action:T.action,onClose:()=>i({...T,isVisible:!1})}),e.jsx(Te,{isOpen:r.isOpen,onClose:ae,onConfirm:_e,title:"Publish Event",message:"Ready to publish? This will create shifts and make them available for worker assignment.",confirmText:r.isLoading?"Publishingâ€¦":"Publish",cancelText:"Cancel",isLoading:r.isLoading,isDestructive:!1}),e.jsx(Te,{isOpen:_.isOpen,onClose:()=>E({isOpen:!1,isLoading:!1}),onConfirm:oe,title:"Unassign Worker",message:`Remove ${_.workerName||"this worker"} from this shift?`,confirmText:_.isLoading?"Removingâ€¦":"Unassign",cancelText:"Cancel",isLoading:_.isLoading,isDestructive:!0}),e.jsx(Te,{isOpen:D.isOpen,onClose:ue,onConfirm:we,title:"Delete Event",message:`Delete "${D.eventTitle}"? This action cannot be undone.`,confirmText:D.isLoading?"Deletingâ€¦":"Delete",cancelText:"Cancel",isLoading:D.isLoading,isDestructive:!0}),e.jsx(us,{isOpen:F.isOpen,eventId:F.eventId||0,roleName:F.roleName||"",unfilledShiftIds:F.unfilledShiftIds,defaultPayRate:F.payRate,onClose:()=>k({isOpen:!1,unfilledShiftIds:[]}),onDone:({assigned:a,conflicts:y,details:$})=>{k({isOpen:!1,unfilledShiftIds:[]});let W=`Assigned ${a} workers â€¢ ${y} skipped`;y>0&&$&&(W+=`: ${$}`),i({isVisible:!0,message:W,type:y>0?"error":"success"}),S()}}),d.event&&e.jsx(hs,{event:d.event,isOpen:d.isOpen,onClose:()=>x({isOpen:!1,event:void 0}),onSuccess:()=>{S(),x({isOpen:!1,event:void 0})}}),Q.isOpen&&Q.event&&e.jsx(gs,{event:Q.event,isOpen:Q.isOpen,onClose:()=>{O({isOpen:!1}),S()},onSuccess:()=>{S(),O({isOpen:!1})}})]})}function bs({events:s,onDelete:c,onPublish:j,onNavigate:l,searchQuery:V}){const n=u=>{if(!u)return"No date set";const M=ce(u);return fe(M,"MMM d, yyyy")},J=u=>{if(!u)return"";const M=ce(u);return fe(M,"h:mm a")};return s.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:V?"No draft events found":"No draft events yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:V?"Try adjusting your search query":"Create your first event to get started"}),!V&&e.jsxs("button",{onClick:()=>l("/events/create"),className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors",children:[e.jsx(De,{size:20}),"Create Event"]})]}):e.jsx("div",{className:"space-y-4",children:s.map(u=>{var M;return e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[u.title,u.schedule&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-600",children:["â€¢ ",J(u.schedule.start_time_utc),"â€“",J(u.schedule.end_time_utc)]})]})}),e.jsx("span",{className:"px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:"Draft"})]}),u.venue&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[e.jsx($e,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:((M=u.venue)==null?void 0:M.name)||"No venue"})]}),u.schedule&&e.jsx("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsx("span",{children:n(u.schedule.start_time_utc)})]})}),u.total_workers_needed>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Pe,{size:16,className:"text-gray-400"}),e.jsxs("span",{children:[u.total_workers_needed," workers needed"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>l(`/events/${u.id}/edit`),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",title:"Edit",children:e.jsx(qe,{size:18})})})]})})},u.id)})})}function ys({events:s,expandedEvents:c,loadingEventDetails:j,onToggleEvent:l,onAssignWorker:V,onUnassign:n,onQuickFill:J,onPublish:u,onDelete:M,onEdit:v,searchQuery:L}){const B=p=>{const H=ce(p);return fe(H,"EEE, MMM d, yyyy")},X=p=>{const H=ce(p);return fe(H,"h:mm a")},K=p=>{if(!p.schedule)return!1;const N=(ce(p.schedule.start_time_utc).getTime()-new Date().getTime())/(1e3*60*60);return N>0&&N<=48},ne=p=>{switch(p){case"fully_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[e.jsx(ve,{size:14}),"Ready"]});case"partially_staffed":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full",children:[e.jsx(he,{size:14}),"Partial"]});case"needs_workers":return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[e.jsx(ke,{size:14}),"Needs Workers"]});default:return null}};return s.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:L?"No active events found":"No active events"}),e.jsx("p",{className:"text-gray-600",children:L?"Try adjusting your search query or filters":"Publish draft events to see them here"})]}):e.jsx("div",{className:"space-y-4",children:s.map(p=>{const H=c.has(p.id);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-5 hover:border-gray-300 hover:shadow-sm transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1 truncate",children:p.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 flex-wrap",children:[p.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Me,{className:"h-4 w-4 flex-shrink-0"}),B(p.schedule.start_time_utc)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"h-4 w-4 flex-shrink-0"}),X(p.schedule.start_time_utc)," - ",X(p.schedule.end_time_utc),K(p)&&e.jsxs("span",{className:"bg-red-50 text-red-800 text-xs font-bold px-2.5 py-1 rounded-full ml-2 inline-flex items-center gap-1.5","aria-label":"Urgent: starts within 48 hours",children:[e.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full"}),"URGENT"]})]})]}),p.venue&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($e,{className:"h-4 w-4 flex-shrink-0"}),p.venue.name]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 ml-4",children:[ne(p.staffing_status),v&&p.status==="published"&&e.jsx("button",{onClick:N=>{N.stopPropagation(),v(p)},title:"Edit Event",className:"p-1.5 text-teal-600 hover:text-teal-700 hover:bg-teal-50 rounded transition-colors",children:e.jsx(ds,{size:14})}),M&&e.jsx("button",{onClick:N=>{N.stopPropagation(),M(p.id)},title:"Delete",className:"p-1.5 text-red-600 hover:text-red-700 hover:bg-red-50 rounded transition-colors",children:e.jsx(Qe,{size:14})}),e.jsx("button",{onClick:()=>l(p.id),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:H?e.jsx(Ze,{size:20,className:"text-gray-600"}):e.jsx(ns,{size:20,className:"text-gray-600"})})]})]}),e.jsx("div",{className:"py-3 border-y border-gray-100 space-y-2",children:(()=>{const N=p.assigned_workers_count||0,R=p.total_workers_needed||0,h=R>0?Math.round(N/R*100):0;p.unfilled_roles_count;const w=(()=>{const Q=p.estimated_cost??p.total_cost??p.total_pay_amount??0;return le(Q,2,"0.00")})(),q=()=>h>=100?"bg-green-500":h>=75?"bg-amber-500":h>=50?"bg-orange-500":"bg-red-500";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 whitespace-nowrap",children:[N," of ",R," roles filled"]}),e.jsx("div",{className:"flex-1 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:de("h-full rounded-full transition-all duration-300",q()),style:{width:`${h}%`}})}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900 whitespace-nowrap",children:[h,"%"]})]}),e.jsxs("div",{className:"text-sm font-medium text-gray-700",children:[N,"/",R," hired"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{children:"Est. Cost: "}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["$",w]})]})]})})()}),H&&e.jsx("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:j.has(p.id)?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-teal-600 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading assignments..."})]})}):p.shifts_by_role&&p.shifts_by_role.length>0?e.jsx("div",{className:"space-y-4",children:p.shifts_by_role.map(N=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:N.role_name}),e.jsxs("span",{className:"text-sm text-gray-600",children:[N.filled_shifts,"/",N.total_shifts," hired"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[N.filled_shifts<N.total_shifts&&e.jsxs("span",{className:"px-2.5 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:[N.total_shifts-N.filled_shifts," needed"]}),N.filled_shifts<N.total_shifts&&e.jsx("button",{onClick:R=>{var q;R.stopPropagation();const h=N.shifts.filter(Q=>Q.staffing_progress.percentage<100).sort((Q,O)=>new Date(Q.start_time_utc).getTime()-new Date(O.start_time_utc).getTime()).map(Q=>Q.id),w=(q=N.shifts[0])==null?void 0:q.pay_rate;J(p.id,N.role_name,h,w)},className:"px-2.5 py-1 text-xs font-semibold bg-teal-600 text-white rounded hover:bg-teal-700",title:"Quick Fill by Skill",children:"Quick Fill by Skill"})]})]}),e.jsx("div",{className:"space-y-2",children:N.shifts.map((R,h)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 text-gray-700 rounded-md flex items-center justify-center text-xs font-medium",children:h+1}),e.jsxs("span",{className:"text-sm text-gray-700",children:[X(R.start_time_utc)," - ",X(R.end_time_utc)]}),R.assignments.length>0&&e.jsx("div",{className:"flex flex-col gap-1.5",children:R.assignments.map(w=>{const q=`${w.worker.first_name} ${w.worker.last_name}`,Q=Number(w.hourly_rate||R.pay_rate||0),O=Ge(w),Y=O?`${q} â€¢ $${le(Q,0,"0")}/hr â€¢ ${O}`:`${q} â€¢ $${le(Q,0,"0")}/hr`;return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:de("bg-white text-black border rounded-full px-2.5 py-1 text-sm font-medium shadow-sm max-w-[140px] truncate",w.status==="no_show"||w.status==="cancelled"||w.status==="removed"?"border-red-200 opacity-60":w.approved?"border-green-200":"border-gray-200"),title:Y,children:q}),e.jsx("button",{onClick:A=>{A.stopPropagation(),n(w.id,q)},className:"w-5 h-5 flex items-center justify-center text-red-600 hover:text-red-700 hover:bg-red-50 rounded",title:"Unassign worker",children:e.jsx(ke,{size:12})})]}),O&&e.jsx("div",{className:de("text-xs font-medium ml-2",w.status==="no_show"||w.status==="cancelled"||w.status==="removed"?"text-red-600":w.approved?"text-green-700":"text-gray-500"),children:O})]},w.id)})})]}),R.staffing_progress.percentage===100?e.jsxs("span",{className:"flex items-center gap-1.5 text-sm font-medium text-green-600",children:[e.jsx(ve,{size:16}),"Assigned"]}):e.jsx("button",{onClick:w=>{w.stopPropagation(),V(R.id)},className:"px-3 py-1.5 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Assign Worker"})]},R.id))})]},N.role_name))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:p.status==="draft"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"This event is still in draft status"}),e.jsx("p",{className:"text-sm",children:"Publish the event to generate shifts and assign workers"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:"No shifts available"}),e.jsx("p",{className:"text-sm",children:"This event may not have any shifts generated yet"})]})}),e.jsx("div",{className:"flex items-center justify-center gap-3",children:p.status==="draft"&&e.jsx("button",{onClick:()=>u(p.id),className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors",children:"Publish Event"})})]})})]},p.id)})})}function js({events:s,searchQuery:c,onApproveHours:j}){const l=n=>{const J=ce(n);return fe(J,"MMM d, yyyy")},V=n=>{const J=ce(n);return fe(J,"h:mm a")};return s.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“‹"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:c?"No past events found":"No past events yet"}),e.jsx("p",{className:"text-gray-600",children:c?"Try adjusting your search query":"Completed events will appear here"})]}):e.jsx("div",{className:"space-y-4",children:s.map(n=>{var u;const J=Be(n.total_hours??n.total_hours_worked??0);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-5 hover:border-gray-300 hover:shadow-sm transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1 truncate",children:n.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 flex-wrap",children:[n.schedule&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Me,{className:"h-4 w-4 flex-shrink-0"}),l(n.schedule.start_time_utc)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"h-4 w-4 flex-shrink-0"}),V(n.schedule.start_time_utc)," - ",V(n.schedule.end_time_utc)]})]}),n.venue&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($e,{className:"h-4 w-4 flex-shrink-0"}),n.venue.name]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 ml-4",children:[e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-700 rounded",children:"Completed"}),n.approval_status&&n.approval_status.pending>0&&e.jsxs("span",{className:"px-2 py-1 text-xs font-medium bg-amber-100 text-amber-700 rounded",children:[n.approval_status.pending," Pending"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 py-3 border-y border-gray-100",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Workers"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:n.assigned_workers_count||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Hours"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:le(J,2,"0.00")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Cost"}),e.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:["$",(u=n.cost_summary)!=null&&u.total_estimated_cost?le(n.cost_summary.total_estimated_cost,2,"0.00"):n.total_pay_amount?le(n.total_pay_amount,2,"0.00"):"0.00"]}),n.approval_status&&n.approval_status.pending>0&&n.cost_summary&&e.jsxs("div",{className:"text-xs text-amber-600 font-medium mt-0.5",children:["$",le(n.cost_summary.pending_cost,2,"0.00")," pending"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Staffing"}),(()=>{const M=n.total_workers_needed||0,v=n.assigned_workers_count||0;if(M===0&&v===0)return e.jsx("div",{className:"text-lg font-semibold text-gray-400",children:"Not staffed"});const L=n.staffing_percentage||(M>0?Math.round(v/M*100):0);return e.jsxs("div",{className:de("text-lg font-semibold",L===100?"text-green-600":L>0?"text-yellow-600":"text-red-600"),children:[L,"%"]})})()]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:j&&(()=>{const M=n.total_workers_needed||0,v=n.assigned_workers_count||0,L=n.approval_status&&n.approval_status.total>0;return M===0&&v===0&&!L?null:e.jsxs("button",{onClick:()=>j(n),className:de("px-4 py-2 text-sm font-medium rounded-lg flex items-center gap-2 transition-colors shadow-sm",n.approval_status&&n.approval_status.pending>0?"bg-amber-600 hover:bg-amber-700 text-white":n.approval_status&&n.approval_status.approved===n.approval_status.total&&L||L?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"),disabled:!L,children:[n.approval_status&&n.approval_status.pending>0?e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-4 w-4"}),"Approve Hours (",n.approval_status.pending,")"]}):L?e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"h-4 w-4"}),"Approved"]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"h-4 w-4"}),"No assignments"]}),e.jsx(is,{className:"h-4 w-4"})]})})()})]},n.id)})})}export{Ws as EventsPage};
