import{c as te,a as C,j as e,A as se}from"./index-DxaJQHS1.js";import{r as d,R as N}from"./vendor-79DyBOV9.js";import{T as re}from"./Toast-CMBjIbym.js";import{s as R}from"./number-BA3fu1JD.js";import{f as o,C as ae}from"./index-cqc3Gttj.js";import{s as M}from"./index--uCTdyrX.js";import{e as W,s as O}from"./index-BAdqQKKx.js";import{F as V}from"./file-text-ZC5AYHhO.js";import{D as H}from"./dollar-sign-CBiOphmD.js";import{U as le}from"./users-njODl4GS.js";import{C as L}from"./calendar-DbeTA1d0.js";import{D as Y}from"./download-Cavw821X.js";import"./x-circle-BDQdZOxX.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=te("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);function je(){const[r,p]=d.useState(null),[f,g]=d.useState("last_7_days"),[h,j]=d.useState({start:o(M(new Date,7),"yyyy-MM-dd"),end:o(new Date,"yyyy-MM-dd")}),[c,x]=d.useState(null),[m,T]=d.useState(null),[u,B]=d.useState(null),[v,A]=d.useState(!1),F=N.useRef(!1),[J,G]=d.useState([]),[q,K]=d.useState([]),[Q,X]=d.useState([]),[Z,U]=d.useState(null),[ee,I]=d.useState(!1),[S,$]=d.useState({isVisible:!1,message:"",type:"success"});N.useEffect(()=>{(async()=>{var t,a,i;try{const s=await C.get("/workers?active=true"),b=(((a=(t=s.data)==null?void 0:t.data)==null?void 0:a.workers)||((i=s.data)==null?void 0:i.data)||[]).map(y=>({id:y.id,name:`${y.first_name} ${y.last_name}`,skills_json:y.skills_json||[]}));G(b);const n=new Set;b.forEach(y=>(y.skills_json||[]).forEach(P=>n.add(P))),X(Array.from(n).sort())}catch(s){console.error("Failed to load workers for filters",s)}})(),(async()=>{var t;try{const i=((t=(await C.get("/events?tab=active")).data)==null?void 0:t.data)||[];K(i.map(s=>({id:s.id,title:s.title})))}catch(a){console.error("Failed to load events for filters",a)}})()},[]);const k=N.useCallback(()=>{const t=new Date;switch(f){case"today":return{start:o(t,"yyyy-MM-dd"),end:o(t,"yyyy-MM-dd")};case"yesterday":const a=M(t,1);return{start:o(a,"yyyy-MM-dd"),end:o(a,"yyyy-MM-dd")};case"last_7_days":return{start:o(M(t,7),"yyyy-MM-dd"),end:o(t,"yyyy-MM-dd")};case"last_30_days":return{start:o(M(t,30),"yyyy-MM-dd"),end:o(t,"yyyy-MM-dd")};case"this_month":return{start:o(O(t),"yyyy-MM-dd"),end:o(W(t),"yyyy-MM-dd")};case"last_month":const i=new Date(t.getFullYear(),t.getMonth()-1,1);return{start:o(O(i),"yyyy-MM-dd"),end:o(W(i),"yyyy-MM-dd")};case"custom":return h;default:return h}},[f,h]),E=N.useCallback(async()=>{var t;I(!0);try{const a=k();let i=`/reports/timesheet/preview?start_date=${a.start}&end_date=${a.end}`;m&&(i+=`&event_id=${m}`),c&&(i+=`&worker_id=${c}`),u&&(i+=`&skill_name=${encodeURIComponent(u)}`);const s=await C.get(i),l=((t=s.data)==null?void 0:t.data)||s.data;U(l)}catch(a){console.error("Failed to fetch timesheet preview:",a),U(null)}finally{I(!1)}},[k,m,c,u]);N.useEffect(()=>{E()},[E]),N.useEffect(()=>{const t=()=>{E()};return window.addEventListener("approval-updated",t),()=>{window.removeEventListener("approval-updated",t)}},[E]);async function w(t){var a,i;if(!F.current){F.current=!0,A(!0);try{const s=k();let l="";switch(t){case"timesheet":l=`/reports/timesheet?start_date=${s.start}&end_date=${s.end}`,m&&(l+=`&event_id=${m}`),c&&(l+=`&worker_id=${c}`),u&&(l+=`&skill_name=${encodeURIComponent(u)}`);break;case"payroll":l=`/reports/payroll?start_date=${s.start}&end_date=${s.end}`,m&&(l+=`&event_id=${m}`),c&&(l+=`&worker_id=${c}`);break;case"worker_hours":l=`/reports/worker_hours?start_date=${s.start}&end_date=${s.end}`,c&&(l+=`&worker_id=${c}`),u&&(l+=`&skill_name=${encodeURIComponent(u)}`);break;case"event_summary":l=`/reports/event_summary?start_date=${s.start}&end_date=${s.end}`,m&&(l+=`&event_id=${m}`);break}const b=await C.get(l,{responseType:"blob"}),n=b.headers["content-disposition"],P=((a=n==null?void 0:n.match(/filename="?([^";]+)"?/i))==null?void 0:a[1])||`report_${s.start}_to_${s.end}.csv`,z=window.URL.createObjectURL(new Blob([b.data])),_=document.createElement("a");_.href=z,_.setAttribute("download",P),document.body.appendChild(_),_.click(),_.remove(),window.URL.revokeObjectURL(z)}catch(s){console.error("Failed to export:",s);const l=(i=s==null?void 0:s.response)==null?void 0:i.data;try{if(l&&typeof l.text=="function"){const b=await l.text(),n=JSON.parse(b),y=(n==null?void 0:n.message)||(n==null?void 0:n.errors)&&(Array.isArray(n.errors)?n.errors.join(", "):String(n.errors));$({isVisible:!0,message:y||"Failed to export report",type:"error"})}else $({isVisible:!0,message:(s==null?void 0:s.message)||"Failed to export report",type:"error"})}catch{$({isVisible:!0,message:"Failed to export report",type:"error"})}}finally{A(!1),F.current=!1}}}return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Reports"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Export timesheets and payroll data for processing"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsx(D,{icon:e.jsx(V,{size:24}),title:"Weekly Timesheet",description:"Detailed time records with clock-in/clock-out times. Use as backup documentation if needed.",color:"teal",lastExport:"Last 7 days",onExport:()=>{g("last_7_days"),w("timesheet")},exporting:v,preview:Z,loadingPreview:ee}),e.jsx(D,{icon:e.jsx(H,{size:24}),title:"Payroll Summary",description:"See total hours and compensation per worker. Perfect for processing weekly or monthly payroll.",color:"indigo",lastExport:"Last 7 days",onExport:()=>{g("last_7_days"),w("payroll")},exporting:v}),e.jsx(D,{icon:e.jsx(le,{size:24}),title:"Worker Hours Report",description:"Individual worker breakdown showing all shifts worked. Good for performance reviews and audits.",color:"blue",lastExport:"This month",onExport:()=>{g("this_month"),w("worker_hours")},exporting:v}),e.jsx(D,{icon:e.jsx(L,{size:24}),title:"Event Summary",description:"Track labor costs per event. See which events are most expensive and monitor monthly spending.",color:"purple",lastExport:"Last 30 days",onExport:()=>{g("last_30_days"),w("event_summary")},exporting:v})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Advanced Export Options"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Select Report Type"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[e.jsx("button",{onClick:()=>p("timesheet"),className:`p-4 rounded-lg border-2 transition-all text-left ${r==="timesheet"?"border-teal-600 bg-teal-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${r==="timesheet"?"bg-teal-100 text-teal-600":"bg-gray-100 text-gray-600"}`,children:e.jsx(V,{size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Timesheet Report"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Job ID, Worker, Role, Hours, Break Time, Supervisor"})]})]})}),e.jsx("button",{onClick:()=>p("payroll"),className:`p-4 rounded-lg border-2 transition-all text-left ${r==="payroll"?"border-indigo-600 bg-indigo-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${r==="payroll"?"bg-indigo-100 text-indigo-600":"bg-gray-100 text-gray-600"}`,children:e.jsx(H,{size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Payroll Summary"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Date, Event, Worker, Hours, Rate, Total Pay"})]})]})}),e.jsx("button",{onClick:()=>p("worker_hours"),className:`p-4 rounded-lg border-2 transition-all text-left ${r==="worker_hours"?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${r==="worker_hours"?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600"}`,children:e.jsx(ae,{size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Worker Hours"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Total hours by worker for period"})]})]})}),e.jsx("button",{onClick:()=>p("event_summary"),className:`p-4 rounded-lg border-2 transition-all text-left ${r==="event_summary"?"border-purple-600 bg-purple-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${r==="event_summary"?"bg-purple-100 text-purple-600":"bg-gray-100 text-gray-600"}`,children:e.jsx(oe,{size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Event Summary"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Complete staffing details by event"})]})]})})]})]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Date Range"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 mb-4",children:[{value:"today",label:"Today"},{value:"yesterday",label:"Yesterday"},{value:"last_7_days",label:"Last 7 Days"},{value:"last_30_days",label:"Last 30 Days"},{value:"this_month",label:"This Month"},{value:"last_month",label:"Last Month"},{value:"custom",label:"Custom Range"}].map(t=>e.jsx("button",{onClick:()=>{g(t.value),t.value!=="custom"&&j({start:o(M(new Date,7),"yyyy-MM-dd"),end:o(new Date,"yyyy-MM-dd")})},className:`px-3 py-2 text-sm font-medium rounded-lg transition-colors ${f===t.value?"bg-teal-100 text-teal-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:t.label},t.value))}),f==="custom"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:h.start,onChange:t=>j(a=>({...a,start:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsx("div",{className:"pt-6",children:e.jsx("span",{className:"text-gray-500",children:"to"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:h.end,onChange:t=>j(a=>({...a,end:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]})]}),e.jsx("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-700",children:[e.jsx(L,{size:16}),e.jsxs("span",{className:"font-medium",children:["Selected Range: ",o(new Date(k().start),"MMM d, yyyy")," - ",o(new Date(k().end),"MMM d, yyyy")]})]})})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Optional Filters"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(r==="timesheet"||r==="payroll"||r==="worker_hours")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-2",children:"Filter by Worker (optional)"}),e.jsxs("select",{value:c||"",onChange:t=>x(t.target.value?parseInt(t.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500",children:[e.jsx("option",{value:"",children:"All Workers"}),J.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),(r==="timesheet"||r==="payroll"||r==="event_summary")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-2",children:"Filter by Event (optional)"}),e.jsxs("select",{value:m||"",onChange:t=>T(t.target.value?parseInt(t.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500",children:[e.jsx("option",{value:"",children:"All Events"}),q.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),(r==="timesheet"||r==="worker_hours")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-2",children:"Filter by Skill (optional)"}),e.jsxs("select",{value:u||"",onChange:t=>B(t.target.value||null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500",children:[e.jsx("option",{value:"",children:"All Skills"}),Q.map(t=>e.jsx("option",{value:t,children:t},t))]})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("button",{onClick:()=>r&&w(r),disabled:v,className:"w-full md:w-auto px-6 py-3 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(Y,{size:20}),v?"Exporting...":"Export CSV Report"]}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(se,{size:18,className:"text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-700",children:[e.jsx("p",{className:"font-medium text-blue-800 mb-2",children:"Export Information:"}),e.jsxs("ul",{className:"space-y-1 text-xs",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Timesheet Format:"})," Matches your sample exactly (JOB_ID, SKILL_NAME, etc.)"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Break Policy:"})," 30 minutes (0.5 hours) per shift by default"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Hours Calculation:"})," (End Time - Start Time) - Break Time"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Status Filter:"})," Only completed/approved shifts are exported"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Date Format:"})," MM/DD/YYYY, Times in 12-hour format (AM/PM)"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Overnight Shifts:"})," Use start date for shift date"]})]})]})]})})]})]})]})]}),e.jsxs("div",{className:"mt-8 bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Report guide"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-700",children:[e.jsxs("div",{className:"p-3 rounded border border-gray-200",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Payroll Summary"}),e.jsx("p",{className:"mt-1",children:"One row per worker with hours and payout. Use for payroll runs."})]}),e.jsxs("div",{className:"p-3 rounded border border-gray-200",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Event Summary"}),e.jsx("p",{className:"mt-1",children:"Workers per event and total labor cost. Good for monthly reviews."})]}),e.jsxs("div",{className:"p-3 rounded border border-gray-200",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Weekly Timesheet"}),e.jsx("p",{className:"mt-1",children:"Clock-in/out detail per shift for audit or disputes."})]}),e.jsxs("div",{className:"p-3 rounded border border-gray-200",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Worker Hours"}),e.jsx("p",{className:"mt-1",children:"All shifts for a worker with hours and payout totals."})]})]})]})]}),e.jsx(re,{isVisible:S.isVisible,message:S.message,type:S.type,onClose:()=>$({...S,isVisible:!1})})]})}function D({icon:r,title:p,description:f,color:g,lastExport:h,onExport:j,exporting:c,preview:x,loadingPreview:m}){const T={teal:"bg-teal-100 text-teal-600",indigo:"bg-indigo-100 text-indigo-600",blue:"bg-blue-100 text-blue-600",purple:"bg-purple-100 text-purple-600"};return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 hover:shadow-md transition-shadow cursor-pointer",onClick:j,role:"button","aria-label":`${p} quick export`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg ${T[g]} flex items-center justify-center`,children:r}),e.jsx("button",{onClick:u=>{u.stopPropagation(),j()},disabled:c,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition disabled:opacity-50",title:"Quick export",children:e.jsx(Y,{size:20})})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:p}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:f}),x!==void 0&&e.jsx("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg space-y-2 border border-gray-200",children:m?e.jsx("div",{className:"text-sm text-gray-500",children:"Loading preview..."}):x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Approved for Payout:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["$",R(x.approved_pay,2,"0.00")," (",R(x.approved_hours,1,"0.0"),"h)"]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Pending Approval:"}),e.jsxs("span",{className:"font-semibold text-amber-600",children:["$",R(x.pending_pay,2,"0.00")," (",R(x.pending_hours,1,"0.0"),"h)"]})]}),x.no_shows>0&&e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"No-Shows:"}),e.jsxs("span",{className:"font-semibold text-red-600",children:[x.no_shows," ",x.no_shows===1?"worker":"workers"]})]})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"No data available"})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(L,{size:16}),e.jsx("span",{children:h})]})]})}export{je as ReportsPage};
