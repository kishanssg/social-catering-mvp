import{r as c,j as e,L as u}from"./application.js";import{u as F}from"./useAssignments.js";import{A as h,u as V}from"./AssignmentStatusBadge.js";import{B as R,T as I,C as O}from"./BulkAssignModal.js";import{L as W,E as q}from"./ErrorMessage2.js";import{U as G}from"./users.js";import{c as B}from"./createLucideIcon.js";import{B as X}from"./briefcase.js";import{U as H}from"./user.js";import{C as J}from"./calendar.js";import{C as K}from"./clock.js";import{C as P}from"./circle-alert.js";import{X as Q}from"./x.js";import{f}from"./format.js";import{p as j}from"./parseISO.js";import"./api.js";import"./shiftsApi.js";import"./workersApi.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Z=B("chevron-down",Y);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],se=B("search",ee),we=()=>{const[t,o]=c.useState(""),[a,g]=c.useState(""),[l,y]=c.useState(""),[d,m]=c.useState("grouped"),[i,p]=c.useState(null),[T,w]=c.useState(!1),[v,b]=c.useState(null),{assignments:N,loading:U,error:_,refetch:C}=F(),k=N.filter(s=>{const r=!t||s.worker.first_name.toLowerCase().includes(t.toLowerCase())||s.worker.last_name.toLowerCase().includes(t.toLowerCase())||s.shift.client_name.toLowerCase().includes(t.toLowerCase())||s.shift.role_needed.toLowerCase().includes(t.toLowerCase()),n=!a||s.status===a,z=!l||f(j(s.shift.start_time_utc),"yyyy-MM-dd")===l;return r&&n&&z}),x=k.reduce((s,r)=>{const n=f(j(r.shift.start_time_utc),"yyyy-MM-dd");return s[n]||(s[n]=[]),s[n].push(r),s},{}),S=async(s,r)=>{p(s);try{await V(s,r),b({message:`Assignment status updated to ${r}`,type:"success"}),C()}catch{b({message:"Failed to update assignment status",type:"error"})}finally{p(null)}},A=s=>{try{return f(j(s),"EEE, MMM d, yyyy")}catch{return s}},L=s=>{try{return f(j(s),"h:mm a")}catch{return s}},M=s=>{switch(s){case"completed":return e.jsx(O,{className:"h-4 w-4 text-green-600"});case"no_show":return e.jsx(Q,{className:"h-4 w-4 text-red-600"});case"cancelled":return e.jsx(P,{className:"h-4 w-4 text-gray-600"});default:return null}},E=()=>N.filter(s=>new Date(s.shift.start_time_utc)>new Date&&s.status==="assigned").length,$=()=>N.filter(s=>s.status==="completed").length;return U?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(W,{message:"Loading assignments..."})}):_?e.jsx("div",{className:"py-8",children:e.jsx(q,{message:_,onRetry:C})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Assignments"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Track worker assignments and shift staffing"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>w(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Bulk Assign"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 text-center min-w-[100px]",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:E()}),e.jsx("div",{className:"text-xs text-blue-700 mt-1",children:"Upcoming"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 text-center min-w-[100px]",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:$()}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"Completed"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative md:col-span-2",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search workers, shifts, or clients...",value:t,onChange:s=>o(s.target.value),className:"pl-10 pr-4 py-2 w-full border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:a,onChange:s=>g(s.target.value),className:"px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"no_show",children:"No Show"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]}),e.jsx("input",{type:"date",value:l,onChange:s=>y(s.target.value),className:"px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"View:"}),e.jsx("button",{onClick:()=>m("list"),className:`px-3 py-1 text-sm rounded ${d==="list"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"List"}),e.jsx("button",{onClick:()=>m("grouped"),className:`px-3 py-1 text-sm rounded ${d==="grouped"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Grouped by Date"})]})]}),k.length===0?e.jsx("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:e.jsxs("div",{className:"max-w-sm mx-auto",children:[e.jsx(X,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:t||a||l?"No assignments found":"No assignments yet"}),e.jsx("p",{className:"text-gray-500 mb-6",children:t||a||l?"Try adjusting your filters to see more results":"Start by creating shifts and assigning workers. Assignments will appear here as you schedule your team."}),!t&&!a&&!l&&e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(u,{to:"/shifts/new",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Create Shift"}),e.jsx(u,{to:"/workers",className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"View Workers"})]})]})}):d==="grouped"?e.jsx("div",{className:"space-y-6",children:Object.keys(x).sort().reverse().map(s=>e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-6 py-3 border-b",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:A(x[s][0].shift.start_time_utc)}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[x[s].length," ",x[s].length===1?"assignment":"assignments"]})]}),e.jsx("div",{className:"divide-y",children:x[s].map(r=>e.jsx(D,{assignment:r,onStatusChange:S,updatingStatus:i,formatTime:L,getStatusIcon:M},r.id))})]},s))}):e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"divide-y",children:k.map(s=>e.jsx(D,{assignment:s,onStatusChange:S,updatingStatus:i,formatTime:L,formatDate:A,getStatusIcon:M,showDate:!0},s.id))})}),T&&e.jsx(R,{onClose:()=>w(!1),onSuccess:()=>{C(),w(!1)}}),v&&e.jsx(I,{message:v.message,type:v.type,onClose:()=>b(null)})]})},D=({assignment:t,onStatusChange:o,updatingStatus:a,formatTime:g,formatDate:l,getStatusIcon:y,showDate:d=!1})=>{const[m,i]=c.useState(!1),p=a===t.id;return e.jsx("div",{className:"p-6 hover:bg-gray-50",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Worker"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(u,{to:`/workers/${t.worker.id}`,className:"font-medium text-blue-600 hover:text-blue-700 flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),t.worker.first_name," ",t.worker.last_name]}),e.jsx(u,{to:`/workers/${t.worker.id}/schedule`,className:"text-xs text-gray-500 hover:text-green-600",title:"View schedule",children:e.jsx(J,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Shift"}),e.jsx(u,{to:`/shifts/${t.shift.id}`,className:"font-medium text-gray-900 hover:text-blue-600",children:t.shift.client_name}),e.jsx("div",{className:"text-sm text-gray-600",children:t.shift.role_needed})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Time"}),d&&e.jsx("div",{className:"text-sm text-gray-900 mb-1",children:l(t.shift.start_time_utc)}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[e.jsx(K,{className:"h-4 w-4"}),g(t.shift.start_time_utc)," - ",g(t.shift.end_time_utc)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Status"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>i(!m),disabled:p,className:"flex items-center gap-2",children:[e.jsx(h,{status:t.status}),y(t.status),e.jsx(Z,{className:"h-4 w-4 text-gray-400"})]}),m&&e.jsxs("div",{className:"absolute top-full left-0 mt-1 bg-white border rounded-lg shadow-lg z-10 min-w-[150px]",children:[e.jsx("button",{onClick:()=>{o(t.id,"assigned"),i(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:e.jsx(h,{status:"assigned",size:"sm"})}),e.jsx("button",{onClick:()=>{o(t.id,"completed"),i(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:e.jsx(h,{status:"completed",size:"sm"})}),e.jsx("button",{onClick:()=>{o(t.id,"no_show"),i(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:e.jsx(h,{status:"no_show",size:"sm"})}),e.jsx("button",{onClick:()=>{o(t.id,"cancelled"),i(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:e.jsx(h,{status:"cancelled",size:"sm"})})]})]})]})]})})})};export{we as default};
//# sourceMappingURL=AssignmentsList.js.map
