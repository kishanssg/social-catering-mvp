import{j as e,L as _,r as b}from"./application.js";import{u as O}from"./useShifts.js";import{t as N,c as j,n as f,b as D,f as h,s as $}from"./format.js";import{e as L,M as Y,D as U,C as H}from"./map-pin.js";import{S as I}from"./ShiftStatusBadge.js";import{X as R}from"./x.js";import{C as M,a as z}from"./clock.js";import{U as K}from"./users.js";import{U as B}from"./user-plus.js";import{P as V}from"./plus.js";import{C as G}from"./calendar.js";import"./shiftsApi.js";import"./api.js";import"./createLucideIcon.js";function C(t,l,r){const a=N(t,r?.in);if(isNaN(l))return j(t,NaN);if(!l)return a;const d=a.getDate(),n=j(t,a.getTime());n.setMonth(a.getMonth()+l+1,0);const s=n.getDate();return d>=s?n:(a.setFullYear(n.getFullYear(),n.getMonth(),d),a)}function X(t,l,r){const[a,d]=f(r?.in,t,l);return+D(a)==+D(d)}function S(t,l){const r=N(t,l?.in),a=r.getMonth();return r.setFullYear(r.getFullYear(),a+1,0),r.setHours(23,59,59,999),r}function q(t,l){const[r,a]=f(t,l.start,l.end);return{start:r,end:a}}function J(t,l){const{start:r,end:a}=q(l?.in,t);let d=+r>+a;const n=d?+r:+a,s=d?a:r;s.setHours(0,0,0,0);let i=1;const o=[];for(;+s<=n;)o.push(j(r,s)),s.setDate(s.getDate()+i),s.setHours(0,0,0,0);return d?o.reverse():o}function T(t,l){const r=N(t,l?.in);return r.setDate(1),r.setHours(0,0,0,0),r}function Q(t,l,r){const[a,d]=f(r?.in,t,l);return a.getFullYear()===d.getFullYear()&&a.getMonth()===d.getMonth()}function Z(t,l,r){return C(t,-1,r)}const ee=t=>{const l=T(t),r=S(t),a=$(l,{weekStartsOn:0}),d=L(r,{weekStartsOn:0}),n=J({start:a,end:d}),s=new Date;return n.map(i=>({date:i,isCurrentMonth:Q(i,t),isToday:X(i,s)}))},se=t=>h(t,"MMMM yyyy"),te=t=>Z(t),ae=t=>C(t,1),k=t=>h(t,"yyyy-MM-dd"),re=()=>["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ne=({date:t,isCurrentMonth:l,isToday:r,shifts:a,onClick:d})=>{const n=h(t,"d"),s=a.filter(x=>x.status==="published"),i=a.filter(x=>x.status==="draft"),o=s.some(x=>(x.assignments?.length||0)<x.capacity),u=s.some(x=>(x.assignments?.length||0)>=x.capacity),p=a.reduce((x,g)=>x+(g.assignments?.length||0),0),y=a.length>0?`${a.length} shift${a.length!==1?"s":""} - Click to view details`:"";return e.jsxs("button",{onClick:()=>d(t),title:y,className:`
        min-h-[80px] sm:min-h-[120px] p-1 sm:p-2 border border-gray-200 
        hover:bg-gray-50 transition-colors flex flex-col items-start relative
        ${l?"bg-white":"bg-gray-50 text-gray-400"}
        ${r?"ring-2 ring-blue-500 ring-inset bg-blue-50":""}
        ${a.length>0?"hover:border-blue-300":""}
      `,children:[e.jsx("div",{className:`
        text-xs sm:text-sm font-semibold mb-1 sm:mb-2 flex items-center justify-center
        ${r?"bg-blue-600 text-white rounded-full h-5 w-5 sm:h-6 sm:w-6":""}
      `,children:n}),a.length>0&&e.jsxs("div",{className:"w-full space-y-0.5 sm:space-y-1",children:[s.length>0&&e.jsxs("div",{className:`text-xs px-1 sm:px-2 py-0.5 sm:py-1 rounded ${o?"bg-yellow-100 text-yellow-800 border border-yellow-200":u?"bg-green-100 text-green-800 border border-green-200":"bg-blue-100 text-blue-800 border border-blue-200"}`,children:[s.length," ",o?"needs staff":u?"filled":"published"]}),i.length>0&&e.jsxs("div",{className:"text-xs px-1 sm:px-2 py-0.5 sm:py-1 rounded bg-gray-100 text-gray-800 border border-gray-200",children:[i.length," draft"]}),p>0&&e.jsxs("div",{className:"text-xs text-gray-600 mt-0.5 sm:mt-1",children:[p," worker",p!==1?"s":""]}),a.length>2&&e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5 sm:mt-1",children:["+",a.length-2," more"]})]}),a.length>0&&e.jsx("div",{className:"absolute top-1 right-1 w-2 h-2 bg-blue-500 rounded-full opacity-0 group-hover:opacity-100 transition-opacity"})]})},le=({days:t,shifts:l,onDayClick:r})=>{const a=re(),d=l.reduce((s,i)=>{const o=h(new Date(i.start_time_utc),"yyyy-MM-dd");return s[o]||(s[o]=[]),s[o].push(i),s},{}),n=s=>{const i=h(s,"yyyy-MM-dd");return d[i]||[]};return e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"grid grid-cols-7 border-b border-gray-200",children:a.map(s=>e.jsx("div",{className:"py-3 text-center text-sm font-semibold text-gray-700 bg-gray-50",children:s},s))}),e.jsx("div",{className:"grid grid-cols-7",children:t.map((s,i)=>e.jsx(ne,{date:s.date,isCurrentMonth:s.isCurrentMonth,isToday:s.isToday,shifts:n(s.date),onClick:r},i))})]})},de=({date:t,shifts:l,onClose:r})=>{const a=n=>{try{return h(new Date(n),"h:mm a")}catch{return n}},d=[...l].sort((n,s)=>new Date(n.start_time_utc).getTime()-new Date(s.start_time_utc).getTime());return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:h(t,"EEEE, MMMM d, yyyy")}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[l.length," ",l.length===1?"shift":"shifts"," scheduled"]})]}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",children:e.jsx(R,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:l.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(M,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No shifts scheduled for this day"})]}):e.jsx("div",{className:"space-y-4",children:d.map(n=>{const s=n.assignments?.length||0,i=s<n.capacity;return e.jsxs(_,{to:`/shifts/${n.id}`,className:"block bg-white border rounded-lg p-5 hover:border-blue-500 hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:n.client_name}),e.jsx("p",{className:"text-sm text-gray-600",children:n.role_needed})]}),e.jsx(I,{status:n.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsxs("span",{children:[a(n.start_time_utc)," - ",a(n.end_time_utc)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsxs("span",{className:i?"text-yellow-600 font-medium":"text-green-600 font-medium",children:[s,"/",n.capacity," assigned"]})]}),n.location&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{className:"truncate",children:n.location})]}),n.pay_rate&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsxs("span",{children:["$",n.pay_rate,"/hr"]})]})]}),s>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"Assigned Workers:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.assignments?.slice(0,3).map(o=>e.jsxs("span",{className:"px-2 py-1 text-xs bg-blue-50 text-blue-700 rounded",children:[o.worker?.first_name||"Worker"," ",o.worker?.last_name||o.worker_id||"Unknown"]},o.id)),s>3&&e.jsxs("span",{className:"px-2 py-1 text-xs text-gray-500",children:["+",s-3," more"]})]})]}),i&&n.status==="published"&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-yellow-700 bg-yellow-50 px-3 py-2 rounded",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsxs("span",{children:["Needs ",n.capacity-s," more ",n.capacity-s===1?"worker":"workers"]})]})]},n.id)})})}),e.jsx("div",{className:"flex items-center justify-end p-6 border-t bg-gray-50",children:e.jsx("button",{onClick:r,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Close"})})]})})},we=()=>{const[t,l]=b.useState(new Date),[r,a]=b.useState(null),d=T(t),n=S(t),{shifts:s,loading:i,error:o}=O({start_date:k(d),end_date:k(n)}),u=ee(t),y=(c=>{if(!c)return[];const m=h(c,"yyyy-MM-dd");return s.filter(A=>h(new Date(A.start_time_utc),"yyyy-MM-dd")===m)})(r);b.useEffect(()=>{const c=m=>{m.key==="ArrowLeft"?x():m.key==="ArrowRight"?g():m.key==="t"||m.key==="T"?v():m.key==="Escape"&&r&&a(null)};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[r,t]);const x=()=>{l(te(t))},g=()=>{l(ae(t))},v=()=>{l(new Date)},E=c=>{a(c)},w=s.length,F=s.filter(c=>c.status==="published").length,P=s.filter(c=>(c.assignments?.length||0)<c.capacity&&c.status==="published").length,W=s.reduce((c,m)=>c+(m.assignments?.length||0),0);return i?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-48 animate-pulse mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-64 animate-pulse"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex gap-3",children:Array.from({length:4}).map((c,m)=>e.jsxs("div",{className:"bg-gray-200 rounded-lg px-4 py-3 animate-pulse min-w-[80px]",children:[e.jsx("div",{className:"h-6 bg-gray-300 rounded mb-1"}),e.jsx("div",{className:"h-3 bg-gray-300 rounded w-12"})]},m))}),e.jsx("div",{className:"h-10 bg-gray-200 rounded-lg w-32 animate-pulse"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"h-10 w-10 bg-gray-200 rounded-lg animate-pulse"}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-32 animate-pulse"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-48 animate-pulse"})]}),e.jsx("div",{className:"h-10 w-10 bg-gray-200 rounded-lg animate-pulse"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-16 animate-pulse mb-3"}),e.jsx("div",{className:"flex flex-wrap gap-4",children:Array.from({length:5}).map((c,m)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20 animate-pulse"})]},m))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"grid grid-cols-7 border-b border-gray-200",children:Array.from({length:7}).map((c,m)=>e.jsx("div",{className:"py-3 text-center",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-8 mx-auto animate-pulse"})},m))}),e.jsx("div",{className:"grid grid-cols-7",children:Array.from({length:35}).map((c,m)=>e.jsxs("div",{className:"min-h-[120px] p-2 border border-gray-200 bg-white",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-6 animate-pulse mb-2"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 animate-pulse"})]})]},m))})]})]}):o?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800",children:o})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Calendar"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Visual overview of all shifts and assignments"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex gap-2 sm:gap-3 overflow-x-auto pb-2 sm:pb-0",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg px-3 sm:px-4 py-2 sm:py-3 text-center min-w-[70px] sm:min-w-[80px]",children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold text-blue-600",children:w}),e.jsx("div",{className:"text-xs text-blue-700 mt-1",children:"Total"})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg px-3 sm:px-4 py-2 sm:py-3 text-center min-w-[70px] sm:min-w-[80px]",children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold text-yellow-600",children:P}),e.jsx("div",{className:"text-xs text-yellow-700 mt-1",children:"Need Staff"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg px-3 sm:px-4 py-2 sm:py-3 text-center min-w-[70px] sm:min-w-[80px]",children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold text-green-600",children:F}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"Published"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg px-3 sm:px-4 py-2 sm:py-3 text-center min-w-[70px] sm:min-w-[80px]",children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold text-purple-600",children:W}),e.jsx("div",{className:"text-xs text-purple-700 mt-1",children:"Workers"})]})]}),e.jsxs(_,{to:"/shifts/new",className:"btn-primary flex items-center gap-2 w-full sm:w-auto justify-center",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{children:"Create Shift"})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:x,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Previous month",children:e.jsx(H,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:se(t)}),e.jsx("button",{onClick:v,className:"px-3 py-1 text-sm btn-primary",children:"Today"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 rounded",children:"←"})," /",e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 rounded",children:"→"})," Navigate months •",e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 rounded",children:"T"})," Today"]})]}),e.jsx("button",{onClick:g,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Next month",children:e.jsx(z,{className:"h-6 w-6"})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Legend"}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-yellow-100 border border-yellow-200"}),e.jsx("span",{className:"text-gray-700",children:"Needs Workers"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-blue-100 border border-blue-200"}),e.jsx("span",{className:"text-gray-700",children:"Published"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-green-100 border border-green-200"}),e.jsx("span",{className:"text-gray-700",children:"Fully Staffed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-gray-100 border border-gray-200"}),e.jsx("span",{className:"text-gray-700",children:"Draft"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded border-2 border-blue-500"}),e.jsx("span",{className:"text-gray-700",children:"Today"})]})]})]}),e.jsx(le,{days:u,shifts:s,onDayClick:E}),w===0&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(G,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No shifts this month"}),e.jsx("p",{className:"text-gray-500",children:"Create shifts to see them on the calendar"})]}),r&&e.jsx(de,{date:r,shifts:y,onClose:()=>a(null)})]})};export{we as default};
//# sourceMappingURL=CalendarView.js.map
